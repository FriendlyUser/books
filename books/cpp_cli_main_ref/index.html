<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- favicon -->
    <link rel="shortcut icon" href="/images/favicon.png">
    <!-- theme meta -->
    <meta name="theme-name" content="pinwheel-astro">
    <meta name="msapplication-TileColor" content="#000000">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479144310234386" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6">

  </script>
  
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
    <meta name="generator" content="Astro v2.6.6">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- google font css -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&#38;family=Merriweather:wght@700;900&#38;display=swap" rel="stylesheet">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
		<script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>

    <!-- responsive meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">

    <!-- title -->
    <title>
      Introduction to C++ and Command Line Applications
    </title>

    <!-- canonical url -->
    

    <!-- noindex robots -->
    

    <!-- meta-description -->
    <meta name="description" content="Implementing core linux command line applications in C++">

    <!-- author from config.json -->
    <meta name="author" content="FriendlyUser">

    <!-- og-title -->
    <meta property="og:title" content="Introduction to C++ and Command Line Applications">

    <!-- og-description -->
    <meta property="og:description" content="Implementing core linux command line applications in C++">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pinwheel-astro.vercel.app/books/cpp_cli_main_ref/">

    <!-- twitter-title -->
    <meta name="twitter:title" content="Introduction to C++ and Command Line Applications">

    <!-- twitter-description -->
    <meta name="twitter:description" content="Implementing core linux command line applications in C++">

    <!-- og-image -->
    <meta property="og:image" content="https://pinwheel-astro.vercel.app/images/og-image.png">

    <!-- twitter-image -->
    <meta name="twitter:image" content="https://pinwheel-astro.vercel.app/images/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
  <link rel="stylesheet" href="/_astro/_single_.db0af2d4.css" />
<link rel="stylesheet" href="/_astro/404.99013387.css" /><script type="module" src="/_astro/hoisted.f0b9be19.js"></script></head>
  <body>
    
    <header class="header">
  <nav class="navbar container">
    <!-- logo -->
    <div class="order-0">
      <a href="/" class="navbar-brand block">
  <img alt="Pinwheel Astro" style="height:31px;width:147px" width="294" height="62" src="/_astro/logo_ZThIBR.png" loading="lazy" decoding="async">
</a>
    </div>
    <!-- navbar toggler -->
    <input id="nav-toggle" type="checkbox" class="hidden">
    <label id="show-button" for="nav-toggle" class="order-2 flex cursor-pointer items-center lg:order-1 lg:hidden">
      <svg class="h-6 fill-current" viewBox="0 0 20 20">
        <title>Menu Open</title>
        <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path>
      </svg>
    </label>
    <label id="hide-button" for="nav-toggle" class="order-2 hidden cursor-pointer items-center lg:order-1">
      <svg class="h-6 fill-current" viewBox="0 0 20 20">
        <title>Menu Close</title>
        <polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"></polygon>
      </svg>
    </label>
    <!-- /navbar toggler -->

    <ul id="nav-menu" class="navbar-nav order-3 hidden w-full lg:order-1 lg:flex lg:w-auto lg:space-x-2">
      <li class="nav-item">
                <a href="/" class="nav-link inline-block lg:block false">
                  Home
                </a>
              </li><li class="nav-item">
                <a href="/books" class="nav-link inline-block lg:block false">
                  Books
                </a>
              </li><li class="nav-item">
                <a href="/contact" class="nav-link inline-block lg:block false">
                  Contact
                </a>
              </li>
      <li class="nav-item mt-2 lg:hidden">
        <a class="btn btn-white btn-sm border-border" href="/books">
          View Books</a>
      </li>
    </ul>
    <div class="order-1 ml-auto hidden items-center md:order-2 md:ml-0 lg:flex">
      <a class="btn btn-white btn-sm" href="/signin"> View Books</a>
    </div>
  </nav>
</header>
<script>
  const button = document.getElementById("dropdown-button");
  button.addEventListener("click", () => {
    const dropdown = document.getElementById("dropdown");
    dropdown.classList.toggle(dropdown.style === "hidden" ? "block" : "hidden");
  });

  //sticky header
  const header = document.querySelector(".header");
  window.addEventListener("scroll", () => {
    const scrollY = window.scrollY;
    if (scrollY > 0) {
      header.classList.add("header-sticky");
    } else {
      header.classList.remove("header-sticky");
    }
  });
</script>
    <main id="main-content">
      
  <section class="section blog-single">
    <div class="container">
      <div class="row justify-center">
        <div class="lg:col-10">
          <img class="w-full rounded-xl" alt="" width="920" height="450" src="/_astro/3847215807_Z1jkxpi.png" loading="lazy" decoding="async">
        </div>
        <div class="mt-10 max-w-[810px] lg:col-9">
          <h1 class="h2">
            Introduction to C++ and Command Line Applications
          </h1>
          <div class="mb-5 mt-6 flex items-center space-x-2">
            <ul class="mb-4">
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 104c-53 0-96 43-96 96s43 96 96 96 96-43 96-96-43-96-96-96zm0 144c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm0-240C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-49.7 0-95.1-18.3-130.1-48.4 14.9-23 40.4-38.6 69.6-39.5 20.8 6.4 40.6 9.6 60.5 9.6s39.7-3.1 60.5-9.6c29.2 1 54.7 16.5 69.6 39.5-35 30.1-80.4 48.4-130.1 48.4zm162.7-84.1c-24.4-31.4-62.1-51.9-105.1-51.9-10.2 0-26 9.6-57.6 9.6-31.5 0-47.4-9.6-57.6-9.6-42.9 0-80.6 20.5-105.1 51.9C61.9 339.2 48 299.2 48 256c0-110.3 89.7-200 200-200s200 89.7 200 200c0 43.2-13.9 83.2-37.3 115.9z"></path></svg>
                
              </li>

              <!-- <li class="mr-4 inline-block">
                <FaRegCalendarAlt className={"mr-2 -mt-1 inline-block"} />
                {dateFormat(post.data?.pubDate)}
              </li> -->
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg>
                61 Mins read
              </li>
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"></path></svg>
                
              </li>
            </ul>
          </div>

          <div class="content">
            <div id="search" class="ml-3 p-4 -mt-8"></div>
            <article id="article">
              <h1 id="chapter-1-introduction-to-c-and-command-line-applications">Chapter 1: Introduction to C++ and Command Line Applications</h1>
<p>Why C++ is a good choice for building command line applications?
C++ is a good choice for building command line applications because it is a fast, efficient, and powerful programming language that allows for low-level memory manipulation, making it well-suited for developing system-level applications. Additionally, C++ provides access to a wide range of libraries and tools that make it easy to create complex command line applications. C++ is also portable and can be compiled to run on different operating systems, making it a versatile choice for developers who need to build command line applications that can be used across different platforms.</p>
<p>Basic concepts and tools for building command line applications in C++
Building command line applications in C++ requires a basic understanding of a few key concepts and tools:</p>
<ol>
<li>Command line arguments: Command line applications typically take input in the form of command line arguments, which are passed to the program when it is executed. In C++, command line arguments are passed to the <code>main</code> function as an array of character pointers, with the first argument being the name of the program itself.</li>
<li>Standard input and output: Command line applications typically interact with the user through standard input (stdin) and standard output (stdout), which can be accessed using the <code>cin</code> and <code>cout</code> objects in C++.</li>
<li>Text processing: Command line applications often involve processing text input, such as parsing command line arguments or reading input from a file. C++ provides a rich set of string manipulation functions and libraries, such as <code>std::string</code> and <code>std::regex</code>, to make it easy to work with text data.</li>
<li>File I/O: Command line applications often need to read from and write to files. C++ provides a variety of functions and classes for file I/O, such as <code>std::ifstream</code> and <code>std::ofstream</code>.</li>
<li>Build tools: To compile and build C++ command line applications, developers typically use build tools such as make, cmake, or a C++ compiler such as GCC or Clang. These tools help automate the build process, manage dependencies, and generate executable files.</li>
</ol>
<p>By mastering these key concepts and tools, developers can build powerful and efficient command line applications in C++.</p>
<h1 id="chapter-2-building-a-tail-command">Chapter 2: Building a Tail Command</h1>
<p>Overview of the tail command and its functionality
The <code>tail</code> command is a common Unix/Linux command-line utility used to display the last few lines of a file or input stream. It can be used to quickly view the end of a large file or to monitor changes to a log file in real time.</p>
<p>The basic syntax for the <code>tail</code> command is as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">tail [options] [filename]</span></span></code></pre>
<p>Here, <code>options</code> are optional command line arguments that modify the behavior of the <code>tail</code> command, and <code>filename</code> is the name of the file to display the last few lines of. If <code>filename</code> is not specified, <code>tail</code> reads from standard input.</p>
<p>Some common options for the <code>tail</code> command include:</p>
<ul>
<li><code>-n</code> or <code>--lines</code>: Specifies the number of lines to display from the end of the file. For example, <code>tail -n 10 myfile.txt</code> will display the last 10 lines of <code>myfile.txt</code>.</li>
<li><code>-f</code> or <code>--follow</code>: Continuously display the last few lines of the file, updating the display as new lines are added to the file. This is useful for monitoring log files in real time.</li>
<li><code>- or</code>—bytes<code>: Specifies the number of bytes to display from the end of the file, rather than lines. For example,</code>tail -c 100 myfile.txt<code>will display the last 100 bytes of</code>myfile.txt`.</li>
</ul>
<p>The <code>tail</code> command is a simple yet powerful tool for working with files and input streams in a command-line environment.</p>
<p>Designing the C++ implementation of the tail command
The implementation of the <code>tail</code> command in C++ would involve the following steps:</p>
<ol>
<li>Parse command line arguments: The <code>arg and</code>argv<code>parameters passed to the</code>main<code>function can be used to parse the command line arguments. The</code>-n<code>and</code>-f` options would need to be recognized, and the number of lines to display would need to be stored in a variable.</li>
<li>Open the file: If a filename is provided as an argument, the program should attempt to open the file using the <code>std::ifstream</code> class.</li>
<li>Read the file: If the file is successfully opened, the program should read the last <code>n</code> lines of the file, where <code>n</code> is the number of lines specified by the <code>-n</code> option. This can be done by reading the file line by line, storing each line in a circular buffer of size <code>n</code>, and overwriting the oldest line when the buffer is full.</li>
<li>Display the output: Once the last <code>n</code> lines of the file have been read, they can be displayed to the user using the <code>std::cout</code> object.</li>
<li>Monitor the file (optional): If the <code>-f</code> option is specified, the program should enter a loop that continuously reads new lines from the file and displays them to the user as they are added. This can be done by using the <code>std::getline</code> function to read new lines from the file and appending them to the circular buffer.</li>
<li>Close the file: Once the program is finished reading from the file, it should be closed using the <code>std::ifstream::close</code> function.</li>
</ol>
<p>Overall, the implementation of the <code>tail</code> command in C++ involves reading and processing input from the command line, reading and writing files, and manipulating strings and data structures to store and display the desired output.</p>
<p>Reading and processing the input file
To read and process the input file in the implementation of the <code>tail</code> command in C++, the following steps can be taken:</p>
<ol>
<li>Open the file: To open the file, we can use the <code>std::ifstream</code> class. Here’s an example of how to open the file named <code>filename.txt</code>:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">std::</span><span style="color: #E5C07B">ifstream</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">input_file</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"filename.txt"</span><span style="color: #ABB2BF">);</span></span></code></pre>
<ol start="2">
<li>Check if the file is open: It’s always a good idea to check if the file was opened successfully. We can do this using the <code>is_open()</code> method of the <code>std::ifstream</code> class:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">input_file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is_open</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: could not open file.</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>If the file cannot be opened, an error message is printed to <code>std::cerr</code> and the program returns with a non-zero exit code (in this case, 1).</p>
<ol start="3">
<li>Read the file line by line: We can read the file line by line using the <code>std::getline()</code> function. Here’s an example of how to read a line from the file:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">std::string line;</span></span>
<span class="line"><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">getline</span><span style="color: #ABB2BF">(input_file, line)) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Process the line here</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This loop reads each line of the file and stores it in the <code>line</code> variable. Inside the loop, we can process the line as needed (e.g. store it in a circular buffer or print it to <code>std::cout</code>).</p>
<ol start="4">
<li>Close the file: Once we’re finished reading from the file, we should close it using the <code>close()</code> method of the <code>std::ifstream</code> class:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E5C07B">input_file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span></code></pre>
<p>Overall, these steps allow us to open, read, and process the input file in the implementation of the <code>tail</code> command in C++.</p>
<p>Implementing the tail functionality
To implement the <code>tail</code> functionality in C++, we need to read the last <code>n</code> lines of a file. We can do this using a circular buffer to store the last <code>n</code> lines as we read them. Here’s an example of how to implement the <code>tail</code> function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;fstream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;vector></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">*</span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> n </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // Default number of lines to display</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string filename;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Parse command line arguments</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> argc; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">string</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i]) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"-n"</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (i </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> argc) {</span></span>
<span class="line"><span style="color: #ABB2BF"> n </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">stoi</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF"> i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> filename </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i];</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Open the file</span></span>
<span class="line"><span style="color: #ABB2BF"> std::ifstream </span><span style="color: #61AFEF">input_file</span><span style="color: #ABB2BF">(filename);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">input_file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is_open</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: could not open file.</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Create a circular buffer to store the last n lines</span></span>
<span class="line"><span style="color: #ABB2BF"> std::vector</span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF">std::string</span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">lines</span><span style="color: #ABB2BF">(n);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Read the file line by line</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string line;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> index </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">getline</span><span style="color: #ABB2BF">(input_file, line)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[index] </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> line;</span></span>
<span class="line"><span style="color: #ABB2BF"> index </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> (index </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> n;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Display the last n lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> n; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[index] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> index </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> (index </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> n;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Close the file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">input_file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This implementation parses the command line arguments to determine the filename and the number of lines to display (defaulting to 10 if not specified). It then opens the file, creates a circular buffer of size <code>n</code>, and reads the file line by line, storing each line in the buffer and overwriting the oldest line when the buffer is full. Finally, it displays the last <code>n</code> lines of the file to <code>std::cout</code> and closes the file.</p>
<p>Note that this implementation assumes that the input file contains at least <code>n</code> lines. If the file contains fewer than <code>n</code> lines, the program will still display the last <code>n</code> lines, but the earlier lines will be empty. To handle this case, we could count the number of lines in the file before reading it and adjust <code>n</code> accordingly.</p>
<p>Outputting the results to the console
To output the results of the <code>tail</code> command to the console, we can use the <code>std::cout</code> object. In the implementation I provided earlier, the last <code>n</code> lines of the file are displayed using the following loop:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> n; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[index] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> index </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> (index </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> n;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This loop prints each line of the circular buffer to <code>std::cout</code>, starting with the oldest line and ending with the newest line.</p>
<p>The <code>&#x3C;&#x3C;</code> operator is used to output each line to <code>std::cout</code>. In this case, we’re outputting each line followed by a newline character (<code>'\n'</code>) to ensure that each line is printed on a separate line in the console.</p>
<p>Once the loop is complete, the <code>tail</code> command has finished executing and the program can exit.</p>
<p>Testing the tail command
To test the <code>tail</code> command, we can create a test file with some sample data and run the command on that file. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">$ cat </span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">test</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">1</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">2</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">3</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">4</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">5</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">6</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">7</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">8</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">9</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">10</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">11</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">12</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">13</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">14</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">15</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">16</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">17</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">18</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">19</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">20</span></span>
<span class="line"><span style="color: #56B6C2">^</span><span style="color: #ABB2BF">D</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">$ tail </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">n </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">test</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">16</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">17</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">18</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">19</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">20</span></span></code></pre>
<p>In this example, we create a file called <code>test.txt</code> with 20 lines of text. We then run the <code>tail</code> command on this file, specifying <code>-n 5</code> to display the last 5 lines of the file.</p>
<p>The output of the <code>tail</code> command is the last 5 lines of the file, starting with <code>line 16</code> and ending with <code>line 20</code>, which is what we expected.</p>
<p>We can also test the <code>tail</code> command with different values of <code>n</code> to ensure that it works correctly for different numbers of lines. For example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">$ tail </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">n </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">test</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">11</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">12</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">13</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">14</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">15</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">16</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">17</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">18</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">19</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">20</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">$ tail </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">n </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">test</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">18</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">19</span></span>
<span class="line"><span style="color: #ABB2BF">line </span><span style="color: #D19A66">20</span></span></code></pre>
<p>In both of these examples, the <code>tail</code> command produces the expected output, demonstrating that our implementation of the command is correct.</p>
<h1 id="chapter-3-building-a-head-command">Chapter 3: Building a Head Command</h1>
<p>Overview of the head command and its functionality
The <code>head</code> command is a Unix utility that is used to display the first <code>n</code> lines of a file or input stream. By default, it displays the first 10 lines of the file or input stream.</p>
<p>The syntax of the <code>head</code> command is as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">head [</span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">n </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF">number</span><span style="color: #C678DD">></span><span style="color: #ABB2BF">] [</span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF">file</span><span style="color: #C678DD">></span><span style="color: #ABB2BF">...]</span></span></code></pre>
<p>where <code>number</code> is the number of lines to display, and <code>file</code> is the name of the file to display the lines from. If no file is specified, the command reads from standard input.</p>
<p>The <code>head</code> command reads the specified input file or standard input and outputs the first <code>n</code> lines of the file to standard output. If the input file has fewer than <code>n</code> lines, all of the lines are displayed.</p>
<p>The <code>head</code> command can be used with various options to modify its behavior. For example, the <code>- option can be used to display the first</code>n<code>bytes of a file instead of the first</code>n` lines.</p>
<p>The <code>head</code> command is useful for quickly previewing the contents of a file or displaying the beginning of a large file without having to load the entire file into memory.</p>
<p>Designing the C++ implementation of the head command
The C++ implementation of the <code>head</code> command will be similar to that of the <code>tail</code> command we designed earlier. Here are the basic steps we can follow:</p>
<ol>
<li>Parse the command line arguments to determine the number of lines to display and the name of the input file, if any.</li>
<li>If an input file is specified, open the file for reading. If no input file is specified, use standard input as the input stream.</li>
<li>Read the input file or standard input line by line, storing each line in a circular buffer of size <code>n</code> (where <code>n</code> is the number of lines to display).</li>
<li>After all lines have been read, print the first <code>n</code> lines from the circular buffer to standard output.</li>
</ol>
<p>Here’s some sample code to get us started:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;fstream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;vector></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> n </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // Default number of lines to display</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string filename;</span><span style="color: #7F848E; font-style: italic"> // Input file name</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Parse command line arguments</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> argc; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string arg </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (arg </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"-n"</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Next argument is the number of lines to display</span></span>
<span class="line"><span style="color: #ABB2BF"> i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (i </span><span style="color: #C678DD">>=</span><span style="color: #ABB2BF"> argc) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: -n option requires a number argument"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> n </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">stoi</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i]);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Assume this argument is the input file name</span></span>
<span class="line"><span style="color: #ABB2BF"> filename </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> arg;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Open input file or use standard input</span></span>
<span class="line"><span style="color: #ABB2BF"> std::istream</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> input;</span></span>
<span class="line"><span style="color: #ABB2BF"> std::ifstream file;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">filename</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">empty</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> input </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">std::cin;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">(filename);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is_open</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: could not open file "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> filename </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> input </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">file;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Read input file or standard input line by line</span></span>
<span class="line"><span style="color: #ABB2BF"> std::vector</span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF">std::string</span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">lines</span><span style="color: #ABB2BF">(n);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> index </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string line;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">getline</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF">input, line)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[index] </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> line;</span></span>
<span class="line"><span style="color: #ABB2BF"> index </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> (index </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> n;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Print first n lines from circular buffer</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> n; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[index] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> index </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> (index </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> n;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Clean up</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is_open</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code should provide a basic implementation of the <code>head</code> command that reads the input file or standard input and displays the first <code>n</code> lines of the file to standard output. We can test this implementation using the same approach we used for testing the <code>tail</code> command.</p>
<p>Reading and processing the input file
To read and process the input file in the <code>head</code> command, we need to modify the code we wrote earlier to read and process the input file in the <code>tail</code> command.</p>
<p>Here’s the updated code for reading and processing the input file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Read input file or standard input line by line</span></span>
<span class="line"><span style="color: #ABB2BF">std::</span><span style="color: #E5C07B">vector</span><span style="color: #ABB2BF">&#x3C;std::</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">> </span><span style="color: #61AFEF">lines</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">n</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> index </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">std::string line;</span></span>
<span class="line"><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">getline</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF">input, line)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[index] </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> line;</span></span>
<span class="line"><span style="color: #ABB2BF"> index </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> (index </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> n;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we use a vector of strings to store the last <code>n</code> lines of the input file. We initialize the vector with size <code>n</code>, and we use a circular buffer approach to store the last <code>n</code> lines of the file. We read each line from the input stream using <code>std::getline()</code>, and we store each line in the next available slot in the vector. Once we have read all the lines from the input file, we can proceed to the next step of printing the first <code>n</code> lines of the file.</p>
<p>If we are reading from standard input, the code above will read from standard input until the user terminates input (e.g., by pressing Ctrl+D on Unix-based systems or Ctrl+Z on Windows systems).</p>
<p>Implementing the head functionality
Now that we have read and processed the input file, we can implement the <code>head</code> functionality. The <code>head</code> command prints the first <code>n</code> lines of the input file.</p>
<p>Here’s the C++ code to implement the <code>head</code> functionality:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Print the first n lines of the file</span></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> n; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[i] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we use a for loop to print the first <code>n</code> lines of the input file. We simply iterate over the first <code>n</code> elements of the <code>lines</code> vector and print each line to standard output using <code>std::cout</code>. We add a newline character at the end of each line using <code>std::endl</code> to ensure that each line is printed on a separate line.</p>
<p>We can also add error handling to this code to handle the case where the input file has fewer than <code>n</code> lines. In this case, we can simply print all the lines in the input file. Here’s the updated code with error handling:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Print the first n lines of the file</span></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> n </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> index; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[i] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// If input file has fewer than n lines, print all lines</span></span>
<span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (index </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> n) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> index; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[i] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this updated code, we use <code>index</code> to determine the number of lines in the input file. If <code>index</code> is less than <code>n</code>, then the input file has fewer than <code>n</code> lines. In this case, we print all the lines in the input file using another for loop.</p>
<p>Outputting the results to the console
Now that we have implemented the <code>head</code> functionality, we need to output the results to the console.</p>
<p>Here’s the C++ code to output the results to the console:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Output the results to the console</span></span>
<span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (output_file </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">""</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Output to console</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Printing the first "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> n </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" lines of the input file:"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> n </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> index; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[i] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (index </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> n) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> index; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[i] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Output to file</span></span>
<span class="line"><span style="color: #ABB2BF"> std::ofstream </span><span style="color: #61AFEF">output</span><span style="color: #ABB2BF">(output_file);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> n </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> index; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> output </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[i] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (index </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> n) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> index; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> output </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">[i] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"The first "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> n </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" lines of the input file have been written to "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> output_file </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we first check if the <code>output_file</code> variable is empty. If it is empty, we output the results to the console using <code>std::cout</code>. We first print a message to the console indicating that we are printing the first <code>n</code> lines of the input file. Then, we use a for loop to print the first <code>n</code> lines of the input file to the console. If the input file has fewer than <code>n</code> lines, we print all the lines in the input file.</p>
<p>If the <code>output_file</code> variable is not empty, we output the results to a file using <code>std::ofstream</code>. We first open the output file using the <code>output_file</code> variable, and then we use a for loop to output the first <code>n</code> lines of the input file to the output file. If the input file has fewer than <code>n</code> lines, we output all the lines in the input file to the output file. Finally, we print a message to the console indicating that the results have been written to the output file, and we close the output file.</p>
<p>Note that in both cases, we add a newline character at the end of each line using <code>std::endl</code> to ensure that each line is printed on a separate line.</p>
<p>Testing the head command
To test the <code>head</code> command, we can create a sample file with some lines of text and then use the <code>head</code> command to print the first few lines of the file to the console or to an output file.</p>
<p>Here’s an example of how we can test the <code>head</code> command:</p>
<ol>
<li>Create a file named <code>sample.txt</code> and add the following lines of text:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">This is the first line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the second line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the third line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the fourth line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the fifth line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the sixth line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the seventh line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the eighth line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the ninth line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the tenth line of the file.</span></span></code></pre>
<ol start="2">
<li>Open a command prompt or terminal window and navigate to the directory where the <code>head</code> executable is located.</li>
<li>To print the first 5 lines of the file to the console, run the following command:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">.</span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">head </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">n </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">sample</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>This should output the following to the console:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">Printing the first </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> lines of the input file:</span></span>
<span class="line"><span style="color: #ABB2BF">This is the first line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the second line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the third line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the fourth line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the fifth line of the file.</span></span></code></pre>
<ol start="4">
<li>To write the first 5 lines of the file to an output file named <code>output.txt</code>, run the following command:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">.</span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">head </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">n </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">sample</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">o </span><span style="color: #E5C07B">output</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>This should write the first 5 lines of the file to an output file named <code>output.txt</code> and output the following to the console:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">The first </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> lines of the input file have been written to </span><span style="color: #E5C07B">output</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<ol start="5">
<li>To verify that the output file contains the correct output, open the <code>output.txt</code> file and verify that it contains the following lines:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">This is the first line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the second line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the third line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the fourth line of the file.</span></span>
<span class="line"><span style="color: #ABB2BF">This is the fifth line of the file.</span></span></code></pre>
<h1 id="chapter-4-building-a-du-command">Chapter 4: Building a Du Command</h1>
<p>Overview of the du command and its functionality
The <code>du</code> command in Linux and Unix operating systems is used to estimate and summarize the disk usage of a file system or a directory. It displays the disk space used by the files and directories in the specified directory or file system.</p>
<p>The <code>du</code> command can be used to display the disk usage in human-readable format or in bytes, kilobytes, megabytes, or gigabytes. It can also be used to display the disk usage of a single file or a directory tree.</p>
<p>The <code>du</code> command has several options, including <code>-h</code> for human-readable output, <code>-s</code> for summary output, <code>- for grand total output, and</code>-k<code>,</code>-m<code>, and</code>-g` for output in kilobytes, megabytes, and gigabytes, respectively.</p>
<p>Designing the C++ implementation of the du command
The <code>du</code> command can be implemented in C++ using the following steps:</p>
<ol>
<li>Parse the command-line arguments to determine the target directory or file and any additional options.</li>
<li>Traverse the directory tree starting from the target directory and calculate the total size of each file and subdirectory.</li>
<li>Optionally, filter the results based on any specified options, such as a maximum depth or minimum file size.</li>
<li>Format the output in the desired format, such as human-readable or in bytes, kilobytes, megabytes, or gigabytes.</li>
<li>Output the results to the console or to a file.</li>
</ol>
<p>To implement these steps, we can make use of the <code>filesystem</code> library in C++17 or later, which provides convenient functions for traversing directories and accessing file information. We can also use standard library functions for parsing command-line arguments, formatting output, and handling errors.</p>
<p>Reading and processing the input directory
To implement the <code>du</code> command in C++, we first need to read and process the input directory.</p>
<p>We can use the <code>filesystem</code> library to traverse the directory tree and access information about each file and directory. We can use the <code>recursive_directory_iterator</code> class to iterate over all files and subdirectories in the specified directory, and the <code>file_size</code> function to get the size of each file.</p>
<p>Here’s an example code snippet that reads the input directory and calculates the total size of all files:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;filesystem></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">namespace</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">filesystem</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Parse command-line arguments to get the target directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: du &#x3C;directory>"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string target_dir </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Traverse the directory tree and calculate the total size of all files</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> fs::path root_path </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> target_dir;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">uintmax_t</span><span style="color: #ABB2BF"> total_size </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> entry : fs::</span><span style="color: #61AFEF">recursive_directory_iterator</span><span style="color: #ABB2BF">(root_path)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is_regular_file</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> total_size </span><span style="color: #C678DD">+=</span><span style="color: #ABB2BF"> fs::</span><span style="color: #61AFEF">file_size</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">path</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Total size: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> total_size </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" bytes"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::exception</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> e) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">what</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we first parse the command-line arguments to get the target directory. We then use a <code>for</code> loop to iterate over all files and subdirectories in the target directory using the <code>recursive_directory_iterator</code>. For each file, we check if it is a regular file using the <code>is_regular_file</code> function, and if so, we add its size to the <code>total_size</code> variable using the <code>file_size</code> function.</p>
<p>Finally, we output the total size to the console in bytes. We also catch any exceptions that may occur, such as if the target directory does not exist or if there is a permission error.</p>
<p>Implementing the du functionality
To implement the <code>du</code> functionality in C++, we need to calculate the total size of each file and subdirectory in the specified directory. We also need to provide options for filtering the results, such as a maximum depth or minimum file size.</p>
<p>Here’s an example code snippet that implements the <code>du</code> functionality:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;filesystem></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;vector></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;algorithm></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">namespace</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">filesystem</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Function to calculate the total size of a directory</span></span>
<span class="line"><span style="color: #C678DD">uintmax_t</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">calculate_directory_size</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> fs::</span><span style="color: #E5C07B">path</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">max_depth</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">uintmax_t</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">min_size</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">is_directory</span><span style="color: #ABB2BF">(path)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">uintmax_t</span><span style="color: #ABB2BF"> total_size </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> current_depth </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Iterate over all files and subdirectories in the directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> entry : fs::</span><span style="color: #61AFEF">recursive_directory_iterator</span><span style="color: #ABB2BF">(path)) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Check if we have reached the maximum depth</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (max_depth </span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">depth</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> max_depth) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Check if the file meets the minimum size requirement</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is_regular_file</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">file_size</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">>=</span><span style="color: #ABB2BF"> min_size) {</span></span>
<span class="line"><span style="color: #ABB2BF"> total_size </span><span style="color: #C678DD">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">file_size</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> total_size;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Parse command-line arguments to get the target directory and options</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: du &#x3C;directory> [-d max-depth] [-s min-size]"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> std::string target_dir </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> max_depth </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">uintmax_t</span><span style="color: #ABB2BF"> min_size </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> argc; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string arg </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (arg </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"-d"</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> i </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> argc) {</span></span>
<span class="line"><span style="color: #ABB2BF"> max_depth </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">stoi</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF"> i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (arg </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"-s"</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> i </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> argc) {</span></span>
<span class="line"><span style="color: #ABB2BF"> min_size </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">stoull</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF"> i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Invalid option: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> arg </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Calculate the total size of the target directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> fs::path root_path </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> target_dir;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">uintmax_t</span><span style="color: #ABB2BF"> total_size </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">calculate_directory_size</span><span style="color: #ABB2BF">(root_path, max_depth, min_size);</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Total size: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> total_size </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" bytes"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::exception</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> e) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">what</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we first parse the command-line arguments to get the target directory and any options specified by the user. The <code>-d</code> option specifies the maximum depth to search for files, and the <code>-s</code> option specifies the minimum file size to include in the results.</p>
<p>We then define a <code>calculate_directory_size</code> function that takes a path to a directory, the maximum depth to search, and the minimum file size to include. The function iterates over all files and subdirectories in the directory using the <code>recursive_directory_iterator</code>, and checks if each file meets the criteria specified by the options. If a file meets the criteria, its size is added to the <code>total_size</code> variable.</p>
<p>Finally, we output the total size to the console in bytes. If any errors occur during the calculation, such as if the target directory does not exist or if the user does not have sufficient permissions to access the files in the directory, appropriate error messages should be displayed to the user.</p>
<p>Once the total size of the directory has been calculated, the program should output the result to the console in a human-readable format. For example, if the total size is 1024 bytes, the output should be “1 KB”. If the total size is 1048576 bytes, the output should be “1 MB”, and so on.</p>
<p>In addition to the total size of the directory, the program should also output the size of each file and subdirectory in the directory. The output should include the name of each file and subdirectory, as well as its size in bytes and its size as a human-readable string.</p>
<p>Finally, the program should provide options for sorting the output by size in either ascending or descending order, and for limiting the number of entries displayed to the user.</p>
<p>Outputting the results to the console
To output the results of the <code>du</code> command to the console, we can use the standard output stream <code>std::cout</code>. We can format the output using the <code>std::setw</code> and <code>std::left</code> manipulators from the <code>&#x3C;iomanip></code> library to ensure that the output is neatly aligned in columns. Here’s an example of how we can output the results:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::left </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Size"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Name"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF">std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"--------------------------------------------------"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> entry : entries) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is_directory</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::left </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">format_size</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">get_directory_size</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">path</span><span style="color: #ABB2BF">())) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">path</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">filename</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::left </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">format_size</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">file_size</span><span style="color: #ABB2BF">()) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">path</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">filename</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, <code>entries</code> is a vector of <code>std::filesystem::directory_entry</code> objects representing the files and subdirectories in the target directory. <code>get_directory_size()</code> is a function that calculates the size of a directory, and <code>format_size()</code> is a function that converts a size in bytes to a human-readable string.</p>
<p>By default, the output is sorted alphabetically by file name. To sort the output by size, we can use the <code>std::sort()</code> algorithm with a custom comparator function that compares the file sizes. To limit the number of entries displayed, we can use the <code>std::min()</code> function to take the minimum of the number of entries and the specified limit.</p>
<p>Here’s an example of how we can implement these options:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (sort_order </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> SortOrder::ASCENDING) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">sort</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">entries</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">begin</span><span style="color: #ABB2BF">(), </span><span style="color: #E5C07B">entries</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">end</span><span style="color: #ABB2BF">(), [](</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">a</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">b</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">a</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">file_size</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">b</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">file_size</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (sort_order </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> SortOrder::DESCENDING) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">sort</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">entries</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">begin</span><span style="color: #ABB2BF">(), </span><span style="color: #E5C07B">entries</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">end</span><span style="color: #ABB2BF">(), [](</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">a</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">b</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">a</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">file_size</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">b</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">file_size</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> count </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> entry : entries) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (count </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> limit) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Output the entry</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> count</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, <code>sort_order</code> is an enum that specifies whether to sort the output in ascending or descending order, and <code>limit</code> is the maximum number of entries to display. We use lambda functions as comparators to sort the entries by file size, and we use a counter to limit the number of entries displayed to the user.</p>
<p>Testing the du command
To test the <code>du</code> command, we can create a directory structure with some files and subdirectories of different sizes, and run the command on that directory. We can verify that the output of the command matches our expectations based on the size and sorting order of the files.</p>
<p>For example, let’s say we have the following directory structure:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">test</span><span style="color: #56B6C2">/</span></span>
<span class="line"><span style="color: #ABB2BF">├── </span><span style="color: #E5C07B">file1</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">txt</span><span style="color: #ABB2BF"> (</span><span style="color: #D19A66">100</span><span style="color: #ABB2BF"> bytes)</span></span>
<span class="line"><span style="color: #ABB2BF">├── </span><span style="color: #E5C07B">file2</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">txt</span><span style="color: #ABB2BF"> (</span><span style="color: #D19A66">200</span><span style="color: #ABB2BF"> bytes)</span></span>
<span class="line"><span style="color: #ABB2BF">├── sub1</span><span style="color: #56B6C2">/</span></span>
<span class="line"><span style="color: #ABB2BF">│ ├── </span><span style="color: #E5C07B">file3</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">txt</span><span style="color: #ABB2BF"> (</span><span style="color: #D19A66">50</span><span style="color: #ABB2BF"> bytes)</span></span>
<span class="line"><span style="color: #ABB2BF">│ └── </span><span style="color: #E5C07B">file4</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">txt</span><span style="color: #ABB2BF"> (</span><span style="color: #D19A66">75</span><span style="color: #ABB2BF"> bytes)</span></span>
<span class="line"><span style="color: #ABB2BF">└── sub2</span><span style="color: #56B6C2">/</span></span>
<span class="line"><span style="color: #ABB2BF"> └── </span><span style="color: #E5C07B">file5</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">txt</span><span style="color: #ABB2BF"> (</span><span style="color: #D19A66">150</span><span style="color: #ABB2BF"> bytes)</span></span></code></pre>
<p>We can run the command <code>./du test</code> to calculate the sizes of the files and subdirectories in the <code>test</code> directory. The expected output, sorted by ascending size, would be:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">Size Name</span></span>
<span class="line"><span style="color: #C678DD">--------------------------------------------------</span></span>
<span class="line"><span style="color: #D19A66">50</span><span style="color: #ABB2BF"> bytes </span><span style="color: #E5C07B">file3</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #D19A66">75</span><span style="color: #ABB2BF"> bytes </span><span style="color: #E5C07B">file4</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #D19A66">100</span><span style="color: #ABB2BF"> bytes </span><span style="color: #E5C07B">file1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #D19A66">150</span><span style="color: #ABB2BF"> bytes </span><span style="color: #E5C07B">file5</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #D19A66">200</span><span style="color: #ABB2BF"> bytes </span><span style="color: #E5C07B">file2</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>We can also test the sorting order and limit options by running the command with different parameters and verifying that the output matches our expectations. For example, <code>./du test --sort descending --limit 3</code> should output the following:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">Size Name</span></span>
<span class="line"><span style="color: #C678DD">--------------------------------------------------</span></span>
<span class="line"><span style="color: #D19A66">200</span><span style="color: #ABB2BF"> bytes </span><span style="color: #E5C07B">file2</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #D19A66">150</span><span style="color: #ABB2BF"> bytes </span><span style="color: #E5C07B">file5</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #D19A66">100</span><span style="color: #ABB2BF"> bytes </span><span style="color: #E5C07B">file1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<h1 id="chapter-5-building-a-df-command">Chapter 5: Building a Df Command</h1>
<p>Overview of the df command and its functionality
The <code>df</code> command in Unix-like operating systems is used to display information about the file system disk space usage, including the total size, used space, available space, and file system type for each mounted file system.</p>
<p>The <code>df</code> command can be used with various options to customize the output and display information about specific file systems or disk partitions. By default, <code>df</code> displays information for all file systems currently mounted on the system.</p>
<p>Some common options for the <code>df</code> command include <code>-h</code> to display sizes in a human-readable format, <code>-T</code> to display the file system type, and <code>-t</code> to filter the output by a specific file system type. Additionally, the <code>df</code> command can be used with the <code>-i</code> option to display information about the inode usage instead of disk usage.</p>
<p>Designing the C++ implementation of the df command
To implement the <code>df</code> command in C++, we can use the <code>statvfs()</code> system call to retrieve information about the file system disk space usage.</p>
<p>Here’s a high-level overview of the steps we can follow to design the implementation:</p>
<ol>
<li>Parse the command line arguments to determine if any options were specified.</li>
<li>Call <code>statvfs()</code> to retrieve information about the file system disk space usage.</li>
<li>Calculate the total size, used space, and available space for the file system.</li>
<li>Print the results to the console in a formatted table.</li>
</ol>
<p>To customize the output based on the specified options, we can add conditional statements that check for each option and modify the output accordingly. For example, if the <code>-h</code> option is specified, we can convert the size values to a human-readable format before printing them to the console. Similarly, if the <code>-t</code> option is specified, we can filter the output to only display information for file systems of the specified type.</p>
<p>Once the implementation is complete, we can test the <code>df</code> command by running it on different file systems and verifying that the output matches our expectations based on the file system size and type.</p>
<p>Reading and processing the input file system
The <code>df</code> command does not take an input file system as an argument. Instead, it displays information about all file systems that are currently mounted on the system.</p>
<p>To retrieve information about the file systems, we can call the <code>statvfs()</code> system call without any arguments, which returns information about the file system that contains the current working directory. We can then use a loop to call <code>statvfs()</code> on each mounted file system and retrieve information about its disk space usage.</p>
<p>Here’s some sample code that demonstrates how to retrieve information about the file systems:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;sys/statvfs.h></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">statvfs</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Call statvfs() without any arguments to retrieve information about the file system</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">statvfs</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"."</span><span style="color: #ABB2BF">, </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">fsinfo) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Failed to retrieve file system information"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Retrieve information about the file system</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"File System ID: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_fsid</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Block size: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_bsize</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Total blocks: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_blocks</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Free blocks: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_bfree</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Available blocks: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_bavail</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Total file nodes: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_files</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Free file nodes: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_ffree</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Max file name length: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_namemax</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code retrieves information about the file system that contains the current working directory and prints it to the console. We can modify this code to loop through all mounted file systems and retrieve information about their disk space usage.</p>
<p>Implementing the df functionality
To implement the <code>df</code> command in C++, we can use the <code>statvfs()</code> system call to retrieve information about the mounted file systems, similar to how we did in the previous section. We can then format and output this information to the console in a user-friendly way.</p>
<p>Here’s some sample code that demonstrates how to implement the <code>df</code> command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iomanip></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;sys/statvfs.h></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">statvfs</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Filesystem"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"1K-blocks"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Used"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Available"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Capacity"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Mounted on"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Call statvfs() on each mounted file system to retrieve disk usage information</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">char</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> mount_points[] </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> {</span><span style="color: #98C379">"/"</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">"/home"</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">"/mnt/external"</span><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> num_mount_points </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">sizeof</span><span style="color: #ABB2BF">(mount_points) </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">sizeof</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">mount_points</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> num_mount_points; </span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">i) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">statvfs</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">mount_points</span><span style="color: #ABB2BF">[i], </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">fsinfo) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Failed to retrieve file system information for "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">mount_points</span><span style="color: #ABB2BF">[i] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsigned</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> block_size </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_frsize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsigned</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> total_blocks </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_blocks</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsigned</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> free_blocks </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_bfree</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsigned</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> available_blocks </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_bavail</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Calculate disk usage information</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsigned</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> total_size </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> total_blocks </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> block_size;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsigned</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> used_size </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> (total_blocks </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> free_blocks) </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> block_size;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsigned</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">long</span><span style="color: #ABB2BF"> available_size </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> available_blocks </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> block_size;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">double</span><span style="color: #ABB2BF"> capacity </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> static_cast</span><span style="color: #C678DD">&#x3C;double></span><span style="color: #ABB2BF">(used_size) </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> total_size </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">100</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Format and output disk usage information</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::left </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">mount_points</span><span style="color: #ABB2BF">[i]</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::right </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> total_size </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> used_size </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> available_size </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setprecision</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::fixed </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> capacity </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"%"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsinfo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">f_mntonname</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code retrieves disk usage information for the file systems mounted at <code>/</code>, <code>/home</code>, and <code>/mnt/external</code>, and prints the information to the console in a user-friendly way. We use <code>std::setw()</code> to set the width of each output field, and <code>std::setprecision()</code> and <code>std::fixed</code> to format the capacity percentage as a decimal number with two decimal places. The output should look similar to the following:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">Filesystem </span><span style="color: #D19A66">1</span><span style="color: #E06C75">K</span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">blocks Used Available Capacity Mounted on </span></span>
<span class="line"><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">524288</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1196208</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">224744</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">84.28</span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span></span>
<span class="line"><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">home </span><span style="color: #D19A66">2097152</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">597920</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1361232</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">28.51</span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">home</span></span>
<span class="line"><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">mnt</span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">external </span><span style="color: #D19A66">19531250</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">16064436</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2898704</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">82.23</span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">mnt</span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">external</span></span></code></pre>
<p>Outputting the results to the console
To output the results of the <code>df</code> command to the console, we will use the <code>std::cout</code> object from the <code>iostream</code> library. We will display the following information for each file system:</p>
<ul>
<li>File system name</li>
<li>Total space</li>
<li>Used space</li>
<li>Free space</li>
<li>Percentage of space used</li>
</ul>
<p>We can use the <code>std::setw()</code> function from the <code>iomanip</code> library to set the width of the output fields.</p>
<p>Here’s an example implementation of the <code>df</code> command output function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iomanip></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">print_df_results</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">vector</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">FileSystem</span><span style="color: #ABB2BF">></span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">file_systems</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"File System Name"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Total Space"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Used Space"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Free Space"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #D19A66">% U</span><span style="color: #98C379">sed"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> fs : file_systems) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">total_space</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">used_space</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">free_space</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">setw</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">percent_used</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This function uses a vector of <code>FileSystem</code> objects as input and outputs the results to the console in a formatted table. We first output the column headers using <code>std::setw()</code> to set the width of each column to 20 characters. We then loop through each file system and output the name, total space, used space, free space, and percentage of space used using <code>std::setw()</code> to set the width of each column to 20 characters.</p>
<p>Note that we assume that the <code>FileSystem</code> struct has the following fields: <code>name</code> (a string), <code>total_space</code>, <code>used_space</code>, <code>free_space</code>, and <code>percent_used</code> (all integers representing the sizes in bytes).</p>
<p>Testing the df command
To test the <code>df</code> command, we need to create a few test file systems with known sizes and use the <code>df</code> command to calculate the used and free space. We can then compare the results of the <code>df</code> command with the expected values.</p>
<p>Here’s an example test case:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">test_df</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::vector</span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF">FileSystem</span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> file_systems {</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span><span style="color: #98C379">"/dev/sda1"</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1000000000</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">500000000</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">500000000</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">50</span><span style="color: #ABB2BF">},</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span><span style="color: #98C379">"/dev/sda2"</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2000000000</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1000000000</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1000000000</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">50</span><span style="color: #ABB2BF">},</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span><span style="color: #98C379">"/dev/sdb1"</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">500000000</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">200000000</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">300000000</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">40</span><span style="color: #ABB2BF">},</span></span>
<span class="line"><span style="color: #ABB2BF"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">print_df_results</span><span style="color: #ABB2BF">(file_systems);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This test case creates a vector of three <code>FileSystem</code> objects with known sizes and calls the <code>print_df_results()</code> function to output the results to the console. We can then compare the output with the expected values.</p>
<p>For example, we can expect the output to look like this:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">bashCopy code `File System Name Total Space Used Space Free Space </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> Used</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">dev</span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">sda1 </span><span style="color: #D19A66">1000000000</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">500000000</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">500000000</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">50</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">dev</span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">sda2 </span><span style="color: #D19A66">2000000000</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1000000000</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1000000000</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">50</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">dev</span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">sdb1 </span><span style="color: #D19A66">500000000</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">200000000</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">300000000</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">40</span></span></code></pre>
<p>We can then visually inspect the output and verify that the calculated values are correct. In this case, the calculated values match the expected values, so we can consider the <code>df</code> command implementation to be correct.</p>
<h1 id="chapter-6-building-a-rm-command">Chapter 6: Building a Rm Command</h1>
<p>Overview of the rm command and its functionality
The <code>rm</code> command in Linux and Unix systems is used to remove files or directories from the file system. When a file or directory is removed using the <code>rm</code> command, it is permanently deleted and cannot be recovered. The <code>rm</code> command also has a number of options that can be used to modify its behavior, such as the <code>-r</code> option to recursively remove directories and their contents.</p>
<p>The basic syntax for the <code>rm</code> command is as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">rm file_name</span></span></code></pre>
<p>This will remove the specified file from the file system. If the file is a directory, the <code>rm</code> command will fail unless the <code>-r</code> option is used to recursively remove the directory and its contents.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">rm </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">r directory_name</span></span></code></pre>
<p>This will recursively remove the specified directory and its contents from the file system. If the directory contains files or subdirectories, they will also be removed. The <code>-r</code> option should be used with caution, as it can cause data loss if used incorrectly.</p>
<p>Designing the C++ implementation of the rm command
The <code>rm</code> command in Linux and Unix systems is a powerful tool that can be used to remove files and directories from the file system. In designing the C++ implementation of the <code>rm</code> command, we need to consider several factors, such as:</p>
<ol>
<li>The user should be able to specify the file or directory to be removed as a command line argument.</li>
<li>The program should handle errors gracefully and provide informative error messages to the user.</li>
<li>If the file to be removed is a directory, the program should be able to recursively remove the directory and its contents if the user specifies the <code>-r</code> option.</li>
</ol>
<p>With these considerations in mind, we can design the C++ implementation of the <code>rm</code> command as follows:</p>
<ol>
<li>Parse the command line arguments to determine the file or directory to be removed and whether the user has specified the <code>-r</code> option.</li>
<li>Check if the specified file or directory exists in the file system. If it does not exist, display an error message and exit the program.</li>
<li>If the specified file or directory is a regular file, simply delete it using the <code>remove()</code> function from the <code>&#x3C;cstdio></code> header.</li>
<li>If the specified file or directory is a directory and the <code>-r</code> option has been specified, recursively delete the directory and its contents using a recursive function.</li>
<li>If the specified file or directory is a directory and the <code>-r</code> option has not been specified, display an error message and exit the program.</li>
</ol>
<p>Here’s a basic outline of what the C++ implementation of the <code>rm</code> command might look like:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;cstdio></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;cstring></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;dirent.h></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;sys/stat.h></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_file</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Use the remove() function to delete the file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">remove</span><span style="color: #ABB2BF">(path) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Handle error here</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_dir</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Open the directory</span></span>
<span class="line"><span style="color: #ABB2BF"> DIR</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> dir </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">opendir</span><span style="color: #ABB2BF">(path);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (dir </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">NULL</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Handle error here</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Loop through the directory entries</span></span>
<span class="line"><span style="color: #ABB2BF"> dirent</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> entry;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> ((entry </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">readdir</span><span style="color: #ABB2BF">(dir)) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">NULL</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Ignore "." and ".." entries</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">strcmp</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">-></span><span style="color: #E06C75">d_name</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">"."</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">strcmp</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">-></span><span style="color: #E06C75">d_name</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">".."</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Build the full path to the entry</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">char</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">full_path</span><span style="color: #ABB2BF">[PATH_MAX];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">snprintf</span><span style="color: #ABB2BF">(full_path, PATH_MAX, </span><span style="color: #98C379">"</span><span style="color: #D19A66">%s</span><span style="color: #98C379">/</span><span style="color: #D19A66">%s</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">, path, </span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">-></span><span style="color: #E06C75">d_name</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Get information about the entry</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(full_path, </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">info) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Handle error here</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // If the entry is a file, delete it</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISREG</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_file</span><span style="color: #ABB2BF">(full_path);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // If the entry is a directory, recursively delete it</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISDIR</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_dir</span><span style="color: #ABB2BF">(full_path);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Close the directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">closedir</span><span style="color: #ABB2BF">(dir);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Delete the directory itself</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">rmdir</span><span style="color: #ABB2BF">(path) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Handle error here</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Parse command line arguments</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Check if the specified file or directory exists</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(path, </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">info) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Handle error here</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // If the specified file is a regular file, delete it</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISREG</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">remove_file</span><span style="color: #ABB2BF">(path);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // If the specified file is a directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISDIR</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_directory</span><span style="color: #ABB2BF">(path);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // If the specified file is neither a file nor a directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"rm: cannot remove '"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"': Not a regular file or directory</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In the above code, we first check if the specified path is a regular file using the <code>S_ISREG</code> macro. If it is a file, we call the <code>remove_file</code> function to delete it. If it is a directory, we call the <code>remove_directory</code> function to delete it recursively.</p>
<p>If the specified path is neither a file nor a directory, we output an error message to the standard error stream and return without deleting anything.</p>
<p>Reading and processing the input file or directory
To implement the <code>rm</code> command, we need to first read and process the input file or directory specified by the user.</p>
<p>Here’s a code snippet to get the path of the file or directory to be deleted from the command-line arguments:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;unistd.h></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" FILE/DIR</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Get the path of the file or directory</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string path </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Use the unlink system call to delete the file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">unlink</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">()) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"rm: cannot remove '"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"': "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">strerror</span><span style="color: #ABB2BF">(errno) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In the above code, we first check if the user has provided the correct number of command-line arguments (i.e., the path of the file or directory to be deleted). If not, we output an error message to the standard error stream and return with a non-zero exit code.</p>
<p>Next, we use the <code>unlink</code> system call to delete the file. If the file is a symbolic link, the link itself is removed and not the target file. If the file is a hard link, the link count of the target file is decremented by one. If the link count becomes zero, the target file is deleted.</p>
<p>If the <code>unlink</code> system call fails, we output an error message to the standard error stream using the <code>strerror</code> function to get a human-readable description of the error. We then return with a non-zero exit code to indicate failure.</p>
<p>Implementing the rm functionality
To implement the <code>rm</code> functionality, we will use the <code>remove()</code> and <code>rmdir()</code> functions from the C++ standard library. These functions provide a portable way of deleting files and directories across different operating systems.</p>
<p>Here’s a code snippet to delete a file or directory using the <code>remove()</code> and <code>rmdir()</code> functions:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;sys/stat.h></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_file</span><span style="color: #ABB2BF">(std::</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Use the remove function to delete the file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">remove</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">()) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"rm: cannot remove '"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"': "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">strerror</span><span style="color: #ABB2BF">(errno) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_directory</span><span style="color: #ABB2BF">(std::</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Use the rmdir function to delete the directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">rmdir</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">()) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"rm: cannot remove '"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"': "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">strerror</span><span style="color: #ABB2BF">(errno) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" FILE/DIR</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Get the path of the file or directory</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string path </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Get information about the file or directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">info) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"rm: cannot access '"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"': "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">strerror</span><span style="color: #ABB2BF">(errno) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Check if the specified path is a regular file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISREG</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_file</span><span style="color: #ABB2BF">(path);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // If the specified path is a directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISDIR</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_directory</span><span style="color: #ABB2BF">(path);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // If the specified path is neither a regular file nor a directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"rm: cannot remove '"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"': Not a regular file or directory</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In the above code, we have defined two helper functions <code>remove_file()</code> and <code>remove_directory()</code> to delete a file and a directory, respectively. We then check if the specified path is a regular file or a directory using the <code>S_ISREG()</code> and <code>S_ISDIR()</code> macros from the <code>stat.h</code> header file. If the specified path is a regular file, we call the <code>remove_file()</code> function to delete it. If it is a directory, we call the <code>remove_directory()</code> function to delete it. If the specified path is neither a regular file nor a directory, we output an error message to the standard error stream and return with a non-zero exit code.</p>
<p>In the <code>remove_file()</code> function, we use the <code>remove()</code> function to delete the file. If the <code>remove()</code> function fails, we output an error message to the standard error stream using the <code>strerror</code> function to get a human-readable description of the error.</p>
<p>In the <code>remove_directory()</code> function, we use the <code>rmdir()</code> function to delete the directory. If the <code>rmdir()</code> function fails, we output an error message to the standard error stream using the <code>strerror</code> function to get a human-readable description of the error. Note that the <code>rmdir()</code> function can only delete empty directories. If the directory is not empty, we need to delete its contents first before calling <code>rmdir()</code>.</p>
<p>Once we have determined whether the path specified by the user is a file or directory, we can implement the <code>rm</code> functionality as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_file</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">info) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Cannot access "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISREG</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">remove</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">()) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Cannot delete "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISDIR</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> DIR</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> dir </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">opendir</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">dir) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Cannot access directory "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // delete contents of the directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">dirent</span><span style="color: #C678DD">*</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> ((entry </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">readdir</span><span style="color: #ABB2BF">(dir)) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">NULL</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">strcmp</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">-></span><span style="color: #E06C75">d_name</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">"."</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">strcmp</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">-></span><span style="color: #E06C75">d_name</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">".."</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> std::string full_path </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> path </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"/"</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">-></span><span style="color: #E06C75">d_name</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">remove_file</span><span style="color: #ABB2BF">(full_path);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">closedir</span><span style="color: #ABB2BF">(dir);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">rmdir</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">()) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Cannot delete directory "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This implementation first checks whether the specified path is a regular file or a directory using <code>S_ISREG()</code> and <code>S_ISDIR()</code> macros, respectively. If the path points to a regular file, it calls <code>std::remove()</code> to delete the file. If the path points to a directory, it opens the directory using <code>opendir()</code> and iterates through its contents using <code>readdir()</code>. For each entry in the directory, it recursively calls <code>remove_file()</code> to delete the entry. Once all entries in the directory have been deleted, it calls <code>rmdir()</code> to delete the directory itself. If any errors occur during the deletion process, it prints an error message to <code>std::cerr</code>.</p>
<p>Outputting the results to the console
Once the <code>remove_file()</code> and <code>remove_directory()</code> functions have finished running, we can output the results of the <code>rm</code> command to the console. We can use <code>std::cout</code> to print messages to the console, indicating which files or directories were successfully deleted and which ones could not be deleted due to errors.</p>
<p>Here’s an example of how we could output the results of the <code>rm</code> command to the console:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (removed_files </span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> removed_directories </span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Removed "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> removed_files </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" file(s) and "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> removed_directories </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" directory(s)."</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (failed_files </span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> failed_directories </span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Failed to remove "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> failed_files </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" file(s) and "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> failed_directories </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" directory(s)."</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code checks if any files or directories were successfully deleted and outputs the number of deleted files and directories to the console. It then checks if any files or directories failed to be deleted and outputs the number of failed files and directories to the console.</p>
<p>We could also output more detailed error messages to the console using <code>std::cerr</code> if desired.</p>
<p>Testing the rm command
To test the <code>rm</code> command, we can create a few files and directories in a test directory and try to remove them using the <code>rm</code> command. We can then verify that the files and directories were properly removed or not.</p>
<p>Here’s an example test case:</p>
<ol>
<li>Create a test directory and navigate to it:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">mkdir test_dir</span></span>
<span class="line"><span style="color: #ABB2BF">cd test_dir</span></span></code></pre>
<ol start="2">
<li>Create a few files and directories:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">touch file1 file2</span></span>
<span class="line"><span style="color: #ABB2BF">mkdir dir1 dir2</span></span></code></pre>
<ol start="3">
<li>Use the <code>rm</code> command to remove some of the files and directories:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">rm file1 dir1</span></span></code></pre>
<ol start="4">
<li>Verify that the files and directories were properly removed:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">ls</span></span></code></pre>
<p>This should output:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">file2</span></span>
<span class="line"><span style="color: #ABB2BF">dir2</span></span></code></pre>
<p>and we can confirm that <code>file1</code> and <code>dir1</code> were successfully removed.</p>
<ol start="5">
<li>Try to remove a non-existent file or directory:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">rm file3</span></span></code></pre>
<p>This should output an error message indicating that <code>file3</code> does not exist.</p>
<ol start="6">
<li>Try to remove a non-empty directory:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">rm dir2</span></span></code></pre>
<p>This should output an error message indicating that <code>dir2</code> is not empty.</p>
<p>By performing these tests, we can verify that the <code>rm</code> command is working correctly and can properly remove files and directories.</p>
<h1 id="chapter-7-building-a-touch-command">Chapter 7: Building a Touch Command</h1>
<p>Overview of the touch command and its functionality
The <code>touch</code> command is a common Unix command that is used to update the timestamps (access time and modification time) of a file or create an empty file if the specified file does not exist. When used to create a new file, the file will be empty and have default permissions.</p>
<p>The basic syntax of the <code>touch</code> command is:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">touch [options] </span><span style="color: #61AFEF">file</span><span style="color: #ABB2BF">(s)</span></span></code></pre>
<p>Some common options of the <code>touch</code> command include:</p>
<ul>
<li><code>-a</code>: Only update the access time of the file(s).</li>
<li><code>-m</code>: Only update the modification time of the file(s).</li>
<li>`-: Do not create a new file if it does not already exist.</li>
<li><code>-r</code>: Use the timestamps of an existing file instead of the current time.</li>
<li><code>-t</code>: Set the timestamp to a specific time and date.</li>
</ul>
<p>The <code>touch</code> command is often used in shell scripts and command pipelines, where the creation or modification time of a file is important for monitoring changes or triggering other actions.</p>
<p>Designing the C++ implementation of the touch command
To implement the <code>touch</code> command in C++, we will need to:</p>
<ol>
<li>Parse the command line arguments to determine the file(s) to update/create and any options specified.</li>
<li>Check if the file(s) exist and if they do not, create an empty file with default permissions.</li>
<li>Update the modification and/or access time of the file(s) as specified by the options.</li>
</ol>
<p>Here is a possible design for the C++ implementation of the <code>touch</code> command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;fstream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;ctime></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;unistd.h></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;getopt.h></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">touch_file</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">file_path</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">create_file</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">update_access_time</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">update_modification_time</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[])</span></span>
<span class="line"><span style="color: #ABB2BF">{</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> create_file </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> update_access_time </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> update_modification_time </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string file_path;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Parse command line options</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> option;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> ((option </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">getopt</span><span style="color: #ABB2BF">(argc, argv, </span><span style="color: #98C379">"cam"</span><span style="color: #ABB2BF">)) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">switch</span><span style="color: #ABB2BF"> (option) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'c'</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF"> create_file </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'a'</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF"> update_access_time </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'m'</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF"> update_modification_time </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">default</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Invalid option</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(EXIT_FAILURE);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Parse file path argument</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (optind </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> argc) {</span></span>
<span class="line"><span style="color: #ABB2BF"> file_path </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[optind];</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Missing file path argument</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(EXIT_FAILURE);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Check if file exists</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> file_exists </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">access</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">file_path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), F_OK) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Create file if it doesn't exist</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">file_exists </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> create_file) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::ofstream </span><span style="color: #61AFEF">file</span><span style="color: #ABB2BF">(file_path);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Update file timestamp(s)</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">touch_file</span><span style="color: #ABB2BF">(file_path, create_file, update_access_time, update_modification_time);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">touch_file</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">file_path</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">create_file</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">update_access_time</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">update_modification_time</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">{</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file_stat</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">file_path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">file_stat) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error getting file stats</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(EXIT_FAILURE);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (create_file) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Set default permissions for new file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">chmod</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">file_path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), S_IRUSR </span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> S_IWUSR </span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> S_IRGRP </span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> S_IROTH);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #61AFEF">S_ISREG</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">file_stat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"File is not a regular file</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(EXIT_FAILURE);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Get current time</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">time_t</span><span style="color: #ABB2BF"> current_time </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">time</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">NULL</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">utimbuf</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">new_times</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">new_times</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">actime</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file_stat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_atime</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">new_times</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">modtime</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file_stat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mtime</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (update_access_time) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">new_times</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">actime</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> current_time;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (update_modification_time) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">new_times</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">modtime</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> current_time;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Update file timestamps</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">utime</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">file_path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">new_times) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error updating file timestamp(s)</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(EXIT_FAILURE);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This implementation uses the <code>getopt</code> function to parse command line options and the <code>stat</code> function to get file information such as its type and timestamps. The <code>utime</code> function is used to update the timestamps of the file(s). The <code>chmod</code> function is used to change the permissions of the file(s).</p>
<p>The touch command has a very simple functionality - it updates the access and modification timestamps of a file to the current time. If the file does not exist, it is created with the current timestamp.</p>
<p>To implement this functionality in C++, we can make use of the <code>utime</code> and <code>chmod</code> functions provided by the <code>sys/stat.h</code> header file.</p>
<p>The <code>utime</code> function takes two arguments - the path of the file and a pointer to a <code>utimbuf</code> structure that specifies the new timestamps. We can use the <code>time</code> function provided by the <code>time.h</code> header file to get the current time, and set the <code>actime</code> and <code>modtime</code> fields of the <code>utimbuf</code> structure to this value.</p>
<p>The <code>chmod</code> function takes two arguments - the path of the file and a mode_t value that specifies the new permissions. We can use the <code>S_IRUSR</code>, <code>S_IWUSR</code>, <code>S_IRGRP</code>, <code>S_IROTH</code> constants to specify the default permissions for a new file (readable and writable by the owner, readable by the group and others).</p>
<p>We can also handle the case where multiple files are specified as arguments to the touch command. In this case, we would need to update the timestamps and permissions of each file.</p>
<p>Reading and processing the input file
Since the <code>touch</code> command can create a new file or update the timestamps of an existing file, we need to process the input file in two different ways depending on whether it already exists or not.</p>
<p>If the file already exists, we simply need to update its timestamps using the <code>utime()</code> function. We can check if the file exists by calling the <code>access()</code> function, which checks if a file exists and if the user has permission to access it.</p>
<p>If the file does not exist, we need to create it. We can create a new empty file using the <code>open()</code> function with the <code>O_CREAT</code> and <code>O_WRONLY</code> flags. This function returns a file descriptor that we can use to set the timestamps and close the file.</p>
<p>Implementing the touch functionality
Here’s an implementation of the <code>touch</code> command in C++:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;sys/stat.h></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;sys/types.h></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;fcntl.h></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;unistd.h></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;utime.h></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;ctime></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" FILE..."</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> argc; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">access</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i], F_OK) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // File exists, update timestamps</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">utime</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i], </span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // File does not exist, create it</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> fd </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i], O_CREAT </span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> O_WRONLY, S_IRUSR </span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> S_IWUSR </span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> S_IRGRP </span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> S_IROTH);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (fd </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: could not create file "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">(fd);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>The program takes one or more filenames as command-line arguments. For each filename, it checks if the file exists using the <code>access()</code> function. If the file exists, it updates its timestamps using the <code>utime()</code> function. If the file does not exist, it creates a new empty file using the <code>open()</code> function with the <code>O_CREAT</code> and <code>O_WRONLY</code> flags. The <code>close()</code> function is used to close the file descriptor returned by <code>open()</code>. If there is an error creating the file or updating the timestamps, the program prints an error message to <code>stderr</code> and exits with a non-zero status.</p>
<p>Outputting the results to the console
Since the touch command doesn’t typically output anything to the console, there is no need for an output function. Instead, we can output a success message if the file was successfully created or if its timestamps were successfully updated. If there was an error, we can output an error message with the corresponding error code.</p>
<p>Testing the touch command
To test the touch command, we can create a new file with a specific timestamp using the <code>touch</code> command, and then verify that the timestamp has been set correctly using the <code>stat</code> command.</p>
<p>For example, we can create a new file called “test.txt” with a timestamp of “2022-04-01 12:00:00” using the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">touch </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">t </span><span style="color: #D19A66">202204011200.00</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">test</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>We can then verify that the timestamp has been set correctly using the <code>stat</code> command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">stat </span><span style="color: #E5C07B">test</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>The output should include a line similar to the following:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">Modify: </span><span style="color: #D19A66">2022</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">0</span><span style="color: #D19A66">4</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">0</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">12</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">0</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">:</span><span style="color: #D19A66">00.000000000</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #E06C75">0</span><span style="color: #D19A66">000</span></span></code></pre>
<p>This indicates that the modification timestamp for the file “test.txt” is set to “2022-04-01 12:00:00”.</p>
<h1 id="chapter-8-building-a-locate-command">Chapter 8: Building a Locate Command</h1>
<p>Overview of the locate command and its functionality
The <code>locate</code> command is a utility for finding files by name quickly on Unix and Unix-like operating systems. It works by maintaining a database of all files and directories on the system, and then searching this database for files that match a given pattern or regular expression.</p>
<p>The <code>locate</code> command is usually much faster than using <code>find</code> or other file search tools because it does not search the file system directly. Instead, it relies on the pre-built database, which is updated periodically using the <code>updatedb</code> command.</p>
<p>The <code>locate</code> command takes one or more patterns as arguments and searches the file system for files that match the pattern. By default, <code>locate</code> returns a list of all files on the system that match the pattern, but it can also be used to search for files in specific directories, or to restrict the search to files that were modified or created within a certain time frame.</p>
<p>Designing the C++ implementation of the locate command
The <code>locate</code> command is used to find files and directories by name on the file system. It works by searching a pre-built database of files and directories that is periodically updated by the system.</p>
<p>To implement the <code>locate</code> command in C++, we will need to:</p>
<ol>
<li>Parse the input pattern and search for matches in the pre-built database of files and directories</li>
<li>Output the results to the console</li>
</ol>
<p>To parse the input pattern, we can use command line arguments or prompt the user for input. Once we have the pattern, we can search for matches in the pre-built database of files and directories using the <code>locate</code> system command or a library function that implements the same functionality.</p>
<p>The output of the <code>locate</code> command typically includes the full path of the matching files and directories. We can output the results to the console in a format that is easy to read and parse by humans, such as one path per line.</p>
<p>Reading and processing the input search query
In the case of the <code>locate</code> command, the input is the search query, which is a string representing the file or directory name to search for. The implementation of the <code>locate</code> command will take the search query as a command-line argument.</p>
<p>The search query can be used to search for file or directory names containing the search query string. The search can be performed recursively, starting from a given directory, or it can be performed on the entire file system.</p>
<p>To process the search query, we can use the <code>std::string</code> class in C++. We can obtain the search query by accessing the appropriate command-line argument using the <code>arg and</code>argv<code>arguments of the</code>main` function.</p>
<p>Once we have obtained the search query, we can use it to search for the files or directories containing the search query. We can use the <code>std::filesystem</code> library to traverse the file system and search for files or directories with the specified name.</p>
<p>Implementing the locate functionality
To implement the <code>locate</code> command, we can use the <code>find</code> command in combination with some string manipulation to extract only the file paths that match the search query.</p>
<p>Here’s a possible implementation in C++:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;fstream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;sstream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;vector></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;cstdlib></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;algorithm></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">using</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">namespace</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Check if the user specified a search query</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" search_query"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Construct the find command</span></span>
<span class="line"><span style="color: #ABB2BF"> string find_cmd </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"find / -name '*"</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">string</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">]) </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"*' 2>/dev/null"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Open a pipe to the find command</span></span>
<span class="line"><span style="color: #ABB2BF"> FILE</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> pipe </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">popen</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">find_cmd</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), </span><span style="color: #98C379">"r"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">pipe) {</span></span>
<span class="line"><span style="color: #ABB2BF"> cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: could not open pipe to find command."</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Read the output of the find command</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">char</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">buffer</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">4096</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> string result;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">fgets</span><span style="color: #ABB2BF">(buffer, </span><span style="color: #C678DD">sizeof</span><span style="color: #ABB2BF">(buffer), pipe) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> result </span><span style="color: #C678DD">+=</span><span style="color: #ABB2BF"> buffer;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Close the pipe to the find command</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">pclose</span><span style="color: #ABB2BF">(pipe);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Split the result into individual file paths</span></span>
<span class="line"><span style="color: #ABB2BF"> stringstream </span><span style="color: #61AFEF">ss</span><span style="color: #ABB2BF">(result);</span></span>
<span class="line"><span style="color: #ABB2BF"> string path;</span></span>
<span class="line"><span style="color: #ABB2BF"> vector</span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF">string</span><span style="color: #C678DD">></span><span style="color: #ABB2BF"> paths;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">getline</span><span style="color: #ABB2BF">(ss, path, </span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Remove any trailing newline characters</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">erase</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">remove</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">begin</span><span style="color: #ABB2BF">(), </span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">end</span><span style="color: #ABB2BF">(), </span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">end</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Add the path to the list of file paths</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">paths</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push_back</span><span style="color: #ABB2BF">(path);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Sort the file paths alphabetically</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sort</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">paths</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">begin</span><span style="color: #ABB2BF">(), </span><span style="color: #E5C07B">paths</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">end</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Output the file paths to the console</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> string</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> path : paths) {</span></span>
<span class="line"><span style="color: #ABB2BF"> cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this implementation, we first check if the user specified a search query as a command-line argument. If not, we print an error message and exit with an error code.</p>
<p>Next, we construct the <code>find</code> command by concatenating the search query with the appropriate wildcards to match any file names that contain the query. We redirect any error messages to <code>/dev/null</code> to suppress them.</p>
<p>We then open a pipe to the <code>find</code> command and read its output into a string. We close the pipe and split the string into individual file paths. We remove any trailing newline characters and sort the file paths alphabetically.</p>
<p>Finally, we output the file paths to the console, one per line.</p>
<p>Note that this implementation assumes that the <code>find</code> command is installed on the system and that the user running the program has sufficient permissions to search the root directory. Also, the performance of this implementation may not be optimal for large file systems with many matching files, as it reads the entire output of the <code>find</code> command into memory before processing it.</p>
<p>Outputting the results to the console
The <code>locate</code> command typically outputs the absolute paths of all files and directories in the system that contain the specified search query. We can use the <code>std::cout</code> function to output the search results to the console.</p>
<p>Here’s an example code snippet for outputting the search results:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> result : search_results) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> result </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code snippet, <code>search_results</code> is a vector of strings that contains the absolute paths of all files and directories that match the search query. We loop through this vector using a range-based for loop and output each result to the console using <code>std::cout</code>. We also use the <code>std::endl</code> function to insert a newline character after each result.</p>
<p>Testing the locate command
Since the <code>locate</code> command relies on an index of file names, it requires an initial indexing process to be performed before it can be used effectively. This indexing process can take some time to complete, depending on the size of the file system being indexed.</p>
<p>To test the <code>locate</code> command, we first need to ensure that the indexing process has completed. Once the indexing process is complete, we can then run the <code>locate</code> command with various search queries and verify that it returns the expected results.</p>
<p>Here is an example test plan for the <code>locate</code> command:</p>
<ol>
<li>Run the indexing process on a test file system using the <code>updatedb</code> command.</li>
<li>Search for a file that exists in the file system using a full path, and verify that <code>locate</code> returns the correct path.</li>
<li>Search for a file that exists in the file system using a partial path, and verify that <code>locate</code> returns the correct path.</li>
<li>Search for a file that does not exist in the file system using a full path, and verify that <code>locate</code> returns no results.</li>
<li>Search for a file that does not exist in the file system using a partial path, and verify that <code>locate</code> returns no results.</li>
<li>Search for a file using a case-insensitive search query, and verify that <code>locate</code> returns the correct results.</li>
<li>Search for a file using a regular expression search query, and verify that <code>locate</code> returns the correct results.</li>
<li>Search for a file using a search query that includes wildcards, and verify that <code>locate</code> returns the correct results.</li>
</ol>
<h1 id="chapter-9-building-a-find-command">Chapter 9: Building a Find Command</h1>
<p>Overview of the find command and its functionality
The <code>find</code> command is a powerful tool for searching for files and directories in a specified location based on various criteria such as file name, size, type, modification time, and permissions. The <code>find</code> command traverses the specified directory hierarchy recursively, examining each file and directory to determine if it matches the specified criteria. When a match is found, the <code>find</code> command can perform various actions on the matching files or directories, such as printing their names, executing commands on them, or deleting them.</p>
<p>The basic syntax of the <code>find</code> command is as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">find [path] [expression]</span></span></code></pre>
<p>Here, <code>path</code> is the directory or file to start the search from, and <code>expression</code> specifies the search criteria. The <code>expression</code> consists of various tests and actions separated by operators such as <code>-and</code>, <code>-or</code>, <code>-not</code>, and <code>(</code> and <code>)</code>. Some common tests include <code>-name</code>, which matches files by name, <code>-type</code>, which matches files by type, <code>-size</code>, which matches files by size, and <code>-mtime</code>, which matches files by modification time. Some common actions include <code>-print</code>, which prints the names of matching files, <code>-exe, which executes a command on matching files, and</code>-delete`, which deletes matching files.</p>
<p>The <code>find</code> command is a complex tool with many options and features, and can be used for a wide variety of search and file management tasks. It is widely used in system administration, software development, and data analysis.</p>
<p>Designing the C++ implementation of the find command
The <code>find</code> command is used to search for files and directories in a given path that match a specified set of criteria. The criteria can include the file name, modification time, file size, and more.</p>
<p>To design the C++ implementation of the <code>find</code> command, we need to consider the following steps:</p>
<ol>
<li>Reading and processing the input path and search criteria</li>
<li>Implementing the find functionality by recursively traversing the directory tree and checking each file and directory against the search criteria</li>
<li>Outputting the results to the console</li>
<li>Testing the <code>find</code> command</li>
</ol>
<p>Let’s take a closer look at each of these steps.</p>
<p>Reading and processing the input directory and search query
To implement the <code>find</code> command, we need to take two input parameters: the directory to search in and the search query. The search query can include one or more search terms, such as filenames, file extensions, file types, or other attributes.</p>
<p>The basic functionality of the <code>find</code> command is to traverse the given directory recursively and search for files and directories that match the search query. The search results can then be displayed to the user.</p>
<p>To implement the <code>find</code> command, we can use the following steps:</p>
<ol>
<li>Parse the input parameters, i.e., the directory to search in and the search query.</li>
<li>Open the directory to search and traverse it recursively.</li>
<li>For each file and directory encountered, check if it matches the search query. This can involve checking the file name, extension, type, size, and other attributes.</li>
<li>If the file or directory matches the search query, add it to the search results.</li>
<li>Once the traversal is complete, display the search results to the user.</li>
</ol>
<p>We can use the <code>boost::filesystem</code> library to traverse directories and search for files and directories. We can also use regular expressions to match the search query with file and directory names and extensions.</p>
<p>Implementing the find functionality
To implement the <code>find</code> command in C++, we can follow these steps:</p>
<ol>
<li>Parse the command-line arguments to get the input directory and search query.</li>
<li>Traverse the input directory recursively using a depth-first search algorithm.</li>
<li>For each file or directory encountered, check if its name matches the search query. If so, print its absolute path to the console.</li>
<li>When the traversal is complete, exit the program.</li>
</ol>
<p>Here’s some sample code that demonstrates this implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;filesystem></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">namespace</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">filesystem</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">traverse</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> fs::</span><span style="color: #E5C07B">path</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">dir_path</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">search_query</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">{</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> entry : fs::</span><span style="color: #61AFEF">directory_iterator</span><span style="color: #ABB2BF">(dir_path))</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">path</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is_directory</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">traverse</span><span style="color: #ABB2BF">(path, search_query);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">entry</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is_regular_file</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">filename</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">string</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">find</span><span style="color: #ABB2BF">(search_query) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> std::string::npos)</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[])</span></span>
<span class="line"><span style="color: #ABB2BF">{</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" &#x3C;dir_path> &#x3C;search_query>"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::string dir_path </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::string search_query </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">traverse</span><span style="color: #ABB2BF">(dir_path, search_query);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this implementation, we use the <code>std::filesystem</code> library to traverse the directory tree and check if each entry is a file or directory. We then use the <code>std::string</code> <code>find</code> method to check if the filename contains the search query. If so, we print the absolute path of the file to the console.</p>
<p>We also perform some error checking to ensure that the program is called with the correct number of command-line arguments. If not, we print a usage message to the console and exit with an error code.</p>
<p>Outputting the results to the console
Once we have found all the files that match the search query, we can output their paths to the console. We can do this using a loop to iterate through the vector of file paths and output each one using the <code>cout</code> object.</p>
<p>Here’s some sample code that shows how this could be done:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Output the results to the console</span></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> path : paths) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code iterates through each path in the <code>paths</code> vector and outputs it to the console using the <code>cout</code> object. The <code>endl</code> function is used to insert a newline character after each path so that they appear on separate lines.</p>
<p>We could also provide options for the user to output the results to a file instead of the console by redirecting the output to a file stream.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Open the output file</span></span>
<span class="line"><span style="color: #ABB2BF">std::</span><span style="color: #E5C07B">ofstream</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">outFile</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"output.txt"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Output the results to the file</span></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> path : paths) {</span></span>
<span class="line"><span style="color: #ABB2BF"> outFile </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Close the output file</span></span>
<span class="line"><span style="color: #E5C07B">outFile</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span></code></pre>
<p>This code opens an output file stream to the file named “output.txt”. It then outputs the results to the file in the same way as before, but using the file stream instead of the <code>cout</code> object. Finally, the output file stream is closed to free up system resources.</p>
<p>Testing the find command
As I am a language model, I don’t have access to a file system to perform tests. However, the find command can be tested by running it on a directory with known files and checking that the expected files are returned in the output. Additionally, edge cases can be tested, such as when the specified directory does not exist or when the search query is empty.</p>
<h1 id="chapter-10-building-a-grep-command">Chapter 10: Building a Grep Command</h1>
<p>Overview of the grep command and its functionality
The <code>grep</code> command is a commonly used command in Unix-like systems that is used for searching files for lines that match a particular pattern. The name “grep” is derived from the command “global regular expression print”.</p>
<p>The <code>grep</code> command takes one or more patterns as input, and searches one or more files or streams for lines that contain the patterns. If a line matches any of the patterns, it is printed to the console or redirected to a file.</p>
<p>The <code>grep</code> command provides a number of options that allow for more complex searches, including regular expression searches, case-insensitive searches, recursive searches, and more.</p>
<p>Designing the C++ implementation of the grep command
The <code>grep</code> command is a tool used to search for a specified pattern in a file or input stream. The basic functionality of the <code>grep</code> command is to print all the lines of a file or input stream that contain a given pattern. Here’s a possible design for the C++ implementation of the <code>grep</code> command:</p>
<ol>
<li>Read and process the command-line arguments: The <code>grep</code> command should take the following arguments:</li>
</ol>
<ul>
<li>The search pattern: A string to search for in the input stream.</li>
<li>The input file(s): One or more files to search for the pattern. If no input file is specified, the standard input stream should be used.</li>
<li>Optional arguments: Options that modify the behavior of the command, such as:</li>
<li><code>-i</code>: Ignore case when matching the pattern.</li>
<li><code>-v</code>: Invert the match, i.e., print all the lines that do not contain the pattern.</li>
<li><code>-n</code>: Print the line numbers along with the matching lines.</li>
<li>`-: Print only the count of matching lines.</li>
<li><code>-l</code>: Print only the names of the files that contain the pattern.</li>
</ul>
<ol start="2">
<li>Open the input file(s): If one or more input files are specified, open them for reading. If no input file is specified, read from the standard input stream.</li>
<li>Read and process the input stream: Read the input stream line by line and search for the pattern in each line. Depending on the options specified, either print the matching lines, the line numbers, the count of matching lines, or the names of the files that contain the pattern.</li>
<li>Close the input file(s): If one or more input files were opened, close them.</li>
<li>Exit the program.</li>
</ol>
<p>This design can be further refined and optimized based on the specific requirements and constraints of the <code>grep</code> command implementation.</p>
<p>Reading and processing the input file and search query
To implement the <code>grep</code> command, we need to read and process the input file and search query.</p>
<p>We can use the following steps:</p>
<ol>
<li>Read the input file line by line.</li>
<li>For each line, check if it contains the search query.</li>
<li>If the line contains the search query, store it in a string vector or output it to the console.</li>
<li>Repeat steps 1-3 until the end of the file is reached.</li>
</ol>
<p>Here’s some sample code for reading and processing the input file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;fstream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;vector></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Check if input file is provided</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" &#x3C;input file> &#x3C;search query>"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Open input file</span></span>
<span class="line"><span style="color: #ABB2BF"> std::ifstream </span><span style="color: #61AFEF">infile</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">infile</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is_open</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: could not open file"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Read input file line by line and process each line</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string line;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">getline</span><span style="color: #ABB2BF">(infile, line)) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Check if line contains search query</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">line</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">find</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> std::string::npos) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Store or output the matching line</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Close input file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">infile</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Note that this is just a basic template and needs to be customized based on the specific requirements of the <code>grep</code> command. For example, we may need to add options for case-insensitive search, regular expressions, or searching multiple files.</p>
<p>Implementing the grep functionality
To implement the <code>grep</code> command in C++, we will follow these steps:</p>
<ol>
<li>Open the input file.</li>
<li>Read the file line by line.</li>
<li>Search for the search query in each line.</li>
<li>If the query is found in a line, print the line to the console.</li>
<li>Close the input file.</li>
</ol>
<p>Here’s the sample code for implementing the <code>grep</code> functionality:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;fstream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">using</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">namespace</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">grep</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">filename</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">query</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> ifstream </span><span style="color: #61AFEF">input</span><span style="color: #ABB2BF">(filename);</span></span>
<span class="line"><span style="color: #ABB2BF"> string line;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">getline</span><span style="color: #ABB2BF">(input, line)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">line</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">find</span><span style="color: #ABB2BF">(query) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> string::npos) {</span></span>
<span class="line"><span style="color: #ABB2BF"> cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> line </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we first open the input file using <code>ifstream</code> and read the file line by line using <code>getline()</code>. We then search for the search query in each line using the <code>find()</code> function, which returns the index of the first occurrence of the query in the line, or <code>string::npos</code> if the query is not found. If the query is found, we print the line to the console. Finally, we close the input file using <code>close()</code>.</p>
<p>Outputting the results to the console
To output the results to the console, we can simply loop through the <code>matched_lines</code> vector and print out each line. Here’s an example implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">print_matched_lines</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">vector</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">></span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">matched_lines</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">auto</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF"> line : matched_lines) {</span></span>
<span class="line"><span style="color: #ABB2BF"> cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> line </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>We can call this function after calling the <code>find_matched_lines</code> function to print out all the lines that match the search query.</p>
<p>Testing the grep command
However, I can provide you with an example of how the <code>grep</code> command works with a sample input and output.</p>
<p>Suppose we have a file named <code>example.txt</code> with the following contents:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">Hello, world</span><span style="color: #56B6C2">!</span></span>
<span class="line"><span style="color: #ABB2BF">This is an example file.</span></span>
<span class="line"><span style="color: #ABB2BF">It contains some text.</span></span></code></pre>
<p>If we want to search for the word “example” in this file, we can run the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">grep </span><span style="color: #98C379">"example"</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">example</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>The output will be:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">This is an example file.</span></span></code></pre>
<p>This output shows the line in the file that contains the searched word “example”. If there were multiple occurrences of the word in the file, then <code>grep</code> would display all of the matching lines.</p>
<h1 id="chapter-11-building-a-tar-command">Chapter 11: Building a Tar Command</h1>
<p>Overview of the tar command and its functionality
The <code>tar</code> command is a popular utility in Unix-like systems that allows for the creation, extraction, and manipulation of tar archives. Tar archives are a way to combine multiple files into a single file for easier distribution, storage, or backup.</p>
<p>The basic syntax for the <code>tar</code> command is:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">tar [options] archive</span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">file files</span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">directories</span></span></code></pre>
<p>where <code>options</code> are various flags that modify the behavior of the <code>tar</code> command, <code>archive-file</code> is the name of the tar archive file, and <code>files/directories</code> are the files or directories that will be added to or extracted from the archive file.</p>
<p>Some common options for the <code>tar</code> command include:</p>
<ul>
<li>`- : create a new archive</li>
<li><code>-x</code> : extract files from an archive</li>
<li><code>-f</code> : specify the name of the archive file</li>
<li><code>-v</code> : verbose output (list the files being processed)</li>
<li><code>-z</code> : use gzip compression</li>
<li><code>-j</code> : use bzip2 compression</li>
<li><code>-t</code> : list the contents of an archive</li>
</ul>
<p>For example, to create a new tar archive called <code>my_archive.tar</code> containing all files and directories in the current directory, the command would be:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">tar </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">czf </span><span style="color: #E5C07B">my_archive</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">tar</span><span style="color: #ABB2BF"> .</span></span></code></pre>
<p>To extract all files from <code>my_archive.tar</code>, the command would be:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">tar </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">xzf </span><span style="color: #E5C07B">my_archive</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">tar</span></span></code></pre>
<p>Designing the C++ implementation of the tar command
The <code>tar</code> command is used for archiving multiple files into a single file, often called a “tarball”. It has several options to control the archiving process, such as compression, preserving file permissions, and more.</p>
<p>In the C++ implementation of the <code>tar</code> command, we will need to handle the following functionalities:</p>
<ol>
<li>Reading and processing the input files or directories to be archived.</li>
<li>Archiving the input files or directories into a single tar file.</li>
<li>Providing options to control the archiving process, such as compression and file permissions.</li>
<li>Extracting the contents of a tar file.</li>
<li>Listing the contents of a tar file.</li>
</ol>
<p>To implement these functionalities, we will need to use libraries such as <code>libtar</code>, <code>zlib</code> for compression, and <code>boost</code> for handling file paths and permissions. We will also need to use system calls such as <code>open()</code>, <code>read()</code>, and <code>write()</code> to read and write files.</p>
<p>The basic steps for implementing the <code>tar</code> command are:</p>
<ol>
<li>Parse the command-line arguments to determine the options and input files or directories.</li>
<li>For archiving, iterate through the input files or directories and add them to the tar file.</li>
<li>For extraction, read the contents of the tar file and extract them to the specified output directory.</li>
<li>For listing, read the contents of the tar file and output them to the console.</li>
<li>Handle any errors that may occur during the archiving or extraction process, such as file not found or insufficient permissions.</li>
</ol>
<p>Reading and processing the input files or directories
To implement the <code>tar</code> command, we need to read and process the input files or directories. The <code>tar</code> command creates an archive file that contains one or more files or directories.</p>
<p>To do this, we can accept a list of file or directory paths as input. We can use the <code>stat</code> function to get information about each file or directory. If a path points to a regular file, we can add it to the archive. If the path points to a directory, we can recursively add its contents to the archive.</p>
<p>Here’s some sample code to illustrate the basic idea:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add_to_archive</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">archive_name</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">info) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // handle error</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISREG</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add_file_to_archive</span><span style="color: #ABB2BF">(path, archive_name);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISDIR</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add_directory_to_archive</span><span style="color: #ABB2BF">(path, archive_name);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add_file_to_archive</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">file_path</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">archive_name</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // open the file and add it to the archive</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // ...</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add_directory_to_archive</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">dir_path</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">archive_name</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // recursively add the contents of the directory to the archive</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // ...</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Note that we’ll also need to define a file format for the archive, which specifies how the files and directories are stored in the archive. The most common format is the “tarball” format, which uses a linear sequence of file entries. Each file entry contains metadata about a file or directory (such as its name, permissions, and modification time) followed by the file’s contents. We’ll need to define functions to write these file entries to the archive and read them back out again when extracting files from the archive.</p>
<p>Implementing the tar functionality
To implement the <code>tar</code> command in C++, we can use the <code>libtar</code> library, which provides an API for creating and manipulating tar archives.</p>
<p>First, we need to include the <code>libtar.h</code> header file and link against the <code>libtar</code> library. Then, we can create a <code>TAR*</code> object to represent the tar archive, and call functions like <code>tar_open()</code>, <code>tar_append_file()</code>, and <code>tar_append_dir()</code> to add files and directories to the archive. Finally, we can call <code>tar_close()</code> to close the archive.</p>
<p>Here’s an example implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;cstring></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;sys/stat.h></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;tar.h></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Check that the correct number of arguments were provided</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" &#x3C;tarfile> &#x3C;file/dir> [&#x3C;file/dir> ...]</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Open the tar archive for writing</span></span>
<span class="line"><span style="color: #ABB2BF"> TAR</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> archive </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tar_open</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">], </span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">, O_WRONLY </span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> O_CREAT </span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> O_TRUNC, </span><span style="color: #E06C75">0</span><span style="color: #D19A66">644</span><span style="color: #ABB2BF">, TAR_GNU);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (archive </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Failed to open archive: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">strerror</span><span style="color: #ABB2BF">(errno) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Add each file or directory to the archive</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">; i </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> argc; i</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i], </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">info) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Failed to get file/directory information: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">strerror</span><span style="color: #ABB2BF">(errno) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tar_close</span><span style="color: #ABB2BF">(archive);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISDIR</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Add the directory to the archive</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">tar_append_dir</span><span style="color: #ABB2BF">(archive, </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i], </span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Failed to add directory to archive: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">strerror</span><span style="color: #ABB2BF">(errno) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tar_close</span><span style="color: #ABB2BF">(archive);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">S_ISREG</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">info</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">st_mode</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Add the file to the archive</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">tar_append_file</span><span style="color: #ABB2BF">(archive, </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[i], </span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Failed to add file to archive: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">strerror</span><span style="color: #ABB2BF">(errno) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tar_close</span><span style="color: #ABB2BF">(archive);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Unsupported file type</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tar_close</span><span style="color: #ABB2BF">(archive);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Close the archive</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">tar_close</span><span style="color: #ABB2BF">(archive) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: Failed to close archive: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">strerror</span><span style="color: #ABB2BF">(errno) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Archive created successfully</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This implementation takes two or more command-line arguments: the name of the tar archive to create, and one or more files or directories to add to the archive. It uses the <code>stat()</code> function to determine whether each argument is a file or directory, and calls <code>tar_append_file()</code> or <code>tar_append_dir()</code> to add it to the archive accordingly. Finally, it calls <code>tar_close()</code> to close the archive.</p>
<p>Note that this implementation only supports the GNU tar format (<code>TAR_GNU</code>). If you want to support other formats, you may need to modify the <code>tar_open()</code> call accordingly.</p>
<p>Outputting the results to the console or archive file
The <code>tar</code> command can output the results to the console or to an archive file. We will implement both options.</p>
<p>To output to the console, we will use <code>std::cout</code> to print the contents of the tar archive as we read them from the input file.</p>
<p>To output to an archive file, we will use the <code>std::ofstream</code> class to create and write to the archive file.</p>
<p>Here is an example of how we can output the contents of a tar archive to the console:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">list_contents</span><span style="color: #ABB2BF">(std::</span><span style="color: #E5C07B">vector</span><span style="color: #ABB2BF">&#x3C;std::</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">> </span><span style="color: #E06C75; font-style: italic">files</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">auto</span><span style="color: #ABB2BF"> file : files) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::ifstream </span><span style="color: #61AFEF">input</span><span style="color: #ABB2BF">(file, std::ios::binary);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">input) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: failed to open file "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> file </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (input) {</span></span>
<span class="line"><span style="color: #ABB2BF"> tar_header header;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">read</span><span style="color: #ABB2BF">(reinterpret_cast</span><span style="color: #C678DD">&#x3C;char</span><span style="color: #56B6C2">*</span><span style="color: #C678DD">></span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">header), </span><span style="color: #C678DD">sizeof</span><span style="color: #ABB2BF">(header));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">gcount</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">sizeof</span><span style="color: #ABB2BF">(header)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">header</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">seekg</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">header</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_filesize</span><span style="color: #ABB2BF">(), std::ios::cur);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>And here is an example of how we can output the contents of a tar archive to an archive file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">void</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">create_tar_archive</span><span style="color: #ABB2BF">(std::</span><span style="color: #E5C07B">vector</span><span style="color: #ABB2BF">&#x3C;std::</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">> </span><span style="color: #E06C75; font-style: italic">files</span><span style="color: #ABB2BF">, std::</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">archive_name</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::ofstream </span><span style="color: #61AFEF">output</span><span style="color: #ABB2BF">(archive_name, std::ios::binary);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">output) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: failed to create file "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> archive_name </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">auto</span><span style="color: #ABB2BF"> file : files) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::ifstream </span><span style="color: #61AFEF">input</span><span style="color: #ABB2BF">(file, std::ios::binary);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">input) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error: failed to open file "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> file </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> tar_header header;</span></span>
<span class="line"><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">memset</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">header, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">sizeof</span><span style="color: #ABB2BF">(header));</span></span>
<span class="line"><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">strncpy</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">header</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), </span><span style="color: #C678DD">sizeof</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">header</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">header</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_filesize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">filesystem</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">file_size</span><span style="color: #ABB2BF">(file));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(reinterpret_cast</span><span style="color: #C678DD">&#x3C;char</span><span style="color: #56B6C2">*</span><span style="color: #C678DD">></span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">header), </span><span style="color: #C678DD">sizeof</span><span style="color: #ABB2BF">(header));</span></span>
<span class="line"><span style="color: #ABB2BF"> output </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">rdbuf</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">close</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Note that the <code>tar_header</code> class contains the information for each file in the archive, such as the filename and file size, and has a <code>get_filesize()</code> function to return the actual size of the file in bytes.</p>
<p>Testing the tar command
Providing guidance on how to test it manually.</p>
<p>To test the <code>tar</code> command, you can follow these steps:</p>
<ol>
<li>Create a few files and directories in a test directory.</li>
<li>Use the <code>tar</code> command to create an archive file containing the test directory.</li>
<li>Verify that the archive file has been created and contains the expected files and directories.</li>
<li>Extract the archive file to a new directory.</li>
<li>Verify that the new directory has been created and contains the expected files and directories.</li>
</ol>
<p>By following these steps, you can verify that the <code>tar</code> command works as expected and correctly archives and extracts files and directories.</p>
<h1 id="chapter-12-building-a-chmod-command">Chapter 12: Building a Chmod Command</h1>
<p>Overview of the chmod command and its functionality
The <code>chmod</code> command is used to change the file permissions of a file or directory. The file permissions determine who can read, write, or execute a file. The <code>chmod</code> command can be used to add or remove specific permissions for the owner, group, or others.</p>
<p>The file permissions are represented by a three-digit octal number, where each digit represents the permissions for the owner, group, and others, respectively. The permissions are represented by the bits in the octal number, where 4 represents read permission, 2 represents write permission, and 1 represents execute permission. For example, 755 represents read, write, and execute permission for the owner, and read and execute permission for the group and others.</p>
<p>The <code>chmod</code> command can also be used to change the file ownership and group ownership of a file or directory. The file ownership determines who owns the file, while the group ownership determines which group the file belongs to.</p>
<p>Designing the C++ implementation of the chmod command
The <code>chmod</code> command is used to change the file permissions of a file or directory. The basic syntax of the command is:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">chmod [options] mode </span><span style="color: #61AFEF">file</span><span style="color: #ABB2BF">(s)</span></span></code></pre>
<p>where <code>options</code> are optional arguments, <code>mode</code> is the new permissions to set, and <code>file(s)</code> is the list of files or directories to change permissions on.</p>
<p>The <code>mode</code> argument is typically a 3-digit octal number representing the desired permissions for the file or directory. The first digit specifies the permissions for the owner of the file, the second digit specifies the permissions for the group that the file belongs to, and the third digit specifies the permissions for everyone else. Each digit is the sum of the permissions that are allowed, where <code>4</code> represents read permission, <code>2</code> represents write permission, and <code>1</code> represents execute permission. For example, a mode of <code>644</code> would give the owner read and write permission and everyone else read permission.</p>
<p>In addition to the numeric mode, it is also possible to use symbolic modes to change the permissions of a file. The symbolic mode is of the form <code>[ugoa][+-=][rwx]</code>, where <code>u</code> specifies the owner of the file, <code>g</code> specifies the group, <code>o</code> specifies everyone else, and <code>a</code> specifies all three. The <code>+</code> sign adds the specified permission, <code>-</code> removes it, and <code>=</code> sets it to exactly the specified permission.</p>
<p>In designing the C++ implementation of the <code>chmod</code> command, we will need to use the <code>chmod</code> function from the <code>sys/stat.h</code> library to change the permissions of the specified file or directory. We will also need to parse the input arguments to determine the desired permissions mode and the files or directories to modify.</p>
<p>Reading and processing the input file or directory and permission settings
To implement the <code>chmod</code> command, we need to read and process the input file or directory and permission settings. The permission settings can be in either of the following formats:</p>
<ol>
<li>Symbolic mode: In this format, we use a combination of the letters “r”, “w”, “x”, “s”, “t”, ”-”, and ”+” to specify the new permissions.</li>
</ol>
<p>For example, to grant read, write, and execute permissions to the owner and group of a file, we can use the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">chmod u</span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF">rwx,g</span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF">rwx filename</span></span></code></pre>
<ol start="2">
<li>Absolute mode: In this format, we use a three-digit octal number to represent the new permissions.</li>
</ol>
<p>The first digit represents the permissions for the owner, the second digit represents the permissions for the group, and the third digit represents the permissions for others.</p>
<p>Each digit is the sum of the permissions for that category. The permissions are represented as follows:</p>
<ul>
<li>4: read permission</li>
<li>2: write permission</li>
<li>1: execute permissionFor example, to grant read, write, and execute permissions to the owner, read and execute permissions to the group, and read-only permission to others, we can use the following command:</li>
</ul>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">chmod </span><span style="color: #D19A66">750</span><span style="color: #ABB2BF"> filename</span></span></code></pre>
<p>To implement the <code>chmod</code> command, we need to parse the input arguments and extract the file or directory path and the permission settings. We can then use the <code>chmod</code> system call to set the new permissions for the specified file or directory.</p>
<p>Implementing the chmod functionality
To implement the <code>chmod</code> command, we need to use the <code>chmod</code> system call. The <code>chmod</code> function requires the path of the file or directory whose permissions need to be changed, as well as the new permissions to be set.</p>
<p>Here is a possible implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;cstdlib></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;cstring></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;cerrno></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;sys/stat.h></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">using</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">namespace</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Check if we have the correct number of arguments</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: chmod &#x3C;mode> &#x3C;file>"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(EXIT_FAILURE);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Get the new mode from the command line arguments</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mode_t</span><span style="color: #ABB2BF"> new_mode </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">strtol</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">], </span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Get the path of the file or directory to modify</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">char</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Call chmod with the new mode and path</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">chmod</span><span style="color: #ABB2BF">(path, new_mode) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error changing permissions of "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">": "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">strerror</span><span style="color: #ABB2BF">(errno) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(EXIT_FAILURE);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Permissions of "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" changed to "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> oct </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> new_mode </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this implementation, we first check if we have the correct number of arguments (2: the new mode and the path of the file or directory to modify). We then use the <code>strtol</code> function to convert the new mode from a string to an integer. Note that we use a base of 8 to indicate that the new mode is in octal notation (as is customary for Unix file permissions).</p>
<p>We then call <code>chmod</code> with the new mode and path. If an error occurs, we print an error message using <code>strerror</code> to convert the <code>errno</code> error code into a human-readable string. Otherwise, we print a success message to the console.</p>
<p>Outputting the results to the console
The <code>chmod</code> command doesn’t typically produce any output to the console. If the command succeeds, it simply changes the permissions of the specified file(s) or directory(ies) without generating any output. If the command fails, it may produce an error message on the console explaining the reason for the failure.</p>
<p>In our C++ implementation, we can print an error message to the console if the <code>chmod</code> function fails to set the specified permissions. For example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">chmod</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), mode) </span><span style="color: #C678DD">==</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Error changing permissions for "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> path </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">": "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">strerror</span><span style="color: #ABB2BF">(errno) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code checks the return value of <code>chmod</code> and prints an error message to <code>stderr</code> using <code>std::cerr</code> if it fails. The <code>strerror</code> function is used to get a human-readable error message corresponding to the error code stored in <code>errno</code>.</p>
<p>Testing the chmod command
However, you can manually test the command by running it on files or directories with different permission settings and verifying that the permissions have been changed accordingly using the <code>ls -l</code> command to display the file permissions.</p>
<p>For example, you could create a new file using the <code>touch</code> command and then change its permission settings using <code>chmod</code>. You can verify that the permission settings have been changed by using the <code>ls -l</code> command to display the permissions of the file before and after running the <code>chmod</code> command.</p>
<p>Here’s an example of how you can test the <code>chmod</code> command:</p>
<ol>
<li>Create a new file called <code>testfile.txt</code> using the <code>touch</code> command:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">touch </span><span style="color: #E5C07B">testfile</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<ol start="2">
<li>Check the permission settings of the file using the <code>ls -l</code> command:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">ls </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">l </span><span style="color: #E5C07B">testfile</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>The output should look something like this:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">rw</span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">r</span><span style="color: #C678DD">--</span><span style="color: #ABB2BF">r</span><span style="color: #C678DD">--</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> user group </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> Mar </span><span style="color: #D19A66">31</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">0</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">testfile</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<ol start="3">
<li>Change the permission settings of the file using the <code>chmod</code> command:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">chmod </span><span style="color: #D19A66">700</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">testfile</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<ol start="4">
<li>Check the permission settings of the file again using the <code>ls -l</code> command:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">ls </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">l </span><span style="color: #E5C07B">testfile</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>The output should now look something like this:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">rwx</span><span style="color: #C678DD">------</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> user group </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> Mar </span><span style="color: #D19A66">31</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">0</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">testfile</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>Note that the permission settings have been changed from <code>-rw-r--r--</code> to <code>-rwx------</code>. This means that the owner of the file (<code>user</code>) has read, write, and execute permissions, while members of the group and others have no permissions.</p>
<h1 id="chapter-13-building-a-wget-command">Chapter 13: Building a Wget Command</h1>
<p>Overview of the wget command and its functionality
Sure, here’s an overview of the wget command and its functionality:</p>
<p>The wget command is a powerful utility tool used for downloading files from the internet via the command line interface. It supports downloading files from HTTP, HTTPS, and FTP servers. With wget, you can download files recursively, follow links and mirror entire websites.</p>
<p>Here’s an example of how to use wget to download a single file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">wget https:</span><span style="color: #7F848E; font-style: italic">//example.com/file.txt</span></span></code></pre>
<p>This will download the file.txt file from the example.com website to the current directory.</p>
<p>Here’s an example of how to use wget to download an entire website:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">wget </span><span style="color: #C678DD">--</span><span style="color: #ABB2BF">mirror </span><span style="color: #C678DD">--</span><span style="color: #ABB2BF">convert</span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">links </span><span style="color: #C678DD">--</span><span style="color: #ABB2BF">adjust</span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">extension </span><span style="color: #C678DD">--</span><span style="color: #ABB2BF">page</span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">requisites </span><span style="color: #C678DD">--</span><span style="color: #ABB2BF">no</span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">parent https:</span><span style="color: #7F848E; font-style: italic">//example.com</span></span></code></pre>
<p>This will download the entire example.com website and save it to a directory named after the website in the current directory. The —mirror option enables recursive downloading, —convert-links ensures that links within the downloaded HTML pages are modified to point to the local files, —adjust-extension adds the correct file extensions, —page-requisites downloads all page components needed to render the HTML pages properly, and —no-parent ensures that wget does not download files from parent directories.</p>
<p>Designing the C++ implementation of the wget command
Sure, here’s a high-level overview of how we could design the C++ implementation of the wget command:</p>
<ol>
<li>Parse command line arguments: The program should accept command line arguments such as the URL to download, the location to save the downloaded file(s), and any other flags to specify the behavior of the program.</li>
<li>Establish a connection to the server: Once the URL is parsed, we need to establish a connection to the server using the appropriate protocol (HTTP, HTTPS, or FTP).</li>
<li>Send the appropriate request: After establishing the connection to the server, we need to send a request for the file or files we wish to download. This involves sending an HTTP GET request to the server with the appropriate headers and parameters.</li>
<li>Receive the response: Once the server receives the request, it will send a response. We need to receive the response, parse the headers and response body, and handle any errors that may occur.</li>
<li>Save the file(s) to disk: Once we have successfully received the response, we can save the file or files to disk. This involves creating a new file or appending to an existing file and writing the response body to the file.</li>
<li>Handle any redirects or recursive downloads: If the user specified the appropriate flags, we may need to handle redirects or recursively download additional files from the server.</li>
<li>Clean up resources: Once the download is complete, we need to close any open connections and clean up any allocated resources.</li>
</ol>
<p>This is just a high-level overview of the design process, and there are many implementation details that need to be considered. However, this should give you a rough idea of how we could design a C++ implementation of the wget command.</p>
<p>Reading and processing the input URL and download options
Sure, here’s an example of how we could read and process the input URL and download options in our C++ implementation of the wget command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;vector></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;getopt.h></span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char**</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string url;</span><span style="color: #7F848E; font-style: italic"> // The URL to download</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string output_dir;</span><span style="color: #7F848E; font-style: italic"> // The output directory to save the downloaded file(s)</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> recursive </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // Whether to download recursively</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> follow_links </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // Whether to follow links during recursive downloads</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Define the available command line options using getopt</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">static</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">option</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">long_options</span><span style="color: #ABB2BF">[] </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span><span style="color: #98C379">"recursive"</span><span style="color: #ABB2BF">, no_argument, </span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'r'</span><span style="color: #ABB2BF">},</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span><span style="color: #98C379">"follow-links"</span><span style="color: #ABB2BF">, no_argument, </span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'l'</span><span style="color: #ABB2BF">},</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span><span style="color: #98C379">"output-dir"</span><span style="color: #ABB2BF">, required_argument, </span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'o'</span><span style="color: #ABB2BF">},</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">nullptr</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #ABB2BF"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> option_index </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> c;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> ((c </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">getopt_long</span><span style="color: #ABB2BF">(argc, argv, </span><span style="color: #98C379">"rlo:"</span><span style="color: #ABB2BF">, long_options, </span><span style="color: #56B6C2">&#x26;</span><span style="color: #ABB2BF">option_index)) </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">switch</span><span style="color: #ABB2BF"> (c) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'r'</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF"> recursive </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'l'</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF"> follow_links </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'o'</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF"> output_dir </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">string</span><span style="color: #ABB2BF">(optarg);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">default</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Unknown option"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // The remaining argument should be the URL to download</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (optind </span><span style="color: #C678DD">>=</span><span style="color: #ABB2BF"> argc) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"URL argument missing"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> url </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> std::</span><span style="color: #61AFEF">string</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[optind]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // TODO: Download the file or files based on the user-specified options</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use the getopt library to parse the command line options specified by the user. We define three options: <code>--recursive</code> (or <code>-r</code>) to enable recursive downloads, <code>--follow-links</code> (or <code>-l</code>) to enable link following during recursive downloads, and <code>--output-dir</code> (or <code>-o</code>) to specify the output directory for the downloaded file(s). We use the <code>switch</code> statement to handle each option and set the corresponding variables.</p>
<p>After parsing the options, we check that there is at least one remaining argument, which should be the URL to download. We store the URL in the <code>url</code> variable.</p>
<p>Note that this is just an example, and there are many other options and error cases that we may want to handle in our implementation.</p>
<p>Implementing the wget functionality in C++ provide an example
Sure, here’s an example implementation of the wget functionality in C++ using the <code>libcurl</code> library:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;curl/curl.h></span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Callback function to write received data to a file</span></span>
<span class="line"><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">write_data</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">void*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">ptr</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">size</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">nmemb</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">FILE</span><span style="color: #C678DD">*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">stream</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> written </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fwrite</span><span style="color: #ABB2BF">(ptr, size, nmemb, stream);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> written;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Downloads a file from the given URL and saves it to the specified output file</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Returns true on success, false on failure</span></span>
<span class="line"><span style="color: #C678DD">bool</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">download_file</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">url</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> std::</span><span style="color: #E5C07B">string</span><span style="color: #C678DD">&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">output_file</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Initialize libcurl</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">curl_global_init</span><span style="color: #ABB2BF">(CURL_GLOBAL_ALL);</span></span>
<span class="line"><span style="color: #ABB2BF"> CURL</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> curl </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">curl_easy_init</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">curl) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Failed to initialize curl"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Set the URL to download</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">curl_easy_setopt</span><span style="color: #ABB2BF">(curl, CURLOPT_URL, </span><span style="color: #E5C07B">url</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Set the callback function to write data to a file</span></span>
<span class="line"><span style="color: #ABB2BF"> FILE</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> fp </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fopen</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">output_file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), </span><span style="color: #98C379">"wb"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">fp) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Failed to open output file: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> output_file </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">curl_easy_setopt</span><span style="color: #ABB2BF">(curl, CURLOPT_WRITEFUNCTION, write_data);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">curl_easy_setopt</span><span style="color: #ABB2BF">(curl, CURLOPT_WRITEDATA, fp);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Perform the request and check for errors</span></span>
<span class="line"><span style="color: #ABB2BF"> CURLcode res </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">curl_easy_perform</span><span style="color: #ABB2BF">(curl);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (res </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> CURLE_OK) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Failed to download file: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">curl_easy_strerror</span><span style="color: #ABB2BF">(res) </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Clean up and close the file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">curl_easy_cleanup</span><span style="color: #ABB2BF">(curl);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fclose</span><span style="color: #ABB2BF">(fp);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char**</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Parse command line arguments</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" &#x3C;url> &#x3C;output_file>"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string url </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string output_file </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Download the file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #61AFEF">download_file</span><span style="color: #ABB2BF">(url, output_file)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Failed to download file"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"File downloaded successfully"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a <code>download_file</code> function that takes a URL and an output file path as parameters. The function initializes libcurl, sets the URL and callback function for writing received data to a file, performs the request, and cleans up the curl handle and file resources.</p>
<p>In <code>main</code>, we parse the command line arguments, call the <code>download_file</code> function, and check for errors. If the download is successful, we print a success message.</p>
<p>Note that this is a simple example that does not handle redirects or recursive downloads. Also, error handling is minimal and could be improved for production use.</p>
<p>Outputting the results to the console or downloaded file
In the previous example, the downloaded file is saved to disk using the <code>write_data</code> callback function. To output the results to the console instead, we can modify the <code>write_data</code> function to write to standard output:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Callback function to write received data to standard output</span></span>
<span class="line"><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">write_data</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">void*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">ptr</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">size</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">nmemb</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">void*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">stream</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> written </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fwrite</span><span style="color: #ABB2BF">(ptr, size, nmemb, stdout);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> written;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Then, in the <code>download_file</code> function, we can set the <code>CURLOPT_WRITEDATA</code> option to <code>NULL</code> to indicate that we want to write the data to standard output instead of a file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Set the callback function to write data to standard output</span></span>
<span class="line"><span style="color: #61AFEF">curl_easy_setopt</span><span style="color: #ABB2BF">(curl, CURLOPT_WRITEFUNCTION, write_data);</span></span>
<span class="line"><span style="color: #61AFEF">curl_easy_setopt</span><span style="color: #ABB2BF">(curl, CURLOPT_WRITEDATA, </span><span style="color: #D19A66">NULL</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>With these modifications, the downloaded data will be output to standard output instead of a file. Alternatively, if we want to save the downloaded data to a file and also output it to the console, we can modify the <code>write_data</code> function to write to both the file and standard output:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Callback function to write received data to a file and standard output</span></span>
<span class="line"><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">write_data</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">void*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">ptr</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">size</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">nmemb</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">void*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">userdata</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> FILE</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> fp </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> (FILE</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF">)userdata;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">size_t</span><span style="color: #ABB2BF"> written </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fwrite</span><span style="color: #ABB2BF">(ptr, size, nmemb, fp);</span></span>
<span class="line"><span style="color: #ABB2BF"> written </span><span style="color: #C678DD">+=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fwrite</span><span style="color: #ABB2BF">(ptr, size, nmemb, stdout);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> written;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Then, in the <code>download_file</code> function, we set the <code>CURLOPT_WRITEDATA</code> option to the file pointer:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Set the callback function to write data to a file and standard output</span></span>
<span class="line"><span style="color: #ABB2BF">FILE</span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> fp </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fopen</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">output_file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">c_str</span><span style="color: #ABB2BF">(), </span><span style="color: #98C379">"wb"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">fp) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Failed to open output file: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> output_file </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #61AFEF">curl_easy_setopt</span><span style="color: #ABB2BF">(curl, CURLOPT_WRITEFUNCTION, write_data);</span></span>
<span class="line"><span style="color: #61AFEF">curl_easy_setopt</span><span style="color: #ABB2BF">(curl, CURLOPT_WRITEDATA, fp);</span></span></code></pre>
<p>With these modifications, the downloaded data will be saved to the specified file and also output to standard output.</p>
<p>Testing the wget command implemented in C++
To test the <code>download_file</code> function, we can write a simple main function that takes a URL and an output file path as command line arguments, and calls the <code>download_file</code> function to download the file and save it to disk:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;iostream></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#x3C;string></span></span>
<span class="line"><span style="color: #C678DD">#include</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"wget.h"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argc</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">char**</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">argv</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (argc </span><span style="color: #C678DD">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Usage: "</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">" &#x3C;url> &#x3C;output_file>"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> std::string url </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> std::string output_file </span><span style="color: #C678DD">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">download_file</span><span style="color: #ABB2BF">(url, output_file)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cout </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"File downloaded successfully!"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> std::cerr </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Failed to download file."</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">&#x3C;&#x3C;</span><span style="color: #ABB2BF"> std::endl;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we check that the user has provided both a URL and an output file path as command line arguments, and then call the <code>download_file</code> function with these arguments. If the download is successful, we output a success message to the console and return with exit code 0. If the download fails, we output an error message to the console and return with exit code 1.</p>
<p>To test this code, we can compile it with the `wget. file and the libcurl library using a command like the following:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">g</span><span style="color: #C678DD">++</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">main</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">cpp</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">wget</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">cpp</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">lcurl </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF">o wget</span></span></code></pre>
<p>This will create an executable file called <code>wget</code>. We can then run this executable with a URL and an output file path as command line arguments, like this:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">.</span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">wget http:</span><span style="color: #7F848E; font-style: italic">//example.com/file.txt file.txt</span></span></code></pre>
<p>This will download the file at the URL <code>http://example.com/file.txt</code> and save it to a file called <code>file.txt</code> in the current directory. If the download is successful, the program will output a success message to the console. If the download fails, the program will output an error message to the console.</p>
<h1 id="chapter-14-conclusion">Chapter 14: Conclusion</h1>
<p>Summary of the book
This technical book provides an introduction to C++ programming and command line applications. The book covers the basics of C++ syntax and concepts such as variables, functions, and control flow, and then shows how to apply these concepts to build command line applications using libraries like libcurl. The book walks the reader through the design and implementation of a simple wget command-line tool, covering topics such as parsing command line arguments, downloading data from the web, and outputting results to the console or a file. The book is aimed at software developers with some programming experience who want to learn C++ and command line application development. By the end of the book, the reader should have a solid understanding of C++ programming and be able to build basic command line applications in C++.</p>
<p>Further resources for building command line applications in C++
Here are some additional resources for building command line applications in C++:</p>
<ol>
<li><a href="https://www.boost.org/doc/libs/1_76_0/doc/html/program_options.html">The Boost.Program_options library</a> provides a powerful and flexible way to parse command line options and arguments. It is a part of the Boost C++ libraries and can be included in your project as a header-only library.</li>
<li><a href="https://cliutils.github.io/CLI11/">CLI11</a> is a modern, header-only library for creating command line interfaces in C++. It supports subcommands, options, flags, and positional arguments, and provides a convenient way to generate help documentation for your application.</li>
<li><a href="https://github.com/jarro2783/cxxopts">cxxopts</a> is a lightweight, header-only library for parsing command line options and arguments. It is easy to use and provides a clean and modern API.</li>
<li><a href="https://github.com/docopt/docopt.cpp">docopt.cpp</a> is a C++ implementation of the docopt language for parsing command line arguments. Docopt is a human-friendly language for describing command line interfaces, and the C++ implementation is easy to use and provides a clean API.</li>
<li><a href="https://github.com/ikalnytskyi/termcolor">Termcolor</a> is a header-only library that provides an easy way to output colored text to the console. This can be useful for highlighting important messages or errors in your command line applications.</li>
</ol>
<p>These libraries can save you time and effort when building command line applications in C++, and can make your code more maintainable and easier to read.</p>
            </article>
          </div>
          <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var c;{let d={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,r)=>{if(t===""||!Array.isArray(r))return r;let[e,n]=r;return e in d?d[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(c=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{var l;if(!this.hydrator||!this.isConnected||(l=this.parentElement)!=null&&l.closest("astro-island[ssr]"))return;let r=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(let s of n){let i=s.closest(this.tagName);!i||!i.isSameNode(this)||(e[s.getAttribute("data-astro-template")||"default"]=s.innerHTML,s.remove())}for(let s of r){let i=s.closest(this.tagName);!i||!i.isSameNode(this)||(e[s.getAttribute("name")||"default"]=s.innerHTML)}let a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((r,e)=>{e.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let r=this.getAttribute("before-hydration-url");r&&await import(r),this.start()}start(){let r=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{let n=this.getAttribute("renderer-url"),[a,{default:l}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),s=this.getAttribute("component-export")||"default";if(!s.includes("."))this.Component=a[s];else{this.Component=a;for(let i of s.split("."))this.Component=this.Component[i]}return this.hydrator=l,this.hydrate},r,this)}attributeChangedCallback(){this.hydrate()}},c.observedAttributes=["props"],c))}})();</script><astro-island uid="ZbKvuO" prefix="r0" component-url="/_astro/Disqus.101366bd.js" component-export="default" renderer-url="/_astro/client.663bf61e.js" props="{}" ssr="" client="load" opts="{&quot;name&quot;:&quot;Disqus&quot;,&quot;value&quot;:true}" await-children=""><div class="row mt-16 justify-center "><div id="disqus_thread"></div></div></astro-island>
        </div>
      </div>
    </div>
  </section>

    </main>
    <footer class="footer bg-[#F1F1F1]">
  <div class="container">
    <div class="gx-5 row pb-10 pt-[52px]">
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <a href="/" class="navbar-brand block">
  <img alt="Pinwheel Astro" style="height:31px;width:147px" width="294" height="62" src="/_astro/logo_ZThIBR.png" loading="lazy" decoding="async">
</a>
        <p class="mt-6">
          Trying to make the world a better place.
        </p>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Socials</h6>

        <ul class="social-icons mt-4 lg:mt-6">
  <li class="inline-block">
        <a aria-label="facebook" href="https://facebook.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M480 257.35c0-123.7-100.3-224-224-224s-224 100.3-224 224c0 111.8 81.9 204.47 189 221.29V322.12h-56.89v-64.77H221V208c0-56.13 33.45-87.16 84.61-87.16 24.51 0 50.15 4.38 50.15 4.38v55.13H327.5c-27.81 0-36.51 17.26-36.51 35v42h62.12l-9.92 64.77H291v156.54c107.1-16.81 189-109.48 189-221.31z"></path></svg>
        </a>
      </li>
  <li class="inline-block">
        <a aria-label="twitter" href="https://twitter.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M496 109.5a201.8 201.8 0 01-56.55 15.3 97.51 97.51 0 0043.33-53.6 197.74 197.74 0 01-62.56 23.5A99.14 99.14 0 00348.31 64c-54.42 0-98.46 43.4-98.46 96.9a93.21 93.21 0 002.54 22.1 280.7 280.7 0 01-203-101.3A95.69 95.69 0 0036 130.4c0 33.6 17.53 63.3 44 80.7A97.5 97.5 0 0135.22 199v1.2c0 47 34 86.1 79 95a100.76 100.76 0 01-25.94 3.4 94.38 94.38 0 01-18.51-1.8c12.51 38.5 48.92 66.5 92.05 67.3A199.59 199.59 0 0139.5 405.6a203 203 0 01-23.5-1.4A278.68 278.68 0 00166.74 448c181.36 0 280.44-147.7 280.44-275.8 0-4.2-.11-8.4-.31-12.5A198.48 198.48 0 00496 109.5z"></path></svg>
        </a>
      </li>
  
  
  
  <li class="inline-block">
        <a aria-label="linkedin" href="https://linkedin.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M444.17 32H70.28C49.85 32 32 46.7 32 66.89v374.72C32 461.91 49.85 480 70.28 480h373.78c20.54 0 35.94-18.21 35.94-38.39V66.89C480.12 46.7 464.6 32 444.17 32zm-273.3 373.43h-64.18V205.88h64.18zM141 175.54h-.46c-20.54 0-33.84-15.29-33.84-34.43 0-19.49 13.65-34.42 34.65-34.42s33.85 14.82 34.31 34.42c-.01 19.14-13.31 34.43-34.66 34.43zm264.43 229.89h-64.18V296.32c0-26.14-9.34-44-32.56-44-17.74 0-28.24 12-32.91 23.69-1.75 4.2-2.22 9.92-2.22 15.76v113.66h-64.18V205.88h64.18v27.77c9.34-13.3 23.93-32.44 57.88-32.44 42.13 0 74 27.77 74 87.64z"></path></svg>
        </a>
      </li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="inline-block">
        <a aria-label="skype" href="https://skype.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M467.16 303.6a205.69 205.69 0 004.9-45.15c0-116.32-95.69-210.7-213.79-210.7a221.83 221.83 0 00-36.52 3A123.58 123.58 0 00155.93 32C87.55 32 32 86.72 32 154.15A119.56 119.56 0 0049 216a211.16 211.16 0 00-4.32 42.35c0 116.44 95.69 210.7 213.67 210.7a214 214 0 0039.09-3.5A125.45 125.45 0 00356.07 480C424.57 480 480 425.28 480 357.85a118 118 0 00-12.84-54.25zM368 359c-9.92 13.76-24.51 24.73-43.41 32.43S283.36 403 257.69 403c-30.69 0-56.36-5.37-76.55-15.87a101 101 0 01-35.24-30.8c-9.11-12.83-13.66-25.66-13.66-38 0-7.7 3-14.35 8.87-19.95 5.84-5.37 13.42-8.17 22.29-8.17 7.35 0 13.65 2.1 18.79 6.42 4.9 4.08 9.1 10.15 12.48 18.08A108.09 108.09 0 00207 336.15q6.32 8.22 17.86 13.65c7.82 3.62 18.2 5.48 31 5.48 17.62 0 32.09-3.73 42.94-11.08 10.74-7.12 15.88-15.75 15.88-26.25 0-8.28-2.69-14.82-8.29-19.95-5.83-5.37-13.42-9.57-22.87-12.37-9.69-3-22.87-6.18-39.21-9.56-22.17-4.67-41-10.27-56-16.57-15.28-6.42-27.65-15.4-36.76-26.48-9.22-11.32-13.77-25.55-13.77-42.24a67.86 67.86 0 0114.47-42.58c9.57-12.25 23.46-21.82 41.55-28.35 17.74-6.53 38.86-9.8 62.66-9.8 19.14 0 35.83 2.22 49.83 6.42s25.91 10.15 35.36 17.38 16.34 14.93 20.77 23 6.66 16.22 6.66 24c0 7.46-2.92 14.35-8.76 20.3a29.65 29.65 0 01-21.94 9.1c-7.93 0-14.12-1.87-18.43-5.6-4-3.5-8.17-8.87-12.72-16.69-5.37-9.91-11.79-17.85-19.14-23.45-7.24-5.36-19.14-8.16-35.71-8.16-15.29 0-27.77 3-37 9-8.87 5.72-13.19 12.37-13.19 20.18a18.26 18.26 0 004.32 12.25 38.13 38.13 0 0012.72 9.57 90.14 90.14 0 0017.15 6.53c6 1.64 15.87 4.09 29.53 7.12 17.38 3.62 33.25 7.82 47.26 12.13 14.24 4.55 26.49 10 36.52 16.45a72.93 72.93 0 0124.16 25.09c5.72 10 8.64 22.63 8.64 37.1A75.09 75.09 0 01368 359z"></path></svg>
        </a>
      </li>
  
  
  
  
  
</ul>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Quick Links</h6>
        <ul>
          <li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/about">
                  About
                </a>
              </li><li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/contact">
                  Contact
                </a>
              </li><li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/elements">
                  Elements
                </a>
              </li><li class="mb-0">
                <a class="hover:text-primary hover:underline " href="/changelog">
                  Changelog
                </a>
              </li>
        </ul>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Location & Contact</h6>
        <ul>
          <li class="mb-2">Somewhere in Canada</li>
          <li class="mb-2">
            <a class="mb-2 hover:text-primary" href="mailto:colourfulmerchtik@gmail.com">colourfulmerchtik@gmail.com</a>
          </li>
          <li>
            <a class="hover:text-primary hover:underline" href="tel:+704-555-0127">+704-555-0127</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container max-w-[1440px]">
    <div class="footer-copyright mx-auto border-t border-border pb-10 pt-7 text-center">
      <p class="content text-text">Copyright © 2023</p>
    </div>
  </div>
</footer>
    
    <script src="https://mediafiles.botpress.cloud/0df54034-3318-451a-aed0-3923a4ee25a5/webchat/config.js" defer></script>
  </body>
</html>