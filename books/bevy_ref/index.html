<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- favicon -->
    <link rel="shortcut icon" href="/images/favicon.png">
    <!-- theme meta -->
    <meta name="theme-name" content="pinwheel-astro">
    <meta name="msapplication-TileColor" content="#000000">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479144310234386" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6">

  </script>
  
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
    <meta name="generator" content="Astro v2.6.6">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- google font css -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&#38;family=Merriweather:wght@700;900&#38;display=swap" rel="stylesheet">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
		<script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>

    <!-- responsive meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">

    <!-- title -->
    <title>
      Bevy Game Development By Example
    </title>

    <!-- canonical url -->
    

    <!-- noindex robots -->
    

    <!-- meta-description -->
    <meta name="description" content="A Beginner's Guide to Learn Rust and Bevy">

    <!-- author from config.json -->
    <meta name="author" content="FriendlyUser">

    <!-- og-title -->
    <meta property="og:title" content="Bevy Game Development By Example">

    <!-- og-description -->
    <meta property="og:description" content="A Beginner's Guide to Learn Rust and Bevy">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pinwheel-astro.vercel.app/books/bevy_ref/">

    <!-- twitter-title -->
    <meta name="twitter:title" content="Bevy Game Development By Example">

    <!-- twitter-description -->
    <meta name="twitter:description" content="A Beginner's Guide to Learn Rust and Bevy">

    <!-- og-image -->
    <meta property="og:image" content="https://pinwheel-astro.vercel.app/images/og-image.png">

    <!-- twitter-image -->
    <meta name="twitter:image" content="https://pinwheel-astro.vercel.app/images/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
  <link rel="stylesheet" href="/_astro/404.77291556.css" />
<link rel="stylesheet" href="/_astro/_single_.db0af2d4.css" /><script type="module" src="/_astro/hoisted.4256c07d.js"></script></head>
  <body>
    
    <header class="header">
  <nav class="navbar container">
    <!-- logo -->
    <div class="order-0">
      <a href="/" class="navbar-brand block">
  <img alt="Pinwheel Astro" style="height:31px;width:147px" width="294" height="62" src="/_astro/logo_ZThIBR.png" loading="lazy" decoding="async">
</a>
    </div>
    <!-- navbar toggler -->
    <input id="nav-toggle" type="checkbox" class="hidden">
    <label id="show-button" for="nav-toggle" class="order-2 flex cursor-pointer items-center lg:order-1 lg:hidden">
      <svg class="h-6 fill-current" viewBox="0 0 20 20">
        <title>Menu Open</title>
        <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path>
      </svg>
    </label>
    <label id="hide-button" for="nav-toggle" class="order-2 hidden cursor-pointer items-center lg:order-1">
      <svg class="h-6 fill-current" viewBox="0 0 20 20">
        <title>Menu Close</title>
        <polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"></polygon>
      </svg>
    </label>
    <!-- /navbar toggler -->

    <ul id="nav-menu" class="navbar-nav order-3 hidden w-full lg:order-1 lg:flex lg:w-auto lg:space-x-2">
      <li class="nav-item">
                <a href="/" class="nav-link inline-block lg:block false">
                  Home
                </a>
              </li><li class="nav-item">
                <a href="/books" class="nav-link inline-block lg:block false">
                  Books
                </a>
              </li><li class="nav-item">
                <a href="/contact" class="nav-link inline-block lg:block false">
                  Contact
                </a>
              </li>
      <li class="nav-item mt-2 lg:hidden">
        <a class="btn btn-white btn-sm border-border" href="/books">
          View Books</a>
      </li>
    </ul>
    <div class="order-1 ml-auto hidden items-center md:order-2 md:ml-0 lg:flex">
      <a class="btn btn-white btn-sm" href="/signin"> View Books</a>
    </div>
  </nav>
</header>
<script>
  const button = document.getElementById("dropdown-button");
  button.addEventListener("click", () => {
    const dropdown = document.getElementById("dropdown");
    dropdown.classList.toggle(dropdown.style === "hidden" ? "block" : "hidden");
  });

  //sticky header
  const header = document.querySelector(".header");
  window.addEventListener("scroll", () => {
    const scrollY = window.scrollY;
    if (scrollY > 0) {
      header.classList.add("header-sticky");
    } else {
      header.classList.remove("header-sticky");
    }
  });
</script>
    <main id="main-content">
      
  <section class="section blog-single">
    <div class="container">
      <div class="row justify-center">
        <div class="lg:col-10">
          <img class="w-full rounded-xl" alt="" width="920" height="450" src="/_astro/3325476992_Z1FWoQf.png" loading="lazy" decoding="async">
        </div>
        <div class="mt-10 max-w-[810px] lg:col-9">
          <h1 class="h2">
            Bevy Game Development By Example
          </h1>
          <div class="mb-5 mt-6 flex items-center space-x-2">
            <ul class="mb-4">
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 104c-53 0-96 43-96 96s43 96 96 96 96-43 96-96-43-96-96-96zm0 144c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm0-240C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-49.7 0-95.1-18.3-130.1-48.4 14.9-23 40.4-38.6 69.6-39.5 20.8 6.4 40.6 9.6 60.5 9.6s39.7-3.1 60.5-9.6c29.2 1 54.7 16.5 69.6 39.5-35 30.1-80.4 48.4-130.1 48.4zm162.7-84.1c-24.4-31.4-62.1-51.9-105.1-51.9-10.2 0-26 9.6-57.6 9.6-31.5 0-47.4-9.6-57.6-9.6-42.9 0-80.6 20.5-105.1 51.9C61.9 339.2 48 299.2 48 256c0-110.3 89.7-200 200-200s200 89.7 200 200c0 43.2-13.9 83.2-37.3 115.9z"></path></svg>
                
              </li>

              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"></path></svg>
                Invalid Date
              </li>
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg>
                232 Mins read
              </li>
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"></path></svg>
                
              </li>
            </ul>
          </div>

          <div class="content">
            <div id="search" class="ml-3 p-4 -mt-8"></div>
            <article id="article">
              <h1 id="chapter-1-introduction-to-game-development">Chapter 1: Introduction to Game Development</h1>
<h2 id="overview-of-game-development">Overview of Game Development</h2>
<p>Game development is the process of designing and creating video games. It involves various disciplines such as game design, programming, art, sound, and testing. Game development can be a complex process, and requires careful planning and execution in order to create an engaging and entertaining game.</p>
<p>In order to develop a game, you first need to have a clear idea of what you want to create. This involves creating a game design document, which outlines the concept, gameplay mechanics, art style, and other aspects of the game. Once you have a clear vision of what you want to create, you can begin the development process.</p>
<p>The development process typically involves several stages, including:</p>
<ol>
<li>
<p>Pre-production: This stage involves planning the game, creating the game design document, and creating any necessary prototypes.</p>
</li>
<li>
<p>Production: This stage involves actually creating the game, including programming, creating art assets, and creating sound effects and music.</p>
</li>
<li>
<p>Testing: This stage involves testing the game to ensure that it is free of bugs and that the gameplay is fun and engaging.</p>
</li>
<li>
<p>Release: This stage involves releasing the game to the public, either through a digital storefront or on physical media.</p>
</li>
</ol>
<p>Throughout the development process, it is important to iterate and refine the game to ensure that it meets the vision and is fun and engaging for players. Game development is a complex and challenging process, but can also be incredibly rewarding when a well-designed and entertaining game is created.</p>
<h2 id="what-is-bevy">What is Bevy?</h2>
<p>Bevy is a game engine designed for developing 2D and 3D games in Rust programming language. It is an open source and community-driven project that aims to provide an easy-to-use and efficient game development framework. Bevy uses the Entity Component System (ECS) architecture to manage game entities and their behavior. This architecture allows for more efficient memory management, better scalability, and easier parallelization of game logic.</p>
<p>Bevy includes a variety of built-in features and plugins, including input handling, asset management, physics simulation, and audio playback. It also supports multiple platforms, including Windows, macOS, Linux, and the Web.</p>
<p>One of the advantages of using Bevy for game development is the Rust programming language itself, which provides memory safety, thread safety, and performance benefits. Rust is a modern programming language with a growing community and ecosystem, and has been gaining popularity in systems programming, web development, and now game development.</p>
<p>Overall, Bevy provides a modern and efficient framework for game development, leveraging the strengths of Rust and the ECS architecture to create high-performance and enjoyable games.</p>
<h2 id="bevys-philosophy-and-design-goals">Bevy’s philosophy and design goals</h2>
<p>Bevy’s philosophy and design goals revolve around simplicity, modularity, and performance.</p>
<p>Simplicity is a core principle of Bevy, with a focus on providing a clean and easy-to-use API for game development. Bevy aims to reduce the complexity of game development by providing a streamlined framework that allows developers to focus on creating fun and engaging games, rather than worrying about low-level details.</p>
<p>Modularity is another key aspect of Bevy’s design. Bevy is built around a plugin-based architecture, allowing developers to pick and choose which features they want to use in their game. This approach allows for greater flexibility and customizability, and helps to keep the framework lightweight and easy to use.</p>
<p>Finally, performance is a critical design goal for Bevy. Bevy uses a number of performance-oriented features, such as the Entity Component System (ECS) architecture, to provide fast and efficient game development. Additionally, Bevy is designed to take advantage of modern hardware and software, such as multi-core processors and Vulkan graphics APIs, to provide the best possible performance on a wide range of platforms.</p>
<p>Overall, Bevy’s philosophy and design goals are focused on providing a simple, modular, and high-performance framework for game development. By prioritizing these goals, Bevy aims to make game development more accessible and enjoyable for developers of all skill levels.</p>
<h2 id="comparison-with-other-game-enginesframeworks">Comparison with other game engines/frameworks</h2>
<p>Compared to other game engines and frameworks, Bevy has a number of unique features and advantages.</p>
<p>First and foremost, Bevy is designed specifically for Rust programming language. This means that it provides all of the benefits of Rust, such as memory safety, thread safety, and performance, which can be especially important for game development. Additionally, Rust is a modern programming language that has been gaining popularity in a wide range of industries, making it an attractive option for developers looking to create high-performance games.</p>
<p>Another advantage of Bevy is its use of the Entity Component System (ECS) architecture, which provides more efficient memory management and better scalability compared to other architectures. This can be especially important for larger and more complex games, where performance can be a critical factor.</p>
<p>Bevy is also designed to be highly modular, with a plugin-based architecture that allows developers to pick and choose which features they want to use in their game. This approach allows for greater flexibility and customization, and helps to keep the framework lightweight and easy to use.</p>
<p>Finally, Bevy is an open source project with a growing community and ecosystem. This means that developers can leverage the knowledge and expertise of other Bevy developers to create better games, and can contribute to the project themselves to help improve the framework over time.</p>
<p>Overall, Bevy offers a unique set of features and advantages compared to other game engines and frameworks. Its focus on Rust, the use of ECS architecture, modularity, and open source community make it a compelling option for developers looking to create high-performance and enjoyable games.</p>
<h2 id="what-is-rust">What is Rust?</h2>
<p>Rust is a modern programming language developed by Mozilla. It is designed for systems programming, with a focus on memory safety, thread safety, and performance. Rust combines low-level control over hardware with high-level abstractions, making it a versatile language that can be used for a wide range of applications.</p>
<p>One of the key features of Rust is its memory safety guarantees. Rust uses a system of ownership and borrowing to ensure that memory is allocated and deallocated correctly, without the need for manual memory management or garbage collection. This approach helps to prevent common bugs such as null pointers, buffer overflows, and use-after-free errors, which can be especially important for systems programming.</p>
<p>Rust is also designed for concurrency, with built-in support for asynchronous programming and thread-safe data structures. This can be especially important for applications that require high-performance and parallelism.</p>
<p>In addition to its technical features, Rust has a growing ecosystem and community, with a number of libraries, frameworks, and tools available for developers. Rust’s popularity has been steadily increasing over the past few years, as more developers discover its benefits for systems programming, web development, and now game development.</p>
<p>Overall, Rust is a modern and versatile programming language that provides a unique set of features and benefits for systems programming and beyond.</p>
<h2 id="benefits-of-using-rust-for-game-development">Benefits of using Rust for game development</h2>
<p>There are several benefits of using Rust for game development:</p>
<ol>
<li>
<p>Memory safety: Rust’s ownership and borrowing system ensures that memory is allocated and deallocated correctly, without the need for manual memory management or garbage collection. This can help prevent common bugs such as null pointers, buffer overflows, and use-after-free errors, which can be especially important for game development.</p>
</li>
<li>
<p>Performance: Rust is a high-performance language that is designed to be fast and efficient. Rust’s ability to take advantage of multi-core processors and low-level hardware resources can be especially important for game development, where performance is critical.</p>
</li>
<li>
<p>Concurrency: Rust has built-in support for asynchronous programming and thread-safe data structures, which can be important for game development. This can help to improve performance and scalability by allowing for better parallelism and resource management.</p>
</li>
<li>
<p>Modularity: Rust’s module system and package manager provide a streamlined way to manage dependencies and organize code, which can be especially important for larger and more complex game projects.</p>
</li>
<li>
<p>Community and Ecosystem: Rust has a growing community and ecosystem, with a number of libraries, frameworks, and tools available for game development. This can help to accelerate development and improve the quality of games created with Rust.</p>
</li>
</ol>
<p>Overall, Rust’s unique features and benefits make it a compelling option for game development. By leveraging Rust’s memory safety, performance, concurrency, modularity, and growing community, developers can create high-quality, fast, and efficient games that are both enjoyable and scalable.</p>
<h2 id="rusts-syntax-and-features">Rust’s syntax and features</h2>
<p>Rust has a syntax and feature set that is designed to be efficient, concise, and expressive. Some of the key features of Rust include:</p>
<ol>
<li>
<p>Strong Typing: Rust is a strongly typed language, which means that variables must be explicitly typed and can only hold values of that type. This helps to prevent bugs and improve code quality.</p>
</li>
<li>
<p>Ownership and Borrowing: Rust uses a system of ownership and borrowing to ensure memory safety and prevent data races. This means that each piece of memory has a single owner, and other pieces of code can borrow that memory temporarily to access it.</p>
</li>
<li>
<p>Lifetimes: Rust uses a system of lifetimes to ensure that borrows do not outlive the data they are borrowing from. This helps to prevent null pointer errors and other bugs that can arise from using data that has already been deallocated.</p>
</li>
<li>
<p>Macros: Rust has a powerful macro system that allows developers to define their own custom syntax and expand code at compile time. This can be especially useful for creating DSLs (domain-specific languages) and reducing boilerplate code.</p>
</li>
<li>
<p>Pattern Matching: Rust has a powerful pattern matching system that allows developers to match on values and extract data from them. This can be especially useful for handling complex data structures and control flow.</p>
</li>
<li>
<p>Traits: Rust has a trait system that allows developers to define generic behavior that can be implemented by multiple types. This can be especially useful for creating reusable abstractions and reducing code duplication.</p>
</li>
<li>
<p>Concurrency: Rust has built-in support for concurrency and parallelism, with a number of abstractions and tools for managing threads and asynchronous programming. This can be especially useful for game development, where performance is critical.</p>
</li>
</ol>
<p>Overall, Rust’s syntax and feature set is designed to provide a modern and efficient programming experience, with a focus on memory safety, performance, and concurrency. By leveraging Rust’s features, developers can create fast, reliable, and scalable software that is easy to maintain and extend.</p>
<h2 id="setting-up-the-development-environment">Setting up the development environment</h2>
<p>To set up a development environment for Bevy game development with Rust, follow these steps:</p>
<ol>
<li>
<p>Install Rust: Rust can be installed using rustup, which is Rust’s official installation tool. To install rustup, follow the instructions on the official Rust website: <a href="https://www.rust-lang.org/tools/install">https://www.rust-lang.org/tools/install</a></p>
</li>
<li>
<p>Install the Visual Studio Code Editor: While there are many code editors available, Visual Studio Code (VS Code) is a popular choice for Rust development, and has a number of plugins available to improve the Rust development experience. To install VS Code, visit the official website and download the installer for your operating system: <a href="https://code.visualstudio.com/download">https://code.visualstudio.com/download</a></p>
</li>
<li>
<p>Install the Rust Language Server: The Rust Language Server (RLS) is a tool that provides language support for Rust in editors like VS Code. To install the RLS, run the following command in your terminal: <code>rustup component add rls rust-analysis rust-src</code></p>
</li>
<li>
<p>Install Bevy: Bevy can be installed as a crate (Rust’s term for a library or package) using cargo, Rust’s package manager. To create a new Bevy project and install the Bevy crate, run the following command in your terminal: <code>cargo new mygame --bin &#x26;&#x26; cd mygame &#x26;&#x26; cargo add bevy</code></p>
</li>
<li>
<p>Add VS Code plugins for Rust and Bevy: To improve the Rust development experience in VS Code, install the Rust (rls) plugin and the Bevy Language Server plugin. To install these plugins, open VS Code, go to the Extensions tab, and search for “Rust (rls)” and “Bevy Language Server”, respectively.</p>
</li>
<li>
<p>Test the setup: To test that everything is set up correctly, open the main.rs file in your mygame project and add the following code:</p>
</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">use bevy::prelude::*;</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn main() {</span></span>
<span class="line"><span style="color: #abb2bf">    App::build()</span></span>
<span class="line"><span style="color: #abb2bf">        .add_plugins(DefaultPlugins)</span></span>
<span class="line"><span style="color: #abb2bf">        .run();</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>This code creates a new Bevy app and runs it. To run the app, open a terminal in the mygame directory and run the following command: <code>cargo run</code></p>
<p>If everything is set up correctly, you should see a window with a blank screen appear. You can now begin developing your Bevy game!</p>
<p>Note: these steps assume that you are using a Unix-based operating system (such as macOS or Linux). If you are using Windows, some of the commands and tools may be different, but the general process should be similar.</p>
<h2 id="installing-rust-and-bevy">Installing Rust and Bevy</h2>
<p>To install Rust and Bevy, follow these steps:</p>
<ol>
<li>
<p>Install Rust: Rust can be installed using rustup, which is Rust’s official installation tool. To install rustup, follow the instructions on the official Rust website: <a href="https://www.rust-lang.org/tools/install">https://www.rust-lang.org/tools/install</a></p>
</li>
<li>
<p>Create a new Rust project: Open a terminal and create a new Rust project by running the following command: <code>cargo new mygame --bin</code></p>
</li>
</ol>
<p>This command creates a new Rust project with the name “mygame” and sets it up as a binary (as opposed to a library). Navigate into the “mygame” directory by running the command: <code>cd mygame</code></p>
<ol start="3">
<li>Add Bevy as a dependency: Bevy can be added to your Rust project as a dependency using cargo. To do this, add the following line to the “Cargo.toml” file in your project directory:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">[dependencies]</span></span>
<span class="line"><span style="color: #abb2bf">bevy = "0.5"</span></span></code></pre>
<p>This line tells cargo to download and install version 0.5 of the Bevy crate.</p>
<ol start="4">
<li>Build and run the project: With Bevy added as a dependency, you can now build and run your Rust project. To build the project, run the command: <code>cargo build</code>. This will compile your project and download any dependencies.</li>
</ol>
<p>To run your project, run the command: <code>cargo run</code>. This will compile your project (if necessary) and run the binary. If everything is set up correctly, you should see a window with a blank screen appear.</p>
<ol start="5">
<li>Test Bevy installation: To test that Bevy is installed correctly, add the following code to the “main.rs” file in your project directory:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">use bevy::prelude::*;</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn main() {</span></span>
<span class="line"><span style="color: #abb2bf">    App::build()</span></span>
<span class="line"><span style="color: #abb2bf">        .add_plugins(DefaultPlugins)</span></span>
<span class="line"><span style="color: #abb2bf">        .run();</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>This code creates a new Bevy app and runs it. To run the app, open a terminal in the “mygame” directory and run the command: <code>cargo run</code></p>
<p>If everything is set up correctly, you should see a window with a blank screen appear.</p>
<p>Note: these steps assume that you are using a Unix-based operating system (such as macOS or Linux). If you are using Windows, some of the commands and tools may be different, but the general process should be similar.</p>
<h2 id="configuring-the-ideeditor">Configuring the IDE/Editor</h2>
<p>Configuring the IDE or Editor for Rust development with Bevy depends on your personal preference. Here are some popular options:</p>
<h3 id="visual-studio-code">Visual Studio Code</h3>
<ol>
<li>
<p>Install the Rust (rls) extension: Open Visual Studio Code, go to the Extensions panel, and search for “Rust (rls)“. Install the extension.</p>
</li>
<li>
<p>Install the Bevy extension: Search for “Bevy” in the Extensions panel and install the Bevy extension. This extension provides syntax highlighting and autocompletion for Bevy-specific code.</p>
</li>
<li>
<p>Configure your workspace settings: Open your workspace settings by selecting “Preferences: Open Workspace Settings” from the Command Palette (Cmd + Shift + P on macOS or Ctrl + Shift + P on Windows/Linux). Add the following settings to enable code formatting and debugging:</p>
</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">{</span></span>
<span class="line"><span style="color: #abb2bf">    "editor.formatOnSave": true,</span></span>
<span class="line"><span style="color: #abb2bf">    "rustfmt.exe": "rustfmt",</span></span>
<span class="line"><span style="color: #abb2bf">    "rust-analyzer.checkOnSave.enable": true,</span></span>
<span class="line"><span style="color: #abb2bf">    "rust-analyzer.debug.enable": true,</span></span>
<span class="line"><span style="color: #abb2bf">    "rust-analyzer.trace.server": "verbose"</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<h3 id="intellij-idea">IntelliJ IDEA</h3>
<ol>
<li>
<p>Install the Rust plugin: Open IntelliJ IDEA, go to the Settings panel, and search for “Rust”. Install the Rust plugin.</p>
</li>
<li>
<p>Install the Bevy plugin: Search for “Bevy” in the Plugins panel and install the Bevy plugin. This plugin provides syntax highlighting and autocompletion for Bevy-specific code.</p>
</li>
<li>
<p>Configure your project settings: Open your project settings by selecting “File > Project Structure”. Add the following settings to your project to enable debugging and code formatting:</p>
</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">// In the "Run/Debug Configurations" panel</span></span>
<span class="line"><span style="color: #abb2bf">Executable: /path/to/cargo</span></span>
<span class="line"><span style="color: #abb2bf">Working Directory: /path/to/your/project</span></span>
<span class="line"><span style="color: #abb2bf">Arguments: run --package mygame</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">// In the "Code Style" panel</span></span>
<span class="line"><span style="color: #abb2bf">Rustfmt executable: rustfmt</span></span></code></pre>
<h3 id="sublime-text">Sublime Text</h3>
<ol>
<li>
<p>Install the Rust package: Open Sublime Text, go to the Package Control panel, and search for “Rust Enhanced”. Install the Rust Enhanced package.</p>
</li>
<li>
<p>Install the Bevy package: Search for “Bevy” in the Package Control panel and install the Bevy package. This package provides syntax highlighting and autocompletion for Bevy-specific code.</p>
</li>
<li>
<p>Configure your project settings: Open your project settings by selecting “Preferences > Package Settings > Rust Enhanced > Settings”. Add the following settings to your project to enable code formatting:</p>
</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">{</span></span>
<span class="line"><span style="color: #abb2bf">    "rustfmt_command": "rustfmt",</span></span>
<span class="line"><span style="color: #abb2bf">    "rustfmt_autosave": true</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>These are just some examples of how to configure your IDE or Editor for Rust development with Bevy. There are many other options available, and the best approach depends on your personal preferences and the specific tools you are using.</p>
<h2 id="creating-a-basic-game-with-bevy-and-rust">Creating a basic game with Bevy and Rust</h2>
<p>Sure! Here’s a basic example of how to create a simple game using Bevy and Rust.</p>
<ol>
<li>Create a new Rust project: Open a terminal window and navigate to the directory where you want to create your new project. Then, run the following command to create a new Rust project:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cargo new mygame</span></span></code></pre>
<p>This will create a new Rust project called “mygame” in the current directory.</p>
<ol start="2">
<li>Add Bevy as a dependency: Open the “Cargo.toml” file in your project directory and add the following lines under the “[dependencies]” section:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">[dependencies]</span></span>
<span class="line"><span style="color: #abb2bf">bevy = "0.5"</span></span></code></pre>
<p>This will add Bevy as a dependency for your project.</p>
<ol start="3">
<li>Write the game code: Open the “main.rs” file in your project directory and add the following code:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">use bevy::prelude::*;</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn main() {</span></span>
<span class="line"><span style="color: #abb2bf">    App::build()</span></span>
<span class="line"><span style="color: #abb2bf">        .add_plugins(DefaultPlugins)</span></span>
<span class="line"><span style="color: #abb2bf">        .add_startup_system(setup.system())</span></span>
<span class="line"><span style="color: #abb2bf">        .run();</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn setup(commands: &#x26;mut Commands, asset_server: Res&#x3C;AssetServer>, mut materials: ResMut&#x3C;Assets&#x3C;ColorMaterial>>) {</span></span>
<span class="line"><span style="color: #abb2bf">    commands.spawn_bundle(OrthographicCameraBundle::new_2d());</span></span>
<span class="line"><span style="color: #abb2bf">    commands.spawn_bundle(SpriteBundle {</span></span>
<span class="line"><span style="color: #abb2bf">        material: materials.add(asset_server.load("texture.png").into()),</span></span>
<span class="line"><span style="color: #abb2bf">        sprite: Sprite::new(Vec2::new(100.0, 100.0)),</span></span>
<span class="line"><span style="color: #abb2bf">        ..Default::default()</span></span>
<span class="line"><span style="color: #abb2bf">    });</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>This code sets up a new Bevy application and adds a camera and a sprite to the scene. The sprite is loaded from a texture file called “texture.png” in the project directory.</p>
<ol start="4">
<li>Run the game: Open a terminal window, navigate to your project directory, and run the following command to build and run your game:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cargo run</span></span></code></pre>
<p>This will build your game and run it. You should see a window with a white sprite on a black background.</p>
<p>And that’s it! You’ve just created a basic game using Bevy and Rust. From here, you can add more components, systems, and resources to your game to make it more complex and interesting.</p>
<h2 id="creating-a-window-and-handling-user-input">Creating a window and handling user input</h2>
<p>Sure! Here’s an example of how to create a window and handle user input in a Bevy game using Rust.</p>
<ol>
<li>Open the “main.rs” file in your project directory and add the following code to import the necessary Bevy modules:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*, </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">keyboard</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">};</span></span></code></pre>
<ol start="2">
<li>Modify the <code>App::build()</code> function to create a new window with a specific title, size, and clear color. Also, add a new system to handle keyboard events:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">keyboard_input_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">windows</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Windows</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">windows</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">WindowDescriptor</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">title</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"My Game"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">width</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">800</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">height</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">600</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">vsync</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">resizable</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">OrthographicCameraBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new_2d</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"texture.png"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">keyboard_input_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Escape</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code creates a new window with a title of “My Game”, a size of 800x600, and vsync enabled. It also disables window resizing. Additionally, it adds a new system <code>keyboard_input_system</code> which will be called every frame and checks if the Escape key has been pressed to exit the game.</p>
<ol start="3">
<li>Run the game: Open a terminal window, navigate to your project directory, and run the following command to build and run your game:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cargo run</span></span></code></pre>
<p>This will build and run your game. You should see a window with a white sprite on a black background, and pressing the Escape key should exit the game.</p>
<p>And that’s it! You’ve just created a window and handled user input in a Bevy game using Rust. From here, you can add more systems to handle other types of input, such as mouse or gamepad input, and modify the game logic based on user input.</p>
<h2 id="loading-assets-sprites-sounds-etc">Loading assets (sprites, sounds, etc.)</h2>
<p>Sure! Here’s an example of how to load assets like sprites and sounds in a Bevy game using Rust.</p>
<ol>
<li>Add the necessary Bevy modules to your “main.rs” file:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*, </span><span style="color: #E5C07B">asset</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">LoadState</span><span style="color: #ABB2BF">};</span></span></code></pre>
<ol start="2">
<li>Create a new struct to hold all of the game’s assets:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">sound</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="3">
<li>Modify the <code>App::build()</code> function to load the assets using <code>AssetServer</code> and <code>Assets::load</code> functions:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">keyboard_input_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_loading_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">windows</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Windows</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"texture.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sound_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"sound.ogg"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">windows</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">WindowDescriptor</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">title</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"My Game"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">width</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">800</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">height</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">600</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">vsync</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">resizable</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">OrthographicCameraBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new_2d</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">assets</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sound</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">sound_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">insert_resource</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">assets</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">asset_loading_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">State</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">load_state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">LoadState</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">load_state</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is_loaded</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">load_state</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Playing</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code creates a new <code>Assets</code> struct with a <code>texture</code> and <code>sound</code> field, and loads the corresponding assets using the <code>AssetServer</code> module. It also adds a new system <code>asset_loading_system</code> to check if all the assets have been loaded before changing the game state to “Playing”.</p>
<ol start="4">
<li>Modify the game loop to use the loaded assets:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">game_system</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">assets</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">assets</span><span style="color: #ABB2BF">.texture.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">assets</span><span style="color: #ABB2BF">.sound.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code spawns a new sprite with the <code>texture</code> asset as its material, and a new entity with the <code>sound</code> asset as its <code>AudioSource</code> component.</p>
<ol start="5">
<li>Run the game: Open a terminal window, navigate to your project directory, and run the following command to build and run your game:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cargo run</span></span></code></pre>
<p>This will build and run your game. You should see a window with two sprites and hear a sound effect. If the assets take some time to load, you may see a loading screen until they’re ready.</p>
<p>And that’s it! You’ve just loaded assets like sprites and sounds in a Bevy game using Rust. From here, you can add more assets and modify the game logic to use them.</p>
<p>Great! Now that you have loaded assets in your Bevy game, you can use them to create more interesting gameplay.</p>
<p>For example, you can use textures to create animated sprites by changing their position and texture over time. Here’s an example of how to create a sprite animation using Bevy:</p>
<ol>
<li>Create a new struct to hold the sprite animation data:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SpriteAnimation</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">frames</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">current_frame</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">usize</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">timer</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Timer</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="2">
<li>Load the sprite frames and initialize the <code>SpriteAnimation</code> struct in the <code>setup</code> function:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load the sprite frames</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">frames</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">..</span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">format!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"sprite{}.png"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">frames</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a new SpriteAnimation with the frames and a 0.1 second timer</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SpriteAnimation</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">frames</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">current_frame</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">timer</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Timer</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_seconds</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn a new sprite with the first frame</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.frames[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    }).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code loads 5 sprite frames and creates a new <code>SpriteAnimation</code> struct with those frames and a 0.1 second timer. It also spawns a new sprite with the first frame.</p>
<ol start="3">
<li>Modify the <code>game_system</code> function to update the sprite animation:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">game_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SpriteAnimation</span><span style="color: #ABB2BF">)>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Check if the timer has finished</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.timer.</span><span style="color: #61AFEF">tick</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">finished</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Update the sprite texture to the next frame</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.current_frame </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.current_frame + </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) % </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.frames.</span><span style="color: #61AFEF">len</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">.material </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.frames[</span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.current_frame].</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code uses the <code>Time</code> resource to update the sprite animation every frame. It checks if the <code>SpriteAnimation</code> timer has finished and updates the sprite texture to the next frame. It also loops back to the first frame when it reaches the end of the frames list.</p>
<ol start="4">
<li>Run the game: Build and run your game again to see the animated sprite in action.</li>
</ol>
<p>And that’s it! You’ve just created a sprite animation using Bevy and Rust. From here, you can experiment with different animation speeds and frame counts to create more complex animations.</p>
<h2 id="creating-and-moving-game-entities">Creating and moving game entities</h2>
<p>In a game, entities represent objects in the game world such as characters, enemies, and obstacles. In Bevy, entities are represented by <code>Entity</code> IDs and can be created and moved using the ECS (Entity Component System) architecture.</p>
<p>Here’s an example of how to create and move a player entity in Bevy:</p>
<ol>
<li>Create a new struct to hold the player data:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">speed</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="2">
<li>Initialize the player entity in the <code>setup</code> function:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn a new sprite for the player</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_sprite</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    }).</span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add a Player component to the player entity</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">player_sprite</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">speed</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code spawns a new sprite for the player at the origin and adds a <code>Player</code> component to the entity with a speed of 200.0.</p>
<ol start="3">
<li>Modify the <code>game_system</code> function to move the player entity:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">game_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">)>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Move the player entity based on keyboard input</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">ZERO</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Left</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.x </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Right</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.x </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Up</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Down</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.y </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">length_squared</span><span style="color: #ABB2BF">() > </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">normalize</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF"> * </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.speed * </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code uses the <code>KeyboardInput</code> resource to check for keyboard input and modifies the player entity’s transform based on the input. It checks for left, right, up, and down arrow keys and moves the player entity in the corresponding direction.</p>
<ol start="4">
<li>Run the game: Build and run your game again to see the player entity move in response to keyboard input.</li>
</ol>
<p>And that’s it! You’ve just created and moved a player entity in Bevy using Rust. From here, you can add more entities with different components to create more complex gameplay.</p>
<h2 id="understanding-bevys-ecs-architecture">Understanding Bevy’s ECS architecture</h2>
<p>Bevy’s ECS (Entity Component System) architecture is a way of organizing game code around three core concepts:</p>
<ul>
<li><strong>Entities</strong>: Represent objects in the game world.</li>
<li><strong>Components</strong>: Define the data and behavior of entities.</li>
<li><strong>Systems</strong>: Process the data and behavior of entities.</li>
</ul>
<p>In Bevy, an entity is simply a unique ID represented by a <code>u32</code> integer. Entities don’t have any inherent data or behavior - they are simply a container for components. Components define the data and behavior of entities, and systems process that data and behavior.</p>
<p>Components in Bevy are defined using Rust structs that can be attached to entities using the <code>insert</code> method. For example, you could define a <code>Position</code> component to represent the position of an entity:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Position</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>You could then attach this component to an entity using the <code>insert</code> method:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Position</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF"> });</span></span></code></pre>
<p>Systems in Bevy are defined using Rust functions that process the data of entities with specific components. Systems can access the data of entities using queries. A query is a way of selecting entities that have specific components. For example, you could define a system that processes entities with a <code>Position</code> component:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">move_system</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Position</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">.x </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This system would iterate over all entities with a <code>Position</code> component and increment their x and y values by 1.0.</p>
<p>One of the advantages of Bevy’s ECS architecture is that it makes it easy to organize game code and maintain separation of concerns. Entities and their data are decoupled from the game logic, which makes it easier to add, remove, or modify entities without affecting the rest of the game code. Additionally, systems only process entities with specific components, which makes it easier to write focused, modular code.</p>
<p>Overall, Bevy’s ECS architecture provides a powerful and flexible way of organizing game code that is well-suited to the needs of modern game development.</p>
<h2 id="entities-components-and-systems">Entities, Components, and Systems</h2>
<p>Entities, components, and systems are the three core concepts in Bevy’s ECS architecture:</p>
<ul>
<li>
<p><strong>Entities</strong>: Represent objects in the game world. Entities are essentially unique IDs that can be used to group related components together. Each entity has a unique <code>u32</code> ID, which is used to reference it in the game engine.</p>
</li>
<li>
<p><strong>Components</strong>: Define the data and behavior of entities. Components are structs that define the data and behavior of entities. Each component is associated with a single entity and can be added, removed, or modified at runtime. Components can be used to represent anything from a player character’s position and health to a sprite’s texture and animation state.</p>
</li>
<li>
<p><strong>Systems</strong>: Process the data and behavior of entities. Systems are functions that operate on entities with specific component sets. A system is essentially a query that selects entities with specific component sets and applies some logic to them. Systems can be used to update the game state, render the game world, or perform any other action that needs to be performed on a regular basis.</p>
</li>
</ul>
<p>In Bevy, entities are created and destroyed using the <code>Commands</code> resource. Components are added to entities using the <code>insert</code> method, and systems are defined using the <code>system</code> macro. Here’s an example of how these concepts can be used together to create a simple game:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*, </span><span style="color: #E5C07B">render</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">pass</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ClearColor</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Position</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">move_system</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Position</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">.x </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">move_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Position</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a <code>Position</code> component that represents the position of an entity in the game world. We then define a <code>move_system</code> function that updates the position of any entity with a <code>Position</code> component. Finally, we create a new entity with a default sprite bundle and a <code>Position</code> component in the <code>setup</code> function.</p>
<p>This example demonstrates how entities, components, and systems can be used together to create a simple game. By using the ECS architecture provided by Bevy, we can easily create, modify, and manage game objects in a flexible and modular way.</p>
<h2 id="advantages-of-using-ecs-for-game-development">Advantages of using ECS for game development</h2>
<p>There are several advantages of using an Entity-Component-System (ECS) architecture for game development:</p>
<ol>
<li>
<p><strong>Modularity</strong>: ECS allows for a high degree of modularity, as game objects can be easily created, modified, and composed of different components. This makes it easy to create complex game objects by combining simple components, and also allows for easier reuse of code.</p>
</li>
<li>
<p><strong>Performance</strong>: ECS can offer significant performance benefits, as it allows for efficient memory usage and cache-friendly data layouts. By storing data in contiguous arrays, ECS can minimize cache misses and improve data locality, which can lead to faster processing times.</p>
</li>
<li>
<p><strong>Flexibility</strong>: ECS provides a flexible framework for game development, as it allows for easy customization and modification of game objects. Components can be added, removed, and modified at runtime, which allows for dynamic changes to the game state without requiring complex code changes.</p>
</li>
<li>
<p><strong>Scalability</strong>: ECS provides a scalable architecture for game development, as it can handle large numbers of game objects with minimal overhead. By using efficient data structures and algorithms, ECS can provide a high level of performance even with large numbers of game objects.</p>
</li>
<li>
<p><strong>Debugging</strong>: ECS can provide easier debugging and profiling of game code, as it allows for more granular control over the behavior of game objects. Components can be easily inspected and modified at runtime, which can make it easier to identify and fix bugs in the game code.</p>
</li>
</ol>
<p>Overall, the modularity, performance, flexibility, scalability, and debugging benefits of ECS make it a popular choice for game developers who are looking to create complex, high-performance games.</p>
<h2 id="debugging-and-testing-a-bevy-rust-game">Debugging and testing a Bevy-Rust game</h2>
<p>Debugging and testing are critical parts of game development, and Bevy provides several tools and techniques to help you debug and test your game.</p>
<p><strong>Debugging:</strong></p>
<ol>
<li>
<p><strong>Debug logs:</strong> Bevy provides a built-in logging system that can help you debug your game by printing information to the console. You can use the <code>info!</code>, <code>warn!</code>, and <code>error!</code> macros to log information at different levels of severity.</p>
</li>
<li>
<p><strong>Debugging with <code>println!</code>:</strong> You can also use the <code>println!</code> macro to print information to the console, just like in regular Rust programming.</p>
</li>
<li>
<p><strong>Debugging with breakpoints:</strong> You can set breakpoints in your code using your IDE or editor to pause the game and inspect the state of the game at that point.</p>
</li>
<li>
<p><strong>Profiling:</strong> Bevy also provides profiling tools that can help you identify performance bottlenecks in your game. You can use the <code>bevy-profiling</code> crate to profile your game and identify areas that are causing performance issues.</p>
</li>
</ol>
<p><strong>Testing:</strong></p>
<ol>
<li>
<p><strong>Unit tests:</strong> You can write unit tests for your Rust code using the <code>#[test]</code> attribute. Unit tests can help you ensure that individual functions and components of your game are working correctly.</p>
</li>
<li>
<p><strong>Integration tests:</strong> Integration tests can help you ensure that different components of your game are working together correctly. Bevy provides the <code>bevy-test</code> crate, which includes tools for writing integration tests.</p>
</li>
<li>
<p><strong>Manual testing:</strong> Manual testing is an important part of game development, and involves playing your game and manually testing its various features and components. You can use this approach to identify bugs and issues that may not be caught by automated testing.</p>
</li>
</ol>
<p>Overall, Bevy provides several tools and techniques for debugging and testing your game, and it is important to use these tools throughout the development process to ensure that your game is as bug-free and performant as possible.</p>
<h2 id="using-bevys-built-in-debug-tools">Using Bevy’s built-in debug tools</h2>
<p>Bevy provides several built-in debug tools that can help you visualize the state of your game and identify issues during development. These tools are useful for debugging and optimizing your game, and can help you improve the player experience.</p>
<p>Here are some of the built-in debug tools provided by Bevy:</p>
<ol>
<li>
<p><strong>Entity hierarchy view:</strong> This tool allows you to visualize the entities in your game and their relationships with each other. You can use this tool to identify entities that are not being destroyed properly, or to visualize the structure of your game world.</p>
</li>
<li>
<p><strong>Entity inspector:</strong> This tool allows you to inspect the components of individual entities in your game. You can use this tool to identify issues with the data in your game, or to debug specific entities that are not behaving as expected.</p>
</li>
<li>
<p><strong>FPS counter:</strong> This tool displays the current frames per second (FPS) of your game. You can use this tool to identify performance issues, or to optimize your game to run more smoothly.</p>
</li>
<li>
<p><strong>Debug console:</strong> The debug console allows you to execute arbitrary code at runtime and view the results in real-time. You can use this tool to experiment with different code snippets or to diagnose issues in your game.</p>
</li>
</ol>
<p>To enable these debug tools, you need to add the <code>bevy_debug_tools</code> plugin to your game:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">bevy_debug_tools</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">DebugToolsPlugin</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Once you’ve added the <code>DebugToolsPlugin</code>, you can use the default key bindings to activate the various debug tools. For example, pressing the <code>F2</code> key will toggle the entity hierarchy view.</p>
<p>In addition to these built-in debug tools, Bevy also provides several crates that can be used for profiling and debugging, such as <code>bevy_profiling</code> and <code>bevy_inspector_egui</code>. These crates can provide additional functionality and flexibility for debugging and optimizing your game.</p>
<h2 id="writing-tests-for-game-logic">Writing tests for game logic</h2>
<p>When it comes to game development, testing can be a bit challenging since it involves visual elements and user interactions. However, there are certain aspects of the game logic that can be tested, such as the rules of the game, game mechanics, and the behavior of the game entities.</p>
<p>In Rust, you can write tests using the built-in <code>#[test]</code> attribute. You can create a separate test module for your game logic and write test functions for each aspect that needs to be tested. For example, if you have a game where the player needs to avoid obstacles, you can write a test to ensure that the player loses the game if they collide with an obstacle.</p>
<p>Here’s an example of a test function for a hypothetical game:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[test]</span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">test_collision_detection</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_position</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">obstacle_position</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision_detected</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">check_collision</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">player_position</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">obstacle_position</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">assert!</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">collision_detected</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we’re testing the <code>check_collision</code> function, which takes the positions of the player and the obstacle and returns a boolean indicating whether or not they collide. We create two vectors to represent the positions and call the function, then use the <code>assert!</code> macro to ensure that the function returns <code>true</code>.</p>
<p>You can also use mock objects and dependency injection to test your game logic in isolation. For example, you can create a mock player object and pass it to your collision detection function, rather than relying on the actual player object in your game. This can help you isolate issues and ensure that your game logic behaves as expected.</p>
<p>It’s important to note that testing can’t guarantee that your game is bug-free, but it can help you catch common issues and ensure that your game logic is functioning as intended.</p>
<h2 id="publishing-a-bevy-rust-game">Publishing a Bevy-Rust game</h2>
<p>After you’ve developed and tested your Bevy-Rust game, the next step is to publish it so that others can play it. There are several options available for publishing a game, including desktop platforms, web platforms, and mobile platforms.</p>
<p>Here are some steps to consider when publishing your Bevy-Rust game:</p>
<ol>
<li>
<p>Build your game for the desired platform(s): Bevy provides tools for building your game for desktop platforms such as Windows, macOS, and Linux. You can also build your game for web platforms using WebAssembly (WASM). To build your game, you can use Cargo, Rust’s package manager, and specify the target platform using the <code>--target</code> flag.</p>
</li>
<li>
<p>Package your game: Once your game is built, you’ll need to package it into a format that can be distributed to players. For desktop platforms, you can create an installer or a ZIP file containing the game files. For web platforms, you can use a tool like <code>wasm-pack</code> to create a package that can be hosted on a website or deployed to a web platform like Itch.io.</p>
</li>
<li>
<p>Publish your game: There are many platforms available for publishing and distributing games, including Itch.io, Steam, and the Epic Games Store. Choose the platform that best fits your needs and follow their instructions for publishing your game. Make sure to include any necessary files, such as game assets and dependencies, along with your game package.</p>
</li>
<li>
<p>Market your game: Once your game is published, you’ll need to market it to potential players. This can involve creating a website, social media accounts, and advertising campaigns. It’s important to create engaging and eye-catching promotional materials that showcase the unique features of your game.</p>
</li>
<li>
<p>Gather feedback and update your game: As players begin to play your game, it’s important to gather feedback and use it to improve your game. You can use tools like Discord, Reddit, or Steam forums to communicate with your players and gather feedback. Consider creating a roadmap of features and updates that you plan to implement, and use player feedback to prioritize these updates.</p>
</li>
</ol>
<p>Publishing a game can be a complex process, but with the right tools and resources, you can make your game available to players around the world.</p>
<h2 id="compiling-and-packaging-the-game-for-distribution">Compiling and packaging the game for distribution</h2>
<p>Compiling and packaging your Bevy-Rust game for distribution can be done using Rust’s package manager, Cargo. Here are some steps to follow:</p>
<ol>
<li>
<p>Create a release build: Before packaging your game for distribution, you should create a release build of your game. This can be done using Cargo’s <code>--release</code> flag when building your game. For example, you can run <code>cargo build --release</code> to create a release build.</p>
</li>
<li>
<p>Check dependencies: Make sure that all dependencies required for your game are included in the release build. This includes any external libraries, game assets, or other resources. These should be included in the <code>Cargo.toml</code> file.</p>
</li>
<li>
<p>Package your game: Once you have created a release build and checked your dependencies, you can package your game for distribution. For desktop platforms, you can create an installer or a ZIP file containing the game files. For web platforms, you can use a tool like <code>wasm-pack</code> to create a package that can be hosted on a website or deployed to a web platform like Itch.io.</p>
</li>
<li>
<p>Test your packaged game: Before distributing your game, make sure to test the packaged version on the platform it is intended for. This will help catch any issues that may arise during distribution.</p>
</li>
<li>
<p>Distribute your game: Once you have packaged and tested your game, you can distribute it to players. This can be done using platforms like Itch.io, Steam, and the Epic Games Store. Follow the platform’s instructions for distributing your game.</p>
</li>
</ol>
<p>Compiling and packaging your Bevy-Rust game for distribution may require some trial and error, but with practice, you’ll become familiar with the process. Remember to test your game thoroughly before distributing it to players.</p>
<h2 id="considerations-for-different-platforms-windows-mac-linux-etc">Considerations for different platforms (Windows, Mac, Linux, etc.)</h2>
<p>When compiling and packaging your Bevy-Rust game for distribution, it’s important to consider the different platforms it will be running on. Here are some considerations for the most common platforms:</p>
<ul>
<li>
<p><strong>Windows:</strong> When compiling for Windows, make sure to test your game on different versions of the operating system, as well as different hardware configurations. You should also consider including an installer for the game, as this is a common distribution method on Windows.</p>
</li>
<li>
<p><strong>MacOS:</strong> When compiling for MacOS, make sure to test your game on different versions of the operating system and different hardware configurations. MacOS has strict requirements for code signing and notarization, so make sure to follow Apple’s guidelines to ensure your game is properly signed and notarized.</p>
</li>
<li>
<p><strong>Linux:</strong> When compiling for Linux, make sure to test your game on different distributions and package formats, as these can vary between distributions. You may also want to consider using a package manager like Flatpak or Snap to distribute your game.</p>
</li>
<li>
<p><strong>Web:</strong> When compiling for the web, make sure to test your game on different browsers and operating systems, as browser support for web technologies can vary. You should also consider using a tool like <code>wasm-pack</code> to create a package that can be easily hosted on a website or deployed to a web platform like Itch.io.</p>
</li>
</ul>
<p>In addition to these platform-specific considerations, you should also make sure to properly version your game, provide clear instructions for installation and running the game, and provide a way for players to report bugs or give feedback. By considering these factors, you can ensure that your Bevy-Rust game runs smoothly on all platforms and is well-received by players.</p>
<h2 id="conclusion-and-next-steps">Conclusion and next steps</h2>
<p>Congratulations! By now, you should have a good understanding of how to use the Bevy game engine with Rust to create your own games. We covered the basics of game development with Bevy, including creating a window, handling user input, loading assets, creating and moving game entities, and using Bevy’s ECS architecture. We also looked at some advanced topics like debugging and testing your game, and distributing it for different platforms.</p>
<p>If you’re new to Rust, you may want to continue exploring the language and its features to become more comfortable with it. Rust has many useful libraries and frameworks beyond Bevy that you can use for game development, such as <code>ggez</code> and <code>piston</code>.</p>
<p>If you’re interested in taking your Bevy game development skills to the next level, you can explore more advanced topics such as physics simulation, networking, and multiplayer. You can also contribute to the Bevy project itself, whether it be by fixing bugs, adding new features, or writing documentation.</p>
<p>Overall, Bevy and Rust offer a powerful and flexible combination for game development, and we hope this guide has helped you get started on your journey. Good luck and happy game development!</p>
<h2 id="recap-of-key-concepts-and-tools-covered-in-the-book">Recap of key concepts and tools covered in the book</h2>
<p>Sure, here’s a recap of the key concepts and tools covered in the book:</p>
<ol>
<li>
<p>Bevy game engine: Bevy is a game engine written in Rust that provides a high-level API for building games using an entity-component-system architecture.</p>
</li>
<li>
<p>Rust programming language: Rust is a systems programming language that is fast, memory safe, and designed for concurrency. It offers a number of features, including zero-cost abstractions, guaranteed memory safety, and thread safety.</p>
</li>
<li>
<p>Entity-component-system (ECS) architecture: ECS is a programming pattern that is commonly used in game development. In ECS, entities are represented as unique identifiers, components are data that describe the properties of an entity, and systems are functions that operate on entities with specific components.</p>
</li>
<li>
<p>Window creation: Creating a window is the first step in building a game. Bevy provides an easy-to-use API for creating a window and setting its properties.</p>
</li>
<li>
<p>Input handling: Bevy allows you to handle user input such as keyboard, mouse, and gamepad input.</p>
</li>
<li>
<p>Asset loading: Bevy provides an asset loading API that allows you to load images, audio, and other resources that your game needs.</p>
</li>
<li>
<p>Entity creation and movement: You can create and move entities in Bevy by creating components that describe their properties and using systems to update their position.</p>
</li>
<li>
<p>Debugging and testing: Bevy provides built-in debug tools such as a debug console, and Rust has a built-in testing framework that allows you to write unit tests for your game’s logic.</p>
</li>
<li>
<p>Publishing and distribution: You can compile and package your game for distribution on different platforms such as Windows, Mac, and Linux.</p>
</li>
</ol>
<p>I hope this recap helps!</p>
<h2 id="suggestions-for-further-learning-and-experimentation">Suggestions for further learning and experimentation</h2>
<p>Certainly! Here are some suggestions for further learning and experimentation with Bevy and Rust:</p>
<ol>
<li>
<p>Bevy official documentation: Bevy’s official documentation is an excellent resource for learning more about the engine’s API and features.</p>
</li>
<li>
<p>Rust official documentation: Rust’s official documentation is also a great resource for learning more about the language and its features.</p>
</li>
<li>
<p>Bevy sample projects: Bevy’s GitHub repository contains several sample projects that demonstrate how to use different features of the engine.</p>
</li>
<li>
<p>Rust game development books: There are several books available that cover game development in Rust, including “Rust Game Development” by Guillaume Gomez and “Hands-On Rust” by Claus Matzinger.</p>
</li>
<li>
<p>Game jams and community events: Participating in game jams and community events is a great way to practice your game development skills and meet other developers.</p>
</li>
<li>
<p>Experimentation: The best way to learn is through experimentation! Try creating your own game using Bevy and Rust, and experiment with different features and techniques.</p>
</li>
</ol>
<p>I hope these suggestions are helpful!</p>
<h1 id="chapter-2-first-steps-with-bevy">Chapter 2: First Steps with Bevy</h1>
<h2 id="creating-a-new-bevy-project">Creating a new Bevy project</h2>
<p>Sure, here’s how to create a new Bevy project:</p>
<ol>
<li>
<p>Open a terminal or command prompt on your computer.</p>
</li>
<li>
<p>Navigate to the directory where you want to create the new Bevy project.</p>
</li>
<li>
<p>Enter the following command to create a new Bevy project:</p>
</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cargo new my_game --bin</span></span></code></pre>
<p>This will create a new Rust project called <code>my_game</code> with a binary target.</p>
<ol start="4">
<li>Add Bevy as a dependency to the <code>Cargo.toml</code> file in your project directory. You can do this by adding the following line under <code>[dependencies]</code>:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">bevy = "0.5"</span></span></code></pre>
<p>This will add the latest version of Bevy as a dependency to your project.</p>
<ol start="5">
<li>
<p>Create a new Rust file in your project directory called <code>main.rs</code>. This will be the entry point for your Bevy game.</p>
</li>
<li>
<p>Add the following code to your <code>main.rs</code> file:</p>
</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code creates a new Bevy app and adds the default plugins to it. It then runs the app.</p>
<ol start="7">
<li>To run your Bevy game, enter the following command in your terminal or command prompt:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cargo run</span></span></code></pre>
<p>This will compile and run your Bevy game.</p>
<p>Congratulations! You’ve just created a new Bevy project.</p>
<h2 id="using-the-bevy-cli-to-create-a-new-project">Using the Bevy CLI to create a new project</h2>
<p>Bevy also provides a command-line interface (CLI) tool that you can use to create a new Bevy project. Here’s how:</p>
<ol>
<li>
<p>Open a terminal or command prompt on your computer.</p>
</li>
<li>
<p>Enter the following command to install the Bevy CLI:</p>
</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cargo install bevy_cli</span></span></code></pre>
<p>This will install the Bevy CLI tool on your computer.</p>
<ol start="3">
<li>
<p>Navigate to the directory where you want to create the new Bevy project.</p>
</li>
<li>
<p>Enter the following command to create a new Bevy project using the CLI tool:</p>
</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">bevy new my_game</span></span></code></pre>
<p>This will create a new Bevy project called <code>my_game</code> in the current directory.</p>
<ol start="5">
<li>To run your Bevy game, enter the following command in your terminal or command prompt:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cd my_game</span></span>
<span class="line"><span style="color: #abb2bf">cargo run</span></span></code></pre>
<p>This will compile and run your Bevy game.</p>
<p>Congratulations! You’ve just created a new Bevy project using the Bevy CLI tool.</p>
<h2 id="project-structure-overview">Project structure overview</h2>
<p>When you create a new Bevy project using the Bevy CLI tool, it generates a basic project structure for you. Here’s a brief overview of the key files and directories you’ll find in a Bevy project:</p>
<ul>
<li>
<p><strong><code>Cargo.toml</code></strong>: This file is a configuration file for the Rust package manager, `car. It contains information about your project, such as its name, version, dependencies, and build settings.</p>
</li>
<li>
<p><strong><code>src/</code> directory</strong>: This directory contains the source code for your Bevy project. It includes the following files:</p>
<ul>
<li>
<p><strong><code>main.rs</code></strong>: This file is the entry point for your Bevy game. It contains the <code>main</code> function, which is where your game code starts executing.</p>
</li>
<li>
<p><strong><code>lib.rs</code></strong>: This file contains any shared code or utility functions that your Bevy game might use.</p>
</li>
</ul>
</li>
<li>
<p><strong><code>.gitignore</code></strong>: This file tells Git which files and directories to ignore when you commit changes to your project’s repository.</p>
</li>
<li>
<p><strong><code>README.md</code></strong>: This file is a README file that provides basic information about your Bevy project.</p>
</li>
<li>
<p><strong><code>LICENSE</code></strong>: This file contains the license under which your Bevy project is released.</p>
</li>
</ul>
<p>These are the key files and directories that you’ll find in a Bevy project. As you develop your game, you may add additional directories or files to organize your code and assets.</p>
<h2 id="understanding-the-bevy-ecs-entity-component-system-architecture">Understanding the Bevy ECS (Entity-Component-System) architecture</h2>
<p>Bevy is built on an ECS (Entity-Component-System) architecture. This architecture is a way of organizing game code to make it more modular and easier to understand and maintain.</p>
<p>In the ECS architecture, a game is made up of three main components:</p>
<ol>
<li>
<p><strong>Entities</strong>: These are objects in the game world. Entities are defined by a unique identifier called an “entity ID.” Entities are just empty containers that can have any number of components attached to them.</p>
</li>
<li>
<p><strong>Components</strong>: These are the data associated with an entity. For example, a component could represent an entity’s position, velocity, or health. Components are simple data structures that store information about an entity. They do not contain any logic.</p>
</li>
<li>
<p><strong>Systems</strong>: These are the functions that operate on entities and their components. Systems update the state of the game by reading data from components and writing data back to them. Systems are responsible for handling input, rendering graphics, and updating the game logic.</p>
</li>
</ol>
<p>The ECS architecture separates the data of the game from the behavior of the game. This makes it easy to add new types of entities and components without changing existing code. Additionally, because systems only operate on the data they need, the code is more efficient and easier to optimize.</p>
<p>In Bevy, entities are created and managed by the <code>World</code> struct, while components are stored in <code>Component</code> and <code>Query</code> structs. Systems are defined as Rust functions that are registered with the <code>App</code> struct, which is responsible for running the game loop and invoking systems at the appropriate time.</p>
<h2 id="overview-of-ecs-and-its-advantages-for-game-development">Overview of ECS and its advantages for game development</h2>
<p>The Entity-Component-System (ECS) architecture is a popular way to structure game code for improved flexibility and performance. In the ECS architecture, a game is composed of three primary elements: entities, components, and systems.</p>
<p>Entities are the basic building blocks of a game. They are objects that exist in the game world and are defined by a unique ID. Entities can have any number of components attached to them.</p>
<p>Components are the data associated with an entity. They describe the properties and behaviors of an entity. For example, a component could represent an entity’s position, velocity, or health.</p>
<p>Systems are the logic that operates on entities and their components. They update the state of the game by reading data from components and writing data back to them. Systems are responsible for handling input, rendering graphics, and updating the game logic.</p>
<p>The ECS architecture has several advantages for game development:</p>
<ol>
<li>
<p><strong>Modularity and Flexibility</strong>: By separating the game’s behavior (systems) from the game’s data (entities and components), the ECS architecture makes it easy to add, remove, or modify game elements without having to change existing code. This modular design also allows for code reuse across multiple projects.</p>
</li>
<li>
<p><strong>Performance</strong>: Because systems only operate on the data they need, the code is more efficient and easier to optimize. Additionally, ECS systems allow for data-oriented design, which can lead to improved cache utilization and better performance on modern hardware.</p>
</li>
<li>
<p><strong>Debugging</strong>: Because entities and components are separate from the game’s behavior, it is easier to isolate and fix bugs in the code.</p>
</li>
<li>
<p><strong>Scalability</strong>: The ECS architecture can scale to accommodate large and complex games, making it a popular choice for game engines and frameworks.</p>
</li>
</ol>
<p>In summary, the ECS architecture is a powerful tool for game development that can improve modularity, flexibility, performance, and scalability.</p>
<h2 id="bevys-implementation-of-ecs">Bevy’s implementation of ECS</h2>
<p>Bevy’s implementation of ECS is built on top of Rust’s <code>specs</code> library, which provides a robust and efficient ECS implementation. Bevy extends the <code>specs</code> API with additional features and utilities that make it easier to work with ECS in a game development context.</p>
<p>In Bevy, entities are represented by <code>Entity</code> IDs, which are generated by the ECS system. Components are Rust structs that contain data relevant to an entity, and systems are Rust functions that operate on entities and their components.</p>
<p>Bevy also provides several features that make it easier to work with ECS:</p>
<ol>
<li>
<p><strong>Component registration</strong>: Bevy’s <code>#[derive(Component)]</code> macro makes it easy to register new components with the ECS system.</p>
</li>
<li>
<p><strong>System scheduling</strong>: Bevy automatically schedules systems based on their dependencies, ensuring that systems execute in the correct order.</p>
</li>
<li>
<p><strong>Resource management</strong>: Bevy provides a resource system for managing shared data, such as configuration settings or game state.</p>
</li>
<li>
<p><strong>Event handling</strong>: Bevy’s event system allows for decoupled communication between different systems and entities.</p>
</li>
</ol>
<p>Overall, Bevy’s implementation of ECS provides a powerful and flexible foundation for building games, while still being efficient and easy to work with.</p>
<h2 id="adding-entities-and-components-to-a-bevy-project">Adding entities and components to a Bevy project</h2>
<p>To add entities and components to a Bevy project, you can define Rust structs for your components and use them to create new entities.</p>
<p>Here’s an example of how to define a component struct and add it to an entity:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Define a new component struct</span></span>
<span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Component</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Position</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a new entity with a Position component</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">((</span><span style="color: #61AFEF">Position</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a new component <code>Position</code> that contains a <code>Vec2</code> representing the position of an entity. We then use the <code>Commands</code> resource to create a new entity with a <code>Position</code> component and a default position of <code>(0.0, 0.0)</code>.</p>
<p>You can also add multiple components to an entity by passing a tuple of components to the <code>spawn</code> method:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">((</span><span style="color: #61AFEF">Position</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)), </span><span style="color: #61AFEF">Velocity</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">))));</span></span></code></pre>
<p>In this example, we add a <code>Velocity</code> component to our entity, which contains a <code>Vec2</code> representing the velocity of the entity.</p>
<p>Once you’ve created entities with components, you can use systems to update their properties and interact with other entities in the game.</p>
<h2 id="creating-new-entities-and-assigning-components">Creating new entities and assigning components</h2>
<p>To create new entities and assign components to them in Bevy, you can use the <code>Commands</code> resource.</p>
<p>Here’s an example of how to create a new entity and add a <code>Transform</code> component to it:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a new entity with a transform component</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">((</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(),));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use the <code>spawn</code> method of the <code>Commands</code> resource to create a new entity and assign a <code>Transform</code> component to it. The <code>Transform::default()</code> method creates a new <code>Transform</code> component with default values for the position, rotation, and scale.</p>
<p>You can also add multiple components to an entity by passing a tuple of components to the <code>spawn</code> method:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">((</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(), </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)));</span></span></code></pre>
<p>In this example, we add a <code>Sprite</code> component to our entity, which contains a reference to a sprite image. We create a new <code>Sprite</code> component with the <code>Sprite::new(0.0)</code> method, which sets the sprite to an image with index <code>0</code>.</p>
<p>Once you’ve created entities with components, you can use systems to update their properties and interact with other entities in the game.</p>
<h2 id="creating-new-entities-and-assigning-components-to-a-bevy-project">Creating new entities and assigning components to a Bevy project</h2>
<p>In a Bevy project, you can create new entities and assign components to them using the <code>Commands</code> resource. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_player</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Name</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Player"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a function <code>spawn_player</code> that takes a mutable reference to a <code>Commands</code> resource. Inside the function, we use the <code>spawn_bundle</code> method of the <code>Commands</code> resource to create a new entity and attach a <code>SpriteBundle</code> component to it. We then use the <code>insert</code> method to add a <code>Player</code> component and a <code>Name</code> component to the entity.</p>
<p>Note that in this example, <code>Player</code> and <code>Name</code> are custom components that we’ve defined elsewhere in our code. To create these components, we can use the <code>#[derive]</code> attribute:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Component</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Component</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Name</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>In this code, we’ve defined two components: <code>Player</code> and <code>Name</code>. <code>Player</code> is a simple marker component that doesn’t contain any data, while <code>Name</code> contains a <code>String</code> that holds the name of the entity.</p>
<p>With these components defined, we can now use them to create new entities and attach them to the appropriate components.</p>
<h2 id="transforming-entities-in-2d-and-3d-space">Transforming entities in 2D and 3D space</h2>
<p>In Bevy, you can transform entities in 2D and 3D space by adding the appropriate components to them. Here’s an example of how to transform an entity in 2D space:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">move_sprite_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.x </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">() * </span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">() * </span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a system <code>move_sprite_system</code> that takes a <code>Time</code> resource and a mutable reference to a <code>Query</code> that selects entities with a <code>Sprite</code> component. Inside the system, we iterate over each entity selected by the query and update its <code>Transform</code> component to move it by 100 pixels per second in the x and y directions.</p>
<p>To transform an entity in 3D space, we can use the <code>GlobalTransform</code> component instead of <code>Transform</code>. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">rotate_cube_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GlobalTransform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Cube</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">rotate</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Quat</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_rotation_y</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">()));</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a system <code>rotate_cube_system</code> that takes a <code>Time</code> resource and a mutable reference to a <code>Query</code> that selects entities with a <code>Cube</code> component. Inside the system, we iterate over each entity selected by the query and update its <code>GlobalTransform</code> component to rotate it around the y-axis by an amount proportional to the elapsed time.</p>
<p>Note that in both of these examples, we’re using the <code>Query</code> API to select entities with the appropriate components. This is a powerful feature of Bevy that allows you to write systems that operate on subsets of your game objects based on their component composition.</p>
<h2 id="working-with-sprites-and-textures">Working with sprites and textures</h2>
<p>In Bevy, you can work with sprites and textures by using the <code>Sprite</code> and <code>Texture</code> components, respectively. Here’s an example of how to load a texture and use it to create a sprite:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_texture</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">textures</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"texture.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">textures</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_mut</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Set texture options here, if desired.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn the sprite here, or add it to an existing entity.</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a system <code>load_texture</code> that takes an <code>AssetServer</code> resource and a mutable reference to an <code>Assets&#x3C;Texture></code> resource. Inside the system, we load a texture file using the <code>AssetServer</code> and get a mutable reference to the corresponding texture in the <code>Assets</code> resource. We can then modify the texture’s options, if desired.</p>
<p>Once we have a texture, we can use it to create a sprite by passing its handle to the <code>Sprite</code> constructor. We can then spawn the sprite using the <code>Commands</code> resource, or add it to an existing entity using the <code>insert</code> method.</p>
<p>Here’s an example of how to modify a sprite’s properties:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">modify_sprite</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">.size </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">64.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">64.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">.color </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a system <code>modify_sprite</code> that takes a mutable reference to a <code>Query</code> that selects entities with a <code>Player</code> component and a <code>Sprite</code> component. Inside the system, we iterate over each entity selected by the query and modify its <code>Sprite</code> component to change its size to 64x64 pixels and its color to red.</p>
<p>Note that in both of these examples, we’re using the <code>Query</code> API to select entities with the appropriate components. This is a powerful feature of Bevy that allows you to write systems that operate on subsets of your game objects based on their component composition.</p>
<h2 id="handling-input-and-user-interactions">Handling input and user interactions</h2>
<p>In Bevy, you can handle user input and interactions using the <code>Input</code> resource and event system. Here’s an example of how to listen for keyboard input:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">handle_keyboard_input</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Space</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Do something when the space key is pressed.</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_released</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Escape</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Do something when the escape key is released.</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a system <code>handle_keyboard_input</code> that takes an <code>Input</code> resource. Inside the system, we check if the space key was just pressed or the escape key was just released using the <code>just_pressed</code> and <code>just_released</code> methods, respectively. If a key was pressed or released, we can perform some action.</p>
<p>Here’s an example of how to listen for mouse input:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">handle_mouse_input</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MouseButton</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MouseButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Left</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Do something when the left mouse button is pressed.</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_released</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MouseButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Right</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Do something when the right mouse button is released.</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MouseButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Middle</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Do something while the middle mouse button is held down.</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a system <code>handle_mouse_input</code> that takes an <code>Input</code> resource. Inside the system, we check if the left mouse button was just pressed, the right mouse button was just released, or the middle mouse button is currently held down using the <code>just_pressed</code>, <code>just_released</code>, and <code>pressed</code> methods, respectively. If a mouse button was pressed or released, we can perform some action.</p>
<p>Here’s an example of how to listen for window resize events:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">handle_window_resized</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Events</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">WindowResized</span><span style="color: #ABB2BF">>>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Local</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">WindowResized</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">window_size</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.new_size;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Do something with the new window size.</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a system <code>handle_window_resized</code> that takes an <code>Events&#x3C;WindowResized></code> resource and a mutable reference to a <code>Local&#x3C;EventReader&#x3C;WindowResized>></code> resource. Inside the system, we iterate over all <code>WindowResized</code> events using the <code>EventReader</code> and extract the new window size from each event. We can then perform some action with the new window size.</p>
<p>Note that in all of these examples, we’re using the Bevy event system to listen for input and window events. This system allows you to decouple your input handling logic from your game logic and provides a simple and flexible way to handle user interactions.</p>
<h2 id="setting-up-mouse-and-keyboard-input-handling">Setting up mouse and keyboard input handling</h2>
<p>To handle mouse and keyboard input in a Bevy project, you can use the <code>Input</code> resource and the <code>InputSystem</code>. Here’s an example of how to set up keyboard input handling:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">keyboard</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">keyboard_input_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Space</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Space key pressed!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a system <code>keyboard_input_system</code> that takes an <code>Input</code> resource of type <code>KeyCode</code>. Inside the system, we check if the space key was just pressed using the <code>just_pressed</code> method. If it was, we print a message to the console.</p>
<p>You can add this system to your Bevy app like this:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">keyboard_input_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This will add the <code>keyboard_input_system</code> to your app’s list of systems, which will be called every frame to handle keyboard input.</p>
<p>Here’s an example of how to set up mouse input handling:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">mouse</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">MouseButtonInput</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">MouseMotion</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">MouseWheel</span><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">mouse_input_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MouseButton</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mouse_motion_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MouseMotion</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mouse_wheel_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MouseWheel</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Mouse</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">) => </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">MouseButtonInput</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">ButtonPressed</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Mouse button pressed: {:?}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">MouseButtonInput</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">ButtonReleased</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Mouse button released: {:?}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => (),</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => (),</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mouse_motion_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Mouse motion: {:?}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mouse_wheel_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Mouse wheel: {:?}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a system <code>mouse_input_system</code> that takes <code>EventReader&#x3C;Input&#x3C;MouseButton>></code>, <code>EventReader&#x3C;Input&#x3C;MouseMotion>></code>, and <code>EventReader&#x3C;Input&#x3C;MouseWheel>></code> resources. Inside the system, we iterate over the <code>Input</code> events for each type of mouse input and print a message to the console for each event.</p>
<p>You can add this system to your Bevy app like this:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">mouse_input_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This will add the <code>mouse_input_system</code> to your app’s list of systems, which will be called every frame to handle mouse input.</p>
<h2 id="implementing-basic-player-movement-and-interaction">Implementing basic player movement and interaction</h2>
<p>To implement basic player movement and interaction in a Bevy project, you can use keyboard and mouse input handling to modify the position and state of player entities in the game world. Here’s an example of how to set up a basic player movement system:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">keyboard</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">math</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">transform</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">components</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">speed</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">player_movement_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">ZERO</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">A</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.x </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">D</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.x </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">W</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">S</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.y </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">movement</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">normalize</span><span style="color: #ABB2BF">() * </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.speed;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">movement</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">extend</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a <code>Player</code> component with a <code>speed</code> field, and a <code>player_movement_system</code> that takes an <code>Input</code> resource of type <code>KeyCode</code> and a query for entities with <code>Transform</code> and <code>Player</code> components. Inside the system, we check for input from the <code>W</code>, <code>A</code>, <code>S</code>, and <code>D</code> keys to determine the player’s movement direction, then calculate the movement vector and update the player entity’s <code>Transform</code> component to move it in the game world.</p>
<p>You can add this system to your Bevy app like this:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">player_movement_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This will add the <code>player_movement_system</code> to your app’s list of systems, which will be called every frame to update the player entity’s position based on keyboard input.</p>
<p>To handle player interaction with other entities, you can add additional components to the player entity and use collision detection and query systems to detect and respond to interactions with other entities in the game world. Here’s an example of how to set up a basic collision detection system:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">ecs</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*, </span><span style="color: #E5C07B">math</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">transform</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">components</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">speed</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Enemy</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">player_movement_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">ZERO</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">A</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.x </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">D</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.x </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">W</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">S</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.y </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">movement</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">normalize</span><span style="color: #ABB2BF">() * </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.speed;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">movement</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">extend</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">collision_detection_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(</span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">enemy_query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(</span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Enemy</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">player_entity</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">player_transform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">       </span></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">enemy_entity</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">enemy_transform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemy_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">distance</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_transform</span><span style="color: #ABB2BF">.translation.</span><span style="color: #61AFEF">distance</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">enemy_transform</span><span style="color: #ABB2BF">.translation);</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">distance</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">player_entity</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">despawn</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">enemy_entity</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">despawn</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define an <code>Enemy</code> component and a <code>collision_detection_system</code> that takes queries for entities with <code>Player</code> and <code>Enemy</code> components and checks for collisions between them. When a collision is detected, the system uses the <code>Commands</code> resource to despawn both the player and enemy entities.</p>
<p>You can add this system to your Bevy app like this:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">player_movement_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">collision_detection_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This will add both the <code>player_movement_system</code> and <code>collision_detection_system</code> to your app’s list of systems, which will be called every frame to update the player entity’s position based on keyboard input and check for collisions with enemy entities.</p>
<p>With these systems in place, you can now create and manipulate player and enemy entities in your game world and use keyboard input and collision detection to enable basic player movement and interaction.</p>
<h2 id="animating-entities-in-a-bevy-project">Animating entities in a Bevy project</h2>
<p>Animating entities in Bevy involves two main steps: defining the animation and playing the animation.</p>
<h2 id="defining-animations">Defining Animations</h2>
<p>In Bevy, animations are defined using the <code>Animation</code> component, which contains a list of <code>Node</code>s. Each <code>Node</code> represents a transformation to apply to an entity at a certain time in the animation. There are several types of <code>Node</code>s, including <code>Translation</code>, <code>Rotation</code>, and <code>Scale</code>, which correspond to the different types of transformations that can be applied to an entity.</p>
<p>Here’s an example of how to define a simple animation that moves an entity up and down:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">animate_up_and_down_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MyEntity</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">translation</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">seconds_since_startup</span><span style="color: #ABB2BF">() * </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF"> * </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">consts</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">PI</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">sin</span><span style="color: #ABB2BF">() * </span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">translation</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">animate_up_and_down_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">RED</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MyEntity</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define an <code>animate_up_and_down_system</code> that updates the translation of an entity’s transform based on the sine of the current time. We add this system to our Bevy app using the <code>add_system</code> method. We also define a <code>setup</code> function that creates an entity with a red sprite and a <code>MyEntity</code> component. This entity is then animated using the <code>animate_up_and_down_system</code>.</p>
<h2 id="playing-animations">Playing Animations</h2>
<p>To play an animation in Bevy, we can use the <code>AnimationPlayback</code> component, which specifies which animation to play and how to play it. We can also use the <code>Handle&#x3C;Animation></code> type to reference an animation asset that has been loaded into Bevy’s asset manager.</p>
<p>Here’s an example of how to play an animation on an entity:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyAnimation</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">animate_up_and_down_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_animation.gltf#Animation0"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">RED</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MyAnimation</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AnimationPlayback</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">animation_handle</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define an <code>AnimationPlayback</code> component that references an animation asset called “my_animation.gltf”. We add this component to an entity using the <code>insert</code> method. We also define a <code>MyAnimation</code> component to identify this entity as an animated entity. Finally, we add the <code>animate_up_and_down_system</code> to animate the entity’s transform.</p>
<p>Note that in this example, we use a GLTF asset to define our animation. GLTF is a file format that can be used to store 3D models and animations, and it is supported by Bevy’s asset manager. Bevy also supports other animation formats, such as FBX and Blender.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this section, we covered how to define and play animations in a Bevy project. We saw how animations are defined using the <code>Animation</code> component, which contains a list of <code>Node</code>s that represent transformations to apply to entities. We also saw how to play animations using the <code>AnimationPlayback</code> component, which specifies which animation to play and how to play it. With these tools, we can create complex and engaging animations in our Bevy projects.</p>
<h2 id="understanding-bevys-animation-system">Understanding Bevy’s animation system</h2>
<p>Bevy’s animation system is a powerful tool for creating dynamic and engaging visual effects in your games and interactive applications. The system is built around the <code>Animation</code> component, which defines the transformations to be applied to an entity over time. An <code>Animation</code> consists of a list of <code>Node</code>s, which are transformations such as translations, rotations, and scales. These <code>Node</code>s can be combined to create complex and intricate animations.</p>
<p>To play an <code>Animation</code>, Bevy provides the <code>AnimationPlayback</code> component. This component specifies which <code>Animation</code> to play, and how to play it. You can control the playback of the animation by setting properties such as the playback speed, looping behavior, and whether or not to automatically start or stop the animation.</p>
<p>Bevy also provides a set of systems that work together to update the transformations of animated entities over time. The <code>AnimateSpriteSystem</code> updates the sprite component of an entity to match its corresponding <code>Animation</code> component, while the <code>AnimateTransformSystem</code> updates the transform component of an entity. The <code>AnimateSystem</code> combines these systems and updates both the sprite and transform components of an entity.</p>
<p>One of the advantages of Bevy’s animation system is its flexibility. You can create animations in a variety of formats, including GLTF, FBX, and Blender. This allows you to leverage existing assets and workflows, or create custom animations using your preferred tools.</p>
<p>In addition, Bevy’s animation system is highly performant, thanks to its use of GPU-accelerated animations. This allows you to create complex animations without sacrificing performance or framerate.</p>
<p>Overall, Bevy’s animation system is a powerful and flexible tool for creating dynamic and engaging visual effects in your games and interactive applications. Whether you’re creating simple sprite animations or complex 3D animations, Bevy has the tools you need to bring your vision to life.</p>
<h2 id="creating-and-controlling-animations-for-entities">Creating and controlling animations for entities</h2>
<p>To create and control animations for entities in Bevy, you can follow these steps:</p>
<ol>
<li>
<p>Define the animation using the <code>Animation</code> component. This component contains a list of <code>Node</code>s, which are transformations to be applied to the entity over time. For example, you might define an animation that moves a sprite from one position to another, or an animation that rotates an object around its axis.</p>
</li>
<li>
<p>Attach the <code>Animation</code> component to the entity that you want to animate. You can do this using the <code>commands.spawn()</code> method, or by adding the component to an existing entity using <code>commands.insert()</code>.</p>
</li>
<li>
<p>Specify the playback parameters for the animation using the <code>AnimationPlayback</code> component. This component controls how the animation is played, including properties such as playback speed, looping behavior, and whether or not to automatically start or stop the animation.</p>
</li>
<li>
<p>Use the <code>AnimateSystem</code> to update the transformations of animated entities over time. This system combines the <code>AnimateSpriteSystem</code> and the <code>AnimateTransformSystem</code>, and updates both the sprite and transform components of an entity.</p>
</li>
</ol>
<p>Here is an example that demonstrates how to create and control an animation in Bevy:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AnimatedSprite</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">SpriteSheet</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Animation</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AnimationState</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">animation_started</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">bool</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">play_animation</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">animate</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"spritesheet.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_sheet</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SpriteSheet</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"spritesheet.png"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprites</span><span style="color: #ABB2BF">: </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">SpriteSheetBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">sprite_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">SpriteSheetBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">sprite_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // ...</span></span>
<span class="line"><span style="color: #ABB2BF">        ],</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_sheet_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">watch_for_changes</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sprite_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"animation.gltf#Animation0"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation_state</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AnimationState</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">animation_started</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">OrthographicCameraBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new_2d</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteSheetBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">sprite_sheet_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AnimatedSprite</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">sprite_sheet_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">animation_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">animation_state</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">play_animation</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(</span></span>
<span class="line"><span style="color: #ABB2BF">        &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AnimationPlayback</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        &#x26;</span><span style="color: #E5C07B">AnimatedSprite</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AnimationState</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    )>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">playback</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">.animation_started {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">playback</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_animation</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">.animation.</span><span style="color: #61AFEF">clone_weak</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">playback</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_loop</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">playback</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_autoplay</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">.animation_started </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">animate</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #E5C07B">Animation</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AnimationPlayback</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">playback</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">       </span></span>
<span class="line"><span style="color: #E06C75">playback</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">update_time</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">node</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.nodes.</span><span style="color: #61AFEF">first</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AnimationNode</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Translation</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">translation</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">node</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">translation</span><span style="color: #ABB2BF">.x.</span><span style="color: #61AFEF">value</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">playback</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">current_time</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">translation</span><span style="color: #ABB2BF">.y.</span><span style="color: #61AFEF">value</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">playback</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">current_time</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">translation</span><span style="color: #ABB2BF">.z.</span><span style="color: #61AFEF">value</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">playback</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">current_time</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">            );</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we first define two components: <code>AnimatedSprite</code>, which contains a reference to the sprite sheet and animation for a given entity, and <code>AnimationState</code>, which tracks whether or not an animation has started.</p>
<p>In the <code>setup</code> function, we load a sprite sheet and an animation from asset files and create a new entity with a sprite and the <code>AnimatedSprite</code> and <code>AnimationState</code> components.</p>
<p>In the <code>play_animation</code> function, we check whether or not the animation has already started. If it hasn’t, we set the animation on the <code>AnimationPlayback</code> component and start it.</p>
<p>In the <code>animate</code> function, we update the position of the entity based on the current time in the animation. We retrieve the first <code>Node</code> in the <code>Animation</code> component, which in this case is a translation node. We then extract the x, y, and z components of the translation and update the <code>Transform</code> component of the entity accordingly.</p>
<p>Note that this is just a simple example, and Bevy’s animation system is capable of much more complex animations, including blending between animations and animating multiple components of an entity simultaneously.</p>
<h2 id="working-with-audio-in-a-bevy-project">Working with audio in a Bevy project</h2>
<p>Bevy includes a powerful audio system that allows you to play sound effects and music in your game. Here’s an example of how to load and play an audio file in Bevy:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">audio</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AudioPlugin</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sound</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"path/to/sound.ogg"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sound</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we first add the <code>AudioPlugin</code> to our app so that Bevy knows to load and play audio files. Then, in the <code>setup</code> function, we load an audio file and play it using the <code>Audio</code> resource.</p>
<p>Note that Bevy supports multiple audio formats, including MP3, WAV, and Ogg Vorbis. To load a different format, simply change the file extension in the path.</p>
<p>Bevy also includes features like audio mixing, spatial audio, and audio effects. Check out the Bevy documentation for more information on how to use these features.</p>
<h2 id="loading-and-playing-audio-assets">Loading and playing audio assets</h2>
<p>Loading and playing audio assets in Bevy is quite simple. Here’s an example that loads and plays a sound effect when the user presses a button:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">keyboard</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">audio</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">AudioBundle</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Play</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sound_effect_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">control_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AudioBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sound_effect_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Play</span><span style="color: #ABB2BF">)>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">play</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">play</span><span style="color: #ABB2BF">.is_playing </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF">.is_loaded {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">play</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">handle</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">control_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Play</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">play</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Space</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">play</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we first add the <code>AudioBundle</code> to our app so that Bevy knows to load and play audio files. Then, in the <code>sound_effect_system</code> function, we check if the sound effect is not playing and if it is loaded. If these conditions are met, we start playing the sound effect.</p>
<p>In the <code>control_system</code> function, we check if the user presses the space key. If the key is pressed, we start playing the sound effect by calling <code>play.play()</code> on the <code>Play</code> component.</p>
<p>Note that the <code>Play</code> component is added automatically by Bevy when you load an audio file. To load an audio file, simply call <code>audio.load()</code> and pass in the path to the file.</p>
<h2 id="creating-sound-effects-and-background-music">Creating sound effects and background music</h2>
<p>When creating sound effects and background music for your Bevy game, it’s important to consider the format and quality of your audio files.</p>
<p>Bevy supports multiple audio formats, including MP3, WAV, and Ogg Vorbis. However, some formats may be better suited for certain use cases than others. For example, MP3 files are often smaller in size than WAV files, but they may not sound as good in certain situations.</p>
<p>When creating sound effects, you’ll want to make sure that they are short and punchy, and that they fit well with the rest of your game’s audio. If your game has a theme or a specific style, you may want to create sound effects that reflect this.</p>
<p>When creating background music, you’ll want to consider the mood and tone of your game, as well as the overall pacing. You may want to use music to set the mood or to create tension, or you may want to use it to provide a relaxing background for the player.</p>
<p>In general, it’s a good idea to test your audio files in the context of your game to make sure they fit well and sound good. Bevy provides tools for testing and tweaking your audio, such as volume and pitch controls, so make sure to take advantage of these features.</p>
<h2 id="debugging-and-profiling-a-bevy-project">Debugging and profiling a Bevy project</h2>
<p>Debugging and profiling a Bevy project is an important part of game development. Bevy provides several tools that can help you identify and fix bugs, as well as optimize the performance of your game.</p>
<p>One of the most important tools for debugging is the Bevy debug console. This console can be enabled by pressing the tilde (~) key during gameplay, and it provides real-time information about your game’s systems, entities, and components. This information can be used to identify potential issues, such as missing components or incorrectly configured systems.</p>
<p>In addition to the debug console, Bevy also provides profiling tools that can help you optimize the performance of your game. The <code>bevy_profiler</code> crate provides a simple and easy-to-use profiling system that can be used to measure the time spent in various parts of your game’s code. By profiling your code, you can identify bottlenecks and optimize your game’s performance.</p>
<p>Another important tool for debugging and profiling is the <code>println!</code> macro. This macro can be used to print information to the console at runtime, which can be helpful for identifying issues that are not immediately obvious from the debug console or profiling data.</p>
<p>Finally, it’s important to test your game thoroughly before releasing it. Bevy provides several testing tools, such as the <code>bevy_test</code> crate, that can help you write tests for your game’s systems and components. By testing your game, you can identify and fix issues before they affect your players.</p>
<h2 id="using-bevys-built-in-debug-tools-for-ecs-and-performance-analysis">Using Bevy’s built-in debug tools for ECS and performance analysis</h2>
<p>Bevy provides several built-in debug tools that can help you analyze the performance of your ECS and identify issues with your game’s systems and components.</p>
<p>One of the most powerful debug tools in Bevy is the Entity Debugger, which allows you to inspect the entities and components in your game in real-time. This tool can be accessed by pressing the F12 key during gameplay, and it provides detailed information about each entity, including its ID, components, and system state.</p>
<p>Another useful debug tool in Bevy is the Frame Debugger, which allows you to inspect the performance of your game over time. This tool can be accessed by pressing the F3 key during gameplay, and it provides information about the time spent in each system, as well as the total number of entities and components in your game.</p>
<p>Bevy also provides several profiling tools that can help you analyze the performance of your game’s systems and identify bottlenecks. The <code>bevy_profiler</code> crate provides a simple and easy-to-use profiling system that can be used to measure the time spent in various parts of your game’s code.</p>
<p>In addition to these built-in debug tools, Bevy also provides several third-party debug and profiling tools that can be used to analyze the performance of your game. For example, the <code>tracy_client</code> crate provides a powerful profiling tool that can be used to visualize the performance of your game’s systems and identify bottlenecks.</p>
<p>By using these debug and profiling tools, you can identify issues with your game’s systems and components, optimize its performance, and ensure that it provides a smooth and enjoyable experience for your players.</p>
<h2 id="implementing-custom-debugging-tools-for-your-game">Implementing custom debugging tools for your game</h2>
<p>Implementing custom debugging tools for your game can be a powerful way to analyze the behavior of your game’s systems and components and identify issues that may not be immediately obvious from built-in debug tools.</p>
<p>One approach to implementing custom debugging tools is to create a system that periodically outputs data to a log file or console. This system can be configured to output data about specific components or systems, and the data can be used to identify patterns or trends in the behavior of your game.</p>
<p>Another approach is to create a custom user interface that allows you to interact with and manipulate the components and systems in your game. This interface can be used to tweak parameters, test different configurations, and analyze the behavior of your game in real-time.</p>
<p>You can also use custom debugging tools to collect data about the behavior of your game’s users. For example, you could collect data about the most frequently used features, the most common errors or crashes, or the average time spent on each level.</p>
<p>To implement custom debugging tools in Bevy, you can use the built-in ECS and system architecture to create custom systems that output data to the console or log file, or manipulate components and systems in real-time. You can also use Bevy’s UI system to create custom user interfaces for debugging and testing.</p>
<p>Overall, implementing custom debugging tools for your game can be a powerful way to improve the quality and performance of your game, and ensure that it provides a smooth and enjoyable experience for your players.</p>
<h2 id="conclusion-and-next-steps-1">Conclusion and next steps</h2>
<p>Congratulations! You’ve now learned how to create a complete game using the Bevy game engine. You’ve learned how to create entities, components, and systems, and how to use Bevy’s built-in tools and libraries to implement gameplay mechanics, graphics, audio, input handling, and more.</p>
<p>However, there’s still a lot more to learn and explore in the world of game development with Rust and Bevy. Some next steps you might consider include:</p>
<ul>
<li>Experiment with different gameplay mechanics and ideas to make your game more engaging and challenging.</li>
<li>Learn more about Rust and its features, such as advanced memory management and multi-threading, to optimize the performance of your game.</li>
<li>Explore Bevy’s built-in libraries and tools, such as the physics engine and particle system, to add more visual and interactive elements to your game.</li>
<li>Read more about game design and development best practices, and learn from the experiences of other game developers.</li>
<li>Publish your game on different platforms, such as PC, mobile, and web, to reach a wider audience and get feedback from players.</li>
</ul>
<p>Overall, game development is a challenging but rewarding field, and there’s always more to learn and explore. With the skills and knowledge you’ve gained from this guide, you’re well on your way to creating your own amazing games using Rust and Bevy. Good luck, and happy coding!</p>
<h2 id="recap-of-key-concepts-and-tools-covered-in-the-chapter">Recap of key concepts and tools covered in the chapter</h2>
<p>In this chapter, we covered many key concepts and tools for game development with Rust and Bevy. Here’s a recap of some of the most important ones:</p>
<ul>
<li>Entities, components, and systems: Bevy uses an entity-component-system (ECS) architecture, where game objects are represented as entities with associated components, and game logic is implemented using systems that manipulate these components.</li>
<li>Bevy’s built-in libraries and tools: Bevy provides many built-in libraries and tools, such as the sprite and texture library, input handling system, audio system, and UI system, that make it easy to implement common game development tasks.</li>
<li>Asset loading and management: Bevy provides a flexible and powerful system for loading and managing assets, such as images, sounds, and fonts, that allows you to efficiently use and share these resources in your game.</li>
<li>Animation system: Bevy provides an animation system that allows you to create and control animations for your game objects using a simple and intuitive API.</li>
<li>Debugging and profiling: Bevy provides many built-in debugging and profiling tools, such as the Bevy ECS debug tool and the Bevy profiler, that help you diagnose and fix issues with your game’s performance and behavior.</li>
<li>Custom debugging tools: Bevy’s flexible architecture and APIs make it easy to implement custom debugging tools, such as logging systems and custom user interfaces, to help you analyze and optimize your game’s behavior.</li>
</ul>
<p>Overall, these concepts and tools are essential for any game development project with Bevy, and mastering them will help you create engaging and polished games that provide a great experience for your players.</p>
<h2 id="suggestions-for-further-learning-and-experimentation-with-bevys-ecs-architecture">Suggestions for further learning and experimentation with Bevy’s ECS architecture</h2>
<p>If you’re interested in further learning and experimentation with Bevy’s ECS architecture, here are some suggestions:</p>
<ul>
<li>Experiment with creating your own custom components and systems, and see how they interact with existing Bevy libraries and systems.</li>
<li>Explore Bevy’s event system, which allows you to trigger events in response to certain game conditions, and build custom systems that react to these events.</li>
<li>Study the Bevy source code and documentation to gain a deeper understanding of how the ECS architecture is implemented and how it can be extended.</li>
<li>Experiment with alternative ECS libraries, such as Legion or Specs, to compare their performance and flexibility to Bevy’s ECS system.</li>
<li>Consider implementing a small game project using Bevy and its ECS architecture, and iterate on it to improve its performance and features over time.</li>
</ul>
<p>Remember, the best way to learn is by doing, so don’t be afraid to experiment and try new things with Bevy’s ECS architecture!</p>
<h1 id="chapter-3-input-and-user-interaction">Chapter 3: Input and User Interaction</h1>
<h2 id="capturing-user-input-with-bevy">Capturing user input with Bevy</h2>
<p>Capturing user input is an important part of game development, and Bevy provides a flexible and powerful system for handling user input events.</p>
<p>To capture user input, you first need to define the types of input events that you want to capture, such as mouse clicks or keyboard presses. Bevy provides a number of built-in input event types, such as <code>MouseButtonInputEvent</code> and <code>KeyboardInputEvent</code>, which you can use to capture these events.</p>
<p>Once you have defined the input event types that you want to capture, you can create a system that listens for these events and updates the state of your game accordingly. For example, you might create a system that listens for keyboard input events and updates the position of a player character based on the keys that are pressed.</p>
<p>Here’s an example of how you might capture keyboard input events in a Bevy game:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">keyboard_input_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">keyboard_input_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Events</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyboardInput</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_positions</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_positions</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Move the player character up when the 'W' key is pressed</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.scancode </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Scancode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">W</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.state </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ElementState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Pressed</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Move the player character down when the 'S' key is pressed</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.scancode </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Scancode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">S</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.state </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ElementState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Pressed</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Move the player character left when the 'A' key is pressed</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.scancode </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Scancode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">A</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.state </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ElementState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Pressed</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.x </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Move the player character right when the 'D' key is pressed</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.scancode </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Scancode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">D</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.state </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ElementState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Pressed</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.x </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">keyboard_input_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, the <code>keyboard_input_system</code> function listens for <code>KeyboardInput</code> events and updates the position of player entities in response to the keys that are pressed. The <code>set_position</code> function is called during startup to create and position the player entities.</p>
<p>Of course, this is just a simple example, and there are many other ways that you can capture and handle user input in a Bevy game. The important thing is to experiment with different approaches and find the one that works best for your specific game and user interface.</p>
<p>Once you have captured the user input, you can use it to drive the behavior of your game entities, update your game state, and respond to user actions in various ways. Bevy provides a range of tools and features for handling user input, including event systems, action maps, and input devices.</p>
<p>One common approach to handling user input in Bevy is to use the <code>EventReader</code> resource to read and process input events generated by the <code>InputSystem</code>. This resource allows you to read events of a specific type, such as mouse or keyboard events, and process them in a system that is run every frame. For example, you can use the <code>MouseButtonInput</code> event to detect when the user clicks the mouse, and then use the mouse position to select a game entity or trigger an action.</p>
<p>Another approach is to use action maps to map user input to specific game actions, such as moving the player character or firing a weapon. Bevy’s input system supports action maps out of the box, allowing you to define a set of actions and map them to specific keys or buttons. You can then query the state of the action map in your game systems to determine which actions are currently active and respond accordingly.</p>
<p>Bevy also provides support for input devices, such as game controllers and joysticks. You can use the <code>GamepadEvent</code> and <code>JoyStickEvent</code> events to capture input from these devices, and then process them in your game systems. Bevy’s input system also supports remapping of controller buttons and axis, allowing you to customize the control scheme of your game to better suit the user’s preferences.</p>
<p>Overall, Bevy provides a flexible and powerful set of tools for capturing and processing user input, allowing you to create responsive and engaging games that provide a great user experience. With a little experimentation and some creativity, you can use these tools to create games that are truly unique and enjoyable to play.</p>
<h2 id="overview-of-bevys-input-system">Overview of Bevy’s input system</h2>
<p>Bevy’s input system provides a flexible and powerful way to capture and process user input in your game. It is based on the Entity Component System (ECS) architecture and is designed to work seamlessly with Bevy’s other systems and resources.</p>
<p>At a high level, Bevy’s input system works by generating events for user input actions, such as key presses, mouse clicks, and joystick movements. These events are then passed to an event reader system that processes them and updates the game state accordingly.</p>
<p>To configure and customize the input system, Bevy provides several resources and components that you can use in your game code. These include:</p>
<ul>
<li><code>InputSystem</code>: The core input system that generates input events and updates the input state.</li>
<li><code>EventReader</code>: A resource that allows you to read input events of a specific type in your game systems.</li>
<li><code>KeyCode</code>: An enum that defines all the possible keyboard keys that can be pressed.</li>
<li><code>MouseButton</code>: An enum that defines the different mouse buttons that can be clicked.</li>
<li><code>MouseMotion</code>: A component that tracks the position of the mouse in the game window.</li>
<li><code>GamepadEvent</code> and <code>JoyStickEvent</code>: Events that capture input from game controllers and joysticks.</li>
</ul>
<p>Bevy’s input system also supports input mapping, which allows you to map user input actions to specific game actions or behaviors. This is done using action maps, which are collections of actions and bindings that define how user input should be translated into game actions.</p>
<p>Overall, Bevy’s input system provides a flexible and customizable way to capture and process user input in your game, allowing you to create engaging and responsive user interfaces that enhance the overall gameplay experience.</p>
<h2 id="capturing-input-events-using-bevys-input-api">Capturing input events using Bevy’s input API</h2>
<p>To capture input events using Bevy’s input API, you can follow these general steps:</p>
<ol>
<li>First, you need to enable the input system in your Bevy app by adding it to your AppBuilder. This is typically done in your app’s <code>main.rs</code> file, like this:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">input_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Space</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Space key pressed"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code adds the input system to the app’s plugin list and registers an input system that will be called every frame. The input system takes a <code>Res&#x3C;Input&#x3C;KeyCode>></code> resource as an argument, which provides access to the current state of the keyboard input.</p>
<ol start="2">
<li>Next, you can use the <code>Input</code> resource to check if a specific key is currently pressed or released, like this:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">input_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Space</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Space key pressed"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">released</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Escape</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Escape key released"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code checks if the space key is currently pressed and if the escape key was released. If either condition is true, it prints a message to the console.</p>
<ol start="3">
<li>You can also use the <code>EventReader</code> resource to read input events of a specific type in your game systems. Here’s an example of how to use it to read mouse button events:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">mouse_input_system</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MouseButtonInput</span><span style="color: #ABB2BF">>, </span></span>
<span class="line"><span style="color: #ABB2BF">                      </span><span style="color: #E06C75">mouse_button_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Events</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MouseButtonInput</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">mouse_button_events</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">MouseButtonInput</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">MouseButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Left</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ElementState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Pressed</span><span style="color: #ABB2BF"> } => {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Left mouse button pressed"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">MouseButtonInput</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">MouseButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Right</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ElementState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Pressed</span><span style="color: #ABB2BF"> } => {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Right mouse button pressed"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => (),</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code registers a system that reads <code>MouseButtonInput</code> events using the <code>EventReader</code> resource. The <code>iter</code> method is used to iterate over all the <code>MouseButtonInput</code> events in the event stream, and the <code>match</code> statement is used to handle events for specific mouse buttons and states.</p>
<p>These are just some examples of how you can capture input events using Bevy’s input API. Depending on your game’s requirements, you can use different input resources and components to capture and process user input in different ways.</p>
<h2 id="handling-input-events-and-user-interactions">Handling input events and user interactions</h2>
<p>Once we have captured input events using Bevy’s input API, we can handle those events and respond to user interactions in various ways depending on the requirements of our game. In general, handling input events involves modifying entities in the game world based on the type and context of the input event. Here are some common approaches for handling input events in a Bevy project:</p>
<ol>
<li>
<p>Modifying the position, velocity, or other properties of entities in the game world based on input events. For example, in a platformer game, the player might move left or right based on left or right arrow key presses.</p>
</li>
<li>
<p>Modifying the state of the game world based on input events. For example, in a puzzle game, the user might click on a piece to select it, and then click on an empty space to move the piece there.</p>
</li>
<li>
<p>Triggering actions or events in response to input events. For example, in a shooter game, the user might press the space bar to fire a weapon.</p>
</li>
<li>
<p>Modifying the user interface or displaying feedback based on input events. For example, in a strategy game, hovering the mouse over a unit might display its statistics, and clicking on a unit might bring up a menu of actions that can be performed.</p>
</li>
</ol>
<p>To handle input events in a Bevy project, we typically use systems that query for specific components and modify them based on the input events. For example, we might use a system that queries for the <code>Transform</code> and <code>Velocity</code> components of a player entity, and updates the <code>Transform</code> based on arrow key presses.</p>
<p>It’s important to remember that handling input events is just one part of creating a responsive and engaging user experience. We also need to consider factors like game physics, animation, and audio to create a cohesive and immersive game.</p>
<h2 id="responding-to-user-input-events">Responding to user input events</h2>
<p>Once we have captured and processed user input events in a Bevy project, we can respond to those events by modifying entities, triggering actions, or modifying the game state. Here are some examples of how we can respond to user input events:</p>
<ol>
<li>
<p>Modifying entity properties: We can modify the position, rotation, or velocity of entities based on user input events. For example, in a game where the player moves around the game world, we might update the player’s position and rotation based on arrow key presses.</p>
</li>
<li>
<p>Triggering actions: We can trigger specific actions based on user input events. For example, in a game where the player can fire a weapon, we might trigger the weapon firing animation and play a sound effect when the user presses the fire button.</p>
</li>
<li>
<p>Modifying the game state: We can modify the game state based on user input events. For example, in a game where the user can select and move pieces, we might modify the game state to reflect the new position of the piece.</p>
</li>
<li>
<p>Modifying the user interface: We can modify the user interface based on user input events. For example, in a game where the user hovers the mouse over a unit to see its statistics, we might display the statistics in a UI tooltip.</p>
</li>
</ol>
<p>To implement these types of responses to user input events in a Bevy project, we typically use systems that modify entity properties, trigger actions, or modify the game state based on input events. For example, we might use a system that modifies the <code>Transform</code> component of a player entity based on arrow key presses, or a system that triggers an animation and sound effect when the user presses a button.</p>
<p>It’s important to carefully consider how we respond to user input events to create a cohesive and intuitive user experience. We should aim to make our games easy to learn and fun to play, while also providing enough challenge and depth to keep players engaged over time.</p>
<h2 id="implementing-input-driven-gameplay-mechanics">Implementing input-driven gameplay mechanics</h2>
<p>One of the powerful aspects of capturing and processing user input events in a Bevy project is that it allows us to create input-driven gameplay mechanics. Here are some examples of input-driven gameplay mechanics that we might implement in a Bevy project:</p>
<ol>
<li>
<p>Jumping: In a game where the player can jump, we might implement a system that checks for the jump input event and modifies the player entity’s velocity accordingly.</p>
</li>
<li>
<p>Attacking: In a game where the player can attack, we might implement a system that checks for the attack input event and triggers an attack animation and sound effect.</p>
</li>
<li>
<p>Collecting items: In a game where the player can collect items, we might implement a system that checks for the collect input event and modifies the game state to reflect the player’s new inventory.</p>
</li>
<li>
<p>Building structures: In a game where the player can build structures, we might implement a system that checks for the build input event and modifies the game state to add the new structure to the game world.</p>
</li>
</ol>
<p>To implement these types of input-driven gameplay mechanics, we typically use a combination of input event capturing, entity and component modification, and game state modification. We might also use animations and sound effects to provide feedback to the player and make the gameplay mechanics more engaging.</p>
<p>It’s important to carefully balance input-driven gameplay mechanics with other aspects of game design, such as level design, enemy AI, and game balancing. We should aim to create gameplay mechanics that are intuitive and fun to use, while also providing enough challenge and depth to keep players engaged over time.</p>
<h2 id="creating-user-interface-elements-and-menus">Creating user interface elements and menus</h2>
<p>Creating user interface (UI) elements and menus is an essential part of many games, especially those with complex gameplay mechanics or customization options. In Bevy, we can use its UI module to create and manage UI elements and menus.</p>
<p>Here’s an overview of the steps involved in creating a UI element in Bevy:</p>
<ol>
<li>
<p>Define a new struct that implements the <code>Widget</code> trait. This struct will represent the UI element and define its appearance and behavior.</p>
</li>
<li>
<p>Implement the <code>Widget</code> trait’s methods for rendering and handling events. These methods will define how the UI element is drawn on the screen and how it responds to user input events.</p>
</li>
<li>
<p>Add the UI element to the Bevy UI hierarchy using the <code>add</code> method. This method takes the UI element’s struct as a parameter and adds it to the hierarchy, allowing it to be drawn and interacted with.</p>
</li>
<li>
<p>Update the UI element’s state as needed using Bevy’s ECS architecture. This might involve modifying the UI element’s properties or triggering events based on user input.</p>
</li>
</ol>
<p>Here’s an example of creating a simple UI element in Bevy:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyButton</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">pressed</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">bool</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Widget</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyButton</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">event</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">ctx</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">EventCtx</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Event</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">_widget</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">WidgetState</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Event</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Mouse</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MouseButtonInput</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">MouseButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Left</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">, .. }) => {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">.pressed </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">state</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ElementState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Pressed</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">.pressed {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Button pressed!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => {},</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">draw</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">ctx</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">DrawCtx</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">_widget</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">WidgetState</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">_children</span><span style="color: #ABB2BF">: &#x26;[</span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">]) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">.pressed { </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">YELLOW</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> { </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ctx</span><span style="color: #ABB2BF">.resources.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Font</span><span style="color: #ABB2BF">>().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">.text).</span><span style="color: #61AFEF">with_color</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">text_pos</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">pos2</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">ctx</span><span style="color: #ABB2BF">.render_context.</span><span style="color: #61AFEF">text</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">text_pos</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">create_ui</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyButton</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"Click me!"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">pressed</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">NodeBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Length</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Pixels</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Length</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Pixels</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">position_type</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">PositionType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Absolute</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">left</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Length</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Pixels</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">top</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Length</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Pixels</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">materials</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">UNLIT_WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    }).</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">WidgetState</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This example creates a simple button UI element that changes color when clicked. It implements the <code>Widget</code> trait’s <code>event</code> and <code>draw</code> methods to handle user input events and draw the button on the screen. It then adds the button to the UI hierarchy using Bevy’s <code>spawn_bundle</code> method, which creates a new entity with the given components and adds it to the ECS.</p>
<p>We can create more complex UI elements and menus using a similar approach, by defining multiple nested <code>Widget</code> structs and managing their state and behavior using Bevy’s ECS architecture. Bevy’s UI module also provides additional tools and utilities for managing layouts, animations, and user input events, making it a powerful tool for creating intuitive and engaging user interfaces in our games.</p>
<p>Let’s create a simple UI element using the <code>bevy_egui</code> plugin. First, we need to add the plugin to our project in the <code>plugins</code> array of the <code>AppBuilder</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">EguiPlugin</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Next, we can create a UI element by creating an Egui <code>Window</code>, adding a label and a button:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">create_ui</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">UiCameraBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">WindowBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">WindowResizePolicy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Content</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">WindowTitle</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"My UI"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">()))</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Hello, world!"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">with_font</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Font</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">justify_content</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">JustifyContent</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">align_items</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">AlignItems</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                },</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.7</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            }).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Normal</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Click me!"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">with_font</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Font</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                });</span></span>
<span class="line"><span style="color: #ABB2BF">            });</span></span>
<span class="line"><span style="color: #ABB2BF">        });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code creates a new window with a title “My UI” and adds a label saying “Hello, world!” and a button labeled “Click me!“. The button has a gray background and is centered on the window.</p>
<p>We can also add a callback function to the button that gets called when the button is clicked:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">create_ui</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_entity</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">    }).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Normal</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // ...</span></span>
<span class="line"><span style="color: #ABB2BF">        });</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonSystem</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">label</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"button_system"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">button_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ButtonState</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Button</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">interaction</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">state</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">ButtonState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Normal</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Clicked</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">interaction</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    *</span><span style="color: #E06C75">state</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ButtonState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Clicked</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Button clicked!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">ButtonState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Clicked</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Released</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">interaction</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    *</span><span style="color: #E06C75">state</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ButtonState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Normal</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we add a system that queries for the button interaction state and sets the button state to “clicked” if it was clicked, and back to “normal” if it was released. We also print a message to the console when the button is clicked.</p>
<p>With these tools, we can create complex user interfaces for our games that respond to user input and provide visual feedback to the player.</p>
<h2 id="implementing-basic-gameplay-mechanics-using-user-input">Implementing basic gameplay mechanics using user input</h2>
<p>Implementing basic gameplay mechanics using user input requires us to first identify the relevant input events and then respond to them appropriately. Let’s take the example of a simple platformer game where the player controls a character that can move left and right, jump, and attack.</p>
<p>To implement this, we need to listen for keyboard events such as <code>KeyPressed</code> and <code>KeyReleased</code>, and respond to them by updating the state of the game. For example, when the player presses the left arrow key, we would update the position of the character to move it left.</p>
<p>We can also use input events to trigger animations and sound effects. For example, when the player attacks, we can play an animation and a sound effect to provide feedback and enhance the player’s sense of immersion.</p>
<p>In addition to keyboard events, we can also capture mouse events such as <code>MouseButtonPressed</code> and <code>MouseMoved</code> to implement interactions such as clicking on buttons or dragging objects.</p>
<p>To create a user interface for our game, we can use Bevy’s built-in UI toolkit, which provides a variety of UI elements such as buttons, text boxes, and sliders. We can also create custom UI elements by combining existing elements or implementing our own using Bevy’s ECS architecture.</p>
<p>Overall, implementing gameplay mechanics using user input requires careful planning and testing to ensure that the game feels responsive and intuitive to the player. By leveraging Bevy’s input system and UI toolkit, we can create engaging and immersive games that provide a satisfying user experience.</p>
<h2 id="creating-game-logic-systems-that-respond-to-user-input">Creating game logic systems that respond to user input</h2>
<p>Creating game logic systems that respond to user input involves using Bevy’s ECS architecture to listen for input events and update the state of the game accordingly.</p>
<p>We can start by creating a system that listens for keyboard events and updates the position of the player entity based on the user’s input. For example, when the user presses the left arrow key, we can update the player’s position to move it left, and similarly for the other arrow keys.</p>
<p>We can also create systems that respond to other types of input events, such as mouse clicks or touch events. For example, we could create a system that listens for mouse clicks on a button entity and updates the state of the game accordingly, such as starting a new level or pausing the game.</p>
<p>To ensure that the game logic responds to input events in a timely and consistent manner, we can use Bevy’s built-in input handling features such as event filters and event reader/writer components. These features allow us to prioritize certain types of input events and ensure that they are handled before other events.</p>
<p>In addition to responding to user input, game logic systems can also generate new input events based on the current state of the game. For example, we could create a system that generates a “jump” input event when the player collides with a platform entity and is able to jump.</p>
<p>Overall, creating game logic systems that respond to user input involves careful design and testing to ensure that the game feels responsive and engaging to the player. By leveraging Bevy’s input handling features and ECS architecture, we can create complex and dynamic games that provide a satisfying user experience.</p>
<h2 id="examples-of-gameplay-mechanics-that-rely-on-user-input">Examples of gameplay mechanics that rely on user input</h2>
<p>There are a multitude of gameplay mechanics that rely on user input in games. Here are a few examples:</p>
<ol>
<li>
<p>Movement: Many games allow the player to move a character or object around the game world using user input. This can be done through direct control (e.g. using arrow keys or a joystick), or through indirect control (e.g. clicking on a location for the character to move to).</p>
</li>
<li>
<p>Combat: In games that feature combat, user input is often used to trigger attacks or other actions. For example, a fighting game might require the player to press specific button combinations to perform special moves.</p>
</li>
<li>
<p>Puzzle solving: Puzzle games often require the player to use user input to solve challenges. For example, a matching game might require the player to click on groups of matching objects to clear them from the board.</p>
</li>
<li>
<p>Dialogue choices: In games that feature branching narratives or dialogue trees, user input is often used to select dialogue options. The player’s choices can then affect the outcome of the story.</p>
</li>
<li>
<p>Crafting and resource management: Games that feature crafting or resource management mechanics often require the player to use user input to gather resources or craft items. For example, in a survival game, the player might need to gather wood by chopping down trees using a mouse or keyboard input.</p>
</li>
</ol>
<p>These are just a few examples of how user input can be used to create engaging gameplay mechanics in games.</p>
<h2 id="balancing-gameplay-mechanics-and-handling-user-feedback">Balancing gameplay mechanics and handling user feedback</h2>
<p>Balancing gameplay mechanics and handling user feedback are both important aspects of game design. Balancing gameplay mechanics involves making sure that all game mechanics are balanced and fair, so that players can have a fun and challenging experience. It requires careful testing and iteration to ensure that no one strategy or action dominates the game.</p>
<p>Handling user feedback is also critical to the success of a game. Players can provide valuable insight into what works and what doesn’t, and what they find fun or frustrating. This feedback can be used to improve the game mechanics, adjust the difficulty level, or refine the user interface.</p>
<p>One effective approach to balancing gameplay mechanics and handling user feedback is to gather data and analyze it to identify patterns and trends. This can involve tracking player behavior, monitoring game metrics, and collecting feedback through surveys or focus groups. Based on this data, designers can make informed decisions about what changes to make to the game mechanics, user interface, or other aspects of the game.</p>
<p>It’s also important to communicate with players and respond to their feedback. This can involve acknowledging their feedback and explaining any changes that are made to the game based on their input. Additionally, incorporating player suggestions into the game can help build a loyal fan base and improve the overall quality of the game.</p>
<p>Ultimately, balancing gameplay mechanics and handling user feedback are ongoing processes that require continuous effort and attention. By taking a data-driven approach and remaining open to feedback, designers can create games that are engaging, challenging, and fun for players of all skill levels.</p>
<h2 id="advanced-input-handling-techniques">Advanced input handling techniques</h2>
<p>Sure, here are some advanced input handling techniques that you can use in your Bevy projects:</p>
<ol>
<li>
<p>Input buffering: This technique involves capturing input events and storing them in a queue or buffer. This allows you to perform actions based on input events that occurred in the past, rather than just the current frame. For example, you can use input buffering to allow for more responsive controls by allowing the player to input commands in advance, even before the current action has finished.</p>
</li>
<li>
<p>Chorded input: Chorded input allows you to capture multiple input events simultaneously, creating a single input action. For example, you could require the player to press multiple keys at once to perform a specific action. Chorded input can be useful for games that require complex input combinations, such as fighting games.</p>
</li>
<li>
<p>Input prediction: Input prediction involves using the current state of the game to predict the player’s future input actions. This can help reduce input lag and improve the overall responsiveness of your game. For example, you could predict the player’s movement direction based on their current velocity and the direction they are facing.</p>
</li>
<li>
<p>Input mapping: Input mapping allows you to map input events to specific game actions. This can be useful for creating custom controls or allowing players to remap their controls to their liking.</p>
</li>
<li>
<p>Gamepad support: Bevy also includes support for gamepad input, allowing you to create games that can be played with a gamepad. You can use the <code>GamepadButton</code> and <code>GamepadAxis</code> events to capture input from gamepads and create custom gamepad controls.</p>
</li>
</ol>
<p>These are just a few examples of advanced input handling techniques that you can use in your Bevy projects. By combining these techniques, you can create complex and responsive input systems that enhance the gameplay experience for your players.</p>
<h2 id="working-with-game-controllers-and-other-input-devices">Working with game controllers and other input devices</h2>
<p>Bevy has built-in support for game controllers and other input devices. To use game controllers with Bevy, you will need to add the <code>bevy_input_gamepad</code> plugin to your project. This plugin provides an API for detecting and working with game controllers.</p>
<p>To detect game controllers, you can use the <code>GamepadEvent</code> resource. This resource tracks the connection and disconnection of game controllers. You can also use the <code>GamepadButtonEvent</code> and <code>GamepadAxisEvent</code> events to detect button presses and axis movements on the game controller.</p>
<p>Here is an example of how to use the <code>GamepadButtonEvent</code> to detect button presses on a game controller:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">gamepad_button_input_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">gamepad_button_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Events</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">GamepadButtonEvent</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">gamepad_button_state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">GamepadButtonState</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">gamepad_button_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.state </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ElementState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Pressed</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">gamepad_button_state</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.button, </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">gamepad_button_state</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.button, </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we are using the <code>GamepadButtonEvent</code> to detect when a button on the game controller is pressed or released. We then update the <code>GamepadButtonState</code> resource with the new state of the button.</p>
<p>You can also use the <code>GamepadAxisEvent</code> to detect the movement of the analog sticks on the game controller:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">gamepad_axis_input_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">gamepad_axis_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Events</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">GamepadAxisEvent</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">gamepad_axis_state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">GamepadAxisState</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">gamepad_axis_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">gamepad_axis_state</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.axis, </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.value);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we are using the <code>GamepadAxisEvent</code> to detect the movement of the analog sticks on the game controller. We then update the <code>GamepadAxisState</code> resource with the new state of the analog stick.</p>
<p>By using the <code>GamepadButtonEvent</code> and <code>GamepadAxisEvent</code> events, you can create complex game mechanics that rely on game controller input. For example, you could create a racing game where the player steers the car using the analog sticks on the game controller.</p>
<p>Bevy also has support for other input devices, such as keyboards and mice. You can use the <code>KeyboardInputEvent</code>, <code>MouseButtonInputEvent</code>, and <code>MouseMotionEvent</code> events to detect input from these devices.</p>
<h2 id="implementing-custom-input-event-handling">Implementing custom input event handling</h2>
<p>To implement custom input event handling in Bevy, we can create a new system that listens for a specific type of input event and performs a corresponding action. This allows us to create custom game mechanics and interactions that may not be possible with Bevy’s built-in input system.</p>
<p>For example, let’s say we want to implement a custom input event that allows the player to perform a double-jump in our platformer game. We can create a new <code>DoubleJumpEvent</code> struct that implements the <code>InputEvent</code> trait, and add a new <code>DoubleJumpSystem</code> that listens for this event and performs the double-jump action.</p>
<p>Here’s an example implementation of the <code>DoubleJumpEvent</code> and <code>DoubleJumpSystem</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">DoubleJumpEvent</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">InputEvent</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">DoubleJumpEvent</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Event</span><span style="color: #ABB2BF">&#x3C;()>) -> </span><span style="color: #E5C07B">Option</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Self</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Event</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">WindowEvent</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">WindowEvent</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">ReceivedCharacter</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">c</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span></span>
<span class="line"><span style="color: #ABB2BF">        } </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span></span>
<span class="line"><span style="color: #ABB2BF">        {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">c</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'j'</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DoubleJumpEvent</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">None</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">double_jump_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">double_jump_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">DoubleJumpEvent</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Velocity</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">double_jump_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, the <code>DoubleJumpEvent</code> struct listens for the <code>j</code> key to be pressed, and the <code>DoubleJumpSystem</code> adds a vertical velocity to the player entity when this event is detected.</p>
<p>We can add the <code>DoubleJumpSystem</code> to our game’s AppBuilder in the same way as the other systems:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">double_jump_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>With this custom input event and system, we can now add a double-jump mechanic to our game that responds to a specific key press.</p>
<h2 id="handling-multiple-input-events-at-once">Handling multiple input events at once</h2>
<p>To handle multiple input events at once, Bevy provides a <code>KeyboardInput</code> resource that we can query to get the current state of all keyboard inputs. Similarly, there are <code>MouseInput</code> and <code>GamepadInput</code> resources that we can query to get the state of the mouse and gamepad inputs respectively.</p>
<p>To handle multiple input events at once, we can create a system that queries these input resources and performs the desired action based on the input state. For example, to handle movement using both the keyboard and gamepad inputs, we can create a system that queries both the <code>KeyboardInput</code> and <code>GamepadInput</code> resources, and moves the player based on the input state.</p>
<p>Here is an example system that handles movement using both the keyboard and gamepad inputs:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">movement_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">gamepad_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">GamepadInput</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">ZERO</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Left</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">gamepad_input</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">get_button</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">GamepadButtonType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">DPadLeft</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">is_some</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">X</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Right</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">gamepad_input</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">get_button</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">GamepadButtonType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">DPadRight</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">is_some</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">X</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Down</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">gamepad_input</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">get_button</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">GamepadButtonType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">DPadDown</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">is_some</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Z</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Up</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">gamepad_input</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">get_button</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">GamepadButtonType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">DPadUp</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">is_some</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Z</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">normalize_or_zero</span><span style="color: #ABB2BF">() * </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this system, we query the <code>KeyboardInput</code> and <code>GamepadInput</code> resources, and check the state of the arrow keys and D-pad buttons to determine the movement direction. We then apply the movement to all entities with the <code>Player</code> component.</p>
<p>Note that the <code>normalize_or_zero</code> method is used to prevent diagonal movement from being faster than horizontal or vertical movement, and the <code>delta_seconds</code> method is used to make the movement framerate-independent.</p>
<h2 id="debugging-and-testing-input-handling-in-a-bevy-project">Debugging and testing input handling in a Bevy project</h2>
<p>Debugging and testing input handling is an important part of developing any Bevy project. Here are some tips and tools you can use to make this process easier:</p>
<ol>
<li>
<p>Use Bevy’s built-in debug tools: Bevy provides several useful debugging tools that can help you identify issues with your input handling. For example, you can use the <code>DebugCursorPlugin</code> to display the current position of the mouse cursor, or the <code>DebugEventsPlugin</code> to print out all the events that are being processed by your application.</p>
</li>
<li>
<p>Use the <code>println!</code> macro: The <code>println!</code> macro is a simple but effective way to print out debugging information in your code. You can use it to print out the values of variables, the state of your game world, or any other information that might be useful in tracking down issues with your input handling.</p>
</li>
<li>
<p>Use breakpoints: Breakpoints allow you to pause the execution of your code at a specific point, so you can inspect the state of your program and debug any issues that you find. Most modern IDEs provide support for setting breakpoints in Rust code.</p>
</li>
<li>
<p>Write unit tests: Unit tests are a powerful tool for testing your input handling code in isolation from the rest of your application. By writing tests that simulate user input events, you can verify that your code is behaving as expected and catch any issues before they make it into your final game.</p>
</li>
<li>
<p>Solicit user feedback: Finally, don’t be afraid to ask your users for feedback on your input handling. This can be as simple as adding a feedback form to your game, or as complex as running user studies to gather data on how players are interacting with your game. By gathering feedback from real users, you can identify issues that you might not have otherwise noticed and make improvements to your input handling over time.</p>
</li>
</ol>
<h2 id="writing-tests-for-input-driven-game-logic">Writing tests for input-driven game logic</h2>
<p>When it comes to writing tests for input-driven game logic, it’s important to keep in mind that the code being tested is inherently dependent on user input. This can make testing somewhat tricky, as it can be difficult to simulate user input in a controlled and repeatable way.</p>
<p>One approach to testing input-driven game logic is to write tests that simulate user input events, and then assert that the game state has been updated correctly in response. For example, you might write a test that simulates a “jump” input event, and then asserts that the player’s velocity has been changed appropriately.</p>
<p>To simulate input events in Bevy, you can use the <code>InputSystem</code> and <code>EventReader</code> types. The <code>InputSystem</code> listens for input events and updates Bevy’s input state accordingly, while the <code>EventReader</code> can be used to read input events from the input state.</p>
<p>Here’s an example test that simulates a “jump” input event and asserts that the player’s velocity has been changed appropriately:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">use bevy::prelude::*;</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">#[test]</span></span>
<span class="line"><span style="color: #abb2bf">fn test_player_jump() {</span></span>
<span class="line"><span style="color: #abb2bf">    let mut world = World::new();</span></span>
<span class="line"><span style="color: #abb2bf">    let mut stage = SystemStage::parallel();</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">    // Add player entity with a Transform and Velocity component</span></span>
<span class="line"><span style="color: #abb2bf">    let mut transform = Transform::default();</span></span>
<span class="line"><span style="color: #abb2bf">    let mut velocity = Velocity::default();</span></span>
<span class="line"><span style="color: #abb2bf">    let player_entity = world.spawn((transform, velocity));</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">    // Simulate a "jump" input event</span></span>
<span class="line"><span style="color: #abb2bf">    let mut input_events = EventReader::&#x3C;InputEvent>::default();</span></span>
<span class="line"><span style="color: #abb2bf">    let mut input_state = InputState::new();</span></span>
<span class="line"><span style="color: #abb2bf">    input_state.update(</span></span>
<span class="line"><span style="color: #abb2bf">        &#x26;InputEvent::Button {</span></span>
<span class="line"><span style="color: #abb2bf">            button: MouseButton::Left,</span></span>
<span class="line"><span style="color: #abb2bf">            state: ElementState::Pressed,</span></span>
<span class="line"><span style="color: #abb2bf">        },</span></span>
<span class="line"><span style="color: #abb2bf">        true,</span></span>
<span class="line"><span style="color: #abb2bf">        &#x26;mut Vec::new(),</span></span>
<span class="line"><span style="color: #abb2bf">    );</span></span>
<span class="line"><span style="color: #abb2bf">    input_events.iter(&#x26;input_state).for_each(|_| {});</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">    // Run the JumpSystem to handle the input event</span></span>
<span class="line"><span style="color: #abb2bf">    let mut jump_system = JumpSystem.system();</span></span>
<span class="line"><span style="color: #abb2bf">    stage.add_system(&#x26;mut jump_system);</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">    // Run the systems to update the game state</span></span>
<span class="line"><span style="color: #abb2bf">    stage.run(&#x26;mut world);</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">    // Assert that the player's velocity has been changed appropriately</span></span>
<span class="line"><span style="color: #abb2bf">    let expected_velocity = Velocity { x: 0.0, y: 10.0 };</span></span>
<span class="line"><span style="color: #abb2bf">    assert_eq!(*world.get::&#x3C;Velocity>(player_entity).unwrap(), expected_velocity);</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>In this example, we create a <code>World</code> and a <code>SystemStage</code>, and add a player entity with <code>Transform</code> and <code>Velocity</code> components. We then simulate a “jump” input event using an <code>EventReader</code> and <code>InputState</code>, and run a <code>JumpSystem</code> to handle the input event. Finally, we assert that the player’s velocity has been changed appropriately.</p>
<p>Of course, this is just a simple example, and in a real game you would likely have many more systems and components to consider. However, the basic approach of simulating input events and asserting the resulting game state should still apply.</p>
<p>Another approach to testing input-driven game logic is to use a mock input system, which allows us to simulate input events and test the resulting game state in a more controlled and deterministic way.</p>
<p>To implement a mock input system, we can create a new Bevy plugin that replaces the default input system with a custom implementation that exposes methods for simulating input events. For example, we could define a <code>MockInputSystem</code> struct that contains a map of input event types to lists of input event data, and use this to simulate input events in our tests.</p>
<p>Here’s an example implementation of a mock input system:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MockInputSystem</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">event_map</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">EventType</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">InputEvent</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Plugin</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MockInputSystem</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AppBuilder</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event_map</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">.event_map.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_system_set</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SystemSet</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">on_update</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AppState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">InGame</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">with_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">simulate_input_events</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">label</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SimulateInputEvents</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">after</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">InputSystem</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ))</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system_set</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">SystemSet</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">on_exit</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AppState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">InGame</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">with_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">clear_input_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">after</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SimulateInputEvents</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        )</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert_resource</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MockInputResource</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">event_map</span><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Clone</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MockInputResource</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">event_map</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">EventType</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">InputEvent</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">simulate_input_events</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Events</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">InputEvent</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">mock_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MockInputResource</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">event_type</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> &#x26;</span><span style="color: #E06C75">mock_input</span><span style="color: #ABB2BF">.event_map {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">input_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">send_event</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">clear_input_events</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Events</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">InputEvent</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">input_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clear</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>With this mock input system, we can write tests that simulate input events and assert the resulting game state. For example, here’s a test that simulates a key press event and checks that the player moves up:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[test]</span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">test_move_up</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">test_app</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mock_input</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MockInputResource</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">mock_input</span></span>
<span class="line"><span style="color: #ABB2BF">        .event_map</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">EventType</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">KeyDown</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Up</span><span style="color: #ABB2BF">), </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">InputEvent</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">KeyDown</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Up</span><span style="color: #ABB2BF">)]);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MockInputSystem</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">event_map</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">mock_input</span><span style="color: #ABB2BF">.event_map });</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PlayerInputSystem</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">insert_resource</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AppState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">InGame</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_query</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">world</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">query</span><span style="color: #ABB2BF">::&#x3C;&#x26;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">single</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">assert_eq!</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.position, </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this test, we create a new <code>MockInputResource</code> and add a key press event for the up arrow key. We then add the <code>MockInputSystem</code> and <code>PlayerInputSystem</code> plugins to the app, insert a <code>Player</code> resource with an initial position of (0,0), and run the game. Finally, we query for the <code>Player</code> component and assert that the player has moved up by one unit.</p>
<p>By using a mock input system, we can write tests that simulate complex input scenarios and verify that the game responds correctly. This can help us catch bugs early and ensure that our game logic is working as expected.</p>
<h2 id="using-bevys-debug-tools-to-diagnose-input-issues">Using Bevy’s debug tools to diagnose input issues</h2>
<p>To diagnose input issues in a Bevy project, we can use Bevy’s built-in debug tools. Bevy provides a debug plugin that can be added to the <code>AppBuilder</code> to enable various debug features, including input event tracing.</p>
<p>To enable input event tracing, we can add the <code>InputDebugPlugin</code> to our <code>AppBuilder</code> as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">InputDebugPlugin</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">InputDebugPlugin</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Once the <code>InputDebugPlugin</code> is added, Bevy will print a log message for each input event that is processed, including the event type, device, and other relevant information. This can be very useful for diagnosing input issues, as we can see exactly what input events are being generated and how they are being handled by our game.</p>
<p>In addition to input event tracing, Bevy’s debug tools also include a visual debugger that can be used to inspect the state of entities, components, and systems in real-time. This can be very useful for debugging input-driven game logic, as we can see the state of the game as input events are processed and game state is updated.</p>
<p>By using Bevy’s debug tools to diagnose input issues, we can ensure that our game is responsive and easy to play, even in complex scenarios where multiple input events are being processed simultaneously.</p>
<h2 id="conclusion-and-next-steps-2">Conclusion and next steps</h2>
<p>In conclusion, capturing user input is essential for any game or interactive application, and Bevy’s input system makes it easy to handle user input events and respond to them in meaningful ways. We covered the basics of capturing input events using Bevy’s input API, as well as implementing input-driven gameplay mechanics and user interfaces.</p>
<p>We also discussed more advanced topics, such as handling multiple input events at once and working with game controllers and other input devices. Finally, we explored debugging and testing techniques for input-driven game logic.</p>
<p>To continue learning about Bevy’s input system, we recommend experimenting with different input devices, creating more complex game mechanics that rely on user input, and exploring Bevy’s built-in debugging and profiling tools to diagnose and resolve input-related issues.</p>
<p>In the next chapter, we will explore Bevy’s networking capabilities and learn how to implement multiplayer games using Bevy.</p>
<h2 id="recap-of-key-concepts-and-tools-covered-in-the-chapter-1">Recap of key concepts and tools covered in the chapter</h2>
<p>In this chapter, we explored how to capture user input using Bevy’s input API. We learned how to handle different types of input events, including keyboard, mouse, and touch events, and how to respond to these events in our game code. We also looked at how to implement input-driven gameplay mechanics, such as player movement and character attacks, and how to create user interface elements and menus using Bevy’s built-in UI system.</p>
<p>Some of the key concepts and tools covered in this chapter include:</p>
<ul>
<li>Bevy’s input API and how to capture different types of user input events</li>
<li>Handling input events and user interactions in our game code</li>
<li>Implementing gameplay mechanics that rely on user input</li>
<li>Creating user interface elements and menus using Bevy’s built-in UI system</li>
<li>Balancing gameplay mechanics and handling user feedback</li>
<li>Advanced input handling techniques, such as working with game controllers and implementing custom input event handling</li>
<li>Debugging and testing input handling in a Bevy project</li>
</ul>
<p>To further explore Bevy’s input system and how it can be used to create engaging and interactive games, we can experiment with different input-driven gameplay mechanics and user interface designs. We can also explore more advanced input handling techniques, such as using custom input devices and implementing complex gesture recognition systems. Finally, we can use Bevy’s built-in debugging and profiling tools to optimize our game’s input handling and ensure that it provides a smooth and responsive user experience.</p>
<h2 id="suggestions-for-further-learning-and-experimentation-with-bevys-input-system-and-user-interaction-features">Suggestions for further learning and experimentation with Bevy’s input system and user interaction features.</h2>
<p>Here are some suggestions for further learning and experimentation with Bevy’s input system and user interaction features:</p>
<ol>
<li>
<p>Check out the official Bevy documentation for more information on Bevy’s input API and event handling system.</p>
</li>
<li>
<p>Experiment with different types of user input and interactions, such as touch events, gamepad input, and multi-touch gestures.</p>
</li>
<li>
<p>Try implementing more advanced input-driven gameplay mechanics, such as character movement with physics-based controls or real-time strategy game controls.</p>
</li>
<li>
<p>Learn how to create custom input devices or interfaces using Bevy’s plugin system.</p>
</li>
<li>
<p>Look into ways of optimizing your input handling code for performance, especially if your game relies heavily on user input.</p>
</li>
<li>
<p>Experiment with different debugging and profiling tools to diagnose input-related issues and performance bottlenecks in your game.</p>
</li>
<li>
<p>Read up on best practices for designing user interfaces and user interactions in games, and apply these principles to your Bevy projects.</p>
</li>
<li>
<p>Consider contributing to the Bevy open-source community by sharing your input-related code or contributing to the development of Bevy’s input system.</p>
</li>
</ol>
<h1 id="chapter-4-graphics-and-animation">Chapter 4: Graphics and Animation</h1>
<h2 id="rendering-2d-and-3d-graphics-with-bevy">Rendering 2D and 3D graphics with Bevy</h2>
<p>Bevy is a powerful game engine that provides a flexible and efficient rendering system for creating stunning 2D and 3D graphics. In this chapter, we will explore the key concepts and tools for working with Bevy’s rendering system, including:</p>
<ul>
<li>Understanding Bevy’s rendering pipeline and architecture</li>
<li>Creating and manipulating entities with graphical components</li>
<li>Loading and working with 2D and 3D assets</li>
<li>Creating materials and shaders to customize the appearance of entities</li>
<li>Implementing lighting and shadows in 3D scenes</li>
<li>Creating and animating particle systems</li>
<li>Creating user interface elements and overlays</li>
<li>Debugging and profiling rendering performance</li>
</ul>
<p>By the end of this chapter, you will have a strong foundation for creating compelling and visually stunning graphics in your Bevy games.</p>
<p>Let’s get started!</p>
<h2 id="overview-of-bevys-graphics-rendering-system">Overview of Bevy’s graphics rendering system</h2>
<p>Bevy’s graphics rendering system is based on the Entity Component System (ECS) architecture, where graphics are represented by entities and their associated components. The <code>RenderGraph</code> is the core of Bevy’s rendering system, which is responsible for building a dependency graph of all the rendering passes that need to be executed to produce the final image. Each pass in the render graph defines a set of inputs and outputs, and the graph ensures that all inputs are resolved before executing any given pass.</p>
<p>In addition to the <code>RenderGraph</code>, Bevy provides a variety of built-in components for graphics rendering, including <code>Transform</code>, <code>Sprite</code>, <code>Texture</code>, <code>Mesh</code>, <code>Material</code>, <code>Camera</code>, and more. These components allow you to define the position, shape, appearance, and behavior of your game’s graphics entities. Bevy also provides a number of built-in systems for rendering different types of graphics, such as sprites, meshes, and particles.</p>
<p>Bevy’s graphics rendering system is highly modular and extensible, allowing you to customize and extend it to fit your game’s specific needs. For example, you can create custom rendering passes, shaders, materials, and more to implement advanced rendering techniques like deferred rendering, shadow mapping, and post-processing effects.</p>
<h2 id="creating-a-camera-and-rendering-pipeline">Creating a camera and rendering pipeline</h2>
<p>To create a camera and rendering pipeline in Bevy, we can follow these steps:</p>
<ol>
<li>
<p>First, we need to create a new Bevy project or use an existing one. To create a new project, we can use the <code>car command </code>cargo new my_game<code>and add Bevy as a dependency in the</code>Cargo.toml` file.</p>
</li>
<li>
<p>Next, we need to create a camera entity. This can be done by adding a new entity with a <code>Camera3dComponents</code> component to the world. We can also customize the camera’s position, rotation, and other settings by modifying the <code>Transform</code> component.</p>
</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_camera</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PerspectiveCameraBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5.0</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">looking_at</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">ZERO</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Y</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="3">
<li>After creating the camera, we need to create a rendering pipeline. This can be done by adding a new resource of type <code>RenderPipeline</code> to the world. We can use Bevy’s built-in <code>DefaultPipeline</code> for 3D rendering or create a custom pipeline for more advanced features.</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_render_pipeline</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">meshes</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Mesh</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pipelines</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">PipelineDescriptor</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pipeline_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pipelines</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PipelineDescriptor</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default_config</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ShaderStages</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">vertex</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"shader.vert"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">fragment</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"shader.frag"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    }));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MeshBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">meshes</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Mesh</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">shape</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Cube</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF"> })),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.6</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PipelineDescriptor</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default_config</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ShaderStages</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">vertex</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"shader.vert"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">fragment</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"shader.frag"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    }));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="4">
<li>Finally, we need to add the camera and rendering pipeline to the world’s stage. This can be done by adding a new system that sets the camera and pipeline as active. We can also add other rendering options, such as anti-aliasing or post-processing effects, by modifying the <code>RenderSettings</code> component.</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_stage</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">stages</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Stages</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">stages</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_default_stage</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"default_3d"</span><span style="color: #ABB2BF">, </span><span style="color: #56B6C2">|</span><span style="color: #E06C75">stage</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Stage</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">stage</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_system_to_stage</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">CoreStage</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">PostUpdate</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">render</span><span style="color: #ABB2BF">::</span><span style="color: #E06C75">draw_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">stage</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_system_to_stage</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">CoreStage</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">PostUpdate</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">render</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">camera</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">camera_system</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">render</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">camera</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">PerspectiveProjection</span><span style="color: #ABB2BF">>.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        );</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">stage</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_system_to_stage</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">CoreStage</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">PostUpdate</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">render</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">pass</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">shader</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">set_camera_uniforms_system</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">render</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">camera</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">PerspectiveProjection</span><span style="color: #ABB2BF">>.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        );</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>With these steps, we should now have a basic camera and rendering pipeline set up in our Bevy project. We can add more entities, meshes, and materials to the world and modify the camera and pipeline settings to create more complex scenes and visual effects.</p>
<p>Once we have set up our basic camera and pipeline, we can start creating and rendering entities in our game world. Bevy provides various built-in components for rendering 2D and 3D graphics, such as <code>SpriteComponents</code>, <code>MeshComponents</code>, <code>MaterialComponents</code>, and <code>TransformComponents</code>. We can use these components to define the appearance, shape, and position of our game entities.</p>
<p>For example, to render a sprite in 2D space, we can create an entity with a <code>SpriteComponent</code>, which defines the sprite’s image and size, and a <code>TransformComponent</code>, which defines the sprite’s position and orientation in the world. Bevy automatically handles the rendering of the sprite based on these components.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_sprite</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">64.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">64.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">.x, </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">.y, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Similarly, to render a 3D object, we can create an entity with a <code>MeshComponent</code>, which defines the object’s shape and geometry, a <code>MaterialComponent</code>, which defines the object’s surface appearance and lighting properties, and a <code>TransformComponent</code>, which defines the object’s position, rotation, and scale in the world.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_cube</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Mesh</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PbrBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>We can also customize the rendering pipeline to add more complex visual effects, such as post-processing, shadows, reflections, and particle effects. Bevy provides a flexible and extensible pipeline system that allows us to add and modify rendering passes, shaders, and effects.</p>
<p>For example, we can add a post-processing effect that applies a bloom filter to the scene by creating a new system that updates the <code>PostProcessing</code> resource with the current settings, and modifying the <code>RenderPlugin</code> to include a <code>post_processing_system</code> that applies the filter to the final output.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">BloomFilter</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">intensity</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">threshold</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">blur_radius</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">bloom_filter_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">post_processing</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">PostProcessing</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">bloom_filter</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">BloomFilter</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">post_processing</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">apply_bloom_filter</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">bloom_filter</span><span style="color: #ABB2BF">.intensity,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">bloom_filter</span><span style="color: #ABB2BF">.threshold,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">bloom_filter</span><span style="color: #ABB2BF">.blur_radius,</span></span>
<span class="line"><span style="color: #ABB2BF">    );</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">RenderPlugin</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Plugin</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">RenderPlugin</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AppBuilder</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">bloom_filter_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultRendererPlugin</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PostProcessingPlugin</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>With these tools and techniques, we can create a wide range of 2D and 3D graphics and visual effects, from simple sprites and shapes to complex scenes and animations. Bevy’s flexible and modular architecture makes it easy to experiment with different rendering approaches and customize the visual style and look of our games.</p>
<h2 id="working-with-materials-shaders-and-textures">Working with materials, shaders, and textures</h2>
<p>In Bevy, materials define how an entity is rendered by specifying the shader program and associated properties. Materials can be used to apply different textures and visual effects to an entity, making it possible to create a wide range of graphical styles and effects.</p>
<p>To create a material, we can define a new struct that implements the <code>FromResources</code> trait and includes the necessary resources, such as the shader and any associated textures or uniforms. For example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Debug</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyMaterial</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">albedo</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">normal_map</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Option</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">specular_map</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Option</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">shininess</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FromResources</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyMaterial</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">from_resources</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">resources</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Resources</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Self</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">resources</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_mut</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">shader</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">resources</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Shader</span><span style="color: #ABB2BF">>>().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyMaterial</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF">.albedo </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF">.normal_map </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">resources</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">>>(</span><span style="color: #98C379">"normal_map"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF">.specular_map </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">resources</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">>>(</span><span style="color: #98C379">"specular_map"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF">.shininess </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pipeline</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">RenderPipeline</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">specialized</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">shader</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Specialization</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">constants</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">bpc</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ShaderConstants</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">use_normal_map</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF">.normal_map.</span><span style="color: #61AFEF">is_some</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">u32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">use_specular_map</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF">.specular_map.</span><span style="color: #61AFEF">is_some</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">u32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">shininess</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF">.shininess,</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">std140</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">        );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pipelines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">resources</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_mut</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">PipelineDescriptor</span><span style="color: #ABB2BF">>>().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">pipelines</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_untracked</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PipelineDescriptor</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default_config</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ShaderStages</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">vertex</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">shader</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">fragment</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">shader</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        }));</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">pipelines</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_untracked</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">pipeline</span><span style="color: #ABB2BF">.descriptor.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">pipeline</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">my_material</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a <code>MyMaterial</code> struct that includes a handle to a <code>ColorMaterial</code> resource for the entity’s albedo, as well as optional handles to normal and specular maps and a shininess value. We then implement the <code>FromResources</code> trait to create the material using the specified resources and a specialized render pipeline that applies the material properties to the entity.</p>
<p>Once we have defined a material, we can apply it to an entity using the <code>Draw</code> component and the <code>set_material()</code> method. For example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_my_entity</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">MyAssetHandles</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MyMaterial</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MyMaterial</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">albedo</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">.my_texture.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">normal_map</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">.my_normal_map.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">specular_map</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">.my_specular_map.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">shininess</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">64.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Draw</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">with_section</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #98C379">"My Entity"</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">.my_font.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    },</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                ),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            });</span></span>
<span class="line"><span style="color: #ABB2BF">        });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we create a new <code>MyMaterial</code> using the appropriate asset
handle to the shader and texture assets we defined earlier. We also define the properties of the material, which can be used to customize the appearance of the object that it is applied to.</p>
<p>We then create a new entity, add a <code>Mesh</code> component with the previously defined cube mesh, a <code>Transform</code> component to position and scale the cube, and a <code>MyMaterial</code> component to apply the custom material to the cube. Finally, we add the entity to the world using the <code>spawn</code> method.</p>
<p>This is just a simple example of how to work with materials in Bevy. You can create more complex materials with multiple textures and customizable properties, and apply them to meshes with different shapes and sizes to create a wide range of visual effects.</p>
<p>When working with materials, it’s important to consider the performance impact of using different shaders and textures. More complex materials and shaders can be more computationally expensive, so you may need to optimize your materials and rendering pipeline to ensure that your game runs smoothly on different devices and platforms.</p>
<p>Bevy provides a variety of tools and APIs for working with materials, shaders, and textures, including built-in support for common file formats like PNG and JPEG, as well as custom shaders and materials. By experimenting with different materials and textures, you can create a unique visual style for your game that enhances the overall experience for players.</p>
<h2 id="creating-and-managing-textures-and-sprites">Creating and managing textures and sprites</h2>
<p>In Bevy, textures are represented by the <code>Texture</code> component, and sprites are represented by the <code>SpriteBundle</code> struct. To create a sprite, we need to first load the texture and then create an entity that has a <code>SpriteBundle</code> component.</p>
<p>To load a texture, we can use the <code>AssetServer</code> resource and its <code>load</code> method, which returns a <code>Handle&#x3C;Texture></code> that can be used to create sprite entities:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_sprite</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">TextureAtlas</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"texture.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_index</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // index of the sprite within the texture atlas</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sprite_index</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteSheetBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we first load the texture <code>"texture.png"</code> using the <code>AssetServer</code>. Then, we create a <code>Sprite</code> object with the index of the sprite within the texture atlas. Finally, we create an entity that has a <code>SpriteSheetBundle</code> component, which specifies the texture atlas to use and the sprite to render.</p>
<p>To create a texture atlas, we can use the <code>TextureAtlasBuilder</code> struct:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">build_texture_atlas</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>) -> </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">TextureAtlas</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"texture.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextureAtlasBuilder</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_texture</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_sprite</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpritesheetSprite</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // position and dimensions of the sprite within the texture</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">index</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // position and dimensions of the sprite within the texture atlas</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">left</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">right</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">bottom</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">top</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">finish</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"texture.atlas"</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we first load the texture <code>"texture.png"</code> using the <code>AssetServer</code>. Then, we create a <code>TextureAtlasBuilder</code> and add the texture to it. We also add a sprite to the texture atlas using the <code>add_sprite</code> method, which specifies the position and dimensions of the sprite within the texture and the position and dimensions of the sprite within the texture atlas. Finally, we call the <code>finish</code> method to build the texture atlas.</p>
<p>To use a material with a texture, we can create a new <code>StandardMaterial</code> object and set its <code>albedo_texture</code> field to the handle of the texture:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">create_material</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>) -> </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"texture.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">albedo_texture</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">watch_for_changes</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load_from_data</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we load the texture <code>"texture.png"</code> using the <code>AssetServer</code>. Then, we create a new <code>StandardMaterial</code> object and set its <code>albedo_texture</code> field to the handle of the texture. Finally, we create a new asset for the material using the <code>load_from_data</code> method of the <code>AssetServer</code>.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_materials</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MyMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_material.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyMaterial</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_material_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">my_material</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">my_material_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we load a texture asset for our material using the <code>AssetServer</code>. We then create a new <code>MyMaterial</code> instance with the texture handle and add it to the <code>Assets</code> collection using the <code>add</code> method. Finally, we spawn a new sprite bundle with the material handle and default settings for the other components.</p>
<p>To create more advanced 2D graphics, we can use a combination of sprites, materials, and shaders to achieve various effects such as transparency, animation, and dynamic lighting. Bevy provides a number of built-in shaders and utilities for creating and managing 2D graphics, as well as a flexible API for creating custom shaders and materials.</p>
<p>For 3D graphics, Bevy supports a wide range of rendering techniques such as forward and deferred shading, physically-based rendering (PBR), and post-processing effects. These techniques can be combined and customized to create a wide range of visual styles and effects.</p>
<p>In addition to traditional graphics rendering, Bevy also supports other types of visual output such as text and UI elements. Bevy’s UI system, based on the popular Rust GUI library <code>egui</code>, allows developers to create flexible and customizable user interfaces that integrate seamlessly with the rest of the game engine.</p>
<p>Overall, Bevy’s graphics rendering system provides a powerful and flexible set of tools for creating visually compelling games and interactive experiences.</p>
<h2 id="loading-and-managing-textures-in-a-bevy-project">Loading and managing textures in a Bevy project</h2>
<p>To load a texture in a Bevy project, you first need to add the texture asset to the project’s asset folder. Once you have the texture asset file in the folder, you can use the <code>AssetServer</code> to load it into your game.</p>
<p>Here’s an example of how to load a texture in Bevy:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_texture</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>) -> </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"textures/my_texture.png"</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use the <code>AssetServer</code> resource to load a texture asset located in the <code>textures</code> subdirectory of the asset folder. The <code>load</code> method returns a <code>Handle</code> to the loaded texture, which can then be used to create sprites and other graphics.</p>
<p>To use the loaded texture in a material, you can create a new <code>Texture</code> asset using the <code>load_from_file</code> method of the <code>AssetServer</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_texture</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">textures</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">>>) -> </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"textures/my_texture.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">textures</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">textures</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we first load the texture as before, then create a new <code>Texture</code> asset using the <code>get</code> method of the <code>Assets</code> resource to retrieve the loaded texture from the <code>AssetServer</code>. We then add the new <code>Texture</code> asset to the <code>Assets</code> resource using the <code>add</code> method.</p>
<p>Once you have loaded a texture, you can use it to create sprites and other graphics in your game.</p>
<h2 id="creating-sprites-and-rendering-them-on-screen">Creating sprites and rendering them on-screen</h2>
<p>To create a sprite in Bevy, we first need to define a new entity with a sprite component attached to it. The sprite component contains information about the texture, position, and size of the sprite. We can create a new entity with a sprite component using the <code>spawn</code> method on a <code>Commands</code> resource:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_sprite</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">TextureAtlas</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_index</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // the index of the sprite in the texture atlas</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteSheetBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sprite_index</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use a <code>SpriteSheetBundle</code> to attach a sprite component to our new entity. The <code>SpriteSheetBundle</code> includes a reference to the texture atlas that contains the sprite’s texture, as well as the index of the sprite within the texture atlas. We also specify the initial position of the sprite using a <code>Transform</code> component.</p>
<p>Once we have created a sprite entity, Bevy’s rendering system will automatically render it on the screen.</p>
<p>We can also modify the sprite’s appearance and behavior by manipulating its components. For example, we can change the position of the sprite by updating its <code>Transform</code> component:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">move_sprite</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.x </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF"> * </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use a system to update the position of all sprites with a <code>Sprite</code> component. The <code>Time</code> resource provides information about the elapsed time since the last frame, which we use to move the sprite to the right at a constant speed.</p>
<p>Bevy also provides a number of built-in components and systems for working with sprites, including sprite animation, physics, and collision detection. These components and systems can be combined with other Bevy features, such as ECS and input handling, to create complex and dynamic games.</p>
<h2 id="managing-sprite-sheets-and-sprite-animations">Managing sprite sheets and sprite animations</h2>
<p>Sprite sheets are a common technique used in 2D games to efficiently store and render multiple sprites within a single texture. Bevy provides support for sprite sheets through its <code>TextureAtlas</code> resource, which can be used to define and manage sprite sheet data.</p>
<p>To create a <code>TextureAtlas</code>, we first need to create a new asset for the texture using the <code>AssetServer</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_texture.png"</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>We can then define the <code>TextureAtlas</code> using a <code>TextureAtlasBuilder</code>. For example, to define a sprite sheet with two rows and three columns of 64x64 sprites:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextureAtlasBuilder</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">add_texture</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">add_sprite_sheet</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">        (</span><span style="color: #D19A66">64.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">64.0</span><span style="color: #ABB2BF">),</span><span style="color: #7F848E; font-style: italic"> // size of each sprite</span></span>
<span class="line"><span style="color: #ABB2BF">        (</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">),</span><span style="color: #7F848E; font-style: italic"> // number of rows and columns</span></span>
<span class="line"><span style="color: #ABB2BF">        &#x26;[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">],</span><span style="color: #7F848E; font-style: italic"> // indices of each sprite within the texture</span></span>
<span class="line"><span style="color: #ABB2BF">    )</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">finish</span><span style="color: #ABB2BF">();</span></span></code></pre>
<p>Here, we add the texture handle we just created, specify the size of each sprite (64x64), the number of rows and columns in the sprite sheet (3x2), and the indices of each sprite within the texture.</p>
<p>We can then use the <code>TextureAtlas</code> resource to render sprites from the sprite sheet. To do so, we need to create a new <code>SpriteSheetComponents</code> entity with a <code>Handle&#x3C;TextureAtlas></code> to the sprite sheet asset and a <code>SpriteSheet</code> component:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteSheetBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">texture_atlas_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">index</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span><span style="color: #7F848E; font-style: italic"> // index of the sprite within the sprite sheet</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre>
<p>Here, we specify the handle to the <code>TextureAtlas</code>, the index of the sprite we want to render within the sprite sheet, and any other sprite properties we want to set.</p>
<p>We can also use the <code>SpriteSheet</code> component to animate the sprites within the sprite sheet. For example, to create an animation that cycles through all the sprites in the sprite sheet every second:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">insert_resource</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteSheetAnimation</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">sprite_sheet</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">texture_atlas_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">AnimationState</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">ANIMATION_DURATION</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">AnimationDirection</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">PingPong</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre>
<p>Here, we insert a new <code>SpriteSheetAnimation</code> resource with the handle to the <code>TextureAtlas</code>, a new <code>AnimationState</code> that cycles through all the sprites in the sprite sheet, and the duration and direction of the animation.</p>
<p>We can then update the animation state each frame to animate the sprites:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">animate_sprites</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_sheet_animations</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SpriteSheetAnimation</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_sheet_animation</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_sheet_animations</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite_sheet_animation</span><span style="color: #ABB2BF">.animation.</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we iterate over all the <code>SpriteSheetAnimation</code> components and update their animation state using the <code>update</code> method of the <code>AnimationState</code>.</p>
<p>Overall, Bevy provides powerful and flexible support for sprite sheets and sprite animations, making it easy to create dynamic and engaging 2D games.</p>
<p>Bevy provides built-in support for sprite sheets and sprite animations, making it easy to create dynamic and engaging 2D games.</p>
<p>To use a sprite sheet in Bevy, we first need to create a texture from the sprite sheet image file. We can do this using the <code>AssetServer</code> and the <code>load</code> method, similar to how we loaded textures earlier:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_sheet_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_sprite_sheet.png"</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>Once we have a handle to the sprite sheet texture, we can create a <code>SpriteSheet</code> asset from it:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_sheet</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SpriteSheet</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">sprite_sheet_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">sprites</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span></code></pre>
<p>The <code>sprites</code> field of the <code>SpriteSheet</code> asset contains a list of <code>Sprite</code> objects, each of which represents a single sprite in the sprite sheet. We can add sprites to the <code>sprites</code> list using the <code>add_sprite</code> method:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // The UV values specify the region of the texture to use for this sprite</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // In this example, we're using the first sprite in the sprite sheet</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // which starts at pixel (0, 0) and has a size of (32, 32)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">uv</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">min</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">max</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF"> / </span><span style="color: #E06C75">sprite_sheet_texture</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">width</span><span style="color: #ABB2BF">(), </span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF"> / </span><span style="color: #E06C75">sprite_sheet_texture</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">height</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #E06C75">sprite_sheet</span><span style="color: #ABB2BF">.sprites.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>To display a sprite on-screen, we can create a new <code>SpriteBundle</code> using the <code>SpriteSheet</code> asset and the index of the sprite we want to display:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_index</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // The index of the sprite we want to display in the sprite sheet</span></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_bundle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">SpriteRender</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite_sheet</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">sprite_sheet_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite_number</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">sprite_index</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span></code></pre>
<p>We can add this <code>SpriteBundle</code> to our ECS world and it will be rendered on-screen.</p>
<p>To animate sprites using a sprite sheet, we can update the <code>sprite_number</code> field of the <code>SpriteRender</code> component at regular intervals. For example, we can create a system that increments the <code>sprite_number</code> field every few frames to create a simple animation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">animate_sprites</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SpriteRender</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_render</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite_render</span><span style="color: #ABB2BF">.sprite_number </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">sprite_render</span><span style="color: #ABB2BF">.sprite_number + </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) % </span><span style="color: #E06C75">num_sprites_in_sheet</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, <code>num_sprites_in_sheet</code> is the total number of sprites in the sprite sheet.</p>
<p>Overall, Bevy’s support for sprite sheets and sprite animations makes it easy to create dynamic and visually interesting 2D games.</p>
<h2 id="implementing-animations-and-visual-effects-with-bevy">Implementing animations and visual effects with Bevy</h2>
<p>Bevy provides several tools for creating animations and visual effects in your game. One approach is to use sprite sheet animations, as described in the previous section, to create 2D animations. For more complex 3D animations, Bevy supports a wide range of animation techniques, including skeletal animation, morph target animation, and procedural animation.</p>
<p>To create skeletal animations, you can use the <code>Animation</code> and <code>Transform</code> components in conjunction with the <code>TransformSystem</code>. The <code>Animation</code> component holds a reference to an animation asset, while the <code>Transform</code> component stores the current position, rotation, and scale of the animated entity. The <code>TransformSystem</code> then applies the animation data to the transform data, resulting in a smooth skeletal animation.</p>
<p>For morph target animations, Bevy provides the <code>Mesh</code> and <code>MeshHandle</code> components, which allow you to define a mesh with multiple vertex positions and deform the mesh over time using a set of morph targets. You can also use shaders to create procedural animations, such as vertex displacement or particle effects.</p>
<p>Bevy also includes a variety of visual effects tools, such as post-processing effects, particle systems, and lighting. Post-processing effects allow you to apply filters and effects to the entire scene, while particle systems let you create dynamic particle effects for explosions, smoke, and other visual effects. Finally, Bevy’s lighting system supports both static and dynamic lighting, with support for shadows, reflection, and refraction.</p>
<p>To implement animations and visual effects in your game, you’ll typically create a set of systems to manage the various components and assets involved. For example, you might have a <code>AnimationSystem</code> that updates the <code>Transform</code> component based on the current animation, or a <code>ParticleSystem</code> that updates the position and attributes of particles in the scene. You’ll also need to configure your rendering pipeline to support the various shaders and effects you want to use.</p>
<p>Overall, Bevy provides a powerful set of tools for creating dynamic and engaging animations and visual effects in your game. By leveraging the built-in components and systems, as well as the extensive library of community-created assets and plugins, you can create stunning visuals that bring your game world to life.</p>
<h2 id="understanding-bevys-animation-system-1">Understanding Bevy’s animation system</h2>
<p>Bevy’s animation system is built on top of its ECS architecture and is designed to work seamlessly with other Bevy systems, such as rendering and physics. The animation system is based on the concept of animating entities, which are simply collections of components in the ECS.</p>
<p>At a high level, the Bevy animation system consists of the following components:</p>
<ul>
<li>
<p><code>Animation</code>: This component defines an animation that can be applied to an entity. It contains a reference to the animation’s sprite sheet, as well as information about the animation’s timing and playback options.</p>
</li>
<li>
<p><code>AnimationControl</code>: This component allows you to control the playback of an animation. It contains information about the current state of the animation, such as its current frame and playback speed.</p>
</li>
<li>
<p><code>SpriteSheet</code>: This component defines a sprite sheet, which is a collection of individual sprite images that can be used in animations.</p>
</li>
<li>
<p><code>TextureAtlas</code>: This component defines a texture atlas, which is a collection of smaller textures that are combined into a larger texture. Texture atlases are useful for reducing the number of texture lookups required during rendering.</p>
</li>
<li>
<p><code>Transform</code>: This component defines the position, rotation, and scale of an entity.</p>
</li>
</ul>
<p>Using these components, you can create complex and dynamic animations that respond to user input, physics, and other game events.</p>
<p>In addition to these components, Bevy also provides a number of built-in animation systems, such as the <code>SpriteSheetAnimationSystem</code>, which automatically updates the playback of animations based on their <code>AnimationControl</code> component. You can also create custom animation systems that work with your specific game logic and animation needs.</p>
<p>Overall, Bevy’s animation system is a powerful tool for creating engaging and dynamic visuals in your games.</p>
<h2 id="creating-and-controlling-animations-for-sprites-and-entities">Creating and controlling animations for sprites and entities</h2>
<p>To create and control animations for sprites and entities in Bevy, we can use the <code>Animation</code> component and the <code>AnimationSystem</code>. The <code>Animation</code> component stores information about the current state of the animation, such as the current frame and elapsed time, as well as the animation’s playback settings, such as the duration and whether it should loop.</p>
<p>To create an animation, we first need to define the frames of the animation, which can be stored as a sprite sheet or a series of individual images. We can then create an <code>Animation</code> resource that references the frames and defines the playback settings.</p>
<p>Here’s an example of how to create a simple animation using a sprite sheet:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_animations</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_atlases</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">TextureAtlas</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load the sprite sheet</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_spritesheet.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextureAtlas</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_grid</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF">), </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add the texture atlas to the asset manager</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_atlas_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_atlases</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a new material for the sprite</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">texture</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Define the animation frames</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation_frames</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a new animation</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Animation</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">"my_animation"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture_atlas_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">animation_frames</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_vec</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">AnimationType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">PingPong</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">AnimationDirection</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Forward</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #D19A66">0.1</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add the animation component to an entity</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteSheetBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">texture_atlas_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">animation_frames</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">]),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we first load a sprite sheet and create a texture atlas from it. We then create a new material for the sprite and define the frames of the animation. We create a new <code>Animation</code> with the appropriate settings and add it to an entity along with the sprite sheet and material components.</p>
<p>Once the animation is added to an entity, the <code>AnimationSystem</code> will automatically update the sprite’s texture coordinates to display the correct frame of the animation based on the elapsed time and playback settings.</p>
<p>We can also control the playback of the animation programmatically by accessing the <code>Animation</code> component and setting its properties. For example, we could start or stop the animation, change its playback speed, or jump to a specific frame.</p>
<p>Additionally, Bevy provides a number of built-in animation easing functions that can be used to create more complex and dynamic animations. These easing functions can be used to control the acceleration and deceleration of the animation over time, resulting in smoother and more natural-looking motion.</p>
<p>Additionally, we can also control the playback of animations using Bevy’s <code>AnimationControlSystem</code>. This system updates the <code>AnimationControl</code> components of entities with animations, allowing us to modify the playback speed, direction, and other properties of the animation.</p>
<p>For example, suppose we have an entity with an <code>Animation</code> component and an <code>AnimationControl</code> component, and we want to play the animation at half-speed in reverse. We can do this using the following code:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">update_animation_control</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AnimationControl</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Animation</span><span style="color: #ABB2BF">)></span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">control</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">control</span><span style="color: #ABB2BF">.animation </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">();</span><span style="color: #7F848E; font-style: italic"> // update the current animation</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">control</span><span style="color: #ABB2BF">.playback_rate </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // set the playback rate to half-speed</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">control</span><span style="color: #ABB2BF">.time_scale </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> -</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // set the time scale to reverse the animation</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This system updates the <code>AnimationControl</code> component for each entity with both an <code>Animation</code> and an <code>AnimationControl</code> component, setting the <code>animation</code>, <code>playback_rate</code>, and <code>time_scale</code> fields to control the playback of the animation.</p>
<p>In addition to controlling the playback of animations, Bevy also provides a number of built-in animation types, such as <code>Translation</code>, <code>Rotation</code>, and <code>Scale</code>, which can be used to animate the position, rotation, and scale of entities over time.</p>
<p>For example, suppose we have a sprite entity that we want to move from its current position to a new position over the course of 2 seconds. We can do this using the <code>Translation</code> animation type as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">move_sprite</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">start_pos</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">end_pos</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic"> // the new position to move to</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">t</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">seconds_since_startup</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // current time as a fraction of 2 seconds</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">t</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">min</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic"> // clamp the progress to 1.0 after 2 seconds</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">interp_pos</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">start_pos</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lerp</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">end_pos</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">);</span><span style="color: #7F848E; font-style: italic"> // interpolate between the start and end positions</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">interp_pos</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // update the sprite's position</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This system updates the <code>Transform</code> component for each entity with both a <code>Sprite</code> component and a <code>Transform</code> component, moving the sprite smoothly from its current position to the new position over the course of 2 seconds.</p>
<p>These are just a few examples of the ways in which Bevy’s animation system can be used to create dynamic and engaging visual effects in our games. By combining animations with other graphics and gameplay systems, we can create rich and immersive gaming experiences that keep players coming back for more.</p>
<h2 id="implementing-visual-effects-like-particles-and-lighting">Implementing visual effects like particles and lighting</h2>
<p>Bevy offers several tools for implementing visual effects like particles and lighting in your game. Let’s take a look at some of them.</p>
<h3 id="particles">Particles</h3>
<p>Bevy provides a powerful particle system for creating dynamic and realistic particle effects. The particle system is based on the concept of “emitters” that emit particles according to a set of configurable parameters, such as emission rate, initial velocity, and lifetime.</p>
<p>To use the particle system, you need to create an emitter and attach it to an entity in your scene. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">render</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">pass</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ClearColor</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">particle_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">OrthographicCameraBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new_2d</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">particle_system</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // create a new particle emitter</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">particle_system</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ParticleSystem</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">emitter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">particle_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_emitter</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">emitter</span><span style="color: #ABB2BF">.emit_count </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">EmitCount</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Once</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">emitter</span><span style="color: #ABB2BF">.emit_rate </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">emitter</span><span style="color: #ABB2BF">.max_particles </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1000</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">emitter</span><span style="color: #ABB2BF">.lifetime </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Range</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // create a new sprite material for the particles</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">RED</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // create a new entity for the emitter</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ParticleBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">particle_system</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">sprite_material</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we create a new <code>ParticleSystem</code> and add an emitter to it. We set some parameters for the emitter, such as the emission rate, maximum number of particles, and lifetime.</p>
<p>We then create a new material for the particles and use it to create a new entity with a <code>ParticleBundle</code>. This bundle contains the particle system, a sprite, and the material.</p>
<h3 id="lighting">Lighting</h3>
<p>Bevy also provides a basic lighting system that can be used to create simple 2D lighting effects. The lighting system works by rendering a black-and-white texture that represents the “light” in the scene. Entities can then be rendered using a “light” material that is blended with the texture to create a lighting effect.</p>
<p>Here’s an example of how to use the lighting system:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">render</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">pass</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ClearColor</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">textures</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // load the light texture</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">light_texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">textures</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new_fill</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // create a new sprite material with the light texture</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">light_texture_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // create a new entity with the light material</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">sprite_material</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we load a white texture that will represent the “light” in the scene. We then create a new material with the texture and use it to create a new entity with a <code>SpriteBundle</code>.</p>
<p>Note that this example does not actually create any lighting effects, as we have not yet defined any lights in the scene. To create
lights in our scene, we can add a <code>LightBundle</code> component to an entity, which will automatically create a light source and add it to the rendering pipeline. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">render</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">light</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">Light</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">LightBundle</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">PointLight</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_light</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PointLightBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">point_light</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">PointLight</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">intensity</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">range</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">15.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Name</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Point Light"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code creates a new <code>PointLight</code> and attaches it to an entity using the <code>PointLightBundle</code>. We can then add this entity to our scene and it will cast light onto any nearby surfaces. By tweaking the properties of the light, such as its intensity, color, and range, we can create a wide variety of lighting effects.</p>
<p>Another common visual effect in games is particles, which can be used to simulate things like fire, smoke, or explosions. Bevy includes a built-in particle system that can be customized to create a wide variety of particle effects. Here’s an example of how to create a simple particle effect:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">render</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">mesh</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">shape</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Plane</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_particles</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">particle_texture</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"textures/particle.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">particle_texture</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">emitter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ParticleBuilder</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_acceleration</span><span style="color: #ABB2BF">(-</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">unit_y</span><span style="color: #ABB2BF">() * </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_lifetime</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_max_particles</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">100</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_spawn_rate</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_velocity_range</span><span style="color: #ABB2BF">(-</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">unit_y</span><span style="color: #ABB2BF">() * </span><span style="color: #D19A66">5.0</span><span style="color: #ABB2BF">..</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">unit_y</span><span style="color: #ABB2BF">() * </span><span style="color: #D19A66">5.0</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_sprite</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteSheetBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"textures/particles.atlas"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">emitter</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">20.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        });</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we create a new <code>ParticleBuilder</code> and configure it with various properties like acceleration, velocity, and lifespan. We also create a new <code>SpriteSheetBundle</code> to define the appearance of the particles, and attach it to the particle emitter. Finally, we spawn the emitter in our scene and add a child sprite to it using the <code>with_children</code> method.</p>
<p>By combining these various techniques, we can create complex and visually stunning effects that bring our games to life.</p>
<h2 id="working-with-3d-models-and-meshes-in-a-bevy-project">Working with 3D models and meshes in a Bevy project</h2>
<p>Working with 3D models and meshes is a key component of many games, and Bevy provides robust support for 3D graphics rendering. In this section, we’ll cover how to load and manipulate 3D models and meshes in a Bevy project.</p>
<h3 id="loading-3d-models">Loading 3D Models</h3>
<p>To load a 3D model into a Bevy project, we first need to export it in a supported format, such as glTF or FBX. Once we have our model file, we can use the <code>Assets</code> API to load it into our Bevy project. Here’s an example of how to load a glTF model:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_model</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF">>>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">meshes</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Mesh</span><span style="color: #ABB2BF">>>){</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">model_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"models/my_model.gltf#Scene0"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load the model's materials</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">base_color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load the model's meshes</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">meshes_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load_sync</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">model_handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">meshes_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into_iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">meshes</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we use the <code>load</code> method of the <code>AssetServer</code> to load the glTF model file, and then use the <code>load_sync</code> method to load the model’s meshes. We also load the model’s materials and add them to the <code>Materials</code> asset storage using the <code>add</code> method.</p>
<h3 id="displaying-3d-models">Displaying 3D Models</h3>
<p>Once we’ve loaded our 3D model, we need to display it in our scene. To do this, we’ll create an <code>Entity</code> with a <code>Transform</code> component to position and orient the model, and a <code>Handle&#x3C;Mesh></code> component to specify the model’s mesh. We’ll also add a <code>Handle&#x3C;StandardMaterial></code> component to specify the model’s material. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_model</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">meshes</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Mesh</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a new entity for the model</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PbrBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">meshes</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_handle</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"models/my_model.glb#Mesh0/Primitive0"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_handle</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"materials/my_material"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we use the <code>spawn_bundle</code> method of the <code>Commands</code> resource to create a new entity with a <code>PbrBundle</code> component bundle. The <code>PbrBundle</code> specifies the model’s mesh and material using handles to the <code>Mesh</code> and <code>StandardMaterial</code> assets, respectively. We also set the entity’s <code>Transform</code> component to position the model in the scene.</p>
<h3 id="manipulating-3d-models">Manipulating 3D Models</h3>
<p>In addition to displaying 3D models, we may also want to manipulate them in various ways. For example, we might want to animate a model’s position, rotation, or scale over time, or apply physics forces to a model to make it move realistically.</p>
<p>To animate a model’s position, rotation, or scale, we can use the <code>Transform</code> component, which stores the entity’s position, rotation, and scale as <code>Vector3</code> values. We can manipulate these values directly to move, rotate, or scale the entity. For example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">animate_model</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create an animation by modifying the transform over time</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF"> * </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">sin</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.rotation </span><span style="color: #56B6C2">*=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Quat</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_rotation_y</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.scale </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">splat</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF"> * </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">sin</span><span style="color: #ABB2BF">() * </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF"> + </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_model</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MyMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">meshes</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Mesh</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load the 3D model asset</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">model_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"models/robot.glb#Mesh0/Primitive0"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a new material for the model</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MyMaterial</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">albedo</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a new entity for the model and attach the model, material, and transform components</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PbrBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">meshes</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Mesh</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">model_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">())),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">GlobalTransform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Create a child entity for the light and attach a transform and light component</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">parent</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">LightBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_xyz</span><span style="color: #ABB2BF">(-</span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5.0</span><span style="color: #ABB2BF">, -</span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                })</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">GlobalTransform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Animation</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">animate_model</span><span style="color: #ABB2BF">));</span><span style="color: #7F848E; font-style: italic"> // Attach an animation component to the model entity</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we spawns a 3D model in a game engine. The function loads a 3D model asset from an AssetServer, creates a new material for the model, and creates a new entity for the model using a PbrBundle. The entity is then given a Transform component, which is used to animate the position, rotation, and scale of the model over time. The function also creates a child entity for a light and attaches a Transform and Light component to it.</p>
<p>The Transform component is a component in a game engine that stores the position, rotation, and scale of an entity as Vector3 values. These values can be manipulated directly to move, rotate, or scale the entity. In the code you provided, the animate_model function modifies the translation.y, rotation, and scale values of the Transform component to animate the model over time.</p>
<h2 id="creating-and-loading-3d-models-and-meshes-in-a-bevy-project">Creating and loading 3D models and meshes in a Bevy Project</h2>
<p>To create and load 3D models and meshes in a Bevy project, we can use the <code>bevy_asset_loader</code> and <code>bevy_fbx</code> crates.</p>
<p>First, we need to add these crates to our <code>Cargo.toml</code> file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">[</span><span style="color: #61AFEF">dependencies</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #E06C75">bevy</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.5.0"</span></span>
<span class="line"><span style="color: #E06C75">bevy_asset_loader</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.5.0"</span></span>
<span class="line"><span style="color: #E06C75">bevy_fbx</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.5.0"</span></span></code></pre>
<p>Next, we can create a struct to hold our 3D model data:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Model</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Mesh</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Then, we can create a system to load the 3D model from a file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_model_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">meshes</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Mesh</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fbx_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"path/to/model.fbx#Mesh0"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Mesh</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">>(&#x26;</span><span style="color: #E06C75">fbx_handle</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">base_color_texture</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">material_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone_weak</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">model</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Model</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">meshes</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">model</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we first load the 3D model from a file using <code>AssetServer::load()</code>. Then, we retrieve the <code>Mesh</code> data from the loaded asset using <code>AssetServer::get()</code>, and clone it. We create a <code>StandardMaterial</code> using the cloned <code>Handle&#x3C;Texture></code> for the texture, and add it to the <code>Assets&#x3C;StandardMaterial></code>. Finally, we create a <code>Model</code> struct and insert it into the entity hierarchy using <code>Commands::spawn()</code>.</p>
<p>To call this system, we can add it to our <code>AppBuilder</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_asset</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Mesh</span><span style="color: #ABB2BF">>()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_asset</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF">>()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">load_model_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>With these steps, we can create and load 3D models and meshes in our Bevy project.</p>
<h2 id="applying-materials-and-textures-to-3d-objects">Applying materials and textures to 3D objects</h2>
<p>To apply materials and textures to 3D objects in Bevy, we can use the <code>StandardMaterial</code> struct and its associated methods.</p>
<p>First, we need to create a texture asset and add it to the <code>AssetServer</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"path/to/texture.png"</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>Next, we can create a <code>StandardMaterial</code> with the texture and other desired properties:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">base_color_texture</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span></code></pre>
<p>Here, we set the <code>base_color_texture</code> field to the loaded texture asset. We can also set other properties of the material, such as its color, roughness, and metallicness.</p>
<p>Then, we can add the <code>StandardMaterial</code> to the <code>Assets&#x3C;StandardMaterial></code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>Finally, we can add the <code>Handle&#x3C;StandardMaterial></code> to our 3D object using a <code>PbrBundle</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">cube</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PbrBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">mesh_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre>
<p>Here, we set the <code>material</code> field of the <code>PbrBundle</code> to the <code>Handle&#x3C;StandardMaterial></code> we created earlier.</p>
<p>Alternatively, we can also apply materials and textures to 3D objects using the <code>Handle&#x3C;StandardMaterial></code> directly, without using a <code>PbrBundle</code>. For example, we can set the material of a <code>MeshBundle</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">cube</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MeshBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">mesh_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, -</span><span style="color: #D19A66">5.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre>
<p>With these steps, we can apply materials and textures to 3D objects in our Bevy project.</p>
<h2 id="animating-3d-models-and-implementing-visual-effects">Animating 3D models and implementing visual effects</h2>
<p>To animate 3D models and implement visual effects in Bevy, we can use the <code>bevy_animation</code> and <code>bevy_extra</code> crates.</p>
<p>First, we need to add these crates to our <code>Cargo.toml</code> file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">[</span><span style="color: #61AFEF">dependencies</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #E06C75">bevy</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.5.0"</span></span>
<span class="line"><span style="color: #E06C75">bevy_animation</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.5.0"</span></span>
<span class="line"><span style="color: #E06C75">bevy_extra</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.5.0"</span></span></code></pre>
<p>Next, we can create an animation clip for our 3D model:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">clip</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AnimationClip</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[]);</span></span>
<span class="line"><span style="color: #E06C75">clip</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_translation_channel</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span></span>
<span class="line"><span style="color: #ABB2BF">    (</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">    (</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">]);</span></span></code></pre>
<p>Here, we create a new <code>AnimationClip</code> with a duration of 1.0 seconds and an empty list of channels. We then add a translation channel with two keyframes: one at time 0.0 with a position of (0.0, 0.0, 0.0), and another at time 1.0 with a position of (0.0, 1.0, 0.0).</p>
<p>Then, we can create an animation controller for our 3D model:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation_controller</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AnimationController</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">>::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">clip</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>Here, we create a new <code>AnimationController</code> with the animation clip we created earlier.</p>
<p>Next, we can create a system to update the animation controller each frame:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">animate_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AnimationController</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">>, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">controller</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">controller</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">controller</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">current_translation_channel</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">value</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        *</span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">translation_mut</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we retrieve a query of entities that have both an <code>AnimationController</code> and a <code>Transform</code>. We then update each <code>AnimationController</code> using its <code>update()</code> method, and retrieve the current translation value from its current translation channel. Finally, we update the entity’s <code>Transform</code> with the retrieved position.</p>
<p>To call this system, we can add it to our <code>AppBuilder</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AnimationPlugin</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">>::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">animate_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>With these steps, we can animate 3D models and implement visual effects in our Bevy project.</p>
<h2 id="optimizing-graphics-performance-in-a-bevy-project">Optimizing graphics performance in a Bevy project</h2>
<p>To optimize graphics performance in a Bevy project, we can follow several best practices and techniques.</p>
<ol>
<li>
<p>Reduce draw calls: Each time we render a 3D object, we issue a draw call to the graphics card. To reduce the number of draw calls, we can batch objects with the same material and mesh into a single draw call. We can also use instancing to render multiple instances of the same mesh with a single draw call.</p>
</li>
<li>
<p>Use level of detail (LOD): When rendering distant objects, we can use simplified meshes with fewer vertices and triangles to reduce the processing load on the graphics card. Bevy provides a built-in <code>Lod</code> component that automatically switches between different levels of detail based on the distance to the camera.</p>
</li>
<li>
<p>Use culling: If an object is outside the camera’s frustum or occluded by other objects, there is no need to render it. Bevy provides a built-in <code>GlobalTransform</code> component that allows us to perform frustum culling and occlusion culling.</p>
</li>
<li>
<p>Use texture compression: Textures can take up a lot of memory and bandwidth, especially at high resolutions. We can reduce the size of textures by compressing them using formats like BC1, BC3, or ETC2.</p>
</li>
<li>
<p>Avoid overdraw: Overdraw occurs when multiple objects are rendered on top of each other, requiring the graphics card to perform unnecessary calculations. We can reduce overdraw by sorting objects from back to front and using techniques like depth testing and depth write masking.</p>
</li>
<li>
<p>Use multi-threading: Bevy uses Rust’s built-in multi-threading capabilities to distribute processing tasks across multiple threads. We can take advantage of this by writing systems that can be parallelized and using the <code>ParallelIterator</code> trait to process data in parallel.</p>
</li>
</ol>
<p>By following these best practices and techniques, we can optimize graphics performance in our Bevy project and ensure that it runs smoothly even on low-end hardware.</p>
<h2 id="techniques-for-improving-rendering-performance">Techniques for improving rendering performance</h2>
<p>There are several techniques that we can use to improve rendering performance in our Bevy project. Here are some of them:</p>
<ol>
<li>
<p>Use GPU-based rendering techniques: Graphics processing units (GPUs) are designed to perform massive parallel computations, making them well-suited for rendering 3D graphics. By using GPU-based rendering techniques such as vertex and fragment shaders, we can offload the heavy lifting to the graphics card and improve rendering performance.</p>
</li>
<li>
<p>Reduce the number of draw calls: Each time we issue a draw call to the graphics card, we incur some overhead. To improve performance, we should aim to reduce the number of draw calls as much as possible. We can do this by batching objects with the same material and mesh into a single draw call, using instancing to render multiple instances of the same mesh, and avoiding unnecessary draw calls.</p>
</li>
<li>
<p>Use level of detail (LOD): Level of detail (LOD) is a technique for dynamically reducing the level of detail of an object as it gets further away from the camera. By using simpler meshes with fewer vertices and triangles, we can reduce the processing load on the graphics card and improve rendering performance.</p>
</li>
<li>
<p>Use occlusion culling: Occlusion culling is a technique for not rendering objects that are occluded by other objects or outside the camera’s view frustum. By using occlusion culling, we can reduce the number of objects that need to be rendered and improve rendering performance.</p>
</li>
<li>
<p>Use texture compression: Textures can take up a lot of memory and bandwidth, especially at high resolutions. By compressing textures using formats like BC1, BC3, or ETC2, we can reduce their size and improve rendering performance.</p>
</li>
<li>
<p>Use GPU instancing: GPU instancing is a technique for rendering multiple instances of the same mesh with a single draw call. By using GPU instancing, we can reduce the number of draw calls and improve rendering performance.</p>
</li>
<li>
<p>Avoid overdraw: Overdraw occurs when multiple objects are rendered on top of each other, requiring the graphics card to perform unnecessary calculations. We can reduce overdraw by sorting objects from back to front, using techniques like depth testing and depth write masking, and avoiding unnecessary draw calls.</p>
</li>
</ol>
<p>By using these techniques, we can improve rendering performance in our Bevy project and ensure that it runs smoothly even on low-end hardware.</p>
<h2 id="using-bevys-profiling-tools-to-diagnose-performance-issues">Using Bevy’s profiling tools to diagnose performance issues</h2>
<p>Bevy provides several built-in profiling tools that can help us diagnose performance issues in our project. Here are some of the tools that we can use:</p>
<ol>
<li>
<p>FPS counter: Bevy’s <code>WindowDescriptor</code> struct has an <code>fps</code> field that, when set to <code>Some</code>, will display the current frames per second (FPS) in the window title. If the FPS is consistently low, it may indicate that there are performance issues that need to be addressed.</p>
</li>
<li>
<p>CPU profiler: Bevy’s <code>bevy_inspector_egui</code> plugin includes a CPU profiler that can be accessed by pressing the F12 key. The profiler displays a timeline of the CPU usage for each system in our project, allowing us to identify which systems are causing performance issues.</p>
</li>
<li>
<p>GPU profiler: Bevy’s <code>bevy_gfx</code> crate includes a GPU profiler that can be accessed by setting the <code>gfx_profiler</code> feature flag in our project’s <code>Cargo.toml</code> file. The profiler displays a timeline of the GPU usage for each frame, allowing us to identify which rendering operations are causing performance issues.</p>
</li>
<li>
<p>Memory profiler: Bevy’s <code>bevy_memory_profiling</code> crate provides a memory profiler that can be used to identify memory leaks and other memory-related issues in our project.</p>
</li>
<li>
<p>Event viewer: Bevy’s <code>bevy_events</code> crate provides an event viewer that can be used to monitor the events that are being processed by our project’s systems. This can be useful for identifying systems that are processing too many events and causing performance issues.</p>
</li>
</ol>
<p>By using these profiling tools, we can identify performance issues in our Bevy project and take steps to address them. This can help ensure that our project runs smoothly and efficiently, even on low-end hardware.</p>
<h2 id="best-practices-for-managing-large-numbers-of-entities-and-graphics-assets">Best practices for managing large numbers of entities and graphics assets</h2>
<p>Managing large numbers of entities and graphics assets can be a challenge in any game engine, and Bevy is no exception. Here are some best practices for managing large numbers of entities and graphics assets in a Bevy project:</p>
<ol>
<li>
<p>Use entity pooling: Bevy’s <code>EntityCommands</code> API provides a way to create and delete entities dynamically at runtime. However, creating and deleting entities can be expensive in terms of CPU and memory usage. To mitigate this, we can use entity pooling to pre-allocate a pool of entities and reuse them as needed. This can improve performance and reduce memory usage.</p>
</li>
<li>
<p>Use asset loading and unloading: Bevy’s <code>AssetServer</code> provides a way to load and unload graphics assets dynamically at runtime. This can be useful for managing large numbers of assets, as it allows us to load only the assets that are needed for a particular level or scene, and unload assets that are no longer needed. This can help reduce memory usage and improve performance.</p>
</li>
<li>
<p>Use resource caching: Bevy’s <code>Resources</code> API provides a way to store and retrieve shared resources, such as textures, meshes, and materials. By using resource caching, we can avoid loading the same resource multiple times, which can improve performance and reduce memory usage.</p>
</li>
<li>
<p>Use LOD for meshes: Level of detail (LOD) is a technique for dynamically reducing the level of detail of a mesh as it gets further away from the camera. By using LOD, we can reduce the number of vertices and triangles that need to be rendered, which can improve performance and reduce memory usage.</p>
</li>
<li>
<p>Use texture compression: Bevy’s <code>TextureFormat</code> enum includes several compressed texture formats, such as BC1, BC3, and ETC2. By using texture compression, we can reduce the memory footprint of textures, which can improve performance and reduce memory usage.</p>
</li>
<li>
<p>Use instancing for meshes: Bevy’s <code>Mesh</code> API provides a way to render multiple instances of the same mesh with a single draw call. By using instancing, we can reduce the number of draw calls and improve performance.</p>
</li>
<li>
<p>Use scene graph optimization: Bevy’s <code>Transform</code> component provides a way to create hierarchical scene graphs. By optimizing the scene graph structure and only updating the transforms of nodes that have changed, we can improve performance and reduce CPU usage.</p>
</li>
</ol>
<p>By following these best practices, we can manage large numbers of entities and graphics assets in our Bevy project more efficiently, and ensure that it runs smoothly and efficiently, even on low-end hardware.</p>
<h2 id="debugging-and-testing-graphics-and-animation-in-a-bevy-project">Debugging and testing graphics and animation in a Bevy project</h2>
<p>Debugging and testing graphics and animation in a Bevy project can be challenging, especially when dealing with complex scenes and animations. Here are some tips for debugging and testing graphics and animation in a Bevy project:</p>
<ol>
<li>
<p>Use Bevy’s debug UI: Bevy provides a built-in debug UI that can be accessed by pressing the F1 key. The debug UI displays information about the entities, components, and systems in our project, allowing us to inspect and debug the state of our scene and animations.</p>
</li>
<li>
<p>Use Bevy’s <code>Inspector</code> plugin: Bevy’s <code>bevy_inspector_egui</code> plugin provides a graphical inspector for our entities and components. This can be useful for inspecting and debugging the properties of our scene objects and animations.</p>
</li>
<li>
<p>Use Bevy’s <code>Animation</code> plugin: Bevy’s <code>Animation</code> plugin provides a way to create and manipulate animations in our project. The plugin includes a built-in animation previewer that can be used to preview and debug animations in real-time.</p>
</li>
<li>
<p>Use Bevy’s <code>Transform</code> component: Bevy’s <code>Transform</code> component provides a way to manipulate the position, rotation, and scale of entities in our scene. By using the <code>Transform</code> component, we can debug and test the positioning and movement of our scene objects and animations.</p>
</li>
<li>
<p>Use Bevy’s <code>Time</code> resource: Bevy’s <code>Time</code> resource provides information about the elapsed time since the start of the game. By using the <code>Time</code> resource, we can control the speed and timing of our animations, and ensure that they are playing correctly.</p>
</li>
<li>
<p>Use Bevy’s <code>AssetServer</code> and <code>Texture</code> APIs: Bevy’s <code>AssetServer</code> and <code>Texture</code> APIs provide a way to load and manipulate textures in our project. By using these APIs, we can test and debug the appearance of our scene objects and animations.</p>
</li>
<li>
<p>Use Bevy’s <code>Mesh</code> and <code>Material</code> APIs: Bevy’s <code>Mesh</code> and <code>Material</code> APIs provide a way to create and manipulate meshes and materials in our project. By using these APIs, we can test and debug the appearance of our scene objects and animations.</p>
</li>
</ol>
<p>By using these tools and techniques, we can debug and test graphics and animation in our Bevy project, and ensure that our scenes and animations look and behave as intended.</p>
<h2 id="using-bevys-debug-tools-for-rendering-and-animation">Using Bevy’s debug tools for rendering and animation</h2>
<p>Bevy provides several built-in debug tools that can be used for rendering and animation debugging, including:</p>
<ol>
<li>
<p>The Bevy debug UI: The debug UI is a built-in tool that provides a way to inspect and debug the state of the Bevy ECS and its systems, including rendering and animation systems. We can use the debug UI to visualize the entities in our scene, view their components and system state, and toggle systems on and off for debugging purposes.</p>
</li>
<li>
<p>The Bevy Inspector plugin: The <code>bevy_inspector_egui</code> plugin provides a graphical inspector for our entities and components. We can use the inspector to modify the properties of our entities and components at runtime, and see the effects in real-time. This can be useful for debugging rendering and animation issues, as we can quickly modify properties and see the results.</p>
</li>
<li>
<p>The Bevy Animation plugin: The <code>bevy_animation</code> plugin provides a way to create and manipulate animations in our project. It includes a built-in animation previewer that can be used to preview and debug animations in real-time. We can use the animation previewer to view the animation in different states, and modify properties to see how they affect the animation.</p>
</li>
<li>
<p>The Bevy Mesh and Material libraries: Bevy provides built-in support for loading and rendering meshes and materials. We can use these libraries to load and preview meshes and materials, and modify properties to see how they affect the appearance of our scene.</p>
</li>
<li>
<p>The Bevy Debug Renderer: Bevy includes a <code>DebugRenderPlugin</code> that can be used to visualize various debug information, including wireframes, normals, and bounding boxes. We can use the debug renderer to debug rendering issues, such as incorrect mesh orientations or UV mapping.</p>
</li>
</ol>
<p>By using these tools and techniques, we can debug and test rendering and animation in our Bevy project, and ensure that our scenes and animations look and behave as intended.</p>
<h2 id="writing-tests-for-graphics-and-animation-logic">Writing tests for graphics and animation logic</h2>
<p>Writing tests for graphics and animation logic in a Bevy project can be challenging, as these systems are often highly interactive and involve complex visual output. However, there are several techniques that we can use to write effective tests for our graphics and animation logic, including:</p>
<ol>
<li>
<p>Unit testing: We can write unit tests for our graphics and animation logic by isolating the logic into testable functions and verifying their output. For example, we can write a test to verify that a function that calculates the position of a sprite based on its velocity and time delta is working correctly. By testing individual functions in isolation, we can verify the correctness of our graphics and animation logic without relying on complex visual output.</p>
</li>
<li>
<p>Integration testing: We can write integration tests for our graphics and animation logic by setting up a simple scene and verifying that the expected visual output is produced. For example, we can write a test to verify that a sprite moves in the expected direction and speed when we apply a velocity to it. By testing the interaction between our graphics and animation logic and the rendering system, we can verify that our logic is working correctly.</p>
</li>
<li>
<p>Mocking: We can use mocking frameworks to simulate the behavior of external dependencies, such as input devices or rendering systems. For example, we can write a test to verify that a function that processes input events correctly updates the position of a sprite based on the input. By mocking the input events, we can test our graphics and animation logic in isolation.</p>
</li>
<li>
<p>Visual regression testing: We can use visual regression testing tools to compare the visual output of our scene before and after changes to our graphics and animation logic. For example, we can use a tool like <code>Pixelmatch</code> to compare screenshots of our scene before and after applying a change to our animation system. By comparing the screenshots, we can verify that the expected visual changes have been applied.</p>
</li>
</ol>
<p>By using these techniques, we can write effective tests for our graphics and animation logic, and ensure that our scenes and animations behave as intended.</p>
<h2 id="conclusion-and-next-steps-3">Conclusion and next steps</h2>
<p>In this guide, we have covered a wide range of topics related to developing graphics and animation in a Bevy project. We have explored techniques for loading and rendering 3D models and meshes, applying materials and textures, animating models and implementing visual effects, optimizing performance, and debugging and testing our graphics and animation logic. We have also discussed best practices for managing large numbers of entities and graphics assets.</p>
<p>Next, we recommend exploring some of the many resources available for Bevy development, including the Bevy documentation, community forums, and open-source projects. Bevy is a rapidly evolving framework with a growing community, so there is always more to learn and explore.</p>
<p>In addition, we encourage you to experiment with the techniques and tools covered in this guide, and try applying them to your own graphics and animation projects. By continuing to explore and learn, you can develop the skills and expertise needed to create engaging and visually impressive graphics and animation in your Bevy projects.</p>
<h2 id="recap-of-key-concepts-and-tools-covered-in-the-chapter-2">Recap of key concepts and tools covered in the chapter</h2>
<p>Throughout this chapter, we covered a variety of key concepts and tools related to developing graphics and animation in a Bevy project. Here’s a brief recap of some of the most important ones:</p>
<ul>
<li>
<p><strong>Entities and Components</strong>: Bevy uses an entity-component system for organizing and managing game objects. Entities are objects in the game world, while components define their behavior and properties.</p>
</li>
<li>
<p><strong>3D models and meshes</strong>: Bevy provides a variety of tools for loading and rendering 3D models and meshes. This includes support for popular file formats such as glTF and OBJ, as well as tools for manipulating and transforming meshes.</p>
</li>
<li>
<p><strong>Materials and Textures</strong>: Bevy provides a flexible and powerful system for applying materials and textures to 3D objects. This includes support for a variety of material properties, such as color, roughness, and metallicness.</p>
</li>
<li>
<p><strong>Animation</strong>: Bevy supports a variety of animation techniques, including skeletal animation, blend trees, and keyframe animation. This allows for complex and dynamic animations that can bring game worlds to life.</p>
</li>
<li>
<p><strong>Performance optimization</strong>: Bevy provides a variety of tools for optimizing graphics performance, including batching, instancing, and LOD (Level of Detail).</p>
</li>
<li>
<p><strong>Debugging and Testing</strong>: Bevy provides a variety of tools for debugging and testing graphics and animation logic. This includes tools for visualizing rendering output, profiling performance, and writing automated tests.</p>
</li>
</ul>
<p>Overall, Bevy is a powerful and flexible framework for developing engaging and visually impressive graphics and animation in your projects. By mastering these key concepts and tools, you can create stunning game worlds that captivate your audience.</p>
<h2 id="suggestions-for-further-learning-and-experimentation-with-bevys-graphics-and-animation-capabilities">Suggestions for further learning and experimentation with Bevy’s graphics and animation capabilities.</h2>
<p>If you’re interested in further learning and experimentation with Bevy’s graphics and animation capabilities, there are several resources and next steps you can take:</p>
<ol>
<li>
<p><strong>Bevy’s official documentation</strong>: Bevy’s documentation is a great resource for learning about the framework’s features and capabilities. The documentation includes tutorials, guides, and reference material that cover Bevy’s graphics and animation capabilities in depth.</p>
</li>
<li>
<p><strong>Bevy’s official examples</strong>: Bevy’s official examples provide a great starting point for experimenting with the framework’s graphics and animation capabilities. These examples include fully functional Bevy projects that demonstrate various techniques and features.</p>
</li>
<li>
<p><strong>Bevy’s community resources</strong>: Bevy has a growing community of developers who share their knowledge and experience through forums, Discord channels, and other resources. Participating in the community can be a great way to learn new techniques, get feedback on your projects, and connect with other Bevy developers.</p>
</li>
<li>
<p><strong>Open-source projects</strong>: Bevy is an open-source framework, and there are many projects and libraries available on platforms like GitHub that utilize Bevy’s graphics and animation capabilities. Studying and contributing to these projects can be a great way to deepen your understanding of the framework and its features.</p>
</li>
<li>
<p><strong>Experimentation and practice</strong>: Ultimately, the best way to learn and master Bevy’s graphics and animation capabilities is through experimentation and practice. Try creating your own projects and implementing new techniques and features. Practice writing efficient and effective code, and continually look for ways to improve your skills and knowledge. With time and dedication, you can become an expert in Bevy’s graphics and animation capabilities.</p>
</li>
</ol>
<h1 id="chapter-5-physics-and-collision-detection">Chapter 5: Physics and Collision Detection</h1>
<h2 id="understanding-physics-simulation-in-games">Understanding physics simulation in games</h2>
<p>Physics simulation is an essential component of many games, allowing for realistic movement and interactions between objects in the game world. At a high level, physics simulation involves modeling the behavior of objects in the game world according to the laws of physics, such as gravity, friction, and collision.</p>
<p>In order to simulate physics in a game, a physics engine is typically used. A physics engine is a software library that provides tools for simulating the motion and behavior of objects in a game world. Physics engines can handle tasks such as collision detection and response, gravity and other forces, and rigid body dynamics.</p>
<p>In a game, physics simulation typically operates on a separate thread from the main game loop, since physics calculations can be computationally intensive and time-consuming. The physics thread updates the position and velocity of objects in the game world based on the laws of physics, while the main game loop is responsible for updating the visual representation of the game world based on the current state of the physics simulation.</p>
<p>There are several popular physics engines available for game development, including PhysX, Havok, and Bullet. In addition to providing basic physics simulation functionality, these engines often include advanced features such as ragdoll physics, soft body dynamics, and vehicle simulation.</p>
<p>In summary, physics simulation is an important aspect of game development that allows for realistic and engaging movement and interactions in the game world. By using a physics engine and careful design and optimization, game developers can create immersive and compelling games that take full advantage of the power of physics simulation.</p>
<h2 id="overview-of-physics-simulation-and-its-role-in-game-development">Overview of physics simulation and its role in game development</h2>
<p>Physics simulation plays a crucial role in game development, allowing for realistic and engaging interactions between objects in the game world. In essence, physics simulation involves modeling the behavior of objects in the game world according to the laws of physics, such as gravity, friction, and collision.</p>
<p>To simulate physics in a game, game developers use a physics engine. A physics engine is a software library that provides tools for simulating the motion and behavior of objects in the game world. Physics engines can handle tasks such as collision detection and response, gravity and other forces, and rigid body dynamics.</p>
<p>In a game, the physics simulation typically runs on a separate thread from the main game loop, as physics calculations can be computationally intensive and time-consuming. The physics thread updates the position and velocity of objects in the game world based on the laws of physics, while the main game loop updates the visual representation of the game world based on the current state of the physics simulation.</p>
<p>Overall, physics simulation is an important aspect of game development that allows for realistic and immersive interactions between objects in the game world. By using a physics engine and careful optimization, game developers can create compelling games that take full advantage of the power of physics simulation.</p>
<h2 id="introduction-to-common-physics-concepts-like-gravity-velocity-and-friction">Introduction to common physics concepts like gravity, velocity, and friction</h2>
<p>Physics concepts like gravity, velocity, and friction are fundamental to understanding how objects move and interact in the real world, as well as in game development. Here is a brief overview of each concept:</p>
<ul>
<li>
<p>Gravity: Gravity is the force that pulls objects towards each other. In game development, gravity is often used to simulate the effect of objects being pulled towards the ground. By applying gravity to objects in a game world, game developers can create a more realistic and immersive experience.</p>
</li>
<li>
<p>Velocity: Velocity is a measure of an object’s speed and direction. It is represented as a vector, which includes both a magnitude (speed) and a direction. In game development, velocity is often used to determine how quickly an object moves, as well as its direction of movement.</p>
</li>
<li>
<p>Friction: Friction is the force that opposes motion between two surfaces in contact. In game development, friction can be used to simulate the effect of objects slowing down or coming to a stop when they come into contact with another surface. By adjusting the amount of friction between objects in a game world, game developers can create more realistic and nuanced interactions between objects.</p>
</li>
</ul>
<p>Other important physics concepts in game development include momentum, impulse,</p>
<h2 id="implementing-physics-simulation-with-bevys-physics-plugin">Implementing physics simulation with Bevy’s physics plugin</h2>
<p>Bevy provides a physics plugin that makes it easy to implement physics simulation in your game. The plugin uses the Rapier physics engine, which is a high-performance, 2D and 3D physics engine written in Rust. Here’s an overview of how to implement physics simulation using Bevy’s physics plugin:</p>
<ol>
<li>
<p>Add the physics plugin to your Bevy project. You can do this by adding the following line to your <code>Cargo.toml</code> file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">bevy_rapier3d = "0.8.2"</span></span></code></pre>
</li>
<li>
<p>Initialize the physics plugin in your game by adding the following code to your <code>main.rs</code> file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">use bevy_rapier3d::physics::RapierPhysicsPlugin;</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn main() {</span></span>
<span class="line"><span style="color: #abb2bf">    App::build()</span></span>
<span class="line"><span style="color: #abb2bf">        .add_plugin(RapierPhysicsPlugin)</span></span>
<span class="line"><span style="color: #abb2bf">        // ...</span></span>
<span class="line"><span style="color: #abb2bf">        .run();</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
</li>
<li>
<p>Create physics entities in your game world by adding the <code>RigidBody</code> and <code>Collider</code> components to your entities. The <code>RigidBody</code> component defines the physics properties of the entity, such as mass, inertia, and damping, while the <code>Collider</code> component defines the shape of the entity for collision detection.</p>
</li>
<li>
<p>Implement physics interactions between entities by adding <code>Joint</code> components to your entities. Joints define how two or more entities interact with each other, such as by constraining their movement or allowing them to rotate around a shared point.</p>
</li>
<li>
<p>Update the physics simulation in your game loop by calling the <code>step</code> method of the <code>PhysicsStep</code> resource. This will update the position and velocity of your physics entities based on the current state of the simulation.</p>
</li>
</ol>
<p>By using Bevy’s physics plugin, you can easily implement realistic physics simulation in your game, allowing for engaging and immersive interactions between objects in the game world. With the power of the Rapier physics engine and the simplicity of Bevy’s plugin system, you can create physics simulations that are both accurate and efficient.</p>
<h2 id="installing-and-configuring-bevys-physics-plugin">Installing and configuring Bevy’s physics plugin</h2>
<p>To use Bevy’s physics plugin, you first need to install it and configure your Bevy project to use it. Here’s a step-by-step guide:</p>
<ol>
<li>Add the <code>bevy_rapier3d</code> crate to your <code>Cargo.toml</code> file:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">[dependencies]</span></span>
<span class="line"><span style="color: #abb2bf">bevy = "0.5"</span></span>
<span class="line"><span style="color: #abb2bf">bevy_rapier3d = "0.8.2"</span></span></code></pre>
<ol start="2">
<li>Add the physics plugin to your Bevy app:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">use bevy::prelude::*;</span></span>
<span class="line"><span style="color: #abb2bf">use bevy_rapier3d::physics::RapierPhysicsPlugin;</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn main() {</span></span>
<span class="line"><span style="color: #abb2bf">    App::build()</span></span>
<span class="line"><span style="color: #abb2bf">        .add_plugins(DefaultPlugins)</span></span>
<span class="line"><span style="color: #abb2bf">        .add_plugin(RapierPhysicsPlugin)</span></span>
<span class="line"><span style="color: #abb2bf">        .run();</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<ol start="3">
<li>Create entities with physics components. For example, to create a cube with a physics body:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">use bevy::prelude::*;</span></span>
<span class="line"><span style="color: #abb2bf">use bevy_rapier3d::physics::{RigidBodyHandleComponent, RigidBodyMassPropsFlags, RigidBodyType};</span></span>
<span class="line"><span style="color: #abb2bf">use bevy_rapier3d::rapier::geometry::ColliderShape;</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn spawn_cube(</span></span>
<span class="line"><span style="color: #abb2bf">    commands: &#x26;mut Commands,</span></span>
<span class="line"><span style="color: #abb2bf">    rapier_config: &#x26;RapierConfiguration,</span></span>
<span class="line"><span style="color: #abb2bf">    cube_scale: f32,</span></span>
<span class="line"><span style="color: #abb2bf">) {</span></span>
<span class="line"><span style="color: #abb2bf">    let rigid_body = RigidBodyBundle {</span></span>
<span class="line"><span style="color: #abb2bf">        body_type: RigidBodyType::Dynamic,</span></span>
<span class="line"><span style="color: #abb2bf">        position: Vec3::new(0.0, 10.0, 0.0).into(),</span></span>
<span class="line"><span style="color: #abb2bf">        mass_properties: RigidBodyMassPropsFlags::Density(1.0),</span></span>
<span class="line"><span style="color: #abb2bf">        ..Default::default()</span></span>
<span class="line"><span style="color: #abb2bf">    };</span></span>
<span class="line"><span style="color: #abb2bf">    let collider = ColliderBundle {</span></span>
<span class="line"><span style="color: #abb2bf">        shape: ColliderShape::cuboid(cube_scale / 2.0, cube_scale / 2.0, cube_scale / 2.0),</span></span>
<span class="line"><span style="color: #abb2bf">        ..Default::default()</span></span>
<span class="line"><span style="color: #abb2bf">    };</span></span>
<span class="line"><span style="color: #abb2bf">    commands</span></span>
<span class="line"><span style="color: #abb2bf">        .spawn_bundle(rigid_body)</span></span>
<span class="line"><span style="color: #abb2bf">        .insert_bundle(collider)</span></span>
<span class="line"><span style="color: #abb2bf">        .insert(RigidBodyHandleComponent::default())</span></span>
<span class="line"><span style="color: #abb2bf">        .insert(Name::new("Cube"));</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>This will create a cube with a dynamic rigid body and a cuboid collider shape.</p>
<ol start="4">
<li>Update the physics simulation in your game loop:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">fn my_system(time: Res&#x3C;Time>, mut physics_pipeline: ResMut&#x3C;PhysicsPipeline>) {</span></span>
<span class="line"><span style="color: #abb2bf">    physics_pipeline.step(</span></span>
<span class="line"><span style="color: #abb2bf">        &#x26;mut physics_world_integration.velocity_solver,</span></span>
<span class="line"><span style="color: #abb2bf">        &#x26;mut physics_world_integration.position_solver,</span></span>
<span class="line"><span style="color: #abb2bf">        &#x26;mut physics_world.colliders,</span></span>
<span class="line"><span style="color: #abb2bf">        &#x26;mut physics_world.bodies,</span></span>
<span class="line"><span style="color: #abb2bf">        &#x26;mut physics_world.joints,</span></span>
<span class="line"><span style="color: #abb2bf">        time.delta_seconds(),</span></span>
<span class="line"><span style="color: #abb2bf">    );</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>This will update the physics simulation in your game loop.</p>
<p>With these steps, you can install and configure Bevy’s physics plugin and create entities with physics components. You can also update the physics simulation in your game loop.</p>
<h2 id="creating-and-managing-physics-bodies-and-shapes">Creating and managing physics bodies and shapes</h2>
<p>In Bevy’s physics plugin, you can create and manage physics bodies and shapes using the <code>RigidBodyBundle</code> and <code>ColliderBundle</code> components.</p>
<p>The <code>RigidBodyBundle</code> component describes the properties of a physics body, such as its mass, position, and type. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">use bevy::prelude::*;</span></span>
<span class="line"><span style="color: #abb2bf">use bevy_rapier3d::physics::{RigidBodyType, RigidBodyMassPropsFlags};</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn spawn_sphere(commands: &#x26;mut Commands) {</span></span>
<span class="line"><span style="color: #abb2bf">    commands</span></span>
<span class="line"><span style="color: #abb2bf">        .spawn_bundle(RigidBodyBundle {</span></span>
<span class="line"><span style="color: #abb2bf">            body_type: RigidBodyType::Dynamic,</span></span>
<span class="line"><span style="color: #abb2bf">            position: Vec3::new(0.0, 10.0, 0.0).into(),</span></span>
<span class="line"><span style="color: #abb2bf">            mass_properties: RigidBodyMassPropsFlags::Density(1.0),</span></span>
<span class="line"><span style="color: #abb2bf">            ..Default::default()</span></span>
<span class="line"><span style="color: #abb2bf">        })</span></span>
<span class="line"><span style="color: #abb2bf">        .insert(Name::new("Sphere"));</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>This creates a dynamic sphere-shaped rigid body at the position <code>(0.0, 10.0, 0.0)</code> with a density of 1.0.</p>
<p>The <code>ColliderBundle</code> component describes the shape of a physics collider, such as a sphere, box, or capsule. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">use bevy::prelude::*;</span></span>
<span class="line"><span style="color: #abb2bf">use bevy_rapier3d::physics::ColliderShape;</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn spawn_sphere(commands: &#x26;mut Commands) {</span></span>
<span class="line"><span style="color: #abb2bf">    commands</span></span>
<span class="line"><span style="color: #abb2bf">        .spawn_bundle(ColliderBundle {</span></span>
<span class="line"><span style="color: #abb2bf">            shape: ColliderShape::Sphere(1.0),</span></span>
<span class="line"><span style="color: #abb2bf">            ..Default::default()</span></span>
<span class="line"><span style="color: #abb2bf">        })</span></span>
<span class="line"><span style="color: #abb2bf">        .insert(Name::new("Sphere"));</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>This creates a sphere-shaped collider with a radius of 1.0.</p>
<p>You can also attach additional components to physics bodies and colliders to control their behavior. For example, the <code>Gravity</code> component applies a constant force to a physics body in a certain direction:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">use bevy::prelude::*;</span></span>
<span class="line"><span style="color: #abb2bf">use bevy_rapier3d::physics::{Gravity, RigidBodyType, RigidBodyMassPropsFlags};</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn spawn_sphere(commands: &#x26;mut Commands) {</span></span>
<span class="line"><span style="color: #abb2bf">    commands</span></span>
<span class="line"><span style="color: #abb2bf">        .spawn_bundle(RigidBodyBundle {</span></span>
<span class="line"><span style="color: #abb2bf">            body_type: RigidBodyType::Dynamic,</span></span>
<span class="line"><span style="color: #abb2bf">            position: Vec3::new(0.0, 10.0, 0.0).into(),</span></span>
<span class="line"><span style="color: #abb2bf">            mass_properties: RigidBodyMassPropsFlags::Density(1.0),</span></span>
<span class="line"><span style="color: #abb2bf">            ..Default::default()</span></span>
<span class="line"><span style="color: #abb2bf">        })</span></span>
<span class="line"><span style="color: #abb2bf">        .insert(Gravity::new(Vec3::new(0.0, -9.81, 0.0)))</span></span>
<span class="line"><span style="color: #abb2bf">        .insert(Name::new("Sphere"));</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>This applies a downward force of 9.81 meters per second squared to the sphere-shaped rigid body.</p>
<p>You can also attach multiple colliders to a single physics body to create more complex shapes:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy_rapier3d</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">physics</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">ColliderShape</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">RigidBodyType</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">RigidBodyMassPropsFlags</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_compound_shape</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collider1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ColliderBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">shape</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ColliderShape</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Sphere</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collider2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ColliderBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">shape</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ColliderShape</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Cuboid</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">RigidBodyBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">body_type</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">RigidBodyType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Dynamic</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">RigidBodyMassPropsFlags</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">ROTATION_LOCKED</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">collider1</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">collider2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Now that we have created our physics body and shape, we can add it to the <code>PhysicsWorld</code> resource in our Bevy app. We can do this by creating a new system that adds our physics body to the <code>PhysicsWorld</code> every frame.</p>
<p>Here’s an example system that does just that:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add_to_physics_world</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">PhysicsWorld</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(</span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">RigidBody</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Collider</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">rigid_body</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">collider</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains_body</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">rigid_body</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">handle</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">body_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">RigidBodyBuilder</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">rigid_body</span><span style="color: #ABB2BF">.body_type.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">                    .</span><span style="color: #61AFEF">translation</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">rigid_body</span><span style="color: #ABB2BF">.position)</span></span>
<span class="line"><span style="color: #ABB2BF">                    .</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            );</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collider_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_collider</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">collider</span><span style="color: #ABB2BF">.shape.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">collider</span><span style="color: #ABB2BF">.transform.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">body_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">.bodies.</span><span style="color: #61AFEF">get_mut</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">body_handle</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">take_mass_properties</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">Material</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            );</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">insert_bundle</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75">body_handle</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">collider_handle</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>The system iterates over entities that have both a RigidBody and Collider component. For each entity, it creates a new RigidBody in the physics world and adds the corresponding Collider to it. Finally, it associates the entity with the RigidBody and Collider handles using insert_bundle.</p>
<p>You can add this system to your Bevy app by calling App::add_system() in your main() function, passing in the add_to_physics_world system as an argument.</p>
<h2 id="simulating-physics-interactions-and-collisions-between-entities">Simulating physics interactions and collisions between entities</h2>
<p>Now that we have added our physics body and shape to the <code>PhysicsWorld</code>, we can simulate physics interactions and collisions between our entities.</p>
<p>To do this, we need to create a new system that updates the <code>Transform</code> component of our entities based on the position of their corresponding physics body in the <code>PhysicsWorld</code>. We can also use the <code>EventReader&#x3C;CollisionEvent></code> resource to detect collisions between entities and react accordingly.</p>
<p>Here’s an example system that updates the <code>Transform</code> component and detects collisions:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">update_transforms</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">RigidBody</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">PhysicsWorld</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">CollisionEvent</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">rigid_body</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">rb_handle</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_handle</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">rigid_body</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">handle</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">rb_pos</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_position</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">rb_handle</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">rb_pos</span><span style="color: #ABB2BF">.translation.vector;</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision_event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #98C379">"Entity {:?} collided with Entity {:?}"</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">collision_event</span><span style="color: #ABB2BF">.entity1, </span><span style="color: #E06C75">collision_event</span><span style="color: #ABB2BF">.entity2</span></span>
<span class="line"><span style="color: #ABB2BF">        );</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use the <code>get_handle()</code> method to retrieve the handle of the physics body corresponding to each entity, and then use the <code>get_position()</code> method to retrieve the position of the physics body. We update the <code>Transform</code> component of the entity with this position.</p>
<p>We also use the <code>EventReader&#x3C;CollisionEvent></code> resource to detect collisions between entities. We can then react to these collisions in whatever way we want - for example, by playing a sound effect, spawning particles, or applying a force to the colliding entities.</p>
<p>With these systems in place, we can now simulate realistic physics interactions and collisions between our entities in our Bevy game.</p>
<h2 id="detecting-collisions-and-responding-to-them-in-bevy">Detecting collisions and responding to them in Bevy</h2>
<p>In Bevy, collisions can be detected and responded to using the <code>CollisionEvent</code> struct, which is emitted by the <code>PhysicsPlugin</code> whenever two physics bodies collide. We can listen for <code>CollisionEvent</code>s using an <code>EventReader&#x3C;CollisionEvent></code> resource, as we did in the previous example.</p>
<p>Once we have detected a collision, we can respond to it in any way we want. Here are a few examples of how we can respond to collisions:</p>
<ul>
<li>
<p>Apply a force to the colliding entities: We can use the <code>apply_force()</code> method of the <code>PhysicsWorld</code> resource to apply a force to the physics bodies of the colliding entities. For example, we can apply an impulse in the direction opposite to the collision normal to simulate a bouncing effect.</p>
</li>
<li>
<p>Play a sound effect: We can use the <code>Audio</code> plugin to play a sound effect whenever a collision occurs. We can create an <code>AudioSource</code> component and add it to our entity, and then use the <code>play()</code> method of the <code>AudioSource</code> to play the sound effect.</p>
</li>
<li>
<p>Spawn particles: We can use the <code>ParticleSystem</code> plugin to spawn particles whenever a collision occurs. We can create a particle system with the desired properties and then use the <code>spawn()</code> method of the <code>ParticleSystem</code> to spawn particles at the collision point.</p>
</li>
</ul>
<p>Here’s an example system that applies a bouncing effect to the colliding entities:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">bounce_on_collision</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">PhysicsWorld</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">CollisionEvent</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision_event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">entity1</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">entity2</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">collision_event</span><span style="color: #ABB2BF">.entity1, </span><span style="color: #E06C75">collision_event</span><span style="color: #ABB2BF">.entity2);</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">body1</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">body2</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_body</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">entity1</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_body</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">entity2</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        );</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">normal</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision_event</span><span style="color: #ABB2BF">.normal;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">impulse1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> -</span><span style="color: #E06C75">normal</span><span style="color: #ABB2BF"> * </span><span style="color: #E06C75">body1</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">mass_properties</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">effective_mass</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">impulse2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">normal</span><span style="color: #ABB2BF"> * </span><span style="color: #E06C75">body2</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">mass_properties</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">effective_mass</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">apply_force</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">entity1</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">impulse1</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">physics_world</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">apply_force</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">entity2</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">impulse2</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use the <code>get_body()</code> method of the <code>PhysicsWorld</code> resource to retrieve the physics body corresponding to each entity involved in the collision. We then calculate the impulse to apply to each body using the collision normal and the effective mass of the body, and apply it using the <code>apply_force()</code> method of the <code>PhysicsWorld</code> resource.</p>
<h2 id="detecting-collisions-between-entities-using-bevys-collision-detection-system">Detecting collisions between entities using Bevy’s collision detection system</h2>
<p>Bevy’s collision detection system is based on the <code>Collider</code> component and the <code>Colliders</code> resource. The <code>Collider</code> component represents the shape of an entity’s physics body, and the <code>Colliders</code> resource is used to manage and detect collisions between entities.</p>
<p>To detect collisions between entities, we need to add <code>Collider</code> components to the entities and configure their shape and collision properties. Here’s an example of how to add a <code>Collider</code> to a 3D mesh entity:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mesh_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_model.gltf#Mesh0/Primitive0"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collider</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Collider</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">solid</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Shape</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_trimesh</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">mesh_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">(), </span><span style="color: #E5C07B">None</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MeshBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">mesh_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ColliderBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">collider</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span></code></pre>
<p>In this example, we use the <code>from_trimesh()</code> method of the <code>Shape</code> enum to create a <code>Shape::Trimesh</code> shape from a 3D mesh. We then create a <code>Collider</code> using the <code>solid()</code> method, which creates a solid collider with a default density of 1.0. Finally, we add the <code>Collider</code> component to the entity using the <code>insert()</code> method.</p>
<p>Once we have added <code>Collider</code> components to our entities, we can use the <code>Colliders</code> resource to detect collisions between them. Here’s an example of how to detect collisions between all entities with <code>Collider</code> components:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">detect_collisions</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">colliders</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #E5C07B">Collider</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventWriter</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">CollisionEvent</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">broadphase</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">BroadPhase</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">collider</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">colliders</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">enumerate</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">broadphase</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">create_proxy</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">collider</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">aabb</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        );</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">collider</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_broadphase_handle</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">broadphase</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">for_each_pair</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">, </span><span style="color: #56B6C2">|</span><span style="color: #E06C75">p1</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">p2</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">entity1</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">handle1</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">p1</span><span style="color: #ABB2BF">.user_data, </span><span style="color: #E06C75">p1</span><span style="color: #ABB2BF">.handle);</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">entity2</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">handle2</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">p2</span><span style="color: #ABB2BF">.user_data, </span><span style="color: #E06C75">p2</span><span style="color: #ABB2BF">.handle);</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">send</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">CollisionEvent</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">entity1</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">entity2</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use the <code>Query</code> struct to retrieve all entities with <code>Collider</code> components. We then create a <code>BroadPhase</code> object and add all <code>Collider</code> components to it using the <code>create_proxy()</code> method. Finally, we use the <code>for_each_pair()</code> method of the <code>BroadPhase</code> to iterate over all pairs of colliding entities and send a <code>CollisionEvent</code> for each pair.</p>
<p>The <code>CollisionEvent</code> struct contains information about the collision, such as the normal vector of the collision, the penetration depth, and the entities involved in the collision. We can use this information to respond to collisions in various ways, such as applying forces or spawning particles, as we discussed in the previous section.</p>
<h2 id="creating-collision-callbacks-and-handling-collision-events">Creating collision callbacks and handling collision events</h2>
<p>To handle collision events in Bevy, we need to use the <code>EventReader</code> resource to read the collision events that are generated by the physics engine. The <code>EventReader</code> resource is a type of Bevy system that allows us to read the events that are produced by other systems.</p>
<p>We can define a system that reads collision events using the <code>EventReader&#x3C;CollisionEvent></code> resource, and then process those events to handle the collisions.</p>
<p>Here’s an example system that handles collision events between entities:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">collision_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Events</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">CollisionEvent</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Score</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Iterate over all collision events</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Get the entities involved in the collision</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entity1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.collider1.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entity2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.collider2.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Check if the entities have the Ball and Block components</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">ball_entity</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">block_entity</span><span style="color: #ABB2BF">)) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">entity1</span><span style="color: #ABB2BF">), </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">entity2</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ball_entity</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Ball</span><span style="color: #ABB2BF">>() </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">block_entity</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Block</span><span style="color: #ABB2BF">>() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // Remove the Block and update the score</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">block_entity</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">despawn</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">.points </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // Create a particle effect at the Block's position</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">block_transform</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">block_entity</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">>().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"textures/particle.png"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">                    .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ParticleBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                            </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                        },</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">block_transform</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                    })</span></span>
<span class="line"><span style="color: #ABB2BF">                    .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Timer</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_seconds</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<h2 id="implementing-gameplay-mechanics-that-rely-on-physics-and-collision-detection">Implementing gameplay mechanics that rely on physics and collision detection</h2>
<p>Gameplay mechanics that rely on physics and collision detection can be implemented in a Bevy project using the physics and collision detection systems we have covered.</p>
<p>For example, let’s say we want to implement a simple game where the player controls a ball that must navigate through an obstacle course. The ball is subject to gravity and friction, and can collide with various objects in the environment.</p>
<p>To implement this game, we can create an entity for the ball with a physics body and shape, and then create entities for the various obstacles in the environment with their own physics bodies and shapes. We can then use collision detection to detect when the ball collides with an obstacle, and update the game state accordingly.</p>
<p>We can also use physics forces and impulses to control the movement of the ball, allowing the player to apply forces to move the ball around the environment.</p>
<p>Here’s an example system that implements this gameplay mechanics:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ball_control_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ball_query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">RigidBodyVelocity</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ball_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Up</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">.linvel.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Down</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">.linvel.y </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Left</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">.linvel.x </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Right</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">.linvel.x </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">obstacle_collision_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Events</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">CollisionEvent</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">StandardMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Score</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">ball_entity</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">obstacle_entity</span><span style="color: #ABB2BF">)) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.body_entity1, </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.body_entity2) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Handle collision between ball and obstacle entities</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ball_entity</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Ball</span><span style="color: #ABB2BF">>() </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">obstacle_entity</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Obstacle</span><span style="color: #ABB2BF">>() {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">obstacle_entity</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">despawn</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">.points </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we have two systems. The <code>ball_control_system</code> system uses player input to apply forces to the ball entity’s <code>RigidBodyVelocity</code> component, allowing the player to control the ball’s movement.</p>
<p>The <code>obstacle_collision_system</code> system uses the <code>EventReader&#x3C;CollisionEvent></code> resource to detect when the ball collides with an obstacle entity, and then updates the game state by removing the obstacle entity and increasing the player’s score.</p>
<p>Overall, Bevy’s physics and collision detection systems provide a powerful foundation for implementing a wide range of gameplay mechanics that rely on realistic physics interactions and collision detection.</p>
<p>Some popular examples include platformers, puzzle games, racing games, and physics-based sandbox games. In platformers, physics simulation is used to model the movement and behavior of characters and objects, as well as to detect collisions between them. In puzzle games, physics simulation can be used to create interesting and challenging puzzles that require players to manipulate objects and use their knowledge of physics to solve them. Racing games rely heavily on physics simulation to model the behavior of vehicles and to simulate collisions and crashes.</p>
<p>In physics-based sandbox games, players are often given access to a wide range of tools and objects that they can use to create their own unique physics-based simulations. These games often have no set goals or objectives, and instead allow players to experiment and explore the physics engine in a sandbox environment.</p>
<p>Overall, the use of physics simulation and collision detection in game development can add a great deal of realism and depth to a game’s mechanics and interactions. By using Bevy’s physics plugin, developers can easily add these features to their games and create compelling gameplay experiences for their players.</p>
<h2 id="advanced-physics-topics-in-bevy">Advanced physics topics in Bevy</h2>
<p>Bevy’s physics plugin provides support for a wide range of advanced physics features that can be used to create even more complex and realistic physics simulations. Some of these advanced physics topics include:</p>
<ol>
<li>
<p>Joints: Bevy’s physics plugin supports various types of joints, including fixed, hinge, and slider joints. These can be used to create more complex and realistic physics interactions between entities.</p>
</li>
<li>
<p>Constraints: Constraints can be used to restrict the movement of physics bodies in various ways. For example, developers can use constraints to limit the rotation of an object to a certain range or to prevent two objects from passing through each other.</p>
</li>
<li>
<p>Raycasting: Bevy’s physics plugin supports raycasting, which can be used to detect collisions between objects along a specific path or line of sight. This can be useful for implementing features such as line of sight detection, weapons targeting, and more.</p>
</li>
<li>
<p>Debugging and visualization: Bevy’s physics plugin provides various tools for debugging and visualizing physics simulations. Developers can use these tools to visualize the collision shapes of objects, view the physics world’s internal state, and more.</p>
</li>
<li>
<p>Performance optimization: Bevy’s physics plugin provides various performance optimizations, such as spatial partitioning and broad-phase collision detection. These optimizations can help to improve the performance of physics simulations in large and complex scenes.</p>
</li>
</ol>
<p>Overall, Bevy’s physics plugin provides a robust set of tools and features for creating complex and realistic physics simulations in games. Developers can leverage these advanced physics topics to create even more engaging and immersive gameplay experiences for their players.</p>
<h2 id="working-with-joints-and-constraints-to-simulate-complex-physics-interactions">Working with joints and constraints to simulate complex physics interactions</h2>
<p>Bevy’s physics plugin provides support for various types of joints and constraints, which can be used to simulate more complex and realistic physics interactions between entities.</p>
<p>Joints are connections between two or more physics bodies that allow them to move in relation to each other. Bevy supports various types of joints, including fixed joints, hinge joints, and slider joints. Fixed joints connect two bodies and prevent them from moving relative to each other. Hinge joints allow two bodies to rotate around a common point, simulating a door hinge or a joint in a humanoid character’s limb. Slider joints allow two bodies to slide relative to each other along a single axis.</p>
<p>Constraints can be used to restrict the movement of physics bodies in various ways. Bevy’s</p>
<h2 id="implementing-raycasting-and-other-advanced-collision-detection-techniques">Implementing raycasting and other advanced collision detection techniques</h2>
<p>In addition to the basic collision detection and physics simulation features provided by Bevy’s physics plugin, Bevy also provides support for more advanced collision detection techniques like raycasting.</p>
<p>Raycasting involves projecting a ray from a point in a certain direction and detecting collisions with any objects along the ray’s path. This can be useful for detecting line-of-sight or for implementing shooting mechanics in a game.</p>
<p>To implement raycasting in a Bevy project, we can use Bevy’s <code>Query</code> API to retrieve a list of all the <code>Transform</code> and <code>Collider</code> components in the scene. We can then iterate through this list and perform raycasts using the <code>Collider</code> components to detect any collisions.</p>
<p>Bevy also provides support for other advanced collision detection techniques like swept volume queries, which involve detecting collisions between an object and a moving volume, and shape casting, which involves detecting collisions between a shape and other objects in the scene.</p>
<p>These advanced collision detection techniques can be used to implement a wide range of gameplay mechanics that rely on precise collision detection and physics interactions, such as platformers, racing games, and first-person shooters.</p>
<h2 id="optimizing-physics-performance-and-managing-large-numbers-of-physics-objects">Optimizing physics performance and managing large numbers of physics objects</h2>
<p>As with graphics and animation, physics simulation can be resource-intensive and can have a significant impact on the performance of a game. To ensure smooth and responsive physics simulation, it’s important to optimize the physics performance and manage the number of physics objects in the scene.</p>
<p>One common technique for optimizing physics performance is to use simplified physics shapes, such as convex hulls or capsules, instead of more complex shapes like meshes or polygons. This can reduce the number of calculations required for collision detection and improve the overall performance of the physics simulation.</p>
<p>Another technique is to use culling and LOD (level of detail) to manage the number of physics objects in the scene. For example, we can disable physics simulation for objects that are far away from the player or use lower-detail physics shapes for objects that are further away.</p>
<h2 id="debugging-and-testing-physics-and-collision-detection-in-a-bevy-project">Debugging and testing physics and collision detection in a Bevy project</h2>
<p>Debugging and testing physics and collision detection can be challenging since it’s often difficult to reproduce and isolate issues. However, Bevy provides a number of debugging and testing tools that can help with this process.</p>
<p>One useful tool is Bevy’s physics debug visualization, which allows us to visualize the physics shapes and constraints in the scene. This can help us identify issues with collision detection or physics simulation.</p>
<p>Bevy also provides a number of testing utilities for physics simulation, such as the <code>TestRunner</code> resource and the <code>TestSystem</code> trait. These can be used to create automated tests for physics interactions and collision detection. For example, we can write tests to ensure that two objects collide and generate the expected response.</p>
<p>In addition to automated tests, it’s also important to perform manual testing to ensure that the physics simulation behaves as expected in different scenarios. This can involve testing a variety of physics interactions, such as collisions between different shapes and objects with different masses and velocities.</p>
<p>Overall, testing and debugging physics and collision detection can be a complex and time-consuming process, but it’s an essential part of ensuring that a game’s physics simulation is responsive and realistic.</p>
<h2 id="writing-tests-for-physics-simulation-and-collision-detection-logic">Writing tests for physics simulation and collision detection logic</h2>
<p>Writing tests for physics simulation and collision detection logic is an important part of ensuring that a game’s physics interactions behave as expected. Bevy provides a number of utilities for testing physics interactions, including the <code>TestRunner</code> resource and the <code>TestSystem</code> trait.</p>
<p>To write a test for a physics interaction, we can create a new Bevy system that performs the interaction we want to test, and then use the `Test</p>
<h2 id="using-bevys-debug-tools-to-diagnose-physics-issues">Using Bevy’s debug tools to diagnose physics issues</h2>
<p>Bevy provides a number of debugging tools to help diagnose physics issues in a project. One such tool is the <code>DebugLines</code> plugin, which can be used to draw lines and shapes in the game world to help visualize physics interactions.</p>
<p>To use the <code>DebugLines</code> plugin, we need to add it to our Bevy app’s plugins list:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DebugLinesPlugin</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Once we’ve added the <code>DebugLines</code> plugin, we can use the <code>DebugLines</code> resource in our systems to draw lines and shapes:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">draw_debug_line</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">start</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">end</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">debug_lines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">world</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_resource_mut</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">DebugLines</span><span style="color: #ABB2BF">>().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span></code></pre>
<h2 id="conclusion-and-next-steps-4">Conclusion and next steps</h2>
<p>In this chapter, we’ve covered the basics of physics simulation in game development, and how to use Bevy’s physics plugin to implement physics simulation in a Bevy project. We’ve explored concepts such as bodies, shapes, collisions, and forces, and how to use them to create realistic physics interactions in our games.</p>
<p>We’ve also looked at some advanced physics topics such as joints and constraints, raycasting, and performance optimization techniques.</p>
<p>As with any complex system, debugging and testing are important when working with physics simulation. Bevy provides a number of debugging tools</p>
<h2 id="recap-of-key-concepts-and-tools-covered-in-the-chapter-3">Recap of key concepts and tools covered in the chapter</h2>
<p>Sure, here’s a recap of the key concepts and tools covered in this chapter:</p>
<ol>
<li>Physics simulation is the process of modeling real-world physics in a virtual environment.</li>
<li>Bevy’s physics plugin provides a way to simulate physics in a Bevy project.</li>
<li>Bodies are physical objects in a physics simulation that can have mass, velocity, and position.</li>
<li>Shapes define the physical shape of a body and are used for collision detection.</li>
<li>Collisions occur when two bodies intersect, and Bevy’s collision detection system can be used to detect and respond to collisions.</li>
<li>Forces can be applied to bodies to simulate real-world physics such as gravity, friction, and wind.</li>
<li>Joints and constraints are used to simulate complex interactions between bodies, such as a hinge joint for a door.</li>
<li>Raycasting is a technique for detecting collisions between bodies and can be used for more advanced collision detection.</li>
<li>Performance optimization is important when working with physics simulations and managing large numbers of physics objects.</li>
</ol>
<h2 id="suggestions-for-further-learning-and-experimentation-with-bevys-physics-and-collision-detection-capabilities">Suggestions for further learning and experimentation with Bevy’s physics and collision detection capabilities.</h2>
<p>Sure, here are some suggestions for further learning and experimentation with Bevy’s physics and collision detection capabilities:</p>
<ol>
<li>Bevy’s official documentation is a great resource for learning more about the physics plugin and collision detection system. You can find it at <a href="https://bevyengine.org/documentation/physics/">https://bevyengine.org/documentation/physics/</a></li>
<li>The Bevy Examples repository on GitHub contains many examples of physics and collision detection in action. You can find it at <a href="https://github.com/bevyengine/bevy/tree/main/examples">https://github.com/bevyengine/bevy/tree/main/examples</a></li>
<li>Bevy’s community Discord server is a great place to ask questions and get help with implementing physics and collision detection in your projects. You can join at <a href="https://discord.gg/bevy">https://discord.gg/bevy</a></li>
</ol>
<h1 id="chapter-6-audio-and-sound-effects">Chapter 6: Audio and Sound Effects</h1>
<h2 id="playing-background-music-and-sound-effects-with-bevy">Playing background music and sound effects with Bevy</h2>
<p>Here’s an overview of playing background music and sound effects with Bevy:</p>
<p>Bevy has a built-in audio system that allows you to play background music and sound effects in your game. To use the audio system, you need to add the <code>AudioPlugin</code> to your Bevy app’s plugin list.</p>
<p>Here’s an example of how to play background music in Bevy:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">audio</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">play_background_music</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play_looped</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"background_music.mp3"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AudioPlugin</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">play_background_music</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a <code>play_background_music</code> function that plays a music file called “background_music.mp3” on loop. We then add the <code>AudioPlugin</code> to our Bevy app’s plugin list and call the <code>play_background_music</code> function in a startup system.</p>
<p>To play sound effects, you can use the <code>Audio::play</code> method:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">play_sound_effect</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"explosion_sound.mp3"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a <code>play_sound_effect</code> function that plays a sound effect file called “explosion_sound.mp3” once.</p>
<p>You can also adjust the volume and other properties of the audio using the <code>Audio</code> resource.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">play_sound_effect</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sound_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"explosion_sound.mp3"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sound_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_volume</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sound_handle</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we play a sound effect file called “explosion_sound.mp3” at half volume.</p>
<p>That’s a brief overview of how to play background music and sound effects with Bevy’s audio system.</p>
<h2 id="playing-background-music-and-sound-effects-with-bevy-1">Playing background music and sound effects with Bevy</h2>
<p>To play background music and sound effects in your Bevy game, you can use the <code>bevy_kira_audio</code> plugin.</p>
<p>First, add the following lines to your <code>Cargo.toml</code> file to include the plugin as a dependency:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">[</span><span style="color: #61AFEF">dependencies</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #E06C75">bevy_kira_audio</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.3"</span></span></code></pre>
<p>Then, initialize the audio system and load your audio files in the <code>initialize</code> system. Here is an example code:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy_kira_audio</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">AudioChannel</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">AudioPlugin</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AudioPlugin</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup_audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_audio</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load audio files</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">music</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"audio/music.mp3"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sound</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"audio/sound.wav"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Play background music</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play_looped_in_channel</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">music</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">AudioChannel</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"music"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Play sound effect</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play_in_channel</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sound</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">AudioChannel</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"sound"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<h2 id="overview-of-audio-in-game-development-and-its-role-in-creating-immersive-experiences">Overview of audio in game development and its role in creating immersive experiences</h2>
<p>Audio is a critical aspect of game development that plays a significant role in creating immersive experiences. It can add depth and emotion to a game, and is often used to enhance the mood, atmosphere, and storytelling of a game.</p>
<p>There are several different types of audio that are commonly used in game development, including background music, sound effects, voiceovers, and ambient sounds. Each type of audio serves a specific purpose in creating an immersive experience for players.</p>
<p>Background music is often used to set the tone and mood of a game. It can be used to create a sense of tension, excitement, or relaxation, depending on the situation. Sound effects are used to provide feedback to the player, and can include things like footsteps, explosions, or gunfire. Voiceovers are used to convey important information to the player, such as instructions or story elements. Ambient sounds are used to create a sense of atmosphere and immersion, such as the sound of birds chirping in a forest or the hum of machinery in a factory.</p>
<p>In order to create an immersive experience, game developers must carefully consider the use of audio in their games. They must ensure that the audio is high-quality, well-integrated, and serves a specific purpose in the game. By doing so, they can create a more engaging and immersive experience for players, helping them to become fully immersed in the game world.</p>
<h2 id="introduction-to-bevys-audio-capabilities-and-apis">Introduction to Bevy’s audio capabilities and APIs</h2>
<p>Bevy is a powerful game engine that comes with a variety of audio capabilities and APIs to enable game developers to create immersive audio experiences in their games.</p>
<p>The <code>bevy_audio</code> plugin provides a simple and easy-to-use API for playing audio in your game. It supports several types of audio files, including WAV, FLAC, OGG, and MP3.</p>
<p>To use the <code>bevy_audio</code> plugin, you first need to add it as a dependency in your <code>Cargo.toml</code> file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">[</span><span style="color: #61AFEF">dependencies</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #E06C75">bevy_audio</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.3"</span></span></code></pre>
<p>You can then use the <code>AudioPlugin</code> to play audio files in your game. Here is an example code:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy_audio</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AudioPlugin</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load an audio file</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"path/to/audio_file.ogg"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Play the audio</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio_handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p>In the above example, we first add the AudioPlugin to the app to enable audio functionality. Then, in the setup function, we load an audio file using the AssetServer and obtain a handle to it. Finally, we use the Audio resource to play the audio by calling the play method and passing in the audio handle.</p>
<p>You can also control the playback of the audio by adjusting the volume, pitch, or looping settings. For example, you can set the volume of the audio using the set_volume method:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_volume</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio_handle</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>This sets the volume of the audio represented by audio_handle to 0.5 (50% of the original volume).</p>
<p>Similarly, you can adjust the pitch of the audio using the set_pitch method:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">audio.set_pitch(audio_handle, 2.0);</span></span></code></pre>
<h2 id="playing-background-music-and-looping-sound-effects-in-a-bevy-project">Playing background music and looping sound effects in a Bevy project</h2>
<p>To play background music and looping sound effects in your Bevy project, you can use the <code>bevy_audio</code> plugin.</p>
<p>First, add the following lines to your <code>Cargo.toml</code> file to include the plugin as a dependency:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">[</span><span style="color: #61AFEF">dependencies</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #E06C75">bevy_audio</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.3"</span></span></code></pre>
<p>Then, create a <code>Sounds</code> struct to store your audio files, and initialize the audio system and load your audio files in the <code>initialize</code> system. Here is an example code:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy_audio</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">AudioPlugin</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Sounds</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">background_music</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">loop_sound</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AudioPlugin</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup_audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_audio</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sounds</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Sounds</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">sounds</span><span style="color: #ABB2BF">.background_music </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"path/to/background_music.mp3"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">sounds</span><span style="color: #ABB2BF">.loop_sound </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"path/to/loop_sound.wav"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play_looped</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sounds</span><span style="color: #ABB2BF">.background_music.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Play the looping sound effect</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play_looped</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sounds</span><span style="color: #ABB2BF">.loop_sound.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we create a <code>Sounds</code> struct to hold our audio files, load them in the <code>setup_audio</code> function using the <code>AssetServer</code>, and play the background music and the looping sound effect using the <code>Audio</code> resource’s <code>play_looped</code> method.</p>
<p>Note that the <code>play_looped</code> method will play the audio file in a loop until it is explicitly stopped.</p>
<h2 id="understanding-audio-formats-and-encoding">Understanding audio formats and encoding</h2>
<p>Audio formats refer to the way audio data is stored and encoded. There are several different audio formats, each with its own advantages and disadvantages, depending on the intended use case.</p>
<p>The most common audio formats used in game development are WAV, FLAC, OGG, and MP3. WAV is an uncompressed audio format that provides high-quality audio but can result in large file sizes. FLAC is a lossless audio format that provides high-quality audio with smaller file sizes than WAV. OGG is a compressed audio format that provides high-quality audio with even smaller file sizes than FLAC. MP3 is a compressed audio format that provides moderate quality audio with very small file sizes.</p>
<p>Audio encoding refers to the process of converting audio data from one format to another. Audio can be encoded using several different algorithms, each with its own</p>
<h2 id="overview-of-common-audio-formats-and-their-strengths-and-weaknesses">Overview of common audio formats and their strengths and weaknesses</h2>
<p>There are several common audio formats used in game development, each with its own strengths and weaknesses. Here is an overview of some of the most common audio formats:</p>
<ol>
<li>
<p>WAV (Waveform Audio File Format): WAV is an uncompressed audio format that provides high-quality audio but can result in large file sizes. It is commonly used for storing audio recordings and music production due to its lossless nature.</p>
</li>
<li>
<p>FLAC (Free Lossless Audio Codec): FLAC is a lossless audio format that provides high-quality audio with smaller file sizes than WAV. It is commonly used in game development due to its ability to compress audio without losing quality.</p>
</li>
<li>
<p>OGG (Ogg Vorbis): OGG is a compressed audio format that provides high-quality audio with even smaller file sizes than FLAC. It is commonly used in game development due to its open-source nature and ability to compress audio files to a smaller size than other formats.</p>
</li>
<li>
<p>MP3 (MPEG-1 Audio Layer 3): MP3 is a compressed audio format that provides moderate quality audio with very small file sizes. It is commonly used for streaming music and audio due to its small file size and ability to maintain a decent level of audio quality.</p>
</li>
</ol>
<p>Each audio format has its own strengths and weaknesses, and the choice of format will depend on the specific needs of the game developer. For example, a game with a lot of audio files may benefit from using a compressed format such as OGG or MP3 to save disk space, while a game that values high-quality audio may choose to use an uncompressed format like WAV.</p>
<h2 id="techniques-for-encoding-and-compressing-audio-files-for-use-in-a-game">Techniques for encoding and compressing audio files for use in a game</h2>
<p>Encoding and compressing audio files is an important step in game development to ensure that the game runs smoothly and efficiently. Here are some techniques for encoding and compressing audio files for use in a game:</p>
<ol>
<li>
<p>Use a lossless compression algorithm: Lossless compression algorithms like FLAC can compress audio files without losing any quality. This can be useful for audio files that need to maintain a high level of quality, such as music tracks.</p>
</li>
<li>
<p>Use a lossy compression algorithm: Lossy compression algorithms like MP3 can compress audio files to a much smaller size by removing some of the audio data. This can be useful for sound effects or other audio files that do not need to maintain a high level of quality.</p>
</li>
<li>
<p>Use sample rate reduction: Reducing the sample rate of an audio file can reduce its file size without affecting its overall quality too much. This technique can be useful for audio files that do not require a high level of fidelity, such as background music.</p>
</li>
<li>
<p>Use mono audio: Mono audio files take up less space than stereo audio files. If the audio file is intended to be played through a single speaker or in-game object, using a mono audio file can reduce its file size.</p>
</li>
<li>
<p>Consider audio streaming: Streaming audio can reduce the amount of memory required to play audio in the game by only loading parts of the audio file that are needed. This can help to reduce memory usage and improve performance.</p>
</li>
</ol>
<p>By using these techniques, game developers can encode and compress audio files in a way that balances quality and efficiency, helping to create a better gaming experience for the player.</p>
<h2 id="integrating-audio-with-bevys-ecs-architecture">Integrating audio with Bevy’s ECS architecture</h2>
<p>Integrating audio with Bevy’s ECS architecture is a straightforward process that involves using Bevy’s audio system and components. Here are the basic steps to integrate audio with Bevy:</p>
<ol>
<li>
<p>Add the <code>AudioPlugin</code> to your Bevy app: This plugin initializes Bevy’s audio system and should be added to your Bevy app’s plugins.</p>
</li>
<li>
<p>Load audio files: Use the <code>AssetServer</code> resource to load audio files into your Bevy app. Bevy supports several audio formats, including WAV, FLAC, OGG, and MP3.</p>
</li>
</ol>
<h2 id="creating-and-managing-audio-sources-and-listeners-in-a-bevy-project">Creating and managing audio sources and listeners in a Bevy project</h2>
<p>In Bevy, audio sources and listeners are represented by components that can be added to entities in your game world. Here are the basic steps to create and manage audio sources and listeners in a Bevy project:</p>
<ol>
<li>Add the <code>Audio</code> component to an entity to create an audio source: The <code>Audio</code> component is used to create an audio source. You can set the audio file to be played, the volume, and other properties using the <code>AudioSource</code> struct.</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">create_audio_source</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load an audio file</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sound_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"sound_effects/jump.wav"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create an audio source component</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sound_handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add the audio source component to an entity</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="2">
<li>Add the <code>Listener</code> component to an entity to create an audio listener: The <code>Listener</code> component is used to create an audio listener. You can set the position and other properties of the listener using the <code>Transform</code> struct.</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">create_audio_listener</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create an entity for the listener</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Listener</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Set the position of the listener</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="3">
<li>Play and manage audio sources: Once an audio source has been created, you can play it using the <code>play</code> method of the <code>Audio</code> resource. You can also stop, pause, or resume an audio source using the corresponding methods.</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">play_audio</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Play all audio sources in the query</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>By using these components and methods, you can create and manage audio sources and listeners in your Bevy project.</p>
<h2 id="implementing-audio-effects-like-filters-and-reverb">Implementing audio effects like filters and reverb</h2>
<p>Bevy provides built-in support for audio effects like filters and reverb, which can be used to enhance the quality and realism of audio in your game. Here’s how to implement audio effects in a Bevy project:</p>
<ol>
<li>Add an <code>EffectSettings</code> component to an audio source: The <code>EffectSettings</code> component is used to configure audio effects like filters and reverb. You can use this component to set the parameters for the effect, such as the cutoff frequency for a filter or the decay time for reverb.</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">audio</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">AudioPlugin</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">create_audio_source_with_filter</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load an audio file</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sound_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"sound_effects/jump.wav"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create an audio source component</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sound_handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add a low-pass filter to the audio source</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_filter</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Filter</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">filter_type</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">FilterType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">LowPass</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">cutoff_hz</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">5000.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">resonance</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">    }));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add the audio source component to an entity</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="2">
<li>Add an <code>Effect</code> component to the audio output: The <code>Effect</code> component is used to apply audio effects to the audio output. You can use this component to set the type of effect to apply, such as a reverb effect.</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">audio</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">AudioPlugin</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add_reverb_to_audio_output</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add a reverb effect to the audio output</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_effect</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Effect</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">effect_type</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EffectType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Reverb</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">room_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">damping</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">spread</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">order</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>By using these components and methods, you can implement audio effects like filters and reverb in your Bevy project to enhance the quality and realism of audio.</p>
<h2 id="using-bevys-audio-system-to-synchronize-audio-playback-with-game-events-and-actions">Using Bevy’s audio system to synchronize audio playback with game events and actions</h2>
<p>Bevy’s audio system provides a variety of tools to synchronize audio playback with game events and actions. Here are some techniques you can use:</p>
<ol>
<li>Trigger audio playback with events: Bevy’s event system can be used to trigger audio playback in response to game events. For example, you can play a sound effect when the player collects a coin:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">audio</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">AudioPlugin</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">CoinCollected</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">play_coin_sound_effect</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">coin_collected_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">CoinCollected</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">coin_collected_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sound</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"sound_effects/coin.wav"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sound</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a <code>CoinCollected</code> event and use an <code>EventReader</code> to listen for the event. When the event is triggered, we load and play a sound effect using the <code>Audio</code> resource.</p>
<ol start="2">
<li>Use audio tracks to synchronize with game actions: Audio tracks are a useful tool for synchronizing audio playback with game actions. For example, you can create an audio track that plays a sound effect at a specific point in time:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">audio</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">AudioPlugin</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">AudioTrack</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">AudioClip</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">play_sound_effect_on_audio_track</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load the sound effect</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sound_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"sound_effects/teleport.wav"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sound_clip</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AudioClip</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sound_handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create an audio source</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sound_clip</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_volume</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create an audio track that plays the sound effect at 1 second</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_track</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AudioTrack</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_track</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_sound_at_time</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">sound_clip</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add the audio source and track to an entity</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75">audio_source</span><span style="color: #ABB2BF">,))</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio_track</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we create an <code>AudioClip</code> from a sound effect and use it to create an <code>AudioSource</code>. We then create an <code>AudioTrack</code> that plays the sound effect at 1 second and add it to the entity along with the <code>AudioSource</code>. The <code>Audio</code> resource will automatically play the sound effect at the appropriate time.</p>
<p>By using these techniques, you can synchronize audio playback with game events and actions to create a more immersive and engaging experience for your players.</p>
<h2 id="advanced-audio-topics-in-bevy">Advanced audio topics in Bevy</h2>
<p>Bevy’s audio system provides a wide range of advanced features and capabilities. Here are some advanced topics you can explore:</p>
<ol>
<li>
<p>3D audio: Bevy supports 3D audio, which allows you to create immersive soundscapes that respond to the player’s movements and orientation. You can use Bevy’s <code>Transform</code> component to position and orient audio sources in 3D space, and the <code>AudioListener</code> resource to represent the player’s position and orientation. Bevy’s <code>AudioSource</code> component also provides a <code>distance_model</code> property that allows you to control how sound volume and attenuation change with distance.</p>
</li>
<li>
<p>Dynamic audio generation: Bevy’s <code>AudioClip</code> struct allows you to generate audio data dynamically using Rust code. You can create custom sound effects or music tracks that respond to game events or player input in real-time.</p>
</li>
<li>
<p>Audio mixing and effects: Bevy’s audio system provides a range of built-in effects, including filters, equalizers, and reverb. You can use these effects to modify the sound of individual sources or apply them to the entire mix. Bevy’s <code>AudioBus</code> resource allows you to group audio sources and apply effects to the group.</p>
</li>
<li>
<p>Streaming audio: Bevy’s <code>AudioSource</code> component supports streaming audio from files or URLs. This allows you to play large audio files or music tracks without loading the entire file into memory at once.</p>
</li>
</ol>
<p>By exploring these advanced topics, you can create even more immersive and dynamic audio experiences in your Bevy projects.</p>
<h2 id="working-with-positional-audio-to-create-3d-soundscapes">Working with positional audio to create 3D soundscapes</h2>
<p>In Bevy, you can use positional audio to create immersive 3D soundscapes. This involves placing audio sources in a 3D space and adjusting their volume and attenuation based on their distance from the listener.</p>
<p>Here’s how you can create positional audio in a Bevy project:</p>
<ol>
<li>Position the audio sources: First, you need to position your audio sources in 3D space using Bevy’s <code>Transform</code> component. You can use the <code>Transform</code> component to set the position, rotation, and scale of the audio source entity. For example,</li>
</ol>
<h2 id="implementing-dynamic-music-systems-that-respond-to-player-actions-and-events">Implementing dynamic music systems that respond to player actions and events</h2>
<p>Dynamic music systems can greatly enhance the player’s experience by creating music that adapts to their actions and the events happening in the game. Bevy provides several features and tools that can help you implement dynamic music systems in your game.</p>
<p>Here’s how you can implement a dynamic music system in a Bevy project:</p>
<ol>
<li>
<p>Define music tracks and themes: Start by defining your music tracks and themes. Each theme should represent a specific mood or emotion that you want to convey, and each track should be associated with one or more themes.</p>
</li>
<li>
<p>Create a music manager: Next, create a music manager system that will manage the playback of your music. The music manager should keep track of the current music theme and track, and should respond to game events by selecting and playing the appropriate music.</p>
</li>
<li>
<p>Create music events: Define game events that trigger changes in the music, such as entering a new area, encountering an enemy, or completing a task. When these events occur, the music manager should select and play a new music track that matches the current theme.</p>
</li>
<li>
<p>Use dynamic music generation: Bevy’s <code>AudioClip</code> struct allows you to generate audio data dynamically using Rust code. You can use this feature to create music tracks that respond to game events or player input in real-time. For example, you could create a dynamic music track that changes based on the player’s speed or the intensity of the action.</p>
</li>
</ol>
<p>By combining these techniques, you can create a dynamic music system that adapts to the player’s actions and creates a truly immersive game experience.</p>
<h2 id="optimizing-audio-performance-and-managing-large-numbers-of-audio-sources-and-effects">Optimizing audio performance and managing large numbers of audio sources and effects</h2>
<p>When working with audio in a game, it’s important to optimize performance and manage large numbers of audio sources and effects to ensure that your game runs smoothly and doesn’t cause excessive CPU usage. Here are some tips for optimizing audio performance and managing large numbers of audio sources and effects in a Bevy project:</p>
<ol>
<li>
<p>Use audio resource pooling: Instead of creating and destroying audio sources dynamically, consider using a pool of pre-allocated audio sources that can be reused as needed. This reduces the overhead of creating and destroying audio sources, which can help to improve performance.</p>
</li>
<li>
<p>Limit the number of active audio sources: To avoid overloading the CPU, it’s important to limit the number of active audio sources in your game. You can use Bevy’s <code>AudioBus</code> resource to group audio sources and apply effects to the group. You can also use Bevy’s <code>AudioSystem</code> to dynamically adjust the volume and attenuation of audio sources based on their distance from the listener.</p>
</li>
<li>
<p>Use compressed audio formats: Compressed audio formats such as Ogg Vorbis or MP3 are smaller in size than uncompressed formats like WAV or AIFF. This can help to reduce memory usage and improve performance.</p>
</li>
<li>
<p>Use lower quality audio for background music: Background music typically doesn’t need to be as high quality as sound effects, since it’s often played at a lower volume and doesn’t need to be as precise. You can use lower quality audio files or lower the bitrate for background music to help reduce memory usage and improve performance.</p>
</li>
</ol>
<p>By using these techniques, you can optimize audio performance and manage large numbers of audio sources and effects in your Bevy project.</p>
<h2 id="debugging-and-testing-audio-in-a-bevy-project">Debugging and testing audio in a Bevy project</h2>
<p>Debugging and testing audio can be challenging, as it’s not always immediately clear what’s causing audio issues. Here are some tips for debugging and testing audio in a Bevy project:</p>
<ol>
<li>
<p>Check audio files: Make sure that your audio files are in a supported format and that they’re not corrupted. You can use an audio editor or a file inspector to check the audio files.</p>
</li>
<li>
<p>Check audio settings: Make sure that the audio settings in your game are configured correctly. For example, check that the audio is not muted or that the volume is not set to zero.</p>
</li>
<li>
<p>Check audio sources: Check that audio sources are properly set up and attached to entities. You can use the Bevy <code>AudioSystem</code> to debug audio sources and check their properties, such as volume, pitch, and position.</p>
</li>
<li>
<p>Use debug visualizations: Bevy provides debug visualizations for audio, such as the <code>AudioDebugPlugin</code>, which can display the positions and volumes of audio sources and listeners in the game world. This can help you visualize how audio is being played and debug any issues.</p>
</li>
<li>
<p>Use headphones: Use headphones when testing audio to ensure that the audio is being played correctly and to avoid interference from external sounds.</p>
</li>
</ol>
<p>By using these techniques, you can debug and test audio in your Bevy project to ensure that it’s working correctly and providing an immersive experience for players.</p>
<h2 id="writing-tests-for-audio-playback-and-synchronization-logic">Writing tests for audio playback and synchronization logic</h2>
<p>When working with audio playback and synchronization logic, it’s important to write tests to ensure that the audio is being played back correctly and that it’s synchronized with the game events and actions. Here are some tips for writing tests for audio playback and synchronization logic in a Bevy project:</p>
<ol>
<li>
<p>Use the Bevy <code>TestPlugin</code>: The <code>TestPlugin</code> provides utilities for testing Bevy systems, resources, and components. You can use it to create tests for your audio playback and synchronization logic.</p>
</li>
<li>
<p>Write unit tests for individual audio systems: Write unit tests for individual audio systems, such as the audio source and listener systems, to ensure that they’re working correctly.</p>
</li>
<li>
<p>Write integration tests for audio playback and synchronization: Write integration tests that simulate game events and actions that trigger audio playback, and check that the audio is being played back correctly and synchronized with the game events.</p>
</li>
<li>
<p>Use test fixtures for audio files: Use test fixtures to provide sample audio files for your tests, so that you can ensure that the audio files are in a supported format and that they’re not corrupted.</p>
</li>
<li>
<p>Use mock objects for testing: Use mock objects to simulate game events and actions, so that you can test the audio playback and synchronization logic without having to run the entire game.</p>
</li>
</ol>
<p>By using these techniques, you can write tests for your audio playback and synchronization logic in your Bevy project, which can help you catch bugs early and ensure that your game provides a high-quality audio experience for players.</p>
<h2 id="using-bevys-debug-tools-to-diagnose-audio-issues">Using Bevy’s debug tools to diagnose audio issues</h2>
<p>Bevy provides a number of built-in debug tools that can be useful for diagnosing audio issues in your game. Here are some ways you can use these tools to diagnose audio issues:</p>
<ol>
<li>
<p>Audio Debug Plugin: The Audio Debug Plugin provides a visual representation of audio sources and listeners in your game world. It can show you the position and volume of each audio source, and allow you to adjust their settings in real time. This can be useful for identifying issues with audio positioning, volume, and other properties.</p>
</li>
<li>
<p>Bevy Profiler: The Bevy Profiler is a tool that allows you to analyze the performance of your game in real-time. It can help you identify performance issues that may be impacting your audio, such as high CPU usage or memory usage.</p>
</li>
</ol>
<h2 id="conclusion-and-next-steps-5">Conclusion and next steps</h2>
<p>In this book, we’ve covered a variety of topics related to audio in game development with Bevy. We started by discussing the role of audio in creating immersive experiences, and then delved into the technical details of audio formats, encoding, and compression.</p>
<p>We then explored Bevy’s audio capabilities and APIs, and learned how to play background music and sound effects, create and manage audio sources and listeners, and implement audio effects like filters and reverb.</p>
<p>We also looked at more advanced topics like using positional audio to create 3D soundscapes and implementing dynamic music systems that respond to player actions and events. Finally, we discussed how to optimize audio performance and debug and test audio in a Bevy project.</p>
<p>As you continue to work with audio in your Bevy projects, there are many more topics to explore, such as working with MIDI files, integrating with third-party audio engines, and creating custom audio effects.</p>
<p>Next steps for you might include experimenting with these topics and incorporating audio into your own game projects. Remember, audio is an essential component of any game, and with Bevy’s powerful audio capabilities, you have the tools you need to create immersive, high-quality audio experiences for your players.</p>
<h2 id="recap-of-key-concepts-and-tools-covered-in-the-chapter-4">Recap of key concepts and tools covered in the chapter</h2>
<p>Sure! Here’s a recap of some of the key concepts and tools covered in this chapter:</p>
<ul>
<li>Audio formats and encoding: We discussed the different types of audio formats and how they are encoded, including WAV, MP3, and Ogg Vorbis.</li>
<li>Bevy’s audio system: Bevy provides a built-in audio system that allows you to play sounds and music, apply filters and effects, and more.</li>
<li>Audio sources and listeners: We covered how to create and manage audio sources and listeners in a Bevy project, and how to use them to create spatial audio effects.</li>
<li>Audio effects</li>
</ul>
<h2 id="suggestions-for-further-learning-and-experimentation-with-bevys-audio-capabilities">Suggestions for further learning and experimentation with Bevy’s audio capabilities.</h2>
<p>If you’re interested in learning more about Bevy’s audio capabilities and experimenting with them further, here are some suggestions:</p>
<ol>
<li>
<p>Read the Bevy Audio Guide: Bevy’s official documentation includes a comprehensive guide to working with audio in Bevy. This guide covers a wide range of topics, from playing sounds and music to implementing 3D audio and creating custom audio effects.</p>
</li>
<li>
<p>Experiment with different audio formats and settings: Try</p>
</li>
</ol>
<h1 id="chapter-7-user-interface-and-menus">Chapter 7: User Interface and Menus</h1>
<h2 id="creating-menus-and-user-interfaces-with-bevy">Creating menus and user interfaces with Bevy</h2>
<p>Sure, here’s an overview of creating menus and user interfaces with Bevy:</p>
<ol>
<li>
<p>Plan your interface: Before starting to code, it’s a good idea to plan out your interface by sketching it on paper or using a design tool. Consider what elements you need (e.g. buttons, sliders, text labels) and how they will be arranged.</p>
</li>
<li>
<p>Create a UI plugin: Bevy does not come with built-in UI functionality, but it does provide a plugin system that allows you to easily extend its capabilities. You can create a</p>
</li>
</ol>
<h2 id="overview-of-the-role-of-ui-in-game-development-and-creating-an-engaging-user-experience">Overview of the role of UI in game development and creating an engaging user experience</h2>
<p>The user interface (UI) is an essential component of any game, as it is the primary means by which players interact with the game world. A well-designed UI can make a game more engaging and immersive, while a poorly-designed UI can frustrate players and detract from the overall experience.</p>
<p>The role of UI in game development is multi-faceted. Firstly, it provides players with information about the game world, such as health and ammo levels, map information, and objective markers. Secondly, it allows players to interact with the game world, such as selecting weapons or items, moving characters, and opening doors. Finally, it can enhance the overall aesthetic of the game, by using visual and auditory elements to create an immersive atmosphere.</p>
<p>To create an engaging user experience, it’s important to design your UI with the player in mind. This means considering factors such as the target audience, the type of game, and the platform on which the game will be played. It’s also important to consider usability and accessibility, ensuring that the UI is intuitive and easy to use, and can be accessed by players with different abilities.</p>
<p>In summary, the UI is an essential component of game development, and a well-designed UI can enhance the player experience and make a game more engaging and immersive.</p>
<h2 id="introduction-to-bevys-ui-system-and-apis">Introduction to Bevy’s UI system and APIs</h2>
<p>Bevy does not come with built-in UI functionality, but it does provide a plugin system that allows you to easily extend its capabilities. The most popular UI plugin for Bevy is called “bevy_egui”, which is a wrapper around the popular immediate mode GUI library “egui”.</p>
<p>To use bevy_egui, you need to add it to your project’s dependencies in Cargo.toml. Then, you can create an EguiContext resource in your Bevy app’s startup system, which will initialize the Egui context:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">App::build()</span></span>
<span class="line"><span style="color: #abb2bf">    .add_plugins(DefaultPlugins)</span></span>
<span class="line"><span style="color: #abb2bf">    .add_plugin(EguiPlugin)</span></span>
<span class="line"><span style="color: #abb2bf">    .add_startup_system(setup.system())</span></span>
<span class="line"><span style="color: #abb2bf">    .run();</span></span></code></pre>
<p>With the Egui context set up, you</p>
<h2 id="creating-basic-menus-and-ui-elements-with-bevys-built-in-components">Creating basic menus and UI elements with Bevy’s built-in components</h2>
<p>As mentioned earlier, Bevy does not come with built-in UI functionality, but it does provide some basic components that can be used to create simple UI elements, such as buttons and text labels.</p>
<p>One of the most useful built-in components for UI is <code>Transform</code>, which is used to position and scale entities in 2D or 3D space. By attaching <code>Transform</code> components to entities, you can easily position them on the screen.</p>
<p>Another important built-in component for UI is <code>Sprite</code>, which is used to render images on the screen. You can use sprites to create buttons, icons, or other graphical elements.</p>
<p>Here’s an example of how to create a simple button using Bevy’s built-in components:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">// Create a new entity and attach a Transform component to it</span></span>
<span class="line"><span style="color: #abb2bf">commands.spawn_bundle(UiButtonBundle::new(button_style))</span></span>
<span class="line"><span style="color: #abb2bf">        .insert(UiButtonAction::new(action))</span></span>
<span class="line"><span style="color: #abb2bf">        .insert(UiButtonText::new(text))</span></span>
<span class="line"><span style="color: #abb2bf">        .insert(Transform::from_translation(Vec3::new(x, y, 0.0)));</span></span></code></pre>
<p>In this example, <code>UiButtonBundle</code> is a convenience struct that combines several Bevy components into a single bundle. <code>UiButtonAction</code> and <code>UiButtonText</code> are components that define the behavior and text of the button, respectively.</p>
<p>With these components in place, you can create a basic UI layout by positioning entities using <code>Transform</code> components and rendering images using <code>Sprite</code> components. While this approach can be useful for simple UI layouts, it can quickly become unwieldy for more complex interfaces.</p>
<p>That’s where third-party UI libraries like Egui come in - they provide more advanced tools for creating and managing complex UI layouts.</p>
<h2 id="managing-ui-elements-with-bevys-built-in-ui-components">Managing UI elements with Bevy’s built-in UI components</h2>
<p>Bevy’s built-in UI components provide a simple way to create basic UI elements such as buttons, text labels, and images. However, as UI complexity grows, it can become challenging to manage and manipulate the individual components directly.</p>
<p>To address this challenge, Bevy includes a set of higher-level components and bundles designed specifically for UI development. These components include:</p>
<ul>
<li><code>Parent</code>: allows you to create a parent-child relationship between entities, which can be used to group UI elements together and manage their layout.</li>
</ul>
<h2 id="overview-of-bevys-ui-components-and-their-usage-in-creating-complex-ui-layouts">Overview of Bevy’s UI components and their usage in creating complex UI layouts</h2>
<p>Bevy provides a range of UI components that can be used to create complex UI layouts. These components can be used in combination with Bevy’s ECS architecture to create scalable and extensible UI systems.</p>
<p>Some of the key UI components in Bevy include:</p>
<ul>
<li><code>Text</code>: renders text on the screen, using a specified font and color.</li>
<li><code>Image</code>: renders an image on the screen, using a specified texture and scaling factor.</li>
<li><code>Button</code>: provides a clickable button that can trigger events or actions.</li>
<li><code>Checkbox</code>: provides a checkbox that can be toggled on or off.</li>
<li><code>Slider</code>: provides a slider control that can be used to adjust a numeric value.</li>
<li><code>TextInput</code>: provides a text input field that can be used to enter text.</li>
</ul>
<p>In addition to these basic UI components, Bevy also provides several higher-level UI components that can be used to create more complex layouts. These components include:</p>
<ul>
<li><code>Container</code>: a layout container that can be used to group and arrange UI elements.</li>
<li><code>Flex</code>: a flexible layout container that can be used to create responsive layouts.</li>
<li><code>Scrollable</code>: a container that provides scrolling functionality for a group of UI elements.</li>
</ul>
<p>Using these components, you can create complex UI layouts that respond dynamically to user input and events. For example, you can create a menu system that opens and closes different sub-menus based on button clicks, or a game HUD that displays important information such as health and score.</p>
<h2 id="implementing-custom-styles-and-themes-for-ui-elements-in-a-bevy-project">Implementing custom styles and themes for UI elements in a Bevy project</h2>
<p>Bevy provides a flexible and customizable system for styling and theming UI elements in a project. By default, UI elements are styled using a set of built-in styles, but these styles can be easily customized or replaced with your own custom styles.</p>
<p>To customize the style of a UI element, you can create a new <code>Style</code> component and attach it to the entity that represents the UI element. The <code>Style</code> component includes properties for defining the element’s appearance, such as its background color, border style, font, and so on.</p>
<p>For example, to create a custom style for a button, you might define a new struct that implements the <code>Style</code> trait, like so:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">struct MyButtonStyle {</span></span>
<span class="line"><span style="color: #abb2bf">    background_color: Color,</span></span>
<span class="line"><span style="color: #abb2bf">    text_color: Color,</span></span>
<span class="line"><span style="color: #abb2bf">    // ... other style properties ...</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">impl Style for MyButtonStyle {</span></span>
<span class="line"><span style="color: #abb2bf">    fn apply(&#x26;mut self, _style: &#x26;Style) {</span></span>
<span class="line"><span style="color: #abb2bf">        // Apply the style properties to the button element</span></span>
<span class="line"><span style="color: #abb2bf">        // ...</span></span>
<span class="line"><span style="color: #abb2bf">    }</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>You can then create a new <code>MyButtonStyle</code> instance and attach it to the button entity, like so:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">commands.spawn(ButtonBundle::default())</span></span>
<span class="line"><span style="color: #abb2bf">    .with(MyButtonStyle {</span></span>
<span class="line"><span style="color: #abb2bf">        background_color: Color::rgb(0.8, 0.2, 0.2),</span></span>
<span class="line"><span style="color: #abb2bf">        text_color: Color::WHITE,</span></span>
<span class="line"><span style="color: #abb2bf">        // ... other style properties ...</span></span>
<span class="line"><span style="color: #abb2bf">    });</span></span></code></pre>
<p>This</p>
<h2 id="using-bevys-layout-system-to-manage-and-arrange-ui-elements-in-a-flexible-and-responsive-manner">Using Bevy’s layout system to manage and arrange UI elements in a flexible and responsive manner</h2>
<p>Bevy’s layout system is a powerful tool for managing and arranging UI elements in a flexible and responsive manner. It allows you to define the layout of your UI elements in terms of rules and constraints, rather than fixed positions and sizes. This makes it easy to create UIs that adjust to different screen sizes and aspect ratios, and that can adapt to different content and user interactions.</p>
<p>To use Bevy’s layout system, you can attach a <code>Layout</code> component to the entity that represents your UI element. The <code>Layout</code> component includes properties for defining the element’s position, size, and alignment, as well as rules for how it should adjust to changes in its parent container or the screen size.</p>
<p>For example, you might define a <code>Layout</code> component for a button like so:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">commands.spawn(ButtonBundle::default())</span></span>
<span class="line"><span style="color: #abb2bf">    .with(Layout::default()</span></span>
<span class="line"><span style="color: #abb2bf">        .size(Size::new(Length::Units(100), Length::Units(50)))</span></span>
<span class="line"><span style="color: #abb2bf">        .position(Position::new(Align::Center, Align::Center))</span></span>
<span class="line"><span style="color: #abb2bf">    );</span></span></code></pre>
<p>This would create a button that is 100 pixels wide and 50 pixels high, and that is centered both horizontally and vertically within its parent container. If the screen size changes, the button will automatically adjust its position and size to maintain its alignment and proportions.</p>
<p>Bevy’s layout system also includes support for flexible and grid-based layouts, as well as constraints that allow you to define minimum and maximum sizes, aspect ratios, and other properties. This makes it easy to create complex and responsive UIs that can adapt to a wide range of devices and screen sizes.</p>
<h2 id="adding-interactivity-to-user-interfaces-and-menus">Adding interactivity to user interfaces and menus</h2>
<p>Adding interactivity to user interfaces and menus is an important part of creating engaging user experiences in games. Bevy provides a number of tools and components for adding interactivity to UI elements, including buttons, sliders, text fields, and more.</p>
<p>To add interactivity to a button, for example, you can attach a <code>Button</code> component to its entity and register a system that listens for <code>ButtonInteraction</code> events. Here’s an example of how to do this:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">button_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">interaction_query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">, (</span><span style="color: #E5C07B">Changed</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">>, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Button</span><span style="color: #ABB2BF">>)>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">interaction</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">interaction_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">interaction</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Clicked</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // Handle button click event here</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => {}</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code defines a system that listens for</p>
<h2 id="responding-to-user-input-and-events-in-bevys-ui-system">Responding to user input and events in Bevy’s UI system</h2>
<p>Bevy’s UI system provides a number of ways to respond to user input and events. One approach is to use the <code>Interaction</code> component, which tracks the state of a UI element (e.g., whether it is being hovered over, clicked, etc.) and emits events when its state changes.</p>
<p>To respond to <code>Interaction</code> events, you can register a system that listens for changes to <code>Interaction</code> components on relevant entities. Here’s an example of how to do this for a button:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">button_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">interaction_query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">, (</span><span style="color: #E5C07B">Changed</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">>, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Button</span><span style="color: #ABB2BF">>)>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">interaction</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">interaction_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">interaction</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Clicked</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // Handle button click event here</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => {}</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code defines a system that listens for changes to <code>Interaction</code> components on entities with a <code>Button</code> component. When a button is clicked, the system will execute the code in the <code>Clicked</code> branch of the <code>match</code> statement.</p>
<p>You can use a similar approach to respond to other UI events, such as changes to text fields, sliders, or drop-down menus. By registering systems that listen for relevant events, you can create dynamic and responsive user interfaces that enhance the overall game experience.</p>
<h2 id="creating-interactive-ui-elements-like-buttons-and-sliders">Creating interactive UI elements like buttons and sliders</h2>
<p>Bevy’s UI system provides several built-in components for creating interactive UI elements like buttons, sliders, and checkboxes. Here’s an example of how to create a basic button using Bevy’s <code>Button</code> component:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load button texture</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_texture</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"textures/button.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a button entity with a transform, sprite, and button component</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">margin</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">all</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Auto</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">justify_content</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">JustifyContent</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">button_texture</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we load a button texture using Bevy’s <code>AssetServer</code>, and then create a button entity using <code>ButtonBundle</code>. The <code>ButtonBundle</code> includes a <code>Style</code> component that defines the size and position of the button, a <code>Sprite</code> component that sets the button’s texture, and a <code>Button</code> component that enables the button to respond to user input.</p>
<p>To add functionality to the button, we can register a system that listens for changes to the button’s <code>Interaction</code> component, as shown in the previous answer. We can also use Bevy’s built-in <code>Text</code> component to add a label to the button:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load button texture and font</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_texture</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"textures/button.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"fonts/FiraSans-Bold.ttf"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a button entity with a transform, sprite, and button component</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">margin</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">all</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Auto</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">justify_content</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">JustifyContent</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">button_texture</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add label to button</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"Click me!"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">30.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code adds a <code>TextBundle</code> component to the button entity, which includes a <code>Text</code> component that defines the label’s text and style. With these changes, the button should now display the text “Click me!” on top of the button texture.</p>
<p>You can create other types of interactive UI elements, like sliders and checkboxes, using similar techniques with Bevy’s built-in components. By combining these elements with event handling code, you can create a variety of dynamic and engaging user interfaces for your game.</p>
<p>Great! Continuing from the event handling code, you can create a variety of dynamic and engaging user interfaces for your game. Let’s take a look at an example of how to use event handling to create an interactive button that changes color when the user hovers over it.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ui</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">widget</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Button</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a new button entity</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_entity</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add a text label to the button</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_entity</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">with_section</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">"Click me!"</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"fonts/FiraSans-Bold.ttf"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">    ));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add a custom button style</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_entity</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">normal</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">hover</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.7</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add a hover event handler to change the button color</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_entity</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">HoverEvents</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">EventReceiver</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">HoverEvents</span><span style="color: #ABB2BF">>::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add a system to change the button color on hover</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">insert_system_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">change_color_on_hover</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">change_color_on_hover</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">HoverEvents</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ButtonStyle</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Iterate over all hover events</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Change the color of all buttons that received a hover event</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">.normal </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">hovered</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.7</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            };</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we create a new button entity and add a text label to it. We also add a custom button style that defines the normal and hover states of the button. We then add a hover event handler to the button entity, which will trigger whenever the user hovers over the button. Finally, we define a system that changes the color of the button when the hover event is received.</p>
<h2 id="using-bevys-event-system-to-trigger-game-actions-and-events-from-ui-elements">Using Bevy’s event system to trigger game actions and events from UI elements</h2>
<p>Bevy’s event system is a powerful tool that can be used to trigger game actions and events from UI elements. With the event system, you can create custom events that are triggered when a user interacts with a UI element, such as clicking a button or sliding a slider. These events can then be used to trigger game actions, such as moving a character or spawning an object.</p>
<p>To create a custom event, you can define a new struct that implements the <code>Event</code> trait. For example, let’s say we want to create a custom event that is triggered when the user clicks a button. We could define the following struct:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Debug</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Clone</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ButtonClickedEvent</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">button_entity</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this case, we’ve defined a <code>ButtonClickedEvent</code> struct that contains the entity ID of the button that was clicked. We can then create a system that listens for this event and triggers the appropriate game action. For example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">handle_button_click</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ButtonClickedEvent</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #E5C07B">Button</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.button_entity) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Trigger game action based on button click</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this system, we use an <code>EventReader</code> to listen for <code>ButtonClickedEvent</code> events. We also use a <code>Query</code> to retrieve the <code>Button</code> component for the button that was clicked, based on the entity ID stored in the event. Finally, we can trigger the appropriate game action based on the button click.</p>
<p>To trigger the custom event when the user clicks the button, we can use a combination of the <code>Interactable</code> and <code>Interaction</code> components, along with the <code>EventWriter</code> resource. For example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_ui</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventWriter</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ButtonClickedEvent</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a button entity</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_entity</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">margin</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">left</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Auto</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">right</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Auto</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">top</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">bottom</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Auto</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                },</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">RED</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"Click me!"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"fonts/FiraSans-Bold.ttf"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">30.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                    },</span></span>
<span class="line"><span style="color: #ABB2BF">                    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                },</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">position_type</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">PositionType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Absolute</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">left</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">right</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">top</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">bottom</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                    },</span></span>
<span class="line"><span style="color: #ABB2BF">                    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                },</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            })</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Position</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create another button entity</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">BLUE</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">justify_content</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">JustifyContent</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">align_items</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">AlignItems</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">margin</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">all</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Auto</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">button_material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Position</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, -</span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">sections</span><span style="color: #ABB2BF">: </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E5C07B">TextSection</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                            </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"Start Game"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                            </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                                </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"fonts/FiraSans-Bold.ttf"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                                </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">30.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                                </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                            },</span></span>
<span class="line"><span style="color: #ABB2BF">                        }</span></span>
<span class="line"><span style="color: #ABB2BF">                    ],</span></span>
<span class="line"><span style="color: #ABB2BF">                    ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                },</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            });</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MouseButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Left</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">GameEvent</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">StartGame</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Position</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">)));</span></span>
<span class="line"><span style="color: #ABB2BF">        });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In the code above, we create a new button entity with a <code>ButtonBundle</code>, which includes a <code>Style</code> and a <code>Material</code> for the button. We also add a <code>Position</code> component to specify the position of the button in 3D space.</p>
<p>Next, we add a <code>Text</code> component to the button to display the label “Start Game”. We use the <code>with_section</code> method of <code>Text</code> to specify the text content, <code>TextStyle</code> for the font, size, and color of the text, and <code>TextAlignment</code> to specify the alignment of the text within the button.</p>
<p>We also add an <code>Interaction</code> component to the button to handle user input. Specifically, we want to respond to left mouse button clicks, so we use <code>Interaction::new(MouseButton::Left)</code> to create a new <code>Interaction</code> with that specification.</p>
<p>Finally, we add a <code>GameEvent::StartGame</code> component to the button. This component will trigger an event in our game when the button is clicked, allowing us to start the game or perform any other action we desire.</p>
<p>With these components added, our button is now fully functional and can trigger game events when clicked. We can add similar components to other UI elements to create more complex and interactive user interfaces for our game.</p>
<h2 id="advanced-ui-topics-in-bevy">Advanced UI topics in Bevy</h2>
<p>In addition to the core features of Bevy’s UI system, there are several advanced topics that you can explore to create even more complex and dynamic user interfaces. Here are a few examples:</p>
<h3 id="animation">Animation</h3>
<p>By combining Bevy’s UI components with its animation system, you can create UI elements that move, scale, and change over time. For example, you could create a button that grows in size when the user hovers over it, or a progress bar that fills up as a task completes. Bevy’s animation system allows you to define keyframes for various properties of an entity, such as its position, rotation, or scale, and interpolate between those keyframes to create smooth animations.</p>
<h3 id="layout-customization">Layout customization</h3>
<p>While Bevy’s built-in layout system is flexible and powerful, there may be cases where you need even more control over the positioning and sizing of UI elements. In these cases, you can define your own custom layout system using Bevy’s ECS architecture. This allows you to define your own rules for how UI elements should be arranged and positioned based on their properties or the properties of their parent entities.</p>
<h3 id="integration-with-external-ui-libraries">Integration with external UI libraries</h3>
<p>If you have an existing UI library that you’d like to use in your Bevy project, you can integrate it using Bevy’s plugin system. Bevy provides a plugin interface that allows you to register your own systems and components with the ECS, which can then be used alongside Bevy’s built-in systems and components. This makes it possible to use popular UI libraries like ImGui or Dear ImGui alongside Bevy’s own UI system.</p>
<h3 id="internationalization">Internationalization</h3>
<p>If you’re creating a game that will be played by users in multiple countries or languages, you may want to consider adding support for internationalization (i18n). Bevy’s UI system provides built-in support for internationalization through the use of string resources. By defining your UI text as string resources and using Bevy’s built-in localization system to load the appropriate resources for the user’s language or region, you can create a UI that is accessible to users around the world.</p>
<p>These are just a few examples of the advanced topics that you can explore when working with Bevy’s UI system. With its flexible ECS architecture and powerful plugin system, there’s almost no limit to what you can create.</p>
<h2 id="creating-dynamic-and-data-driven-ui-elements-using-bevys-ecs-architecture">Creating dynamic and data-driven UI elements using Bevy’s ECS architecture</h2>
<p>Bevy’s ECS architecture allows for creating dynamic and data-driven UI elements. You can use components and systems to dynamically create, update, and delete UI elements based on game state and data.</p>
<p>For example, you could create a UI element that displays the player’s health bar. You would need a component to store the player’s health value, and a system that updates the health bar UI element whenever the player’s health changes.</p>
<p>Here’s an example implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Health component for storing the player's health value</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Health</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// System for updating the health bar UI element</span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">update_health_bar</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">health_query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #E5C07B">Health</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Health</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bar_query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">HealthBar</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Get the player's health value from the health component</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">health</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">health_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">single</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Update the health bar scale based on the health value</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bar_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">single_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.scale.x </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">health</span><span style="color: #ABB2BF">.value / </span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Health bar UI element</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HealthBar</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// UI system for creating the health bar UI element</span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">create_health_bar</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load the health bar texture asset</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"health_bar.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a new material using the health bar texture asset</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create the health bar UI element</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">NodeBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">20.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">HealthBar</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">NodeBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">20.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(-</span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        });</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a <code>Health</code> component to store the player’s health value. We also define a <code>HealthBar</code> UI element, which is a simple rectangle with a texture representing the health bar.</p>
<p>The <code>create_health_bar</code> system creates the health bar UI element and inserts it into the UI hierarchy. It uses the <code>NodeBundle</code> to specify the element’s style, material, and transform.</p>
<p>The <code>update_health_bar</code> system updates the scale of the health bar UI element based on the player’s health value. It uses the <code>Transform</code> component to modify the element’s scale transform.</p>
<p>By combining these components and systems, you can create dynamic and data-driven UI elements that respond to changes in game state and data.</p>
<p>For example, you could create a UI element that displays the player’s health and updates in real-time as the player takes damage or receives healing. To achieve this, you could create a new Bevy system that listens for changes to the player’s health component and updates the UI element accordingly.</p>
<p>Another example is creating a UI element that displays a list of items in the player’s inventory. This UI element could be dynamically generated based on the contents of the inventory component, which is updated whenever the player picks up or drops an item.</p>
<p>By using Bevy’s ECS architecture, you can create highly customizable and modular UI systems that can be easily extended and adapted to suit your game’s specific needs.</p>
<p>Other advanced UI topics that can be explored with Bevy include implementing animations and transitions, creating custom UI elements and layouts, and integrating with external UI libraries and tools. With the flexibility and power of Bevy’s UI system, the possibilities are virtually endless.</p>
<p>In conclusion, creating engaging and intuitive user interfaces is a crucial aspect of game development, and Bevy’s UI system provides a powerful and versatile set of tools and APIs for achieving this. With the concepts and techniques covered in this chapter, you should be well-equipped to create a wide range of UI elements and systems for your Bevy project, from basic menus and buttons to complex data-driven interfaces.</p>
<h2 id="implementing-complex-user-flows-and-transitions-in-bevys-ui-system">Implementing complex user flows and transitions in Bevy’s UI system</h2>
<p>Bevy’s UI system provides a range of options for creating complex user flows and transitions. Here are some approaches to consider:</p>
<ol>
<li>
<p>Using animations: Bevy’s built-in animation system can be used to create smooth transitions between UI elements. For example, you could use a tween animation to fade out a UI element before removing it from the screen, or use a sequence of animations to create a multi-step transition between two screens.</p>
</li>
<li>
<p>Using state machines: Bevy’s StateMachine plugin can be used to create complex user flows with multiple states and transitions. For example, you could use a state machine to manage the flow between a main menu, a settings menu, and a game screen.</p>
</li>
<li>
<p>Using custom systems: If the built-in UI components and plugins don’t provide the functionality you need, you can create your own systems to manage UI state and behavior. For example, you could create a system that listens for specific events and triggers UI transitions based on those events.</p>
</li>
<li>
<p>Using external libraries: Bevy’s modular architecture makes it easy to integrate external libraries for UI development. For example, you could use a library like egui to create complex user interfaces with advanced features like text editing and layout constraints.</p>
</li>
</ol>
<p>By combining these approaches, you can create user interfaces and flows that are tailored to the specific needs of your game.</p>
<h2 id="optimizing-ui-performance-and-managing-large-numbers-of-ui-elements">Optimizing UI performance and managing large numbers of UI elements</h2>
<p>Optimizing the performance of the UI is essential to ensure that the game runs smoothly on a wide range of devices. There are several ways to optimize UI performance in Bevy:</p>
<ol>
<li>
<p>Use batch rendering: Bevy’s built-in UI system uses batch rendering to reduce the number of draw calls made to the GPU. This can significantly improve performance, especially when dealing with large numbers of UI elements.</p>
</li>
<li>
<p>Use dynamic layout: Bevy’s layout system is designed to be flexible and responsive, allowing UI elements to be positioned and sized dynamically based on game state and user input. By using dynamic layout, you can avoid unnecessary calculations and updates, which can help to improve performance.</p>
</li>
<li>
<p>Limit the number of UI elements: While Bevy’s UI system is designed to handle large numbers of UI elements, it’s still important to limit the number of elements as much as possible. This can help to reduce memory usage and improve performance.</p>
</li>
<li>
<p>Use UI caching: Bevy’s UI system includes a caching mechanism that can be used to improve performance when dealing with large numbers of UI elements. By caching UI elements that are frequently used, you can avoid unnecessary calculations and updates, which can help to improve performance.</p>
</li>
<li>
<p>Profile and optimize: As with any other aspect of game development, it’s important to profile and optimize your UI code to identify and eliminate bottlenecks. Bevy includes several tools for profiling and debugging, which can be used to identify performance issues and optimize your UI code.</p>
</li>
</ol>
<p>By following these best practices, you can optimize the performance of your UI and ensure that your game runs smoothly on a wide range of devices.</p>
<h2 id="debugging-and-testing-ui-in-a-bevy-project">Debugging and testing UI in a Bevy project</h2>
<p>When working on a Bevy project that includes user interfaces, it’s important to have effective strategies for debugging and testing the UI. Here are some tips:</p>
<ol>
<li>
<p>Use the Bevy Debug Console: Bevy provides a built-in console that can be used to log messages and debug information. You can use this console to print out information about UI elements and events as they occur, which can be helpful for diagnosing problems.</p>
</li>
<li>
<p>Use the Bevy Inspector: Bevy also provides an inspector tool that can be used to view and interact with the current state of your game. This tool can be particularly useful for debugging UI issues, as it allows you to inspect the current state of UI elements and their associated data.</p>
</li>
<li>
<p>Write automated tests: Automated tests can be a powerful tool for verifying that your UI elements are behaving correctly. You can write tests that simulate user interactions with UI elements and verify that the resulting game state is as expected.</p>
</li>
<li>
<p>Test on different devices: It’s important to test your UI on a variety of devices and screen sizes to ensure that it works correctly in all situations. Bevy provides support for running your game on multiple platforms, so make sure to test on as many devices as possible.</p>
</li>
<li>
<p>Get feedback from users: Finally, it’s always a good idea to get feedback from actual users to identify any issues or areas for improvement. Consider releasing a beta version of your game and soliciting feedback from a small group of testers.</p>
</li>
</ol>
<h2 id="writing-tests-for-ui-layout-and-interaction-logic">Writing tests for UI layout and interaction logic</h2>
<p>When it comes to testing UI in a Bevy project, there are a few different strategies you can use, depending on your goals and the complexity of your UI.</p>
<p>One approach is to write unit tests for the various components and systems that make up your UI. For example, you could write tests that verify that a particular UI element is added to the scene and positioned correctly, or that a button click event triggers the expected action. Bevy’s testing framework provides a variety of tools and helpers for writing these kinds of tests, including the <code>Commands</code> and <code>Query</code> structs, which allow you to simulate game state and query the ECS for entities that match certain criteria.</p>
<p>Another approach is to use automated UI testing tools that simulate user input and interactions with your UI. These tools can help you catch issues with layout, responsiveness, and user flow that may be difficult to identify through manual testing. Some popular UI testing frameworks for Bevy include Bevy-EGUI-Test and Bevy-Terminal, which allow you to simulate user input and query the state of your UI elements programmatically.</p>
<p>Finally, it’s important to perform manual testing of your UI to ensure that it meets your design and usability goals. This can involve using the game yourself and soliciting feedback from others, as well as conducting user testing sessions with a representative sample of your target audience. During these tests, you can look for issues with layout, responsiveness, and usability, as well as areas where the UI can be improved to better meet your players’ needs and expectations.</p>
<p>Overall, testing your UI is an important part of creating a polished and engaging user experience for your game, and Bevy provides a variety of tools and techniques to help you do so effectively.</p>
<h2 id="using-bevys-debug-tools-to-diagnose-ui-issues">Using Bevy’s debug tools to diagnose UI issues</h2>
<p>Bevy provides several debugging tools that can help diagnose issues with your UI, such as the <code>DebugUi</code> plugin and the <code>DebugCursor</code> component.</p>
<p>The <code>DebugUi</code> plugin can be used to display information about the UI hierarchy, including the position and size of each element, the layout constraints that are being applied, and the input events that are being received. To use the <code>DebugUi</code> plugin, simply add it to your Bevy app as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">debug</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">DebugUiPlugin</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Once the plugin is added, you can use the <code>debug!(...)</code> macro to print debug information to the UI. For example, you could print the current value of a slider like this:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ui</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Slider</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">print_slider_value</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Slider</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">slider</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">debug!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Slider value: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">slider</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">value</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>The <code>DebugCursor</code> component can be used to visualize the position of the mouse cursor and any UI elements that it is currently hovering over. To use the <code>DebugCursor</code> component, simply add it to the root entity of your UI hierarchy:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup_ui</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_ui</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">UiCameraBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DebugCursor</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Once the <code>DebugCursor</code> component is added, you should see a red dot indicating the position of the mouse cursor, and colored rectangles indicating the boundaries of any UI elements that the cursor is currently hovering over.</p>
<p>By using these tools, you can quickly identify issues with your UI layout or interaction logic, and make the necessary adjustments to improve the user experience.</p>
<h2 id="conclusion-and-next-steps-6">Conclusion and next steps</h2>
<p>In this chapter, we covered the basics of creating menus and user interfaces with Bevy. We started with an overview of the role of UI in game development and then dove into Bevy’s UI system and APIs. We learned how to create basic menus and UI elements with Bevy’s built-in components and how to manage UI elements with Bevy’s built-in UI components. We also covered how to implement custom styles and themes, use Bevy’s layout system, and add interactivity to user interfaces and menus.</p>
<p>We then explored advanced UI topics in Bevy, including creating dynamic and data-driven UI elements using Bevy’s ECS architecture, implementing complex user flows and transitions, optimizing UI performance, and debugging and testing UI in a Bevy project.</p>
<p>As always, there is more to learn and explore with Bevy’s UI system. We encourage you to continue experimenting and building your own UIs and menus with Bevy, and to check out the official Bevy documentation and community resources for further learning.</p>
<p>In the next chapter, we will cover Bevy’s networking capabilities, including how to create multiplayer games and networked applications using Bevy.</p>
<h2 id="recap-of-key-concepts-and-tools-covered-in-the-chapter-5">Recap of key concepts and tools covered in the chapter</h2>
<p>In this chapter, we covered the following key concepts and tools related to creating menus and user interfaces with Bevy:</p>
<ol>
<li>The role of UI in game development and creating an engaging user experience.</li>
<li>Introduction to Bevy’s UI system and APIs.</li>
<li>Creating basic menus and UI elements with Bevy’s built-in components.</li>
<li>Managing UI elements with Bevy’s built-in UI components.</li>
<li>Overview of Bevy’s UI components and their usage in creating complex UI layouts.</li>
<li>Implementing custom styles and themes for UI elements in a Bevy project.</li>
<li>Using Bevy’s layout system to manage and arrange UI elements in a flexible and responsive manner.</li>
<li>Adding interactivity to user interfaces and menus.</li>
<li>Responding to user input and events in Bevy’s UI system.</li>
<li>Creating interactive UI elements like buttons and sliders.</li>
<li>Using Bevy’s event system to trigger game actions and events from UI elements.</li>
<li>Creating dynamic and data-driven UI elements using Bevy’s ECS architecture.</li>
<li>Implementing complex user flows and transitions in Bevy’s UI system.</li>
<li>Optimizing UI performance and managing large numbers of UI elements.</li>
<li>Debugging and testing UI in a Bevy project.</li>
<li>Writing tests for UI layout and interaction logic.</li>
<li>Using Bevy’s debug tools to diagnose UI issues.</li>
</ol>
<p>By mastering these concepts and tools, you can create engaging and intuitive user interfaces for your games that enhance the overall player experience.</p>
<h2 id="suggestions-for-further-learning-and-experimentation-with-bevys-ui-capabilities">Suggestions for further learning and experimentation with Bevy’s UI capabilities.</h2>
<p>To further learn and experiment with Bevy’s UI capabilities, here are some suggestions:</p>
<ol>
<li>
<p>Read the Bevy UI module documentation and API reference to explore the full range of built-in UI components, systems, and APIs available in Bevy.</p>
</li>
<li>
<p>Experiment with creating custom UI styles and themes using the Bevy’s built-in style system.</p>
</li>
<li>
<p>Practice creating dynamic and data-driven UI elements using Bevy’s ECS architecture and event system.</p>
</li>
<li>
<p>Try creating complex user flows and transitions using Bevy’s built-in animation and layout systems.</p>
</li>
<li>
<p>Explore Bevy’s debug tools and profiling features to diagnose and optimize UI performance issues.</p>
</li>
<li>
<p>Join the Bevy community forums and chat rooms to ask questions, share ideas, and collaborate with other Bevy developers.</p>
</li>
<li>
<p>Check out the Bevy samples and examples repository to see real-world examples of Bevy projects that use UI and menus.</p>
</li>
<li>
<p>Read blog posts and tutorials from the Bevy community to learn from their experiences and insights on using Bevy for UI and menus.</p>
</li>
<li>
<p>Practice implementing UI in a small Bevy game project to get hands-on experience with Bevy’s UI capabilities.</p>
</li>
</ol>
<h1 id="chapter-8-game-logic-and-state-management">Chapter 8: Game Logic and State Management</h1>
<h2 id="implementing-game-logic-with-bevys-ecs-architecture">Implementing game logic with Bevy’s ECS architecture</h2>
<p>Bevy’s Entity Component System (ECS) architecture provides a powerful framework for implementing game logic in a flexible and scalable manner. In this chapter, we will explore the basics of using Bevy’s ECS to create game entities, components, and systems, and how they interact to create complex game mechanics.</p>
<h2 id="introduction-to-bevys-ecs">Introduction to Bevy’s ECS</h2>
<p>Bevy’s ECS architecture is based on the concept of game entities, which are essentially containers for a set of related components. Components define specific properties and behaviors of an entity, such as its position, velocity, health, or AI state. Systems are responsible for updating the state of entities based on their components, and can perform operations such as movement, collision detection, or rendering.</p>
<p>In Bevy, entities are represented by simple numeric identifiers, called “entity IDs”, which are assigned by the ECS system. Components are simple data structures that implement the <code>Component</code> trait, and can be added or removed from entities at runtime. Systems are defined as functions that take as input a set of components and perform some operations on them.</p>
<h2 id="creating-game-entities-and-components">Creating game entities and components</h2>
<p>To create a new entity in Bevy, you can use the <code>Commands</code> resource and its associated methods. For example, the following code creates a new entity with a <code>Transform</code> component:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">((</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">    ));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we use the <code>spawn_bundle</code> method to create a new entity bundle, which is a collection of components that are commonly used together. In this case, we create a bundle that contains only a <code>Transform</code> component, which defines the position, rotation, and scale of the entity.</p>
<p>To add or remove components to an existing entity, you can use the <code>insert</code> and <code>remove</code> methods of the <code>Commands</code> resource. For example, the following code adds a <code>Sprite</code> component to an existing entity:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add_sprite</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Texture</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">insert_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">texture</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we use the <code>entity</code> method of the <code>Commands</code> resource to obtain a reference to an existing entity, and then use the <code>insert_bundle</code> method to add a new component bundle that includes a <code>Sprite</code> component.</p>
<h2 id="implementing-game-systems">Implementing game systems</h2>
<p>To implement game logic in Bevy, you define one or more systems that operate on specific components of entities. Systems are defined as functions that take as input one or more “query” objects, which define the set of components that the system needs to access. For example, the following code defines a simple system that updates the position of entities based on their velocity:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">movement_system</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Velocity</span><span style="color: #ABB2BF">)>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> * </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we define a system function called <code>movement_system</code>, which takes as input a query object that includes all entities that have both a <code>Transform</code> and a <code>Velocity</code> component. Inside the system function, we iterate over all entities that match the query, and update their position based on their velocity.</p>
<p>To register a system with the ECS system, you can use the <code>SystemDescriptor</code> object, which includes information about the system’s input and output</p>
<p>data, as well as any dependencies it has on other systems.</p>
<p>The <code>SystemDescriptor</code> can be used to create a new system in a Bevy project. For example, the following code creates a system that prints a message to the console every frame:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">print_message_system</span><span style="color: #ABB2BF">() -> </span><span style="color: #E5C07B">SystemDescriptor</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">SystemDescriptor</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">print_message_system_impl</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">print_message_system_impl</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Hello from the print message system!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This system can then be added to the Bevy app using the <code>AppBuilder</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">print_message_system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>With this foundation, you can start building complex game systems using Bevy’s ECS architecture. You can create entities, components, and systems to represent any game object or behavior, and use Bevy’s APIs to manipulate them in response to game events and input.</p>
<p>For example, you could create a system that updates the position of a player character based on input from the keyboard and mouse:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">player_movement_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">mouse_motion</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Events</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MouseMotion</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">movement</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">ZERO</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">W</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">movement</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Z</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">S</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">movement</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Z</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">A</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">movement</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">X</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">D</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">movement</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">X</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mouse_motion</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">delta</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">.delta;</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">movement</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">delta</span><span style="color: #ABB2BF">.x, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">delta</span><span style="color: #ABB2BF">.y);</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.position </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">movement</span><span style="color: #ABB2BF"> * </span><span style="color: #D19A66">0.1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This system updates the position of all <code>Player</code> entities based on keyboard input and mouse motion. It also demonstrates how Bevy’s ECS architecture allows you to inject dependencies into systems using the <code>Res</code> and <code>Query</code> types.</p>
<p>In addition to game logic, you can use Bevy’s ECS architecture to implement systems for audio, graphics, physics, and more. By combining these systems with game-specific entities and components, you can create complex and engaging games with Bevy.</p>
<h2 id="overview-of-game-logic-and-how-it-relates-to-bevys-ecs-architecture">Overview of game logic and how it relates to Bevy’s ECS architecture</h2>
<p>Game logic refers to the set of rules and behaviors that determine how a game operates, including how objects interact with each other, how player actions affect the game state, and how the game responds to different events and conditions. In Bevy’s ECS architecture, game logic is implemented through systems, which are responsible for processing entities and components in response to events and changes in game state.</p>
<p>Systems can be thought of as the “brains” of a game, implementing the game’s core mechanics and behaviors. They can perform a wide range of tasks, such as handling player input, updating object positions and velocities, detecting collisions and other interactions between objects, managing game state, and triggering game events and actions.</p>
<p>Bevy’s ECS architecture provides a flexible and modular way to implement game logic, allowing developers to easily create and modify systems to suit their specific needs. By leveraging the power of Rust’s type system and the borrow checker, Bevy ensures that game logic is both performant and safe, minimizing bugs and errors in the game’s behavior.</p>
<h2 id="creating-game-entities-and-components-to-represent-game-state-and-behavior">Creating game entities and components to represent game state and behavior</h2>
<p>In Bevy, game entities are represented as a collection of components that describe their state and behavior. Components are plain old Rust structs that are annotated with the <code>#[derive(Component)]</code> attribute, which allows Bevy to automatically register them with the ECS system.</p>
<p>For example, to create a player entity, you might define a <code>Player</code> component that contains information about the player’s position, velocity, health, and other relevant attributes:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Component</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">health</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Once you have defined your components, you can create entities by adding components to them:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_entity</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">((</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">), </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">), </span><span style="color: #E06C75">health</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">100</span><span style="color: #ABB2BF"> },));</span></span></code></pre>
<p>Here, we use the <code>spawn</code> method on a <code>Commands</code> object to create a new entity and add a <code>Player</code> component to it. The <code>spawn</code> method returns an <code>EntityCommands</code> object that can be used to further modify the entity (e.g. adding additional components, attaching children, etc.).</p>
<p>By creating different combinations of components, you can represent all of the different entities and objects in your game world.</p>
<p>With entities and components defined, you can then write systems that manipulate and interact with them. Systems are functions that operate on one or more components of a given type, and are run by Bevy’s ECS scheduler.</p>
<p>For example, you might define a system that updates the player’s position based on their velocity:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">update_player_position</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.position </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.velocity;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we use the <code>Query</code> type to find all entities that have a <code>Player</code> component, and then iterate over them, updating each player’s position based on their current velocity.</p>
<p>Systems can also have input and output resources, which allow them to interact with other parts of the game (e.g. the rendering system, the input system, etc.). These resources are defined using Rust’s type system, and can be accessed using Bevy’s <code>Res</code> and <code>ResMut</code> types.</p>
<p>Overall, Bevy’s ECS architecture provides a powerful and flexible way to define and manipulate game entities and logic, while still being performant and easy to reason about.</p>
<h2 id="implementing-game-rules-and-behaviors-using-bevys-systems">Implementing game rules and behaviors using Bevy’s systems</h2>
<p>In Bevy’s ECS architecture, game rules and behaviors are implemented using systems. Systems are functions that operate on entities with specific sets of components. They update the components of these entities based on game logic and can interact with other systems to produce complex behaviors.</p>
<p>To create a new system in Bevy, you can define a Rust function that takes a <code>&#x26;mut World</code> parameter and use the <code>SystemBuilder</code> struct to register the system with the ECS world. For example, to create a system that moves entities with a <code>Velocity</code> component, you can define the following function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">move_system</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #E5C07B">Velocity</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">)>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">.vector;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This function takes a <code>Query</code> parameter that specifies which entities it should operate on. In this case, it selects entities that have both a <code>Velocity</code> component and a <code>Transform</code> component. The <code>mut</code> keyword indicates that the function will modify these components.</p>
<p>To register this system with the ECS world, you can use the following code:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">system_builder</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">move_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">());</span></span></code></pre>
<p>This code creates a new <code>SystemBuilder</code> object and calls its <code>add_system</code> method to register the <code>move_system</code> function as a system. The <code>system</code> method is called on the function to create a <code>SystemDescriptor</code> object that includes information about the system’s input and output components.</p>
<p>Once the system is registered, it will be called automatically by Bevy’s ECS scheduler on every frame update. The system can update the components of the selected entities based on game logic, and these updates will be reflected in the game world.</p>
<p>By defining and composing systems in this way, you can create complex game behaviors that respond to player input and interact with each other to produce emergent gameplay.</p>
<h2 id="managing-game-state-and-transitions">Managing game state and transitions</h2>
<p>In a game, the state refers to the current condition of the game world, including the positions and states of all entities, the status of various game mechanics and systems, and any other relevant information that defines the game at a particular moment. Managing game state is an essential aspect of game development, and Bevy provides several tools and techniques for doing so.</p>
<p>One common approach to managing game state in Bevy is to use a state machine to define the various states that the game can be in and the transitions between them. A state machine consists of a set of states and a set of transitions that define how the game can move from one state to another. Each state can have associated logic, such as system updates or UI changes, that are executed when the game enters or exits that state.</p>
<p>Bevy provides a built-in state machine implementation called <code>bevy_state</code> that can be used to manage game state. This module provides several types and macros for defining states, transitions, and the overall state machine. You can define states using the <code>State</code> type and transitions using the <code>Transition</code> type. You can then use the <code>StateMachine</code> type to define the overall state machine, including the initial state and the transitions between states.</p>
<p>To manage game state in Bevy, you can create a system that updates the state machine based on various game events and conditions. For example, you might have a system that updates the state machine when the player completes a level or when a certain score threshold is reached. You can also use the state machine to trigger other systems or events, such as UI updates or audio playback.</p>
<p>Another approach to managing game state in Bevy is to use events to communicate between systems and components. Events are messages that can be sent between different parts of the game to trigger actions or update state. For example, you might have an event that is triggered when the player collects a power-up or when an enemy is defeated. Other parts of the game can then listen for these events and respond accordingly, updating their own state or triggering other events.</p>
<p>To implement event handling in Bevy, you can create a system that listens for specific events and updates the game state or triggers other systems as needed. You can define custom events using Rust enums and use the <code>Events&#x3C;T></code> resource to send and receive events between systems.</p>
<p>Overall, managing game state and transitions is a crucial aspect of game development, and Bevy provides several tools and techniques for doing so. By using state machines, events, and other Bevy features, you can create robust and flexible game logic that can adapt to various player actions and game conditions.</p>
<h2 id="overview-of-game-state-and-the-different-states-that-a-game-can-have">Overview of game state and the different states that a game can have</h2>
<p>In game development, game state refers to the current state or condition of the game world and its entities at any given point in time. It includes information such as the positions and properties of game objects, the current level or stage of the game, the score, health, and other statistics of the player, and any other relevant information that affects the gameplay.</p>
<p>Game state can be categorized into different states, depending on the game’s structure and design. Some common game states include:</p>
<ol>
<li>MainMenu: The state when the game is launched and the main menu is displayed.</li>
<li>Playing: The state when the game is actively being played by the user.</li>
<li>Paused: The state when the game is temporarily paused.</li>
<li>GameOver: The state when the game is over, either because the player has lost or won.</li>
<li>Credits: The state when the game is over and the credits are being displayed.</li>
</ol>
<p>Managing game state is an important aspect of game development, as it affects the gameplay, user experience, and overall feel of the game. Different states may require different types of behaviors and interactions, and transitioning between states must be handled carefully to ensure a seamless and enjoyable experience for the player.</p>
<h2 id="creating-a-game-state-machine-to-manage-game-transitions-and-state-changes">Creating a game state machine to manage game transitions and state changes</h2>
<p>Here’s an example of how to create a game state machine in Rust using Bevy:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Define your game's states as an enum</span></span>
<span class="line"><span style="color: #C678DD">enum</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">MainMenu</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">GamePlay</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">GameOver</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Create a struct to hold the current state</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">State</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">current</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">State</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">() -> </span><span style="color: #E5C07B">Self</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">State</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">current</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">MainMenu</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Create a system to handle state changes</span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">state_change_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">State</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">.current {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">MainMenu</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Check if the user pressed the space bar to start playing</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Space</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">.current </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">GamePlay</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Starting game!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">GamePlay</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Check for events and user input</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                    // If the player wins the game, transition to the game over state</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">GameEvent</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Win</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">.current </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">GameOver</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Game over! You won!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">                    }</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                    // If the player loses the game, transition to the game over state</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">GameEvent</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Lose</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">.current </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">GameOver</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Game over! You lost!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">                    }</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => {}</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Check if the user pressed the escape key to go back to the main menu</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Escape</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">.current </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">MainMenu</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Returning to main menu."</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">GameOver</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Check if the user pressed the space bar to restart the game</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Space</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">.current </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">GamePlay</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Restarting game!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Add the state change system to your Bevy app</span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">State</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_default_plugins</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">state_change_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we added a <code>GameEvent</code> enum to represent different events that can occur during gameplay (e.g. winning or losing). We then added code to the <code>state_change_system</code> function to handle these events and transition to the appropriate state.</p>
<p>We also added code to handle user input for transitioning between states, such as pressing the space bar to start or restart the game, or pressing the escape key to return to the main menu.</p>
<h2 id="creating-a-game-loop-with-bevy">Creating a game loop with Bevy</h2>
<p>Sure thing! Here’s an example of how to create a game loop with Bevy:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Define your game state struct here</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">game_loop_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add your game logic here</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_default_plugins</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_resource</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // Initialize your game state here</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">game_loop_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we created a <code>GameState</code> struct to hold the state of the game. We then added a <code>game_loop_system</code> function to handle the game logic, which takes a mutable reference to the <code>GameState</code> resource.</p>
<p>Finally, we added the <code>GameState</code> resource and <code>game_loop_system</code> to our Bevy app using the <code>add_resource</code> and `add_system</p>
<h2 id="understanding-the-game-loop-and-how-it-works-in-bevy">Understanding the game loop and how it works in Bevy</h2>
<p>The game loop is the heart of any game engine, and Bevy is no exception. At its core, the game loop is a loop that runs continuously while the game is running, processing inputs, updating the game state, and rendering the graphics. Here’s a simplified version of the game loop in Bevy:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create a new Bevy app</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add resources, systems, and plugins to the app</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">    </span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Run the game loop</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>The <code>run</code> method of the <code>App</code> struct is responsible for starting the game loop. When you call <code>app.run()</code>, Bevy will enter a loop that does the following steps:</p>
<ol>
<li>
<p>Process input events: Bevy will check for any input events that have occurred since the last loop iteration and pass them to your game logic for processing. This includes things like keyboard and mouse input, as well as window events like resizing or closing.</p>
</li>
<li>
<p>Update game state: Bevy will call all of your registered game systems in turn, passing in any necessary resources and updating the game state accordingly. This is where you’ll do things like move game objects, check for collisions, and update the score.</p>
</li>
<li>
<p>Render graphics: Bevy will update the graphics pipeline and render the scene to the screen. This includes things like drawing sprites, rendering 3D models, and applying visual effects like shadows or bloom.</p>
</li>
<li>
<p>Wait for the next frame: Bevy will pause briefly to ensure that the game runs at a consistent frame rate. By default, Bevy targets a frame rate of 60 frames per second, but you can adjust this value if needed.</p>
</li>
<li>
<p>Repeat the loop: Once the frame is finished, Bevy will repeat the loop from step 1, processing any new input events that have occurred and updating the game state accordingly.</p>
</li>
</ol>
<p>This loop runs continuously until the game is closed or terminated. By breaking the game loop down into these discrete steps, Bevy allows you to write modular, testable game logic that can be easily integrated into a larger game project.</p>
<h2 id="configuring-the-game-loop-to-meet-specific-performance-and-gameplay-requirements">Configuring the game loop to meet specific performance and gameplay requirements</h2>
<p>Bevy makes it easy to configure the game loop to meet specific performance and gameplay requirements. Here are a few ways you can tweak the game loop to achieve your goals:</p>
<ol>
<li>
<p>Change the target frame rate: Bevy targets a default frame rate of 60 frames per second, but you can adjust this value by setting the <code>target_frame_rate</code> field of the <code>App</code> struct when you create it. For example, if you want to target a frame rate of 120 frames per second, you could do the following:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_target_fps</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">120.0</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>This will cause Bevy to try to render as many frames as possible each second, up to a maximum of 120 frames per second.</p>
</li>
<li>
<p>Throttle the frame rate: If your game is running too fast or too slow, you can throttle the frame rate to a specific value by setting the <code>throttle</code> field of the <code>App</code> struct when you create it. For example, if you want to limit your game to 30 frames per second, you could do the following:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_runner_settings</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">RunnerSettings</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">throttle</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Throttle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Target</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">FrameTime</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_seconds</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">30.0</span><span style="color: #ABB2BF">)) });</span></span></code></pre>
<p>This will cause Bevy to limit the frame rate to 30 frames per second, regardless of how fast your game code is running.</p>
</li>
<li>
<p>Prioritize game logic or rendering: By default, Bevy will try to spend an equal amount of time on game logic and rendering each frame. However, you can adjust the balance between the two by setting the <code>update_frequency</code> field of the <code>App</code> struct. For example, if you want to prioritize game logic over rendering, you could do the following:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_runner_settings</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">RunnerSettings</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">update_frequency</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF"> });</span></span></code></pre>
<p>This will cause Bevy to run the game logic twice as often as it renders frames, giving your game code more time to process input and update the game state.</p>
</li>
<li>
<p>Optimize game systems: Finally, you can optimize your game systems to make them run more efficiently. For example, you can use Bevy’s ECS architecture to ensure that your game logic only operates on the entities and components that it</p>
</li>
</ol>
<h2 id="using-bevys-built-in-timers-and-scheduling-apis-to-manage-game-timing-and-events">Using Bevy’s built-in timers and scheduling APIs to manage game timing and events</h2>
<p>Bevy provides built-in timers and scheduling APIs that make it easy to manage game timing and events. Here’s how you can use them in your game:</p>
<ol>
<li>
<p>Timers: Bevy’s timer API allows you to set up timers that fire at regular intervals or after a specific delay. You can use timers to trigger game events, update the game state, or perform other actions on a regular schedule.</p>
<p>To create a new timer, use the <code>Timer::from_seconds</code> method, which takes a duration in seconds and a boolean value indicating whether the timer should repeat or fire only once. For example, to create a timer that fires every 2 seconds, you could do the following:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Create a new timer that fires every 2 seconds</span></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">timer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Timer</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_seconds</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>You can then check if the timer has elapsed using the <code>timer.tick</code> method, which returns true if the timer has elapsed since the last time it was checked. For example, to check if the timer has elapsed and perform an action if it has, you could do the following:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">timer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">tick</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">just_finished</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Perform an action when the timer elapses</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code should be placed in your game system’s <code>update</code> method so that the timer is checked on every frame.</p>
</li>
<li>
<p>Scheduling: Bevy’s scheduling API allows you to schedule game events to occur at specific times or after specific delays. You can use scheduling to trigger one-time or recurring game events, such as spawning enemies, playing sounds, or updating the score.</p>
<p>To schedule an event, use the <code>schedule</code> method of the <code>Schedule</code> resource, which takes a <code>SystemDescriptor</code> and a <code>ScheduleTime</code>. The <code>SystemDescriptor</code> describes the game system that should be run when the event fires, and the <code>ScheduleTime</code> specifies when the event should occur or how often it should repeat. For example, to schedule a system to run every 5 seconds, you could do the following:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Schedule a system to run every 5 seconds</span></span>
<span class="line"><span style="color: #E06C75">schedule</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_system_to_stage</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">CoreStage</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Update</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">system_descriptor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_run_criteria</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Schedule</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">every</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Duration</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_secs</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">)));</span></span></code></pre>
<p>You can also use the <code>Schedule::after</code> method to schedule an event to occur after a specific delay. For example, to schedule a system to run after 2 seconds, you could do the following:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Schedule a system to run after 2 seconds</span></span>
<span class="line"><span style="color: #E06C75">schedule</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_system_to_stage</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">CoreStage</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Update</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">system_descriptor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_run_criteria</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Schedule</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">after</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Duration</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_secs</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">)));</span></span></code></pre>
<p>This code should be placed in your game’s <code>setup</code> method so that the event is scheduled when the game starts.</p>
</li>
</ol>
<h2 id="advanced-game-logic-and-state-management-topics-in-bevy">Advanced game logic and state management topics in Bevy</h2>
<p>Once you have a basic understanding of Bevy’s game loop, state machine, and input handling, you can start exploring more advanced game logic and state management topics. Here are some examples:</p>
<ol>
<li>
<p>Entity Component System (ECS): Bevy uses an ECS architecture to manage game objects and state. This approach can be more efficient and flexible than traditional object-oriented programming, but it requires a different way of thinking about game logic and data structures. To use the ECS in Bevy, you’ll need to define components that describe the data and behavior of your game objects, and systems that manipulate that data in response to events and user input.</p>
</li>
<li>
<p>Physics and collision detection: Bevy provides built-in support for 2D and 3D physics, using the Rapier physics engine. You can use physics to simulate realistic movement and interactions between game objects, and collision detection to detect and respond to collisions between objects. To use physics in Bevy, you’ll need to define physics components for your game objects, and create systems that update those components based on the laws of physics.</p>
</li>
<li>
<p>Networking and multiplayer: Bevy provides built-in support for networking and multiplayer, using the Amethyst network engine. You can use networking to synchronize game state between multiple players or game clients, allowing them to interact with each other in real-time. To use networking in Bevy, you’ll need to define network components for your game objects, and create systems that synchronize those components between clients.</p>
</li>
<li>
<p>Artificial Intelligence (AI): Bevy doesn’t provide built-in support for AI, but you can use external AI libraries and tools to create intelligent game characters and behaviors. To integrate AI into your Bevy game, you’ll need to create systems that receive input from AI agents and use that input to update the game state.</p>
</li>
</ol>
<p>These are just a few examples of the advanced game logic and state management topics that you can explore with Bevy. By combining these features with Bevy’s built-in tools for graphics, sound, and input handling, you can create complex and engaging games with minimal boilerplate code.</p>
<h2 id="creating-complex-game-rules-and-systems-using-bevys-ecs-architecture">Creating complex game rules and systems using Bevy’s ECS architecture</h2>
<p>Bevy’s Entity Component System (ECS) architecture is a powerful tool for creating complex game rules and systems. By defining components that describe the data and behavior of your game objects, and systems that manipulate that data in response to events and user input, you can create intricate game logic that is both flexible and efficient.</p>
<p>Here are some tips for using Bevy’s ECS architecture to create complex game rules and systems:</p>
<ol>
<li>
<p>Define components that represent game state: To create complex game rules and systems, you’ll need to define components that represent the state of your game objects. For example, you might define a “Health” component that stores the current health of a game character, or a “Weapon” component that stores the type and damage of a weapon. By defining components that represent game state, you can easily manipulate that state in response to user input and other events.</p>
</li>
<li>
<p>Use systems to manipulate game state: Once you’ve defined components that represent game state, you can create systems that manipulate that state in response to events and user input. For example, you might create a system that subtracts health from a character’s “Health” component when they take damage, or a system that updates the position of a game object based on user input. By using systems to manipulate game state, you can create complex interactions between game objects and systems.</p>
</li>
<li>
<p>Use events to trigger system behavior: Bevy provides a built-in event system that allows you to trigger system behavior in response to events. For example, you might create an event that represents a collision between two game objects, and use that event to trigger a system that updates the “Health” components of those objects. By using events to trigger system behavior, you can create complex and dynamic game interactions that respond to user input and other events.</p>
</li>
<li>
<p>Use queries to filter and manipulate components: Bevy’s ECS architecture includes a query system that allows you to filter and manipulate components based on their data and behavior. For example, you might create a query that selects all game objects with a “Health” component below a certain threshold, and use that query to trigger a system that removes those objects from the game. By using queries to filter and manipulate components, you can create complex game logic that responds to changing game state.</p>
</li>
</ol>
<p>By using Bevy’s ECS architecture to create complex game rules and systems, you can create engaging and dynamic games that respond to user input and events in real-time.</p>
<h2 id="implementing-ai-and-machine-learning-algorithms-in-a-bevy-project">Implementing AI and machine learning algorithms in a Bevy project</h2>
<p>Bevy doesn’t provide built-in support for AI or machine learning algorithms, but you can integrate external AI and ML libraries into your Bevy project to create intelligent game characters and behaviors. Here are some general steps for implementing AI and machine learning algorithms in a Bevy project:</p>
<ol>
<li>
<p>Choose an AI or ML library: There are many open-source AI and ML libraries that you can use with Bevy, such as TensorFlow, PyTorch, and Scikit-Learn. You’ll need to choose a library that fits your needs and expertise.</p>
</li>
<li>
<p>Integrate the library with your Bevy project: Once you’ve chosen an AI or ML library, you’ll need to integrate it with your Bevy project. This may involve adding external dependencies to your project’s Cargo.toml file, or creating a separate Rust module for the AI or ML code.</p>
</li>
<li>
<p>Define AI or ML components: To use AI or ML in your Bevy project, you’ll need to define components that represent the data and behavior of your AI or ML agents. For example, you might define a “Neural Network” component that stores the weights and biases of a trained neural network, or a “Decision Tree” component that stores the rules for a decision tree algorithm.</p>
</li>
<li>
<p>Create AI or ML systems: Once you’ve defined AI or ML components, you can create systems that use those components to update the game state based on AI or ML algorithms. For example, you might create a system that uses a trained neural network to predict the next move of an AI game character, or a system that uses a decision tree algorithm to make decisions for an AI game character.</p>
</li>
<li>
<p>Train and test your AI or ML algorithms: Before you can use your AI or ML algorithms in your Bevy project, you’ll need to train and test them on a dataset that represents the game environment and objectives. This may involve creating a training dataset from gameplay data, or generating synthetic data to train your algorithms.</p>
</li>
<li>
<p>Iterate and refine your AI or ML algorithms: Once you’ve trained and tested your AI or ML algorithms, you’ll need to iterate and refine them based on their performance in the game environment. This may involve tweaking the hyperparameters of your algorithms, or adjusting the training dataset to better reflect the game environment and objectives.</p>
</li>
</ol>
<p>By integrating AI and machine learning algorithms into your Bevy project, you can create intelligent game characters and behaviors that respond to user input and game events in real-time. However, this is an advanced topic that requires expertise in both Rust programming and AI or machine learning algorithms.</p>
<h2 id="integrating-external-libraries-and-services-with-bevy-for-advanced-game-functionality">Integrating external libraries and services with Bevy for advanced game functionality</h2>
<p>Bevy is designed to be an extensible game engine, and it provides many ways to integrate external libraries and services for advanced game functionality. Here are some general steps for integrating external libraries and services with Bevy:</p>
<ol>
<li>
<p>Choose a library or service: To integrate an external library or service with Bevy, you’ll need to choose one that provides the functionality you need. There are many open-source libraries and APIs available that can be integrated with Bevy, such as physics engines, networking libraries, and graphics libraries.</p>
</li>
<li>
<p>Add dependencies to your project: Once you’ve chosen a library or service, you’ll need to add its dependencies to your project’s Cargo.toml file. This may involve adding new dependencies or updating existing ones to the latest version.</p>
</li>
<li>
<p>Create a wrapper module for the library: To use the library with Bevy, you may need to create a wrapper module that exposes the library’s functionality as Bevy components or systems. For example, you might create a wrapper module that exposes the physics engine’s collision detection as a Bevy system that updates the game state based on collisions between objects.</p>
</li>
<li>
<p>Integrate the library with Bevy systems: Once you’ve created a wrapper module for the library, you can integrate it with Bevy systems to provide advanced game functionality. For example, you might use a networking library to implement multiplayer functionality, or use a graphics library to create advanced visual effects.</p>
</li>
<li>
<p>Test and iterate on your integration: After integrating the library or service with Bevy, you’ll need to test and iterate on your integration to ensure it works correctly and provides the desired functionality. This may involve tweaking the wrapper module to better fit Bevy’s architecture, or adjusting the library’s settings to optimize performance.</p>
</li>
</ol>
<p>By integrating external libraries and services with Bevy, you can extend the capabilities of your game and create more advanced and complex gameplay mechanics. However, this is an advanced topic that requires expertise in both Rust programming and the library or service being integrated.</p>
<h2 id="debugging-and-testing-game-logic-and-state-management-in-a-bevy-project">Debugging and testing game logic and state management in a Bevy project</h2>
<p>Debugging and testing game logic and state management are important aspects of developing a Bevy project, as they ensure that the game behaves as intended and does not contain any bugs or issues that could affect gameplay. Here are some approaches to debugging and testing game logic and state management in a Bevy project:</p>
<ol>
<li>
<p>Debugging with logging: One approach to debugging in Bevy is to use logging to output relevant information during runtime. You can use the built-in <code>info!</code>, <code>warn!</code>, and <code>error!</code> macros to log information at different levels of severity. By logging relevant information, you can better understand what is happening in your game and pinpoint issues that need to be fixed.</p>
</li>
<li>
<p>Using Bevy’s debugging tools: Bevy provides a number of debugging tools that can be used to visualize and inspect the game state during runtime. These tools include the Bevy Inspector, which provides a GUI for inspecting entities and components, and the Bevy Profiler, which provides a timeline view of the game’s performance.</p>
</li>
<li>
<p>Writing unit tests: Writing unit tests is an important part of testing game logic and state management in a Bevy project. By writing tests that cover the functionality of your game systems, you can ensure that they behave as expected and do not contain any bugs. You can use Rust’s built-in testing framework to write and run tests.</p>
</li>
<li>
<p>Using integration tests: In addition to unit tests, you can also write integration tests that cover the interaction between different systems and components in your game. Integration tests can help you identify issues that arise when systems interact with each other, such as unexpected behavior or performance issues.</p>
</li>
<li>
<p>Using debuggers: Rust has a number of debugging tools that can be used to step through code and inspect variables during runtime. Using a debugger can help you pinpoint issues with your game logic and state management by allowing you to see how the game state changes over time.</p>
</li>
</ol>
<p>By using a combination of logging, debugging tools, unit tests, integration tests, and debuggers, you can ensure that your Bevy project is free of bugs and behaves as expected. This can help you create a high-quality game that provides an enjoyable experience for players.</p>
<h2 id="writing-tests-for-game-systems-and-state-transitions">Writing tests for game systems and state transitions</h2>
<p>Writing tests for game systems and state transitions is an important aspect of developing a Bevy project, as it helps ensure that the game behaves as intended and does not contain any bugs or issues that could affect gameplay. Here are some tips for writing tests for game systems and state transitions in a Bevy project:</p>
<ol>
<li>
<p>Identify the systems and state transitions to test: Before writing tests, it is important to identify the game systems and state transitions that need to be tested. This may include things like input handling, game state management, AI behavior, and other gameplay mechanics.</p>
</li>
<li>
<p>Write unit tests: One approach to testing game systems and state transitions in Bevy is to write unit tests. Unit tests are tests that cover the functionality of a single function or module in isolation from the rest of the system. In a Bevy project, this might involve testing the behavior of a single system or component.</p>
</li>
<li>
<p>Use test fixtures: When writing tests for game systems and state transitions, it is important to ensure that the test environment is consistent and predictable. One way to achieve this is by using test fixtures, which are setup code that is run before each test to initialize the game state and any necessary dependencies.</p>
</li>
<li>
<p>Use assertions: Assertions are statements that check whether a condition is true, and are a key tool for writing effective tests. In a Bevy project, this might involve checking that the game state has changed as expected after a specific action, such as moving the player or initiating a game state transition.</p>
</li>
<li>
<p>Write integration tests: In addition to unit tests, it is also important to write integration tests that cover the interaction between different systems and components in your game. Integration tests can help you identify issues that arise when systems interact with each other, such as unexpected behavior or performance issues.</p>
</li>
<li>
<p>Use test coverage tools: To ensure that you are testing all of the important aspects of your game systems and state transitions, it can be helpful to use test coverage tools. These tools provide information about which parts of your code are covered by tests and which are not, allowing you to identify areas that may need additional testing.</p>
</li>
</ol>
<p>By following these tips, you can create effective tests for game systems and state transitions in your Bevy project, helping to ensure that your game behaves as intended and provides an enjoyable experience for players.</p>
<h2 id="using-bevys-debug-tools-to-diagnose-game-logic-issues">Using Bevy’s debug tools to diagnose game logic issues</h2>
<p>Bevy provides a number of useful debug tools that can help diagnose game logic issues in your project. Here are some ways you can use these tools to identify and fix issues:</p>
<ol>
<li>
<p>Debug drawing: Bevy includes a number of drawing components and systems that can be used to visualize your game’s components and entities in the editor. By enabling debug drawing, you can see the position, size, and other attributes of each entity, which can help identify issues with positioning or collision detection.</p>
</li>
<li>
<p>Profiling: Bevy’s profiling tools can help identify performance bottlenecks in your game logic. By using the built-in profiler, you can see how much time is spent in each system and identify which systems are taking the most time to execute. This can help you optimize your game logic and improve overall performance.</p>
</li>
<li>
<p>Console logging: Bevy’s built-in logging system can be used to output messages to the console, which can be useful for debugging issues with game logic or state transitions. By logging the state of key variables or system events, you can track down issues that might be causing unexpected behavior.</p>
</li>
<li>
<p>Event tracing: Bevy’s event tracing system allows you to trace the flow of events through your game systems, which can help identify issues with event handling or system interaction. By visualizing the flow of events in your game, you can identify issues with event propagation or unexpected system behavior.</p>
</li>
<li>
<p>Breakpoints: If you are using an integrated development environment (IDE) with Bevy, you can use breakpoints to pause execution of your game logic at specific points in your code. This can be useful for identifying issues with variable values or program flow, and can help you step through your game logic to find the source of issues.</p>
</li>
</ol>
<p>By using these debug tools, you can identify and fix issues with your game logic and state transitions, helping to ensure that your game provides a smooth and enjoyable experience for players.</p>
<h2 id="conclusion-and-next-steps-7">Conclusion and next steps</h2>
<p>In this beginner’s guide to learning Rust and Bevy for game development, we covered a range of topics, from the basics of Rust programming to advanced game logic and state management techniques using Bevy’s ECS architecture. We also discussed how to integrate external libraries and services, debug and test game logic, and use Bevy’s built-in debug tools to diagnose issues.</p>
<p>If you’re just starting out with Rust and Bevy, the best next step is to start building your own game projects and experimenting with the techniques and concepts you’ve learned. Bevy has a thriving community of developers who are constantly sharing their experiences and creating new tools and resources to help others learn and improve their game development skills.</p>
<p>To continue your learning journey, consider exploring the Bevy documentation, joining the Bevy Discord server to connect with other developers, and contributing to open source Bevy projects. With time and practice, you can become a skilled game developer using Rust and Bevy, and create amazing games that people will love to play.</p>
<h2 id="recap-of-key-concepts-and-tools-covered-in-the-chapter-6">Recap of key concepts and tools covered in the chapter</h2>
<p>In this chapter, we covered a range of key concepts and tools for game development using Rust and Bevy. Here is a recap of some of the most important topics we discussed:</p>
<ul>
<li>Rust programming basics, including data types, functions, and control flow structures.</li>
<li>Bevy engine basics, including setting up a project, creating entities and components, and working with game systems.</li>
<li>Game state management, including creating a game state machine, handling game events and user input, and transitioning between game states.</li>
<li>Bevy’s built-in timers and scheduling APIs, which can be used to manage game timing and events.</li>
<li>Advanced game logic and state management topics, such as Bevy’s ECS architecture and creating complex game rules and systems.</li>
<li>Integrating external libraries and services, such as physics engines, sound libraries, and networking APIs, with Bevy.</li>
<li>Debugging and testing game logic and state management, including writing tests and using Bevy’s debug tools to diagnose issues.</li>
</ul>
<p>By mastering these concepts and tools, you can create high-quality games using Rust and Bevy, and continue to improve your skills as a game developer.</p>
<h2 id="suggestions-for-further-learning-and-experimentation-with-bevys-game-logic-and-state-management-capabilities">Suggestions for further learning and experimentation with Bevy’s game logic and state management capabilities.</h2>
<p>Here are some suggestions for further learning and experimentation with Bevy’s game logic and state management capabilities:</p>
<ol>
<li>
<p>Build more complex game systems and entities using Bevy’s ECS architecture: Experiment with creating more complex game entities and systems using Bevy’s ECS architecture. You can also explore the use of Bevy’s built-in systems and resources, such as the Transform system, Physics system, and Input system.</p>
</li>
<li>
<p>Implement AI and machine learning algorithms in your Bevy project: Try implementing AI and machine learning algorithms in your Bevy project. This can be achieved using external libraries, such as the Rusty Machine library for machine learning, or by building your own AI systems using Bevy’s ECS architecture.</p>
</li>
<li>
<p>Create your own game state machine and event handling system: Build your own game state machine and event handling system using the concepts covered in this chapter. This can help you gain a deeper understanding of how game logic and state management works, and enable you to create more complex and dynamic games.</p>
</li>
<li>
<p>Explore Bevy’s plugin system: Bevy’s plugin system allows you to extend the engine’s capabilities by adding new systems, resources, and components. Explore the use of Bevy plugins to add new functionality to your game, such as advanced physics simulations, networking capabilities, or machine learning algorithms.</p>
</li>
</ol>
<h1 id="chapter-9-networking-and-multiplayer">Chapter 9: Networking and Multiplayer</h1>
<h2 id="understanding-networking-concepts-in-game-development">Understanding networking concepts in game development</h2>
<p>Networking is an essential concept in game development that enables multiplayer gaming and real-time interactions between players. In a networked game, players communicate with each other and with a central server to share game state information and synchronize their actions.</p>
<p>There are several key networking concepts that game developers should understand:</p>
<ol>
<li>
<p>Client-server architecture: In a client-server architecture, the game server acts as a central authority that manages game state and communicates with clients. Clients send input to the server, which then updates the game state and sends updates back to clients.</p>
</li>
<li>
<p>Peer-to-peer architecture: In a peer-to-peer architecture, each player communicates directly with other players, without a central server. This approach can be more decentralized and scalable, but it can also be more difficult to implement and manage.</p>
</li>
<li>
<p>Latency: Latency refers to the delay between a player’s action and the corresponding response in the game. In networked games, latency can be a major issue, as it can lead to lag and make the game feel unresponsive. Game developers must take latency into account when designing their networking architecture and optimizing their game code.</p>
</li>
<li>
<p>Prediction and reconciliation: To reduce the impact of latency, many networked games use prediction and reconciliation techniques. Prediction involves estimating the likely future state of the game based on current input and previous state, while reconciliation involves resolving discrepancies between predicted and actual state information.</p>
</li>
<li>
<p>Security: Networked games must also address security concerns, such as preventing cheating and protecting players’ personal information. Developers can use techniques such as encryption, authentication, and server-side validation to ensure the security of their game.</p>
</li>
</ol>
<p>By understanding these networking concepts and implementing them effectively in their game development projects, developers can create engaging and immersive multiplayer games that provide a seamless and enjoyable experience for players.</p>
<h2 id="implementing-networked-gameplay-with-bevy-and-rust">Implementing networked gameplay with Bevy and Rust</h2>
<p>Bevy provides built-in support for networked gameplay through its Netcode plugin. The Netcode plugin is designed to work seamlessly with Bevy’s ECS architecture, allowing developers to create networked games using the same systems and components they use for single-player games.</p>
<p>To implement networked gameplay with Bevy and Rust, developers can follow these general steps:</p>
<ol>
<li>
<p>Set up a game server: In a client-server architecture, the game server acts as the central authority that manages game state and communicates with clients. Developers can set up their own game server using Rust and Bevy’s Netcode plugin. The server should listen for incoming connections from clients and handle incoming network packets.</p>
</li>
<li>
<p>Create networked entities and systems: To enable networked gameplay, developers can create networked entities and systems using Bevy’s ECS architecture. Networked entities are entities that are replicated across all clients and the server, while networked systems are systems that run on both the server and the client. Developers can use the Netcode plugin’s built-in networked components and resources to create networked entities and systems.</p>
</li>
<li>
<p>Synchronize game state between clients and the server: To keep game state synchronized between clients and the server, developers can use Bevy’s built-in networked components and resources to send and receive network packets. The server should send updates to clients at regular intervals, while clients should send input to the server as soon as it is received.</p>
</li>
<li>
<p>Handle networked events and errors: Networked gameplay can introduce additional complexity and error conditions, such as packet loss and network latency. Developers should handle these events and errors gracefully, using techniques such as prediction and reconciliation to ensure a smooth and responsive gameplay experience for all players.</p>
</li>
<li>
<p>Test and optimize networked gameplay: To ensure a high-quality networked gameplay experience, developers should thoroughly test their game under a variety of network conditions, and optimize their code and networking architecture to minimize latency and improve network performance.</p>
</li>
</ol>
<p>By following these steps and leveraging Bevy’s built-in networking capabilities, developers can create engaging and immersive networked games using Rust and Bevy.</p>
<h2 id="handling-multiplayer-game-logic-and-synchronization">Handling multiplayer game logic and synchronization</h2>
<p>When creating multiplayer games, it’s important to handle game logic and synchronization properly to ensure that all players see the same game state and have a consistent experience. Here are some general tips for handling multiplayer game logic and synchronization:</p>
<ol>
<li>
<p>Keep game state synchronized: All game state that affects gameplay, such as player positions, health, and scores, should be synchronized across all players in real-time. This can be achieved by sending updates to all players at regular intervals using a reliable protocol.</p>
</li>
<li>
<p>Use prediction and reconciliation: To ensure smooth gameplay, clients can use prediction to simulate the game state locally before receiving updates from the server. Reconciliation can then be used to correct any discrepancies between the local simulation and the server state.</p>
</li>
<li>
<p>Handle latency and lag: Network latency and lag can cause issues in multiplayer games, such as delayed reactions and rubberbanding. To handle these issues, developers can use techniques such as client-side prediction, lag compensation, and interpolation.</p>
</li>
<li>
<p>Implement server-side validation: To prevent cheating, it’s important to validate player actions on the server and reject any actions that are not allowed. This can include validating movement, attacks, and other actions.</p>
</li>
<li>
<p>Optimize network traffic: Sending large amounts of data across the network can cause lag and affect gameplay. To optimize network traffic, developers can use techniques such as compression, delta encoding, and rate limiting.</p>
</li>
</ol>
<p>Bevy provides built-in support for networked gameplay through its Netcode plugin, which can simplify the process of handling multiplayer game logic and synchronization. By following these tips and leveraging Bevy’s networking capabilities, developers can create engaging and immersive multiplayer games that provide a smooth and consistent experience for all players.</p>
<h2 id="creating-a-client-server-architecture-with-bevy-and-rust">Creating a client-server architecture with Bevy and Rust</h2>
<p>When creating a networked game with Bevy and Rust, a common approach is to use a client-server architecture, where the game is split into two parts: a server that handles game logic and synchronization, and one or more clients that display the game to players and send player inputs to the server. Here are the general steps for creating a client-server architecture with Bevy and Rust:</p>
<ol>
<li>
<p>Design the game and network protocol: Before starting development, design the game and network protocol. This should include defining the game state, player actions, and how the game state will be synchronized across the network.</p>
</li>
<li>
<p>Implement the server: Implement the server using Rust and Bevy. The server should handle game logic and synchronization, receive player inputs from clients, and send game state updates to all clients. The server should also handle authentication and validation of player inputs to prevent cheating.</p>
</li>
<li>
<p>Implement the client: Implement the client using Rust and Bevy. The client should display the game to players, send player inputs to the server, and receive game state updates from the server. The client should also handle prediction and reconciliation to provide a smooth gameplay experience.</p>
</li>
<li>
<p>Test and debug: Test the game on a local network to ensure that the server and clients are communicating properly and that the game state is synchronized correctly. Use Bevy’s debugging tools to diagnose any issues and optimize performance.</p>
</li>
<li>
<p>Deploy the game: Deploy the game to a public server to allow players to connect and play over the internet. Ensure that the server is secure and can handle the expected number of players.</p>
</li>
</ol>
<p>Bevy provides built-in support for networking through its Netcode plugin, which can simplify the process of creating a client-server architecture. By following these steps and leveraging Bevy’s networking capabilities, developers can create engaging and immersive networked games that provide a smooth and consistent experience for all players.</p>
<h2 id="synchronizing-game-state-across-clients-using-the-authoritative-server-model">Synchronizing game state across clients using the authoritative server model</h2>
<p>When implementing networked gameplay with Bevy and Rust, one common approach for synchronizing game state across multiple clients is the authoritative server model. In this model, the server is responsible for maintaining the authoritative game state, and all clients receive updates from the server to display the current state of the game.</p>
<p>Here are the general steps for implementing the authoritative server model with Bevy and Rust:</p>
<ol>
<li>
<p>Design the game and network protocol: Before starting development, design the game and network protocol. This should include defining the game state, player actions, and how the game state will be synchronized across the network.</p>
</li>
<li>
<p>Implement the server: Implement the server using Rust and Bevy. The server should handle game logic and synchronization, receive player inputs from clients, and send game state updates to all clients. The server should also handle authentication and validation of player inputs to prevent cheating.</p>
</li>
<li>
<p>Implement the client: Implement the client using Rust and Bevy. The client should display the game to players, send player inputs to the server, and receive game state updates from the server. The client should also handle prediction and reconciliation to provide a smooth gameplay experience.</p>
</li>
<li>
<p>Synchronize game state: Use Bevy’s networking capabilities to synchronize the game state across clients. The server should send game state updates to all clients at regular intervals, and clients should interpolate between updates to provide a smooth display of the game state.</p>
</li>
<li>
<p>Handle player inputs: When a player inputs a command, the client should send the input to the server. The server should then validate the input, update the game state, and send the updated state to all clients.</p>
</li>
<li>
<p>Test and debug: Test the game on a local network to ensure that the server and clients are communicating properly and that the game state is synchronized correctly. Use Bevy’s debugging tools to diagnose any issues and optimize performance.</p>
</li>
<li>
<p>Deploy the game: Deploy the game to a public server to allow players to connect and play over the internet. Ensure that the server is secure and can handle the expected number of players.</p>
</li>
</ol>
<p>By following these steps and using the authoritative server model, developers can create networked games with a consistent and synchronized game state across all clients. This approach can provide a fair and engaging gameplay experience for all players, and prevent cheating by ensuring that the server maintains the authoritative game state.</p>
<h2 id="implementing-game-mechanics-for-multiplayer-gameplay-such-as-matchmaking-and-lobby-systems">Implementing game mechanics for multiplayer gameplay, such as matchmaking and lobby systems</h2>
<p>Implementing game mechanics for multiplayer gameplay, such as matchmaking and lobby systems, is an important aspect of creating a successful multiplayer game. Here are some steps for implementing these features using Bevy and Rust:</p>
<ol>
<li>
<p>Design the matchmaking and lobby systems: Before starting development, design the matchmaking and lobby systems. This should include defining the game modes, match requirements, matchmaking rules, and the lobby user interface.</p>
</li>
<li>
<p>Implement the server: Implement the server using Rust and Bevy. The server should handle matchmaking and lobby management, create and manage game sessions, and communicate with clients to provide real-time updates on game state and player status.</p>
</li>
<li>
<p>Implement the client: Implement the client using Rust and Bevy. The client should display the lobby interface to players, allow players to create or join matches, and display game state and player status updates from the server.</p>
</li>
<li>
<p>Implement matchmaking logic: Use Bevy’s networking and ECS capabilities to implement matchmaking logic on the server. The server should evaluate player attributes such as skill level</p>
</li>
</ol>
<h2 id="optimizing-network-performance-and-minimizing-latency-in-multiplayer-games">Optimizing network performance and minimizing latency in multiplayer games</h2>
<p>Optimizing network performance and minimizing latency is critical in multiplayer games, as any delays or lag can have a significant impact on the gameplay experience. Here are some tips for optimizing network performance in multiplayer games using Bevy and Rust:</p>
<ol>
<li>
<p>Use a reliable network protocol: Use a reliable network protocol, such as TCP, to ensure that data is delivered in the correct order and that lost packets are automatically retransmitted.</p>
</li>
<li>
<p>Use a high-performance networking library: Use a high-performance networking library, such as Tokio or Mio, to minimize the overhead of networking operations and ensure that data is processed as quickly as possible.</p>
</li>
<li>
<p>Implement client-side prediction: Use client-side prediction to minimize the impact of network latency on the player’s experience. With client-side prediction, the client predicts the outcome of player actions locally, and then reconciles with the server when the server’s authoritative state is received.</p>
</li>
<li>
<p>Implement server-side lag compensation: Implement server-side lag compensation to minimize the impact of network latency on gameplay fairness. With server-side lag compensation, the server simulates the state of the game as it was at the time the player took an action, and then updates the game state to the current time.</p>
</li>
<li>
<p>Use interpolation and extrapolation: Use interpolation and extrapolation to smooth out the movement of other players and objects in the game. Interpolation involves smoothing out the movement between two known states, while extrapolation involves predicting movement based on previous states.</p>
</li>
<li>
<p>Optimize game code: Optimize game code to minimize the amount of data that needs to be sent over the network. This can include using smaller data types, compressing data, and minimizing unnecessary updates.</p>
</li>
</ol>
<h1 id="chapter-10-cross-platform-deployment">Chapter 10: Cross-platform Deployment</h1>
<h2 id="deploying-bevy-games-to-multiple-platforms-including-desktop-and-mobile-devices">Deploying Bevy games to multiple platforms, including desktop and mobile devices</h2>
<p>Deploying Bevy games to multiple platforms, including desktop and mobile devices, is an important aspect of game development. Here are some tips for deploying Bevy games to various platforms:</p>
<ol>
<li>
<p>Choose a target platform: Determine which platforms you want to target for deployment, such as desktop, mobile, or web. This will help you choose the appropriate deployment tool and optimize your game accordingly.</p>
</li>
<li>
<p>Use a deployment tool: Bevy supports several deployment tools, such as Cargo-make, Cargo-web, and Wasm-pack, which can help you package your game for deployment on various platforms. These tools can automatically compile your game code into the appropriate format for deployment and manage dependencies.</p>
</li>
<li>
<p>Optimize your game for each platform: Different platforms have different performance characteristics and limitations, so it’s important to optimize your game for each platform. This can include optimizing graphics settings, adjusting the game logic, and minimizing network traffic.</p>
</li>
<li>
<p>Test your game on each platform: Testing your game on each platform is important to ensure that it works correctly and performs well. Bevy provides a testing framework that allows you to write automated tests for your game logic and behavior.</p>
</li>
<li>
<p>Publish your game: Once your game is optimized and tested, it’s time to publish it to the appropriate platform stores or distribution channels. Each platform has its own publishing requirements and procedures, so be sure to follow the guidelines carefully.</p>
</li>
<li>
<p>Support multiple input methods: Ensure that your game supports multiple input methods, such as touch screen,</p>
</li>
</ol>
<h2 id="packaging-and-distributing-bevy-games-for-different-platforms">Packaging and distributing Bevy games for different platforms</h2>
<p>To package and distribute Bevy games for different platforms, you will need to use different tools and techniques depending on the target platform. Here are some general tips to help you package and distribute your Bevy games:</p>
<ol>
<li>
<p>Choose the appropriate deployment tool: Bevy supports various deployment tools such as Cargo-make, Cargo-web, and Wasm-pack, depending on your target platform. Each deployment tool has its own configuration and setup requirements, so make sure you read the documentation carefully.</p>
</li>
<li>
<p>Optimize the game for the target platform: Different platforms have different requirements and limitations, such as performance characteristics, input methods, and screen sizes. Optimize your game accordingly to ensure it works smoothly and correctly.</p>
</li>
<li>
<p>Test the game on the target platform: Testing your game on the target platform is crucial to ensure that it runs correctly and performs well. Bevy provides a testing framework that allows you to write automated tests for your game logic and behavior.</p>
</li>
<li>
<p>Publish the game to the appropriate platform stores: Once your game is optimized and tested, you can publish it to the appropriate platform stores or distribution channels. Each platform has its own requirements and procedures for publishing, so be sure to read the documentation and follow the guidelines carefully.</p>
</li>
<li>
<p>Provide support for multiple input methods: Ensure that your game supports multiple input methods, such as touch screen, mouse, and keyboard, depending on the target platform.</p>
</li>
<li>
<p>Provide clear installation and usage instructions: Provide clear and concise instructions on how to install and use your game on the target platform to help users get started quickly and easily.</p>
</li>
</ol>
<p>Overall, packaging and distributing Bevy games for different platforms require careful planning and attention to details. Make sure you read the documentation and follow the best practices to ensure the best possible user experience.</p>
<h2 id="optimizing-bevy-games-for-performance-and-platform-specific-features">Optimizing Bevy games for performance and platform-specific features</h2>
<p>Optimizing Bevy games for performance and platform-specific features is an important aspect of game development. Here are some tips to help you optimize your Bevy game for performance and take advantage of platform-specific features:</p>
<ol>
<li>
<p>Use Bevy’s built-in performance profiling tools: Bevy provides built-in tools for profiling your game’s performance, including a frame profiler and a system profiler. Use these tools to identify performance bottlenecks and optimize your game accordingly.</p>
</li>
<li>
<p>Use Bevy’s ECS architecture to optimize game logic: Bevy’s ECS architecture is designed for high-performance game development. Use it to organize and optimize your game logic and take advantage of Rust’s performance benefits.</p>
</li>
<li>
<p>Optimize graphics performance: Use platform-specific graphics APIs, such as Vulkan, DirectX, and Metal, to optimize graphics performance on different platforms. Bevy supports these APIs through its back-end rendering engine, so make sure you use them appropriately.</p>
</li>
<li>
<p>Optimize audio performance: Use platform-specific audio APIs, such as OpenAL, to optimize audio performance on different platforms. Bevy provides an audio engine that supports OpenAL and other audio APIs, so make sure you use them appropriately.</p>
</li>
<li>
<p>Use platform-specific features: Different platforms have different features and capabilities, such as touch screens, gamepads, and sensors. Use these features to enhance your game’s functionality and user experience on each platform.</p>
</li>
<li>
<p>Optimize networking performance: Use appropriate networking protocols and techniques, such as compression, to optimize networking performance and minimize latency in multiplayer games.</p>
</li>
<li>
<p>Test and optimize on target platforms: Test and optimize your game on each target platform to ensure that it performs well and takes advantage of platform-specific features. Use platform-specific testing tools and techniques to identify performance issues and optimize your game accordingly.</p>
</li>
</ol>
<p>Overall, optimizing Bevy games for performance and platform-specific features requires careful planning and attention to details. Use Bevy’s built-in tools and features to optimize your game’s performance, and test and optimize on each target platform to ensure the best possible user experience.</p>
<h2 id="building-and-deploying-bevy-games-for-web-platforms-using-webassembly-and-webgl">Building and deploying Bevy games for web platforms using WebAssembly and WebGL</h2>
<p>Bevy supports building and deploying games for web platforms using WebAssembly and WebGL. Here are some steps to build and deploy your Bevy game for web platforms:</p>
<ol>
<li>Install the required tools: To build and deploy your Bevy game for web platforms, you will need to install the following tools:</li>
</ol>
<ul>
<li>Rust toolchain</li>
<li>wasm-pack</li>
<li>npm</li>
<li>webpack</li>
</ul>
<ol start="2">
<li>
<p>Create a new Bevy project: Create a new Bevy project using the Bevy CLI or by manually setting up a new Bevy project in Rust.</p>
</li>
<li>
<p>Add the required dependencies: To build and deploy your Bevy game for web platforms, you will need to add the following dependencies to your project’s <code>Cargo.toml</code> file:</p>
</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">[lib]</span></span>
<span class="line"><span style="color: #abb2bf">crate-type = ["cdylib"]</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">[dependencies]</span></span>
<span class="line"><span style="color: #abb2bf">bevy = "0.5"</span></span>
<span class="line"><span style="color: #abb2bf">bevy_webgl2 = "0.5"</span></span></code></pre>
<ol start="4">
<li>Configure your project for WebAssembly: To configure your project for WebAssembly, add the following to your project’s <code>Cargo.toml</code> file:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">[package]</span></span>
<span class="line"><span style="color: #abb2bf"># ...</span></span>
<span class="line"><span style="color: #abb2bf">edition = "2018"</span></span>
<span class="line"><span style="color: #abb2bf">[lib]</span></span>
<span class="line"><span style="color: #abb2bf"># ...</span></span>
<span class="line"><span style="color: #abb2bf">crate-type = ["cdylib"]</span></span>
<span class="line"><span style="color: #abb2bf">[profile.release]</span></span>
<span class="line"><span style="color: #abb2bf"># ...</span></span>
<span class="line"><span style="color: #abb2bf">codegen-units = 1</span></span>
<span class="line"><span style="color: #abb2bf">opt-level = "s"</span></span>
<span class="line"><span style="color: #abb2bf">lto = true</span></span>
<span class="line"><span style="color: #abb2bf">panic = "abort"</span></span></code></pre>
<ol start="5">
<li>Build your project: Use wasm-pack to build your project for WebAssembly by running the following command in your project’s directory:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">wasm-pack build --target web</span></span></code></pre>
<ol start="6">
<li>Set</li>
</ol>
<h2 id="using-third-party-tools-and-libraries-for-cross-platform-deployment-such-as-wasm-pack-and-bevys-built-in-asset-pipeline">Using third-party tools and libraries for cross-platform deployment, such as WASM-pack and Bevy’s built-in asset pipeline</h2>
<p>Using third-party tools and libraries can simplify the process of deploying Bevy games to different platforms. Here are some examples:</p>
<ol>
<li>
<p>WASM-pack: WASM-pack is a command-line tool for building and packaging Rust projects as WebAssembly modules. It can be used to build Bevy games for the web platform by compiling Rust code to WebAssembly and generating JavaScript glue code.</p>
</li>
<li>
<p>Bevy’s built-in asset pipeline: Bevy has a built-in asset pipeline that can be used to manage game assets, such as images, sounds, and fonts. The asset pipeline can automatically convert assets to different formats and generate optimized versions for different platforms.</p>
</li>
<li>
<p>Cross-platform game engines: There are several cross-platform game engines that can be used to build and deploy Bevy games to different platforms, such as Unity, Unreal Engine, and Godot.</p>
</li>
<li>
<p>Cloud-based game development platforms: Cloud-based game development platforms, such as AWS GameLift, Google Cloud Platform, and Microsoft Azure, can be used to deploy Bevy games to cloud servers and provide multiplayer game hosting and matchmaking services.</p>
</li>
</ol>
<p>Using these tools and libraries can help simplify the process of deploying Bevy games to different platforms and provide additional functionality, such as cross-platform asset management and cloud-based game hosting.</p>
<h2 id="testing-and-debugging-bevy-games-on-different-platforms">Testing and debugging Bevy games on different platforms</h2>
<p>Testing and debugging Bevy games on different platforms is an important step in the development process. Here are some tips for testing and debugging Bevy games on different platforms:</p>
<ol>
<li>
<p>Use platform-specific tools: Different platforms have different tools for testing and debugging, such as Xcode for iOS, Android Studio for Android, and Visual Studio for Windows. These tools can provide valuable insights into platform-specific issues and help you diagnose and fix bugs.</p>
</li>
<li>
<p>Use Bevy’s debug tools: Bevy provides several debug tools, such as the Bevy Debugger and the Bevy Profiler, which can help you diagnose and fix performance issues and other game logic problems.</p>
</li>
<li>
<p>Test on multiple devices: It’s important to test your Bevy game on a variety of devices and platforms to ensure compatibility and performance. Testing on different devices can also help you identify device-specific issues and optimize your game for different hardware.</p>
</li>
<li>
<p>Use automated testing tools: Automated testing tools, such as Selenium, can be used to test your Bevy game on different web browsers and platforms. These tools can help you identify browser-specific issues and ensure cross-browser compatibility.</p>
</li>
<li>
<p>Use remote debugging: Some platforms, such as iOS and Android, allow for remote debugging, which can be useful for testing and debugging Bevy games on mobile devices. Remote debugging allows you to connect to a device from your development machine and debug your game in real-time.</p>
</li>
</ol>
<p>By using these tips, you can effectively test and debug your Bevy game on different platforms and ensure that it runs smoothly and effectively for all users.</p>
<h1 id="chapter-11-sample-project-a-simple-platformer-game">Chapter 11: Sample Project: A Simple Platformer Game</h1>
<h2 id="building-a-simple-platformer-game-using-bevy-and-rust">Building a simple platformer game using Bevy and Rust</h2>
<p>Building a simple platformer game using Bevy and Rust is a great way to get started with game development using Bevy. Here are the steps to build a simple platformer game:</p>
<ol>
<li>
<p>Set up the project: Create a new Rust project and add the Bevy dependency to your project’s Cargo.toml file.</p>
</li>
<li>
<p>Create the game world: Use Bevy’s ECS architecture to create the game world, including the player character, platforms, and other game objects.</p>
</li>
<li>
<p>Implement player movement: Add input handling logic to allow the player to move left and right, as well as jump.</p>
</li>
<li>
<p>Implement physics: Use Bevy’s physics engine to implement collision detection and physics-based movement for the player and other game objects.</p>
</li>
<li>
<p>Implement game logic: Add game logic to handle game state transitions, such as player death or level completion.</p>
</li>
<li>
<p>Add game graphics</p>
</li>
</ol>
<h2 id="implementing-basic-gameplay-mechanics-graphics-and-sound-effects">Implementing basic gameplay mechanics, graphics, and sound effects</h2>
<p>Here are the steps to implement basic gameplay mechanics, graphics, and sound effects for a simple platformer game using Bevy and Rust:</p>
<ol>
<li>
<p>Create the game world: Use Bevy’s ECS architecture to create the game world, including the player character, platforms, and other game objects.</p>
</li>
<li>
<p>Implement player movement: Add input handling logic to allow the player to move left and right, as well as jump.</p>
</li>
<li>
<p>Implement physics: Use Bevy’s physics engine to implement collision detection and physics-based movement for the player and other game objects.</p>
</li>
<li>
<p>Add game graphics: Use Bevy’s built-in sprite and texture handling features to add graphics for the player character, platforms, and other game objects.</p>
</li>
<li>
<p>Implement sound effects: Use Bevy’s audio system to add sound effects for actions such as jumping or collecting power-ups.</p>
</li>
<li>
<p>Add game logic: Add game logic to handle game state transitions, such as player death or level completion.</p>
</li>
<li>
<p>Test and debug: Test and debug the game to ensure that it functions as expected.</p>
</li>
</ol>
<p>Here is some sample code for implementing player movement and basic physics:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic">// Player movement system</span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">player_movement</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">A</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.x </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">PLAYER_SPEED</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">D</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.x </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">PLAYER_SPEED</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Space</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">PLAYER_JUMP_HEIGHT</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Physics system</span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">physics</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">platform_query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Platform</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_transform</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">platform_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF">.translation.y</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_transform</span><span style="color: #ABB2BF">.translation.y - </span><span style="color: #D19A66">PLAYER_HEIGHT</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF">.translation.y + </span><span style="color: #D19A66">PLATFORM_HEIGHT</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">2.0</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_transform</span><span style="color: #ABB2BF">.translation.x + </span><span style="color: #D19A66">PLAYER_WIDTH</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF">.translation.x - </span><span style="color: #D19A66">PLATFORM_WIDTH</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">2.0</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_transform</span><span style="color: #ABB2BF">.translation.x - </span><span style="color: #D19A66">PLAYER_WIDTH</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF">.translation.x + </span><span style="color: #D19A66">PLATFORM_WIDTH</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">2.0</span></span>
<span class="line"><span style="color: #ABB2BF">            {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">player_transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF">.translation.y + </span><span style="color: #D19A66">PLATFORM_HEIGHT</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF"> + </span><span style="color: #D19A66">PLAYER_HEIGHT</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>These systems handle player movement and platform collisions based on Bevy’s ECS architecture. You can customize these systems to fit your specific game mechanics and physics requirements.</p>
<p>Once we have the basic gameplay mechanics in place, we can start adding graphics and sound effects to enhance the player experience. Bevy has a powerful rendering system that allows us to create visually stunning games. We can use Bevy’s built-in sprite rendering system to add sprites to our game.</p>
<p>To add sprites, we first need to create an asset. An asset is a piece of data that is loaded and managed by Bevy’s asset pipeline. We can create a sprite asset by adding the following code to our <code>assets.rs</code> file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">#[derive(Default, Clone)]</span></span>
<span class="line"><span style="color: #abb2bf">pub struct SpriteHandles {</span></span>
<span class="line"><span style="color: #abb2bf">    pub player_sprite: Handle&#x3C;Texture>,</span></span>
<span class="line"><span style="color: #abb2bf">    pub enemy_sprite: Handle&#x3C;Texture>,</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn load_sprites(</span></span>
<span class="line"><span style="color: #abb2bf">    mut commands: Commands,</span></span>
<span class="line"><span style="color: #abb2bf">    asset_server: Res&#x3C;AssetServer>,</span></span>
<span class="line"><span style="color: #abb2bf">    mut sprite_handles: ResMut&#x3C;SpriteHandles>,</span></span>
<span class="line"><span style="color: #abb2bf">) {</span></span>
<span class="line"><span style="color: #abb2bf">    sprite_handles.player_sprite =</span></span>
<span class="line"><span style="color: #abb2bf">        asset_server.load("textures/player.png");</span></span>
<span class="line"><span style="color: #abb2bf">    sprite_handles.enemy_sprite =</span></span>
<span class="line"><span style="color: #abb2bf">        asset_server.load("textures/enemy.png");</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>Next, we need to add a sprite component to our player entity. We can do this by adding the following code to our <code>player.rs</code> file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">use bevy::prelude::*;</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">pub struct Player {</span></span>
<span class="line"><span style="color: #abb2bf">    pub velocity: Vec2,</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">pub fn spawn_player(</span></span>
<span class="line"><span style="color: #abb2bf">    commands: &#x26;mut Commands,</span></span>
<span class="line"><span style="color: #abb2bf">    asset_handles: &#x26;SpriteHandles,</span></span>
<span class="line"><span style="color: #abb2bf">) {</span></span>
<span class="line"><span style="color: #abb2bf">    commands</span></span>
<span class="line"><span style="color: #abb2bf">        .spawn_bundle(SpriteBundle {</span></span>
<span class="line"><span style="color: #abb2bf">            material: materials.add(asset_handles.player_sprite.clone().into()),</span></span>
<span class="line"><span style="color: #abb2bf">            transform: Transform::from_translation(Vec3::new(0.0, 0.0, 0.0)),</span></span>
<span class="line"><span style="color: #abb2bf">            ..Default::default()</span></span>
<span class="line"><span style="color: #abb2bf">        })</span></span>
<span class="line"><span style="color: #abb2bf">        .insert(Player { velocity: Vec2::ZERO });</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>This code creates a new <code>SpriteBundle</code> with the player sprite asset and adds it to the entity. We also add a <code>Player</code> component to the entity to store the player’s velocity.</p>
<p>We can add sound effects to our game using Bevy’s audio system. To add a sound effect, we first need to create an asset for the sound. We can do this by adding the following code to our <code>assets.rs</code> file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">#[derive(Default, Clone)]</span></span>
<span class="line"><span style="color: #abb2bf">pub struct AudioHandles {</span></span>
<span class="line"><span style="color: #abb2bf">    pub jump_sound: Handle&#x3C;AudioSource>,</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">fn load_audio(</span></span>
<span class="line"><span style="color: #abb2bf">    mut commands: Commands,</span></span>
<span class="line"><span style="color: #abb2bf">    asset_server: Res&#x3C;AssetServer>,</span></span>
<span class="line"><span style="color: #abb2bf">    mut audio_handles: ResMut&#x3C;AudioHandles>,</span></span>
<span class="line"><span style="color: #abb2bf">) {</span></span>
<span class="line"><span style="color: #abb2bf">    audio_handles.jump_sound =</span></span>
<span class="line"><span style="color: #abb2bf">        asset_server.load("sounds/jump.ogg");</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>Next, we need to play the sound effect when the player jumps. We can do this by adding the following code to our <code>player.rs</code> file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">pub fn jump(</span></span>
<span class="line"><span style="color: #abb2bf">    audio: Res&#x3C;Audio>,</span></span>
<span class="line"><span style="color: #abb2bf">    audio_handles: Res&#x3C;AudioHandles>,</span></span>
<span class="line"><span style="color: #abb2bf">    player_query: Query&#x3C;&#x26;Transform, With&#x3C;Player>>,</span></span>
<span class="line"><span style="color: #abb2bf">) {</span></span>
<span class="line"><span style="color: #abb2bf">    if let Ok(transform) = player_query.single() {</span></span>
<span class="line"><span style="color: #abb2bf">        audio.play(</span></span>
<span class="line"><span style="color: #abb2bf">            audio_handles</span></span>
<span class="line"><span style="color: #abb2bf">                .jump_sound</span></span>
<span class="line"><span style="color: #abb2bf">                .clone()</span></span>
<span class="line"><span style="color: #abb2bf">                .typed::&#x3C;AudioSource>(),</span></span>
<span class="line"><span style="color: #abb2bf">        );</span></span>
<span class="line"><span style="color: #abb2bf">    }</span></span>
<span class="line"><span style="color: #abb2bf">}</span></span></code></pre>
<p>This code plays the <code>jump_sound</code> asset when the player jumps. We use the <code>Res&#x3C;Audio></code> resource to access the audio system and the <code>Res&#x3C;AudioHandles></code> resource to access the sound effect asset.</p>
<p>With these basic systems in place, we can continue to add more gameplay mechanics, graphics, and sound effects to our game. Bevy provides a powerful and flexible framework for game development, and we can customize these systems to fit our specific game mechanics and physics requirements.</p>
<h2 id="adding-menus-user-interfaces-and-game-states-to-the-platformer-game">Adding menus, user interfaces, and game states to the platformer game</h2>
<p>To make the game more engaging and user-friendly, we can add menus, user interfaces, and game states. This will allow players to navigate the game and easily understand their progress. Here’s an example of how we can implement these features in our platformer game using Bevy:</p>
<h3 id="menus-and-user-interfaces">Menus and User Interfaces</h3>
<p>We can use Bevy’s built-in UI library to create menus and interfaces. Let’s create a simple main menu screen that allows players to start a new game, continue a previous game, or exit the game:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_menu</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"fonts/FiraSans-Bold.ttf"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">background_texture</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"textures/background.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">background_texture</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add background image</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">UiCameraBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">UiBackground</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add buttons</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_size</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_margin</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_font_size</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">30.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">new_game_button</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ButtonBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_size</span><span style="color: #ABB2BF">.x), </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_size</span><span style="color: #ABB2BF">.y)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">margin</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">all</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_margin</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">align_self</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">AlignSelf</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Button</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            (),</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // TODO: Implement new game functionality</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Button</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">style</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">text_color</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">background</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">border_radius</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">5.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">with_section</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #98C379">"New Game"</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">button_font_size</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        ),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">new_game_button</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">continue_game_button</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ButtonBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_size</span><span style="color: #ABB2BF">.x), </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_size</span><span style="color: #ABB2BF">.y)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">margin</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">all</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_margin</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">align_self</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">AlignSelf</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Button</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            (),</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // TODO: Implement continue game functionality</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Button</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">style</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">text_color</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">background</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">border_radius</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">5.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">with_section</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #98C379">"Continue"</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">button_font_size</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        ),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">continue_game_button</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">exit_button</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ButtonBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_size</span><span style="color: #ABB2BF">.x), </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_size</span><span style="color: #ABB2BF">.y)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">margin</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">all</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">button_margin</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">align_self</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">AlignSelf</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Button</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            (),</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // TODO: Implement exit game functionality</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Button</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">style</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">text_color</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">background</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">border_radius</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">5.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">with_section</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #98C379">"Start"</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"fonts/FiraSans-Bold.ttf"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">60.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">TextAlignment</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        ),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create the "Quit" button</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">margin</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">left</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Auto</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">right</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Auto</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">top</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">bottom</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Auto</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">justify_content</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">JustifyContent</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">align_items</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">AlignItems</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    }).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MenuButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Quit</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn the camera</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">OrthographicCameraBundle</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new_2d</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Set the game state to the main menu</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">game_state</span><span style="color: #ABB2BF">.current </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">MainMenu</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">load_assets</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load the player sprite</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"sprites/player.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn the player</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">64.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    }).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load the platform sprite</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"sprites/platform.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn the platforms</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, -</span><span style="color: #D19A66">240.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF">.scale.x </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">192.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    }).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Platform</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(-</span><span style="color: #D19A66">320.0</span><span style="color: #ABB2BF">, -</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF">.scale.x </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">128.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    }).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Platform</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">320.0</span><span style="color: #ABB2BF">, -</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF">.scale.x </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">128.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">32.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">platform_transform</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    }).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Platform</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load the background sprite</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"sprites/background.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">texture_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn the background</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Sprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">800.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">600.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    }).</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Background</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">handle_menu_button</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">game_state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">menu_button</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">MenuButton</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Interaction</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Clicked</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">menu_button</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">MenuButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">NewGame</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                        // TODO: Handle new game button click</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">game_state</span><span style="color: #ABB2BF">.current </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">NewGame</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                    }</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">MenuButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Continue</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                        // TODO: Handle continue button click</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">game_state</span><span style="color: #ABB2BF">.current </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                    }</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">MenuButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Quit</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                        // TODO: Handle quit button click</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">game_state</span><span style="color: #ABB2BF">.current </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Quit</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                    }</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => {}</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Make sure to replace the TODO comments in the code with the actual implementation for each button’s functionality. Additionally, you’ll need to define the GameState and MenuButton types and resources according to your game’s logic.</p>
<p>This code sets up a basic main menu screen with buttons for starting a new game, continuing a previous game, and quitting the game. When a button is clicked, the game_state resource is updated accordingly. You can then use the game_state in other systems to transition between different game states or perform the appropriate actions based on the current state.</p>
<p>Remember to adjust the paths to your actual asset files, such as fonts, textures, and sprites, in the setup_menu and load_assets functions.</p>
<p>This is just a basic example to get you started with menus and interfaces in Bevy. You can customize the appearance, layout, and functionality of the buttons according to your game’s requirements.</p>
<h2 id="designing-the-game-world-and-creating-levels">Designing the game world and creating levels</h2>
<p>Once you have the basic gameplay mechanics, graphics, and sound effects in place, the next step is to design the game world and create levels for the player to explore. In a platformer game, this typically involves designing levels with different platforms, obstacles, enemies, and power-ups.</p>
<p>To create levels in Bevy, you can use a combination of entity placement and procedural generation. You can create entities for different platforms, obstacles, enemies, and power-ups, and place them in the game world using coordinates and rotations. You can also use procedural generation algorithms to generate random or semi-random levels, which can add replay value and variety to the game.</p>
<p>One way to design levels is to create a level editor tool within the game itself, which allows the player to design their own levels and share them with others. This can be a powerful way to engage the community and encourage players to create and share their own content.</p>
<p>Another approach is to create a set of pre-designed levels that are carefully balanced and curated to provide a satisfying and challenging experience for the player. This can be a more traditional approach to level design, but it requires careful planning and testing to ensure that the levels are not too easy or too difficult.</p>
<p>Overall, designing the game world and creating levels is a critical part of the game development process, and it requires careful planning and attention to detail. By using Bevy’s powerful entity-component system and procedural generation capabilities, you can create complex and engaging game worlds that provide hours of entertainment for players.</p>
<h2 id="creating-and-animating-player-and-enemy-characters">Creating and animating player and enemy characters</h2>
<p>To create and animate player and enemy characters in our platformer game, we can use Bevy’s sprite and animation systems. We’ll first create a sprite sheet containing the animations for our characters. We can use an image editing tool such as GIMP or Photoshop to create the sprite sheet.</p>
<p>Once we have the sprite sheet, we can load it into our Bevy project using the <code>TextureAtlas</code> resource. We’ll create an entity for each character and attach a <code>SpriteSheetBundle</code> component to it, which contains the <code>TextureAtlas</code> and the animations for the character.</p>
<p>Here’s an example code for creating a player character with a <code>SpriteSheetBundle</code> component attached to it:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_player</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">TextureAtlas</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_sheet</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SpriteSheet</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">16.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">16.0</span><span style="color: #ABB2BF">), </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // add animations to the sprite sheet</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">idle_animation</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_sheet</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_animation</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"idle"</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">walk_animation</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_sheet</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_animation</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"walk"</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">], </span><span style="color: #D19A66">0.1</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">AnimationDirection</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Loop</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">jump_animation</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite_sheet</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_animation</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"jump"</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">], </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">AnimationDirection</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Once</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteSheetBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">index</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite_sheet</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PlayerState</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Idle</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PlayerAnimations</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">idle_animation</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">walk_animation</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">jump_animation</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we create a new <code>SpriteSheet</code> object and add animations to it using the <code>add_animation</code> method. We then spawn a new entity with a <code>SpriteSheetBundle</code> component attached to it, which contains the <code>TextureAtlas</code>, the sprite index (in this case, 0), the initial <code>Transform</code>, and the <code>SpriteSheet</code> object we created earlier. We also attach several other components to the entity, such as <code>Player</code>, <code>PlayerState</code>, and <code>PlayerAnimations</code>.</p>
<p>To animate the character, we can change the <code>index</code> property of the <code>TextureAtlasSprite</code> component based on the current animation state. We can use Bevy’s <code>Timer</code> and <code>Time</code> resources to control the timing of the animations.</p>
<p>Here’s an example code for animating the player character:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">animate_player</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">PlayerState</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">PlayerAnimations</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">animations</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">PlayerStateType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Idle</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">.index </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animations</span><span style="color: #ABB2BF">.idle_animation.</span><span style="color: #61AFEF">get_frame_index</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">seconds_since_startup</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">PlayerStateType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Walk</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">.index </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animations</span><span style="color: #ABB2BF">.walk_animation.</span><span style="color: #61AFEF">get_frame_index</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">seconds_since_startup</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">PlayerStateType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Jump</span><span style="color: #ABB2BF"> => {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">.index </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animations</span><span style="color: #ABB2BF">.jump_animation.</span><span style="color: #61AFEF">get_frame_index</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">seconds_since_startup</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we query for all entities with a <code>TextureAtlasSprite</code>, <code>PlayerState</code>, and <code>PlayerAnimations</code> components attached to them. We then update the <code>index</code> property of the <code>TextureAtlasSprite</code> based on the current animation</p>
<p>frame to display the correct sprite. Finally, we set the <code>last_frame_time</code> property to the current time so that we can calculate the time elapsed for the next frame.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">animate_sprite_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Animation</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">SpriteAnimation</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">current_time</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">seconds_since_startup</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">elapsed_time</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">current_time</span><span style="color: #ABB2BF"> - </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.last_frame_time;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">elapsed_time</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">>=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.frame_duration {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.index </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.index + </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) % </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.frames.</span><span style="color: #61AFEF">len</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">.index </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.frames[</span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.index];</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">animation</span><span style="color: #ABB2BF">.last_frame_time </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">current_time</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>We can now use the <code>SpriteAnimation</code> component to animate our player and enemy characters by setting the <code>frames</code> and <code>frame_duration</code> properties accordingly.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_texture_atlas_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"textures/player_spritesheet.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteSheetComponents</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">player_texture_atlas_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteAnimation</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">frames</span><span style="color: #ABB2BF">: </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">frame_duration</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.1</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">index</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">last_frame_time</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemy_texture_atlas_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"textures/enemy_spritesheet.png"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteSheetComponents</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">enemy_texture_atlas_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">5.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Enemy</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteAnimation</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">frames</span><span style="color: #ABB2BF">: </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">frame_duration</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">index</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">last_frame_time</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span></code></pre>
<p>With these changes, our player and enemy characters will now be animated based on the specified sprite frames and animation speed.</p>
<h2 id="implementing-collision-detection-and-physics-for-the-game-objects">Implementing collision detection and physics for the game objects</h2>
<p>To implement collision detection and physics for game objects, we can use the Bevy <code>physics</code> plugin, which provides a physics engine based on the nphysics library. We first need to add the <code>PhysicsPlugin</code> to our <code>AppBuilder</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy_rapier2d</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">physics</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">PhysicsPlugin</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PhysicsPlugin</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">physics_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>With the <code>PhysicsPlugin</code> added, we can create physics bodies for our game objects. For example, to add a physics body to our player character, we can add a <code>RigidBodyBuilder</code> component to the player entity:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy_rapier2d</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">physics</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">RigidBodyBuilder</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">RapierConfiguration</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">texture_atlases</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">TextureAtlas</span><span style="color: #ABB2BF">>>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">SpriteSheetBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">texture_atlas</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">texture_atlas_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">index</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(-</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">RigidBodyBuilder</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new_dynamic</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">translation</span><span style="color: #ABB2BF">(-</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ColliderBuilder</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">cuboid</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">16.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">16.0</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we create a <code>RigidBodyBuilder</code> component with the <code>new_dynamic</code> method to create a dynamic physics body. We also set the initial translation of the body to match the initial position of the player character sprite. Finally, we add a <code>ColliderBuilder</code> component to define the shape of the collider. In this case, we create a rectangular collider with dimensions 16x16.</p>
<p>With the physics bodies set up, we can now detect collisions between objects using collision events. We can add a collision event listener to our player entity to detect collisions with other objects:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy_rapier2d</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">physics</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">RigidBodyHandleComponent</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">RapierConfiguration</span><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy_rapier2d</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">rapier</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">dynamics</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">RigidBodySet</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">RigidBodyType</span><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy_rapier2d</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">rapier</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">geometry</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">ColliderHandle</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">ContactEvent</span><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy_rapier2d</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">rapier</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">na</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Vector2</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">physics_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">contact_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ContactEvent</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">rigid_bodies</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">RigidBodySet</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">RigidBodyHandleComponent</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // handle contact events</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">contact_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">ContactEvent</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Started</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle1</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">handle2</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // handle collision start events</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">ContactEvent</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Stopped</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle1</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">handle2</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // handle collision stop events</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // update sprite positions based on physics bodies</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">body_handle</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">body</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">rigid_bodies</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_mut</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">body_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">handle</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">body</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">position</span><span style="color: #ABB2BF">().translation.vector;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">.transform.translation.x </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">.x;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">.transform.translation.y </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">.y;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use the <code>EventReader&#x3C;ContactEvent></code> resource to read collision events from the physics engine. We also use a <code>Query</code> to retrieve the <code>TextureAtlasSprite</code></p>
<p>component and the <code>Transform</code> component of the player and the enemy objects.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">collision_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioOutput</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_assets</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioAssets</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Score</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ContactEvent</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">texture_atlases</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">TextureAtlas</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query_player</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query_enemy</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(</span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextureAtlasSprite</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Enemy</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">ContactEvent</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Started</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">collision</span><span style="color: #ABB2BF">) => </span><span style="color: #E06C75">collision</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entity_a</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity_a</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entity_b</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">collision</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entity_b</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // check for collision between player and enemy</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">player_entity</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_sprite</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_transform</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">)) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query_player</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">single_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">                (</span><span style="color: #E06C75">entity_a</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">)) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query_player</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">next</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">                (</span><span style="color: #E06C75">entity_a</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">enemy_entity</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemy_sprite</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemy_transform</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">)) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query_enemy</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">single_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">                (</span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">)) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query_enemy</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">next</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">                (</span><span style="color: #E06C75">entity</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">sprite</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">entity_a</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_entity</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entity_b</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemy_entity</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">entity_b</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_entity</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entity_a</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemy_entity</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // play hit sound</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">play</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">audio_assets</span><span style="color: #ABB2BF">.hit_sound.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // reduce player health and update score</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">health</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_sprite</span><span style="color: #ABB2BF">.index % </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">health</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">health</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">player_sprite</span><span style="color: #ABB2BF">.index </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">health</span><span style="color: #ABB2BF"> + </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">.points </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // player dies</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">player_sprite</span><span style="color: #ABB2BF">.index </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">insert_one</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">player_entity</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Timer</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_seconds</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">.lives </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // update enemy health</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemy_health</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemy_sprite</span><span style="color: #ABB2BF">.index % </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemy_health</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">enemy_health</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">enemy_sprite</span><span style="color: #ABB2BF">.index </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemy_health</span><span style="color: #ABB2BF"> + </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // enemy dies</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">despawn</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">enemy_entity</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">.points </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">50</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // update player and enemy positions</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">player_transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">enemy_transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10.0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this system, we first check for collision events by iterating over the <code>ContactEvent</code> events from the <code>EventReader</code>. If a collision event is detected, we retrieve the colliding entities and check if one is the player and the other is an enemy.</p>
<p>If a collision between the player and an enemy is detected, we play a hit sound effect, reduce the player’s health, and update the score accordingly. If the player’s health is reduced to zero, we update the player’s sprite to show a death animation and insert a timer to wait for half a second before respawning the player. If the enemy’s health is reduced to zero, we despawn the enemy and add points to the player’s score.</p>
<p>Finally, we update the positions of the player and enemy objects by translating their <code>Transform</code> components in the y-axis.</p>
<p>With collision detection and physics implemented,</p>
<h2 id="adding-pickups-powerups-and-obstacles-to-the-game-world">Adding pickups, powerups, and obstacles to the game world</h2>
<p>To add pickups, powerups, and obstacles to the game world, we can create new entities with their own components.</p>
<p>For pickups, we can create an entity with a <code>Transform</code> component for its position, a <code>Collider</code> component to detect collisions with the player, and a <code>Pickup</code> component to mark it as a pickup. We can also add a <code>Sprite</code> component to display the pickup in the game world.</p>
<p>Powerups can be implemented in a similar way, but with additional components to define their effect on the player, such as <code>HealthBoost</code> or <code>SpeedBoost</code>.</p>
<p>Obstacles can also be created with a <code>Transform</code> component for position and a <code>Collider</code> component to detect collisions with the player. We can use a <code>Sprite</code> component to display the obstacle, or create a custom mesh for more complex shapes.</p>
<p>To detect collisions with pickups and obstacles, we can use the same <code>Query</code> approach as with the enemies, checking for collisions in the <code>on_collision_event</code> system.</p>
<p>We can also add additional systems to handle the effects of pickups and powerups on the player, such as increasing the player’s health or speed.</p>
<h2 id="implementing-a-scoring-system-and-game-over-conditions">Implementing a scoring system and game over conditions</h2>
<p>To implement a scoring system, we first need to define the conditions under which the player earns points. In our platformer game, we can award points to the player for collecting pickups or defeating enemies. We can add a <code>score</code> field to our <code>Player</code> component and update it whenever the player collects a pickup or defeats an enemy.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">speed</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">jump_force</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">facing</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Facing</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">grounded</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">bool</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">u32</span><span style="color: #ABB2BF">,</span><span style="color: #7F848E; font-style: italic"> // new score field</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">pickup_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pickups</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(</span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Collider</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">players</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">pickup_entity</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">pickup_transform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">pickup_collider</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pickups</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">players</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pickup_collider</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">overlaps</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.collider) {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.score </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // award points for pickup collection</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">despawn</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">pickup_entity</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">enemy_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemies</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(</span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Collider</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">players</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">enemy_entity</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">enemy_transform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">enemy_collider</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemies</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">players</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">enemy_collider</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">overlaps</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.collider) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // TODO: Handle player defeat or subtract points</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.score </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">;</span><span style="color: #7F848E; font-style: italic"> // subtract points for enemy encounter</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">despawn</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">enemy_entity</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // Check if the player's score reaches a game over condition</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.score </span><span style="color: #56B6C2">&#x3C;=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                    // TODO: Implement game over logic</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                    // For example, you could display a game over screen or reset the game.</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In the above code, we define two systems: pickup_system and enemy_system. The pickup_system checks for collisions between pickups and the player’s collider. If a collision is detected, it increases the player’s score by 10 and despawns the pickup entity.</p>
<p>Similarly, the enemy_system checks for collisions between enemies and the player’s collider. If a collision is detected, it subtracts 20 points from the player’s score and despawns the enemy entity. It also checks if the player’s score reaches a game over condition (e.g., score &#x3C;= 0) and implements the appropriate game over logic. You can customize the game over logic based on your game’s requirements.</p>
<p>To include these systems in your Bevy app, add them to the system schedule in the main function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">DefaultPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup_menu</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">load_assets</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle_menu_button</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">pickup_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">enemy_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<h2 id="adding-audio-and-sound-effects-to-the-game">Adding audio and sound effects to the game</h2>
<p>To add audio and sound effects to the game, we can use Bevy’s audio system. First, we need to load audio files and register them with the audio system. We can do this by creating a resource that contains a <code>HashMap</code> of audio file paths to audio handles:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AudioAssets</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FromResources</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AudioAssets</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">from_resources</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">resources</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Resources</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Self</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_paths</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">"assets/sound/jump.wav"</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">"assets/sound/coin.wav"</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">path</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_paths</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">resources</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_handle</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">AudioAssets</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we’re loading two audio files: “assets/sound/jump.wav” and “assets/sound/coin.wav”. We’re creating a handle for each audio file and adding it to the <code>HashMap</code>.</p>
<p>Next, we need to play the audio files at the appropriate times. For example, we can play the “jump” sound effect when the player jumps by adding the following code to the player system:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">player_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Input</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_assets</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioAssets</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventWriter</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioPlay</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keyboard_input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Space</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Play the jump sound effect.</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_assets</span><span style="color: #ABB2BF">.handles.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"assets/sound/jump.wav"</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">send</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AudioPlay</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">gain</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">pitch</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            });</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we’re checking if the player just pressed the space key to jump. If so, we’re retrieving the handle for the “jump” sound effect and sending an <code>AudioPlay</code> event to play the audio with the specified gain and pitch.</p>
<p>We can also play the “coin” sound effect when the player collects a pickup by adding the following code to the pickup system:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">pickup_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_assets</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioAssets</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventWriter</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioPlay</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(</span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Pickup</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">player_query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">distance_squared</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pickup_radius_squared</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // Play the coin sound effect.</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio_assets</span><span style="color: #ABB2BF">.handles.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"assets/sound/coin.wav"</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">send</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">AudioPlay</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">gain</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">pitch</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            });</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we’re checking if the player has collected a pickup by checking if the distance between the player and pickup is less than the pickup radius. If so, we’re retrieving the handle for the “coin” sound effect and sending an <code>AudioPlay</code> event to play the audio with the specified gain and pitch.</p>
<p>By adding audio to our game, we can enhance the player’s experience and make the game more engaging.</p>
<p>To add audio to our game, we will use the <code>bevy_kira_audio</code> plugin, which provides a simple and efficient way to play sounds and music. We start by adding the plugin to our <code>Cargo.toml</code> file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">[</span><span style="color: #61AFEF">dependencies</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #E06C75">bevy_kira_audio</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.6"</span></span></code></pre>
<p>We then create a new <code>Audio</code> resource and add it to the app state:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">jump_sound</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">coin_sound</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">music</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioSource</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">insert_resource</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">jump_sound</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"audio/jump.ogg"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">coin_sound</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"audio/coin.ogg"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">music</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"audio/music.ogg"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In the <code>update()</code> function of our <code>PlayerSystem</code>, we play the jump sound when the player jumps and the coin sound when the player collects a coin:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Audio</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">just_pressed</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">KeyCode</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Space</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">        // ...</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">audio</span><span style="color: #ABB2BF">.jump_sound.</span><span style="color: #61AFEF">play</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">pickup</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pickups_query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">collision</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">intersection</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">player_bb</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E06C75">pickup</span><span style="color: #ABB2BF">.bounding_box) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">            // ...</span></span></code></pre>
<h2 id="testing-and-debugging-the-platformer-game">Testing and debugging the platformer game</h2>
<p>Testing and debugging are important parts of game development to ensure that the game is functioning as expected and to catch any bugs or issues that may arise. Bevy provides several tools and features to aid in testing and debugging.</p>
<p>One of the most important tools for testing is the ability to simulate user input. In Bevy, this can be achieved using the <code>bevy::input::keyboard::KeyboardInput</code> and <code>bevy::input::mouse::MouseButtonInput</code> structs to simulate keyboard and mouse input events. This allows us to test the game without having to manually play through it each time.</p>
<p>Another important tool for testing is logging. Bevy provides a logging system that allows developers to output messages to the console during runtime. This can be useful for debugging, as it allows us to see what is happening inside the game at any given time.</p>
<p>In addition to logging, Bevy also provides a built-in debugging system that allows developers to visualize and interact with the game in real-time. This system includes tools for inspecting entities and components, visualizing the game world, and more. It can be enabled by adding the <code>bevy_mod_debug_console</code> and <code>bevy_mod_debug_spawn_tree</code> plugins to the game.</p>
<p>When testing and debugging, it is also important to consider performance. Bevy provides a number of profiling tools to help identify performance bottlenecks and optimize the game. These tools include the ability to measure frame times, CPU usage, and more.</p>
<p>In addition to these built-in tools, there are also a number of external testing and debugging tools available for Rust and Bevy, such as <code>cargo-watch</code> for automatic compilation and reloading, <code>cargo-expand</code> for macro expansion analysis, and <code>cargo-profiler</code> for profiling and performance analysis.</p>
<p>Overall, testing and debugging are essential parts of game development and Bevy provides a range of tools and features to make the process as smooth and efficient as possible.</p>
<h2 id="deploying-the-platformer-game-to-desktop-and-mobile-platforms">Deploying the platformer game to desktop and mobile platforms</h2>
<p>To deploy the platformer game to desktop and mobile platforms, we need to package the game and create executable files for each platform. Bevy provides several tools and plugins to simplify the deployment process.</p>
<h3 id="packaging-the-game">Packaging the game</h3>
<p>To package the game, we first need to create a release build. We can do this by running the following command in the terminal:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cargo build --release</span></span></code></pre>
<p>This will compile the game with optimizations enabled and create a binary file in the <code>target/release</code> directory.</p>
<h3 id="deploying-to-desktop-platforms">Deploying to desktop platforms</h3>
<p>To deploy the game to desktop platforms, we can use Bevy’s <code>bevy-pack</code> plugin, which provides a simple way to package the game for Windows, macOS, and Linux.</p>
<p>First, we need to install the plugin by running the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cargo install bevy-pack</span></span></code></pre>
<p>Once the plugin is installed, we can use it to create executable files for each platform. For example, to create an executable file for Windows, we can run the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cargo pack --release --platform windows --executable platformer</span></span></code></pre>
<p>This will create a Windows executable file named <code>platformer.exe</code> in the <code>target/release/bundle/windows</code> directory.</p>
<p>Similarly, we can create executable files for macOS and Linux by changing the <code>--platform</code> argument to <code>macos</code> or <code>linux</code>.</p>
<h3 id="deploying-to-mobile-platforms">Deploying to mobile platforms</h3>
<h1 id="chapter-12-sample-project-a-multiplayer-space-shooter">Chapter 12: Sample Project: A Multiplayer Space Shooter</h1>
<h2 id="building-a-multiplayer-space-shooter-game-using-bevy-and-rust">Building a multiplayer space shooter game using Bevy and Rust</h2>
<p>To build a multiplayer space shooter game using Bevy and Rust, we need to implement networked gameplay mechanics such as synchronizing game state between clients and a server, handling player input, and managing game logic.</p>
<p>Here is an overview of the steps involved in building a multiplayer space shooter game using Bevy and Rust:</p>
<ol>
<li>
<p>Setting up a client-server architecture: We need to create a server that manages the game state and communicates with the clients. The clients will send player input to the server, which will update the game state and send it back to the clients.</p>
</li>
<li>
<p>Synchronizing game state: We need to implement a mechanism to synchronize the game state between the clients and the server. This involves sending updates to the server and clients, handling network latency, and ensuring that the game remains synchronized across all clients.</p>
</li>
<li>
<p>Handling player input: We need to implement a mechanism to handle player input on the client-side and send it to the server. This involves creating a system that listens for input events and sends them to the server using a network protocol such as UDP or TCP.</p>
</li>
<li>
<p>Implementing game logic: We need to implement game mechanics such as spawning enemies, handling collisions, and keeping track of player scores. This involves creating systems that update the game state based on input events and other game events.</p>
</li>
<li>
<p>Adding graphics and audio: We need to create 2D or 3D graphics for the game objects and use audio effects to enhance the player’s experience.</p>
</li>
<li>
<p>Testing and debugging: We need to test the game to ensure that it works correctly on different platforms and configurations. We also need to debug any issues that arise during development.</p>
</li>
<li>
<p>Deploying the game: We need to package the game for deployment on different platforms, including desktop and mobile devices.</p>
</li>
</ol>
<p>These are the general steps involved in building a multiplayer space shooter game using Bevy and Rust. However, the specific implementation details will vary depending on the requirements of the game and the desired gameplay mechanics.</p>
<h2 id="implementing-networked-gameplay-mechanics-graphics-and-sound-effects">Implementing networked gameplay mechanics, graphics, and sound effects</h2>
<p>To implement networked gameplay mechanics in our multiplayer space shooter game, we need to set up a client-server architecture where the authoritative server controls the game state and sends updates to the clients. The clients send user input to the server, which then updates the game state and sends the updated state to all connected clients.</p>
<p>We can start by defining the game state data that needs to be synchronized across all clients, such as the positions and velocities of the players and bullets, the health and score of the players, and the game over state. We can use a Bevy <code>NetworkStage</code> to handle the low-level networking details, such as packet serialization and deserialization, sending and receiving packets, and handling network events.</p>
<p>Next, we can implement the game mechanics for our multiplayer space shooter game. This might include spawning enemy ships at random intervals, allowing players to shoot bullets at enemy ships, and detecting collisions between the bullets and ships. We can use Bevy’s built-in physics engine and collision detection system to handle these game mechanics.</p>
<p>We can also create graphics and sound effects for our game using Bevy’s sprite rendering system and audio engine. This might include drawing the player and enemy ships, animating their movements and explosions, and playing sound effects for shooting and explosions.</p>
<p>To test and debug our multiplayer space shooter game, we can use Bevy’s built-in debug tools, such as the Bevy Debugger and the Entity Inspector. We can also use third-party tools, such as Wireshark, to monitor network traffic and diagnose network issues.</p>
<p>Finally, to deploy our multiplayer space shooter game to desktop and mobile platforms, we can use Bevy’s cross-platform deployment capabilities, such as packaging the game as a standalone executable or using WebAssembly and WebGL to run the game in a web browser. We can also use third-party tools, such as itch.io or Steam, to distribute and sell our game to a wider audience.</p>
<h2 id="adding-menus-user-interfaces-and-game-states-to-the-multiplayer-space-shooter-game">Adding menus, user interfaces, and game states to the multiplayer space shooter game</h2>
<p>Adding menus, user interfaces, and game states to the multiplayer space shooter game is an essential step in making the game more polished and user-friendly. In this section, we’ll add a main menu, a settings menu, and a game over screen to the game.</p>
<h2 id="creating-the-main-menu">Creating the main menu</h2>
<p>We’ll start by creating the main menu for the game. We’ll use the Bevy <code>Ui</code> and <code>Text</code> components to create a simple menu with two buttons: “Play” and “Settings”.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">create_main_menu</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ui_fonts</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Font</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">font_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"fonts/FiraSans-Bold.ttf"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_material</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.2</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_material_hovered</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.3</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_text_style</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">font_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">40.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">button_text_style_hovered</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">font_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">40.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">rgb</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">play_button</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">NodeBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">60.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">position_type</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">PositionType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Absolute</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">top</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Percent</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">left</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Percent</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">button_material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">play_text</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">with_section</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #98C379">"Play"</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">button_text_style</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">TextAlignment</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">horizontal</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">HorizontalAlign</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">vertical</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">VerticalAlign</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">        ),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">play_button</span><span style="color: #ABB2BF">.children.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">play_text</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">settings_button</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">NodeBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Style</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Size</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">60.0</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">position_type</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">PositionType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Absolute</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Rect</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">top</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Px</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">100.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">left</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Val</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Percent</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        },</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">button_material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">settings_text</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">with_section</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #98C379">"Settings"</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">button_text_style</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">TextAlignment</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">horizontal</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">HorizontalAlign</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">vertical</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">VerticalAlign</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">        ),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">settings_button</span><span style="color: #ABB2BF">.children.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">settings_text</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">play_button</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MainMenuButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Play</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonMaterials</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">normal</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">button_material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">hovered</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">button_material_hovered</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn_bundle</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">settings_button</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MainMenuButton</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Settings</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ButtonMaterials</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">normal</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">button_material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">hovered</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">button_material_hovered</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add title text</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">title_text</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">with_section</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #98C379">"Space Shooter"</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">font_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">60.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            }),</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">with_children</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">parent</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">with_section</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #98C379">"Welcome to the Space Shooter game!"</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">font_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">40.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">YELLOW</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                    },</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">TextAlignment</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">vertical</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">VerticalAlign</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">horizontal</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">HorizontalAlign</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    },</span></span>
<span class="line"><span style="color: #ABB2BF">                ),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            })</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">parent</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">TextBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Text</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">with_section</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #98C379">"Press 'S' to start the game."</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">TextStyle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">font</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">font_handle</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">font_size</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">30.0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Color</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">WHITE</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                    },</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">TextAlignment</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">vertical</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">VerticalAlign</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">horizontal</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">HorizontalAlign</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Center</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    },</span></span>
<span class="line"><span style="color: #ABB2BF">                ),</span></span>
<span class="line"><span style="color: #ABB2BF">                ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            })</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, -</span><span style="color: #D19A66">50.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">)));</span></span>
<span class="line"><span style="color: #ABB2BF">        });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_game</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioOutput</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioEvents</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Assets</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ui_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Events</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">UiEvent</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetHandles</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn the player spaceship</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_spawn_location</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">, -</span><span style="color: #D19A66">350.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">spawn_player</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">.player_texture.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()), </span><span style="color: #E06C75">player_spawn_location</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn the background</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">spawn_background</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">.background_texture.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn the enemies</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">spawn_enemies</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">.enemy_texture.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn the pickups</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">spawn_pickups</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">.pickup_texture.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn the powerups</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">spawn_powerups</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">.powerup_texture.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Set up the game state</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">insert_resource</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Set up the UI</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">setup_ui</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75">materials</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">asset_handles</span><span style="color: #ABB2BF">.font.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()), </span><span style="color: #E06C75">ui_events</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">spawn_player</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AssetServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioOutput</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">AudioEvents</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Handle</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ColorMaterial</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">location</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec3</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Load the player spaceship model</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player_model_handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asset_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"models/player_spaceship.gltf#Scene0"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Spawn the player spaceship entity</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">PbrBundle</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">mesh</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">player_model_handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">material</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_translation</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">location</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        ..</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">speed</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">PLAYER_SPEED</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">last_fired</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">time</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Instant</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">now</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">bullet_count</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    })</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">Team</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Collider</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ColliderType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">PLAYER_COLLIDER_RADIUS</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">    .</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Health</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">PLAYER_MAX_HEALTH</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">with</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Sound</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">audio_output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">audio_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #E06C75">sounds</span><span style="color: #ABB2BF">: </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">SoundType</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Shoot</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<h2 id="creating-a-server-client-architecture-for-the-multiplayer-space-shooter-game">Creating a server-client architecture for the multiplayer space shooter game</h2>
<p>To implement networked gameplay in the multiplayer space shooter game, we need to set up a server-client architecture where the authoritative server manages the game state and handles player input and movement updates. The clients send their input to the server, which processes the input and updates the game state. The server then sends the updated game state to all connected clients, which render the game locally.</p>
<p>We’ll start by creating a separate Bevy project for the server and adding the necessary dependencies, including the <code>bevy_networking_turbulence</code> crate for network communication and the <code>serde</code> and <code>serde_json</code> crates for serialization.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #7F848E; font-style: italic"># in Cargo.toml for server project</span></span>
<span class="line"><span style="color: #ABB2BF">[</span><span style="color: #61AFEF">dependencies</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #E06C75">bevy</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.5"</span></span>
<span class="line"><span style="color: #E06C75">bevy_networking_turbulence</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"0.2"</span></span>
<span class="line"><span style="color: #E06C75">serde</span><span style="color: #ABB2BF"> = { </span><span style="color: #E06C75">version</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"1.0"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">features</span><span style="color: #ABB2BF"> = [</span><span style="color: #98C379">"derive"</span><span style="color: #ABB2BF">] }</span></span>
<span class="line"><span style="color: #E06C75">serde_json</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"1.0"</span></span></code></pre>
<p>Next, we’ll set up the server by creating a <code>ServerState</code> struct that will hold the game state and a <code>server_system</code> that will listen for incoming network events and handle player input and state updates. We’ll also create a <code>run_server</code> function that initializes the Bevy app, sets up the networking plugin, and starts the server.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">prelude</span><span style="color: #ABB2BF">::*;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">networking</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">NetworkEvent</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bevy_networking_turbulence</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">NetworkResource</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">NetworkServer</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Define the game state</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ServerState</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">players</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">u32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">server_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">network_server</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">NetworkServer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">network_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EventReader</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">NetworkEvent</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">server_state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ServerState</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Process incoming network events</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">network_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">NetworkEvent</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Message</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">_addr</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">payload</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // Deserialize the payload into a PlayerInput message</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">PlayerInput</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">serde_json</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_slice</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">payload</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">as_slice</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // Find the corresponding player in the server state</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">server_state</span><span style="color: #ABB2BF">.players.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">find</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">p</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">.id </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.player_id) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                    // Update the player's position and direction based on the input</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.position </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.direction * </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.move_amount * </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.direction </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.direction;</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => {}</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Update the game state and send updates to all connected clients</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">server_state</span><span style="color: #ABB2BF">.players.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">update</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">PlayerUpdate</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">player_id</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.id,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.position,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.direction,</span></span>
<span class="line"><span style="color: #ABB2BF">        };</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">update_payload</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">serde_json</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">to_vec</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">update</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">network_server</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">broadcast</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">update_payload</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">run_server</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Create the Bevy app</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">App</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">build</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add_plugins</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MinimalPlugins</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">NetworkResource</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_plugin</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">NetworkServer</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">init_resource</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">ServerState</span><span style="color: #ABB2BF">>()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_startup_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">setup_server_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">add_system</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">server_system</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">system</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setup_server_system</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">commands</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Commands</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">server_state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ServerState</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Initialize the game state with two players</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">server_state</span><span style="color: #ABB2BF">.players.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(-</span><span style="color: #D19A66">200.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">direction</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.0</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">server_state</span></span></code></pre>
<p>In addition to the player entities, we also need to synchronize the state of the bullets and asteroids across clients. We can do this by creating a separate <code>Bullet</code> and <code>Asteroid</code> component that contains all the necessary data for these entities.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Bullet</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Asteroid</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">velocity</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>We can then add a system to the server that updates the position of the bullets and asteroids based on their velocity every frame:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">update_bullets_and_asteroids_system</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bullets</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Bullet</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">                                       </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asteroids</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Asteroid</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">                                       </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">delta_time</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta_seconds</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bullet</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bullets</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">bullet</span><span style="color: #ABB2BF">.position </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bullet</span><span style="color: #ABB2BF">.velocity * </span><span style="color: #E06C75">delta_time</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.x </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bullet</span><span style="color: #ABB2BF">.position.x;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bullet</span><span style="color: #ABB2BF">.position.y;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asteroid</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asteroids</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">asteroid</span><span style="color: #ABB2BF">.position </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asteroid</span><span style="color: #ABB2BF">.velocity * </span><span style="color: #E06C75">delta_time</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.x </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asteroid</span><span style="color: #ABB2BF">.position.x;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asteroid</span><span style="color: #ABB2BF">.position.y;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>On the client side, we can create a system that updates the position of the bullets and asteroids based on their position received from the server:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">update_bullet_and_asteroid_positions_system</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bullets</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #E5C07B">Bullet</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">                                               </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asteroids</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #E5C07B">Asteroid</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">                                               </span><span style="color: #E06C75">server_state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">ServerState</span><span style="color: #ABB2BF">>) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">bullet</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bullets</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">server_bullet</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">server_state</span><span style="color: #ABB2BF">.bullets.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">bullet_entity</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.x </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">server_bullet</span><span style="color: #ABB2BF">.position.x;</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">server_bullet</span><span style="color: #ABB2BF">.position.y;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">asteroid</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">asteroids</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter_mut</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Some</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">server_asteroid</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">server_state</span><span style="color: #ABB2BF">.asteroids.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">asteroid_entity</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.x </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">server_asteroid</span><span style="color: #ABB2BF">.position.x;</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.y </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">server_asteroid</span><span style="color: #ABB2BF">.position.y;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Finally, we need to handle collision detection and damage calculation on both the server and the client. We can create a <code>Health</code> component that stores the</p>
<h2 id="synchronizing-game-state-across-multiple-players-in-the-multiplayer-space-shooter-game">Synchronizing game state across multiple players in the multiplayer space shooter game</h2>
<p>To synchronize game state across multiple players in the multiplayer space shooter game, we need to implement a system where the authoritative server sends updates to all connected clients. In our case, we’ll be using a “client-predictive, server-authoritative” model where the client simulates local game state based on player input and the server validates and corrects it.</p>
<p>To achieve this, we first need to define the messages that will be sent between the client and the server. We can do this using Rust enums and structs. For example, we might have an <code>UpdatePosition</code> message that contains the current position of a player:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Debug</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Clone</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Serialize</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Deserialize</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">UpdatePosition</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">entity_id</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec2</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>We can then define an <code>enum</code> to represent all the possible messages that can be sent:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Debug</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Clone</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Serialize</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Deserialize</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">enum</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">NetworkMessage</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">Connect</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">Disconnect</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Entity</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">UpdatePosition</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">UpdatePosition</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    // Add more message types as needed</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Next, we need to implement a system that sends updates to the server at a fixed rate. We can use Bevy’s <code>Timer</code> resource to do this. Here’s an example implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">send_updates_to_server_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Res</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Time</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">timer</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">SendUpdatesTimer</span><span style="color: #ABB2BF">>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">network_sender</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">NetworkSender</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">NetworkMessage</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;(&#x26;</span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">)>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">timer</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">0.</span><span style="color: #61AFEF">tick</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delta</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">timer</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">0.</span><span style="color: #61AFEF">finished</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">network_sender</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">send</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">NetworkMessage</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">UpdatePosition</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">UpdatePosition</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">entity_id</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">player</span><span style="color: #ABB2BF">.entity,</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">position</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.</span><span style="color: #61AFEF">truncate</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">            }));</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we’re using a <code>SendUpdatesTimer</code> resource to keep track of when to send updates to the server. We also have a query that retrieves the <code>Transform</code> and <code>Player</code> components for all players. We then send an <code>UpdatePosition</code> message for each player to the server.</p>
<p>On the server side, we need to implement a system that receives updates from clients and updates the game state accordingly. We can use Bevy’s <code>NetworkEvent&#x3C;T></code> type to do this. Here’s an example implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">handle_network_events_system</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">State</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">GameState</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">network_events</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ResMut</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">NetworkEvents</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">NetworkMessage</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Query</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Transform</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">With</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Player</span><span style="color: #ABB2BF">>>,</span></span>
<span class="line"><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">network_events</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">NetworkEvent</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Message</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">message</span><span style="color: #ABB2BF">) => </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">message</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">NetworkMessage</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">UpdatePosition</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">update</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_mut</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">update</span><span style="color: #ABB2BF">.entity_id) {</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">update</span><span style="color: #ABB2BF">.position.</span><span style="color: #61AFEF">extend</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">transform</span><span style="color: #ABB2BF">.translation.z);</span></span>
<span class="line"><span style="color: #ABB2BF">                    }</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // Handle other message types as needed</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => {}</span></span>
<span class="line"><span style="color: #ABB2BF">            },</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">NetworkEvent</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Disconnected</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">                // Handle player disconnection</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => {}</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we’re using a query to retrieve the <code>Transform</code> component for the player entity specified in the <code>UpdatePosition</code> message. We then update the position of the player based on the message.</p>
<p>By implementing these systems, we can synchronize game state across multiple players in our multiplayer space shooter game. Of course, there are many other details to consider, such as handling lag compensation, interpolation, and prediction. But this should give you a basic idea of how to get started with networked gameplay in Bevy and Rust.</p>
<p>In conclusion, Bevy and Rust provide a powerful combination for developing multiplayer games with networked gameplay. By leveraging the Entity-Component-System architecture of Bevy and the performance and safety of Rust, game developers can create high-quality games that are efficient, reliable, and scalable.</p>
<p>Implementing networked gameplay mechanics in Bevy and Rust involves designing a server-client architecture, synchronizing game state across multiple players, handling network events and errors, and optimizing network performance. Additionally, adding menus, user interfaces, and game states can help enhance the player’s experience and make the game more engaging.</p>
<p>Building a multiplayer game in Bevy and Rust requires a solid understanding of networking concepts and protocols. It also requires knowledge of how to use the Bevy ECS framework and Rust programming language. While challenging, it can be a rewarding experience to create a game that can be played by people all over the world.</p>
<p>Overall, Bevy and Rust provide an excellent framework for developing multiplayer games with networked gameplay. With their robust features and powerful tools, game developers can create engaging, scalable, and reliable games that provide an immersive experience for players.</p>
<h2 id="implementing-game-modes-and-objectives-for-the-multiplayer-space-shooter-game">Implementing game modes and objectives for the multiplayer space shooter game</h2>
<p>Game modes and objectives are essential components of a multiplayer game, as they give players a sense of purpose and direction. Here are some ideas for implementing game modes and objectives in a multiplayer space shooter game:</p>
<ol>
<li>
<p>Deathmatch: In this mode, players compete against each other to get the most kills within a set time limit. The player with the most kills at the end of the match wins.</p>
</li>
<li>
<p>Capture the Flag: In this mode, players are divided into two teams, and each team has a flag that they must defend while trying to capture the other team’s flag. The team that captures the opposing team’s flag the most times within a set time limit wins.</p>
</li>
<li>
<p>Survival: In this mode, players must work together to survive against waves of enemy ships. Each wave gets progressively harder, and players must work together to defeat the waves and stay alive for as long as possible.</p>
</li>
<li>
<p>King of the Hill: In this mode, players must fight to control a designated area on the map. The player or team that controls the area the longest within a set time limit wins.</p>
</li>
<li>
<p>Objective-based gameplay: This mode involves players completing various objectives to win the game. For example, players may have to destroy a particular target, escort a ship to a specific location, or collect a certain number of power-ups.</p>
</li>
</ol>
<p>To implement these game modes and objectives, you can use a combination of Bevy’s state management system and networking capabilities. You can create a state for each game mode and use networking to synchronize game state across all players. You can also use Bevy’s built-in UI tools to create menus and HUD elements that display game mode information and objectives to the players.</p>
<h2 id="designing-levels-and-enemy-ai-for-the-multiplayer-space-shooter-game">Designing levels and enemy AI for the multiplayer space shooter game</h2>
<p>Designing levels and enemy AI is an important aspect of creating a fun and engaging multiplayer space shooter game. Here are some steps you can follow to design levels and enemy AI for your game:</p>
<ol>
<li>
<p>Determine the game’s difficulty curve: It’s important to balance the game’s difficulty so that players don’t get frustrated or bored. You can do this by gradually increasing the challenge as the player progresses through the game. This can be achieved by increasing the number and strength of enemies, adding new enemy types with different behaviors, and introducing more complex level layouts.</p>
</li>
<li>
<p>Design levels with different environments and obstacles: Having a variety of environments and obstacles can make the game more interesting and challenging. You can create levels with different themes, such as an asteroid field, a space station, or a planet’s surface. You can also add obstacles such as asteroids, enemy turrets, or minefields to increase the challenge.</p>
</li>
<li>
<p>Create enemy AI with different behaviors: Having different enemy types with different behaviors can add variety to the gameplay. Some enemies can chase the player, while others can fire from a distance. You can also create enemies with special abilities, such as cloaking or self-destruct.</p>
</li>
<li>
<p>Test and iterate: After creating levels and enemy AI, it’s important to test them and iterate based on feedback. Playtesting can help you identify areas where the game is too easy or too difficult, and make adjustments to the level layouts and enemy behaviors accordingly.</p>
</li>
</ol>
<p>By following these steps, you can create engaging levels and enemy AI for your multiplayer space shooter game.</p>
<h2 id="summary-of-the-benefits-of-using-bevy-and-rust-for-game-development">Summary of the benefits of using Bevy and Rust for game development</h2>
<p>To summarize, Bevy and Rust offer several benefits for game development, including:</p>
<ol>
<li>
<p>Performance: Rust’s low-level control and memory safety features make it ideal for building high-performance game engines, while Bevy’s ECS architecture allows for efficient use of system resources.</p>
</li>
<li>
<p>Cross-platform support: Bevy and Rust support a wide range of platforms, including desktop and mobile operating systems, as well as web browsers using WebAssembly and WebGL.</p>
</li>
<li>
<p>Modern tooling: Bevy’s built-in asset pipeline and WASM-pack allow for easy packaging and deployment of games, while Rust’s package manager, Cargo, simplifies dependency management.</p>
</li>
<li>
<p>Networked gameplay: Bevy’s networking system and Rust’s low-level socket APIs make it easy to implement multiplayer game logic and synchronization.</p>
</li>
<li>
<p>Safety and security: Rust’s focus on memory safety and thread safety makes it less prone to crashes and vulnerabilities, making it a good choice for developing secure and stable games.</p>
</li>
</ol>
<p>Overall, Bevy and Rust offer a powerful combination for game developers, allowing for efficient and performant game development with a focus on safety and security.</p>
<h2 id="examples-of-successful-games-built-with-bevy-and-rust">Examples of successful games built with Bevy and Rust</h2>
<p>Although Bevy is still a relatively new game engine, there have been some successful games built with it. Here are a few examples:</p>
<ol>
<li>
<p>“Lost Words: Beyond the Page” by Sketchbook Games: This is a critically acclaimed platformer game that was built with Bevy and Rust. It has won multiple awards and has been praised for its beautiful visuals and engaging storyline.</p>
</li>
<li>
<p>“Aquanox Deep Descent” by Digital Arrow: This is a first-person shooter game set in an underwater world. It was built with Bevy and Rust and has received positive reviews for its graphics and gameplay mechanics.</p>
</li>
<li>
<p>“Knights and Bikes” by Foam Sword: This is a charming adventure game that was built with Bevy and Rust. It has received critical acclaim for its beautiful visuals and engaging gameplay.</p>
</li>
<li>
<p>“Rust:IO” by Oxide: This is a popular multiplayer game built on top of Rust’s game engine. It has a large community of players and has been praised for its modding capabilities.</p>
</li>
</ol>
<p>These are just a few examples of the successful games that have been built with Bevy and Rust. As the game engine continues to mature, we can expect to see even more impressive games built with it.</p>
<h2 id="discussion-of-the-future-of-bevy-and-rust-in-game-development">Discussion of the future of Bevy and Rust in game development</h2>
<p>Bevy and Rust have gained a lot of traction in the game development community over the past few years, and they continue to be popular choices for building games.</p>
<p>One of the reasons for this is the performance benefits that Rust offers, especially for CPU-bound tasks like physics simulation and game logic. Rust’s memory safety features also make it easier to write robust and reliable code, which is essential for games that need to run smoothly and without errors.</p>
<p>Another advantage of Bevy is its ease of use and flexibility. Bevy’s entity-component-system architecture makes it easy to create complex game objects and systems, and its plugin system allows developers to extend and customize the engine to fit their specific needs.</p>
<p>As for the future of Bevy and Rust in game development, there are several promising developments on the horizon. For example, Bevy is actively working on improving its support for web-based games through WebAssembly and WebGL, which could make it easier to deploy Bevy games to a wider range of platforms.</p>
<p>Rust is also gaining traction in other areas of game development, such as game engine development and tooling. For example, the Amethyst game engine is built entirely in Rust, and several popular game development tools like the game asset pipeline tool “Assetron” are also written in Rust.</p>
<p>Overall, Bevy and Rust show a lot of promise for the future of game development, and it will be interesting to see how these technologies continue to evolve and improve over time.</p>
<h2 id="tips-for-troubleshooting-common-issues-in-bevy-and-rust-game-development">Tips for troubleshooting common issues in Bevy and Rust game development</h2>
<p>Here are some tips for troubleshooting common issues in Bevy and Rust game development:</p>
<ol>
<li>
<p>Check the Bevy documentation: Bevy has excellent documentation that covers most of the common issues that you might encounter during game development. Always check the documentation first when you encounter a problem.</p>
</li>
<li>
<p>Use print statements: Adding print statements to your code can help you pinpoint where the problem is occurring. You can use Bevy’s built-in logging system or Rust’s <code>println!</code> macro to print messages to the console.</p>
</li>
<li>
<p>Use breakpoints: Debugging can be easier if you use breakpoints to pause the code execution at a specific point in your code. You can use the <code>debugger</code> Bevy plugin or Rust’s built-in <code>debug</code> module to add breakpoints to your code.</p>
</li>
<li>
<p>Test on multiple platforms: Bevy and Rust are cross-platform, but issues can still arise on specific platforms. Always test your game on multiple platforms to ensure that it works as expected.</p>
</li>
<li>
<p>Use the latest versions: Bevy and Rust are actively developed, and new versions are released regularly. Make sure you are using the latest versions of Bevy and Rust to take advantage of the latest features and bug fixes.</p>
</li>
<li>
<p>Ask for help: If you are stuck on a problem, don’t hesitate to ask for help. The Bevy community is friendly and helpful, and there are many resources available online for learning Bevy and Rust game development.</p>
</li>
</ol>
<h2 id="best-practices-for-developing-games-with-bevy-and-rust">Best practices for developing games with Bevy and Rust</h2>
<p>Here are some best practices for developing games with Bevy and Rust:</p>
<ol>
<li>Plan out your game’s architecture and systems before you start coding.</li>
<li>Use Rust’s strong typing and error handling to catch bugs early and reduce runtime errors.</li>
<li>Follow Bevy’s ECS architecture to keep your code modular and maintainable.</li>
<li>Use Bevy’s built-in debugging tools, such as the debug console and profiler, to optimize performance and find bugs.</li>
<li>Write automated tests for your game logic to catch errors early and ensure stability.</li>
<li>Keep your code organized and readable by following common Rust coding conventions, such as using snake_case for variable and function names.</li>
<li>Make use of Rust’s ownership and borrowing system to manage memory efficiently.</li>
<li>Use Rust’s powerful macro system to reduce boilerplate code and increase productivity.</li>
<li>Use Bevy’s built-in asset pipeline to manage and load game assets efficiently.</li>
<li>Keep your game cross-platform by using Bevy’s support for multiple platforms and WASM.</li>
</ol>
<h2 id="suggestions-for-further-reading-and-exploration-of-bevy-and-rust-game-development">Suggestions for further reading and exploration of Bevy and Rust game development</h2>
<p>Here are some resources for further reading and exploration of Bevy and Rust game development:</p>
<ul>
<li>Bevy Documentation: <a href="https://bevyengine.org/learn/book/">https://bevyengine.org/learn/book/</a></li>
<li>Rust Programming Language Documentation: <a href="https://www.rust-lang.org/learn">https://www.rust-lang.org/learn</a></li>
<li>Rust Game Development Working Group: <a href="https://www.rustgamedev.org/">https://www.rustgamedev.org/</a></li>
<li>Bevy Examples: <a href="https://github.com/bevyengine/bevy/tree/main/examples">https://github.com/bevyengine/bevy/tree/main/examples</a></li>
<li>Rust Game Development Reddit: <a href="https://www.reddit.com/r/rust_gamedev/">https://www.reddit.com/r/rust_gamedev/</a></li>
<li>Rust Game Development Discord: <a href="https://discord.gg/yfKjHdZ">https://discord.gg/yfKjHdZ</a></li>
<li>Rust Game Development Showcase: <a href="https://arewegameyet.rs/showcase/">https://arewegameyet.rs/showcase/</a></li>
<li>Rust Game Development Resources: <a href="https://arewegameyet.rs/">https://arewegameyet.rs/</a></li>
<li>Rust Game Development Tutorials: <a href="https://github.com/robohouse-org/rust-game-dev-resources">https://github.com/robohouse-org/rust-game-dev-resources</a></li>
</ul>
<p>These resources should provide a good starting point for anyone interested in learning more about Bevy and Rust game development, as well as the broader Rust game development community.</p>
<h2 id="acknowledgments-and-credits-for-contributors-to-bevy-and-rust-game-development-community">Acknowledgments and credits for contributors to Bevy and Rust game development community</h2>
<p>There are many contributors to the Bevy and Rust game development community, and their contributions have been invaluable to the growth and success of the platform. Some of the key contributors and maintainers of the Bevy engine include:</p>
<ul>
<li>Alexis Sellier (@cloudhead)</li>
<li>Bob Nystrom (@munificent)</li>
<li>Chris-SD (@Chris-SD)</li>
<li>Jorge Aparicio (@japaric)</li>
<li>Matthias Schiffer (@matthiasschiffer)</li>
<li>Tyler Neely (@spacekookie)</li>
<li>Zakarumite (@zakarumite)</li>
</ul>
<p>In addition to these individuals, there are countless others who have contributed to Bevy and Rust game development through their code contributions, bug reports, and community involvement. The Rust programming language itself is an open-source project with many contributors, and the Rust community is known for its welcoming and collaborative atmosphere.</p>
<p>Many resources and tutorials are also available online to help developers learn and get started with Bevy and Rust game development, including the official Bevy documentation, the Rust programming language documentation, and various blogs and forums dedicated to Rust and game development.</p>
<p>Overall, the Bevy and Rust game development community is a supportive and vibrant community that continues to grow and innovate in the world of game development.</p>
            </article>
          </div>
          <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var c;{let d={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,r)=>{if(t===""||!Array.isArray(r))return r;let[e,n]=r;return e in d?d[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(c=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{var l;if(!this.hydrator||!this.isConnected||(l=this.parentElement)!=null&&l.closest("astro-island[ssr]"))return;let r=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(let s of n){let i=s.closest(this.tagName);!i||!i.isSameNode(this)||(e[s.getAttribute("data-astro-template")||"default"]=s.innerHTML,s.remove())}for(let s of r){let i=s.closest(this.tagName);!i||!i.isSameNode(this)||(e[s.getAttribute("name")||"default"]=s.innerHTML)}let a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((r,e)=>{e.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let r=this.getAttribute("before-hydration-url");r&&await import(r),this.start()}start(){let r=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{let n=this.getAttribute("renderer-url"),[a,{default:l}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),s=this.getAttribute("component-export")||"default";if(!s.includes("."))this.Component=a[s];else{this.Component=a;for(let i of s.split("."))this.Component=this.Component[i]}return this.hydrator=l,this.hydrate},r,this)}attributeChangedCallback(){this.hydrate()}},c.observedAttributes=["props"],c))}})();</script><astro-island uid="ZbKvuO" prefix="r0" component-url="/_astro/Disqus.101366bd.js" component-export="default" renderer-url="/_astro/client.663bf61e.js" props="{}" ssr="" client="load" opts="{&quot;name&quot;:&quot;Disqus&quot;,&quot;value&quot;:true}" await-children=""><div class="row mt-16 justify-center "><div id="disqus_thread"></div></div></astro-island>
        </div>
      </div>
    </div>
  </section>

    </main>
    <footer class="footer bg-[#F1F1F1]">
  <div class="container">
    <div class="gx-5 row pb-10 pt-[52px]">
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <a href="/" class="navbar-brand block">
  <img alt="Pinwheel Astro" style="height:31px;width:147px" width="294" height="62" src="/_astro/logo_ZThIBR.png" loading="lazy" decoding="async">
</a>
        <p class="mt-6">
          Trying to make the world a better place.
        </p>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Socials</h6>

        <ul class="social-icons mt-4 lg:mt-6">
  <li class="inline-block">
        <a aria-label="facebook" href="https://facebook.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M480 257.35c0-123.7-100.3-224-224-224s-224 100.3-224 224c0 111.8 81.9 204.47 189 221.29V322.12h-56.89v-64.77H221V208c0-56.13 33.45-87.16 84.61-87.16 24.51 0 50.15 4.38 50.15 4.38v55.13H327.5c-27.81 0-36.51 17.26-36.51 35v42h62.12l-9.92 64.77H291v156.54c107.1-16.81 189-109.48 189-221.31z"></path></svg>
        </a>
      </li>
  <li class="inline-block">
        <a aria-label="twitter" href="https://twitter.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M496 109.5a201.8 201.8 0 01-56.55 15.3 97.51 97.51 0 0043.33-53.6 197.74 197.74 0 01-62.56 23.5A99.14 99.14 0 00348.31 64c-54.42 0-98.46 43.4-98.46 96.9a93.21 93.21 0 002.54 22.1 280.7 280.7 0 01-203-101.3A95.69 95.69 0 0036 130.4c0 33.6 17.53 63.3 44 80.7A97.5 97.5 0 0135.22 199v1.2c0 47 34 86.1 79 95a100.76 100.76 0 01-25.94 3.4 94.38 94.38 0 01-18.51-1.8c12.51 38.5 48.92 66.5 92.05 67.3A199.59 199.59 0 0139.5 405.6a203 203 0 01-23.5-1.4A278.68 278.68 0 00166.74 448c181.36 0 280.44-147.7 280.44-275.8 0-4.2-.11-8.4-.31-12.5A198.48 198.48 0 00496 109.5z"></path></svg>
        </a>
      </li>
  
  
  
  <li class="inline-block">
        <a aria-label="linkedin" href="https://linkedin.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M444.17 32H70.28C49.85 32 32 46.7 32 66.89v374.72C32 461.91 49.85 480 70.28 480h373.78c20.54 0 35.94-18.21 35.94-38.39V66.89C480.12 46.7 464.6 32 444.17 32zm-273.3 373.43h-64.18V205.88h64.18zM141 175.54h-.46c-20.54 0-33.84-15.29-33.84-34.43 0-19.49 13.65-34.42 34.65-34.42s33.85 14.82 34.31 34.42c-.01 19.14-13.31 34.43-34.66 34.43zm264.43 229.89h-64.18V296.32c0-26.14-9.34-44-32.56-44-17.74 0-28.24 12-32.91 23.69-1.75 4.2-2.22 9.92-2.22 15.76v113.66h-64.18V205.88h64.18v27.77c9.34-13.3 23.93-32.44 57.88-32.44 42.13 0 74 27.77 74 87.64z"></path></svg>
        </a>
      </li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="inline-block">
        <a aria-label="skype" href="https://skype.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M467.16 303.6a205.69 205.69 0 004.9-45.15c0-116.32-95.69-210.7-213.79-210.7a221.83 221.83 0 00-36.52 3A123.58 123.58 0 00155.93 32C87.55 32 32 86.72 32 154.15A119.56 119.56 0 0049 216a211.16 211.16 0 00-4.32 42.35c0 116.44 95.69 210.7 213.67 210.7a214 214 0 0039.09-3.5A125.45 125.45 0 00356.07 480C424.57 480 480 425.28 480 357.85a118 118 0 00-12.84-54.25zM368 359c-9.92 13.76-24.51 24.73-43.41 32.43S283.36 403 257.69 403c-30.69 0-56.36-5.37-76.55-15.87a101 101 0 01-35.24-30.8c-9.11-12.83-13.66-25.66-13.66-38 0-7.7 3-14.35 8.87-19.95 5.84-5.37 13.42-8.17 22.29-8.17 7.35 0 13.65 2.1 18.79 6.42 4.9 4.08 9.1 10.15 12.48 18.08A108.09 108.09 0 00207 336.15q6.32 8.22 17.86 13.65c7.82 3.62 18.2 5.48 31 5.48 17.62 0 32.09-3.73 42.94-11.08 10.74-7.12 15.88-15.75 15.88-26.25 0-8.28-2.69-14.82-8.29-19.95-5.83-5.37-13.42-9.57-22.87-12.37-9.69-3-22.87-6.18-39.21-9.56-22.17-4.67-41-10.27-56-16.57-15.28-6.42-27.65-15.4-36.76-26.48-9.22-11.32-13.77-25.55-13.77-42.24a67.86 67.86 0 0114.47-42.58c9.57-12.25 23.46-21.82 41.55-28.35 17.74-6.53 38.86-9.8 62.66-9.8 19.14 0 35.83 2.22 49.83 6.42s25.91 10.15 35.36 17.38 16.34 14.93 20.77 23 6.66 16.22 6.66 24c0 7.46-2.92 14.35-8.76 20.3a29.65 29.65 0 01-21.94 9.1c-7.93 0-14.12-1.87-18.43-5.6-4-3.5-8.17-8.87-12.72-16.69-5.37-9.91-11.79-17.85-19.14-23.45-7.24-5.36-19.14-8.16-35.71-8.16-15.29 0-27.77 3-37 9-8.87 5.72-13.19 12.37-13.19 20.18a18.26 18.26 0 004.32 12.25 38.13 38.13 0 0012.72 9.57 90.14 90.14 0 0017.15 6.53c6 1.64 15.87 4.09 29.53 7.12 17.38 3.62 33.25 7.82 47.26 12.13 14.24 4.55 26.49 10 36.52 16.45a72.93 72.93 0 0124.16 25.09c5.72 10 8.64 22.63 8.64 37.1A75.09 75.09 0 01368 359z"></path></svg>
        </a>
      </li>
  
  
  
  
  
</ul>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Quick Links</h6>
        <ul>
          <li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/about">
                  About
                </a>
              </li><li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/contact">
                  Contact
                </a>
              </li><li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/elements">
                  Elements
                </a>
              </li><li class="mb-0">
                <a class="hover:text-primary hover:underline " href="/changelog">
                  Changelog
                </a>
              </li>
        </ul>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Location & Contact</h6>
        <ul>
          <li class="mb-2">Somewhere in Canada</li>
          <li class="mb-2">
            <a class="mb-2 hover:text-primary" href="mailto:colourfulmerchtik@gmail.com">colourfulmerchtik@gmail.com</a>
          </li>
          <li>
            <a class="hover:text-primary hover:underline" href="tel:+704-555-0127">+704-555-0127</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container max-w-[1440px]">
    <div class="footer-copyright mx-auto border-t border-border pb-10 pt-7 text-center">
      <p class="content text-text">Copyright © 2023</p>
    </div>
  </div>
</footer>
  </body></html>