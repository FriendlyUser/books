<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- favicon -->
    <link rel="shortcut icon" href="/images/favicon.png">
    <!-- theme meta -->
    <meta name="theme-name" content="pinwheel-astro">
    <meta name="msapplication-TileColor" content="#000000">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479144310234386" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6">

  </script>
  
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
    <meta name="generator" content="Astro v2.6.6">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- google font css -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&#38;family=Merriweather:wght@700;900&#38;display=swap" rel="stylesheet">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
		<script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>

    <!-- responsive meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">

    <!-- title -->
    <title>
      Introduction to Typescript and Command Line Applications
    </title>

    <!-- canonical url -->
    

    <!-- noindex robots -->
    

    <!-- meta-description -->
    <meta name="description" content="Implementing core linux command line applications in Typescript">

    <!-- author from config.json -->
    <meta name="author" content="FriendlyUser">

    <!-- og-title -->
    <meta property="og:title" content="Introduction to Typescript and Command Line Applications">

    <!-- og-description -->
    <meta property="og:description" content="Implementing core linux command line applications in Typescript">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pinwheel-astro.vercel.app/books/typescript_cli_main_ref/">

    <!-- twitter-title -->
    <meta name="twitter:title" content="Introduction to Typescript and Command Line Applications">

    <!-- twitter-description -->
    <meta name="twitter:description" content="Implementing core linux command line applications in Typescript">

    <!-- og-image -->
    <meta property="og:image" content="https://pinwheel-astro.vercel.app/images/og-image.png">

    <!-- twitter-image -->
    <meta name="twitter:image" content="https://pinwheel-astro.vercel.app/images/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
  <link rel="stylesheet" href="/_astro/_single_.db0af2d4.css" />
<link rel="stylesheet" href="/_astro/404.99013387.css" /><script type="module" src="/_astro/hoisted.4256c07d.js"></script></head>
  <body>
    
    <header class="header">
  <nav class="navbar container">
    <!-- logo -->
    <div class="order-0">
      <a href="/" class="navbar-brand block">
  <img alt="Pinwheel Astro" style="height:31px;width:147px" width="294" height="62" src="/_astro/logo_ZThIBR.png" loading="lazy" decoding="async">
</a>
    </div>
    <!-- navbar toggler -->
    <input id="nav-toggle" type="checkbox" class="hidden">
    <label id="show-button" for="nav-toggle" class="order-2 flex cursor-pointer items-center lg:order-1 lg:hidden">
      <svg class="h-6 fill-current" viewBox="0 0 20 20">
        <title>Menu Open</title>
        <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path>
      </svg>
    </label>
    <label id="hide-button" for="nav-toggle" class="order-2 hidden cursor-pointer items-center lg:order-1">
      <svg class="h-6 fill-current" viewBox="0 0 20 20">
        <title>Menu Close</title>
        <polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"></polygon>
      </svg>
    </label>
    <!-- /navbar toggler -->

    <ul id="nav-menu" class="navbar-nav order-3 hidden w-full lg:order-1 lg:flex lg:w-auto lg:space-x-2">
      <li class="nav-item">
                <a href="/" class="nav-link inline-block lg:block false">
                  Home
                </a>
              </li><li class="nav-item">
                <a href="/books" class="nav-link inline-block lg:block false">
                  Books
                </a>
              </li><li class="nav-item">
                <a href="/contact" class="nav-link inline-block lg:block false">
                  Contact
                </a>
              </li>
      <li class="nav-item mt-2 lg:hidden">
        <a class="btn btn-white btn-sm border-border" href="/books">
          View Books</a>
      </li>
    </ul>
    <div class="order-1 ml-auto hidden items-center md:order-2 md:ml-0 lg:flex">
      <a class="btn btn-white btn-sm" href="/signin"> View Books</a>
    </div>
  </nav>
</header>
<script>
  const button = document.getElementById("dropdown-button");
  button.addEventListener("click", () => {
    const dropdown = document.getElementById("dropdown");
    dropdown.classList.toggle(dropdown.style === "hidden" ? "block" : "hidden");
  });

  //sticky header
  const header = document.querySelector(".header");
  window.addEventListener("scroll", () => {
    const scrollY = window.scrollY;
    if (scrollY > 0) {
      header.classList.add("header-sticky");
    } else {
      header.classList.remove("header-sticky");
    }
  });
</script>
    <main id="main-content">
      
  <section class="section blog-single">
    <div class="container">
      <div class="row justify-center">
        <div class="lg:col-10">
          <img class="w-full rounded-xl" alt="" width="920" height="450" src="/_astro/3614994253_ZqAmhO.png" loading="lazy" decoding="async">
        </div>
        <div class="mt-10 max-w-[810px] lg:col-9">
          <h1 class="h2">
            Introduction to Typescript and Command Line Applications
          </h1>
          <div class="mb-5 mt-6 flex items-center space-x-2">
            <ul class="mb-4">
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 104c-53 0-96 43-96 96s43 96 96 96 96-43 96-96-43-96-96-96zm0 144c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm0-240C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-49.7 0-95.1-18.3-130.1-48.4 14.9-23 40.4-38.6 69.6-39.5 20.8 6.4 40.6 9.6 60.5 9.6s39.7-3.1 60.5-9.6c29.2 1 54.7 16.5 69.6 39.5-35 30.1-80.4 48.4-130.1 48.4zm162.7-84.1c-24.4-31.4-62.1-51.9-105.1-51.9-10.2 0-26 9.6-57.6 9.6-31.5 0-47.4-9.6-57.6-9.6-42.9 0-80.6 20.5-105.1 51.9C61.9 339.2 48 299.2 48 256c0-110.3 89.7-200 200-200s200 89.7 200 200c0 43.2-13.9 83.2-37.3 115.9z"></path></svg>
                
              </li>

              <!-- <li class="mr-4 inline-block">
                <FaRegCalendarAlt className={"mr-2 -mt-1 inline-block"} />
                {dateFormat(post.data?.pubDate)}
              </li> -->
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg>
                59 Mins read
              </li>
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"></path></svg>
                
              </li>
            </ul>
          </div>

          <div class="content">
            <div id="search" class="ml-3 p-4 -mt-8"></div>
            <article id="article">
              <h1 id="chapter-1-introduction-to-typescript-and-command-line-applications">Chapter 1: Introduction to Typescript and Command Line Applications</h1>
<p>Why Typescript is a good choice for building command line applications?
TypeScript is a statically-typed superset of JavaScript that provides optional static typing, classes, and interfaces. This makes it easier to write and maintain large-scale applications, including command-line applications.</p>
<p>By using TypeScript, developers can catch errors early in the development process and enjoy the benefits of code completion, which helps save time and reduces the likelihood of errors. Additionally, TypeScript can be transpiled to JavaScript, allowing developers to use modern JavaScript features while still supporting older browsers and environments.</p>
<p>In the context of command-line applications, TypeScript can also provide better documentation and easier maintenance due to its explicit type annotations and clear interfaces. This can help prevent common errors that might otherwise occur when working with complex command-line applications.</p>
<p>Basic concepts and tools for building command line applications in Typescript
To build command-line applications in TypeScript, there are a few basic concepts and tools that developers should be familiar with:</p>
<ol>
<li>Command-line interfaces (CLIs): CLIs are programs that allow users to interact with a software application through a command-line interface, using text-based commands and responses.</li>
<li>Node.js: Node.js is a runtime environment that allows developers to run JavaScript code outside of a web browser. It provides built-in modules for working with files, networks, and other system resources, making it an ideal platform for building command-line applications.</li>
<li>Command-line argument parsing: Command-line argument parsing is the process of extracting input arguments and options from a command-line interface. There are several libraries available in TypeScript, such as Commander.js and Yargs, that simplify this process.</li>
<li>Standard Input/Output (stdin/stdout): Standard input (stdin) and standard output (stdout) are the default streams used by command-line applications for input and output, respectively. These streams can be accessed in TypeScript using the <code>process.stdin</code> and <code>process.stdout</code> objects.</li>
<li>Console logging: Console logging is a common way to provide output from a command-line application. In TypeScript, console logging can be done using the <code>console.log()</code> function.</li>
</ol>
<p>By mastering these concepts and tools, developers can build powerful and user-friendly command-line applications in TypeScript.</p>
<h1 id="chapter-2-building-a-tail-command">Chapter 2: Building a Tail Command</h1>
<p>Overview of the tail command and its functionality
The <code>tail</code> command is a popular Unix/Linux command-line utility that is used to display the last few lines of a text file. It can be used to monitor log files or other constantly updating files in real-time. The <code>tail</code> command is also useful for quickly reviewing the end of a file without having to load the entire file into memory.</p>
<p>The basic syntax for the <code>tail</code> command is as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">tail</span><span style="color: #ABB2BF"> [</span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">] [</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">]</span></span></code></pre>
<p>The <code>file</code> argument specifies the file to be displayed. If no file is specified, <code>tail</code> will read from standard input.</p>
<p>Some of the most commonly used options for the <code>tail</code> command include:</p>
<ul>
<li><code>-n</code> or <code>--lines</code>: Specifies the number of lines to display. For example, <code>tail -n 10 file.txt</code> will display the last 10 lines of the file.</li>
<li><code>-f</code> or <code>--follow</code>: Causes <code>tail</code> to continuously monitor the file for changes and display any new lines that are added. This is useful for monitoring log files or other constantly updating files in real-time.</li>
<li><code>-q</code> or <code>--quiet</code>: Suppresses the display of file names when multiple files are specified.</li>
<li><code>-v</code> or <code>--verbose</code>: Displays file names when multiple files are specified, even if only one file is being displayed.</li>
<li><code>-c</code> or <code>--bytes</code>: Specifies the number of bytes to display rather than the number of lines.</li>
</ul>
<p>The <code>tail</code> command is a powerful and versatile tool that can be used to quickly and easily view the end of a text file, monitor log files in real-time, and more.</p>
<p>Designing the Typescript implementation of the tail command
To implement the <code>tail</code> command in TypeScript, we can follow these steps:</p>
<ol>
<li>Parse the command-line arguments to determine which file(s) to read and how many lines to display.</li>
<li>Open the specified file(s) for reading.</li>
<li>Seek to the end of the file(s) to read the last n lines.</li>
<li>Read the last n lines of the file(s) and output them to the console.</li>
</ol>
<p>Here’s an example implementation of the <code>tail</code> command in TypeScript:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tail</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">numLines</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Open the file for reading</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fd</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">openSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'r'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">''</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bufSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Read the file in chunks until we have enough lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">fileData</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">).</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">buf</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Buffer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">alloc</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">bufSize</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fd</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">buf</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">bufSize</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">buf</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Split the file data into lines and output the last n lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fileData</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">startLine</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Math</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">max</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">startLine</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Close the file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">closeSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fd</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Parse the command-line arguments</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">numLines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">parseInt</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Call the tail function for each file</span></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tail</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this implementation, we use the <code>fs</code> module from Node.js to open and read the file(s) specified on the command line. We read the file in chunks to avoid reading the entire file into memory at once. We then split the file data into lines and output the last n lines to the console.</p>
<p>This implementation supports reading from multiple files and allows the user to specify the number of lines to display as a command-line argument (defaulting to 10 if no argument is provided).</p>
<p>Reading and processing the input file
To read and process the input file for the <code>tail</code> command, we need to open the file and read its contents. Here’s an updated version of our <code>tail</code> function that reads the input file and splits its contents into lines:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tail</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">numLines</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Open the file for reading</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fd</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">openSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'r'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">''</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bufSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Read the file in chunks until we have enough lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">fileData</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">).</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">buf</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Buffer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">alloc</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">bufSize</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fd</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">buf</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">bufSize</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">buf</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Split the file data into lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fileData</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Process each line of the file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">line</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">lines</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// TODO: Process the line here</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Close the file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">closeSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fd</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this updated version, we still open the file for reading and read its contents in chunks until we have enough lines. We then split the file data into lines using the <code>split</code> method.</p>
<p>To process each line of the file, we can use a <code>for...of</code> loop to iterate over the <code>lines</code> array. We can then process each line as needed, depending on the requirements of our application. For example, we might want to filter out certain lines, search for specific patterns, or perform calculations on numeric values.</p>
<p>Once we have processed each line of the file, we can close the file using the <code>fs.closeSync</code> method to free up system resources.</p>
<p>Note that this implementation assumes that the input file contains text data. If the file contains binary data, we would need to use a different method of reading and processing the file. Additionally, we should handle errors that may occur when opening or reading the file, such as if the file does not exist or if we do not have permission to read it.</p>
<p>Implementing the tail functionality
To implement the <code>tail</code> functionality of displaying the last n lines of the input file, we can modify our existing <code>tail</code> function to output the last n lines to the console:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tail</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">numLines</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Open the file for reading</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fd</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">openSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'r'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">''</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bufSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Read the file in chunks until we have enough lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">fileData</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">).</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">buf</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Buffer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">alloc</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">bufSize</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fd</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">buf</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">bufSize</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">buf</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Split the file data into lines and output the last n lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fileData</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">startLine</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Math</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">max</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">startLine</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Close the file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">closeSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fd</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this implementation, we split the file data into lines as before, but we now use the <code>slice</code> method to extract the last <code>numLines</code> lines of the file. We then use the <code>join</code> method to join the lines into a single string with newline characters between each line, and we output this string to the console using the <code>console.log</code> method.</p>
<p>Note that this implementation assumes that the input file contains text data and that each line is terminated by a newline character. If the file contains binary data or if the lines are not terminated by newlines, we would need to use a different method of reading and processing the file. Additionally, we should handle errors that may occur when opening or reading the file, such as if the file does not exist or if we do not have permission to read it.</p>
<p>Outputting the results to the console
In our implementation of the <code>tail</code> function, we output the last <code>numLines</code> lines of the input file to the console using the <code>console.log</code> method. We can now wrap our <code>tail</code> function in a <code>main</code> function that accepts command line arguments and calls the <code>tail</code> function with the appropriate arguments:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tail</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">numLines</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Open the file for reading</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fd</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">openSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'r'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">''</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bufSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Read the file in chunks until we have enough lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">fileData</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">).</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">buf</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Buffer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">alloc</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">bufSize</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fd</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">buf</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">bufSize</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">bytesRead</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">buf</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fileData</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Split the file data into lines and output the last n lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fileData</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">startLine</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Math</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">max</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">startLine</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Close the file</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">closeSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fd</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Get the command line arguments</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Check that we have the correct number of arguments</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'Usage: tail &#x3C;file> &#x3C;numLines>'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Parse the command line arguments</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">numLines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">parseInt</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">], </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Call the tail function with the parsed arguments</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tail</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">();</span></span></code></pre>
<p>In this implementation, we define a <code>main</code> function that first checks that we have the correct number of command line arguments (two: the input file and the number of lines to output). If we do not have the correct number of arguments, we output an error message to the console and exit the program using the <code>process.exit</code> method.</p>
<p>If we have the correct number of arguments, we parse them using the <code>parseInt</code> method and call the <code>tail</code> function with the parsed arguments.</p>
<p>When we run this program from the command line with the appropriate arguments (e.g., <code>node tail.js input.txt 10</code>), it will output the last 10 lines of the <code>input.txt</code> file to the console.</p>
<p>Testing the tail command
To test the <code>tail</code> command, we can create a test file with some sample text data and then run the <code>tail</code> command with different numbers of lines to ensure that it outputs the correct results.</p>
<p>For example, we can create a test file called <code>test.txt</code> with the following contents:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span></span>
<span class="line"><span style="color: #E06C75">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span></span>
<span class="line"><span style="color: #E06C75">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span></span>
<span class="line"><span style="color: #E06C75">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">4</span></span>
<span class="line"><span style="color: #E06C75">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span></span>
<span class="line"><span style="color: #E06C75">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">6</span></span>
<span class="line"><span style="color: #E06C75">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">7</span></span>
<span class="line"><span style="color: #E06C75">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">8</span></span>
<span class="line"><span style="color: #E06C75">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">9</span></span>
<span class="line"><span style="color: #E06C75">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span></span></code></pre>
<p>We can then run the <code>tail</code> command with different numbers of lines and verify that it outputs the correct results:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #61AFEF">$</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">node</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">tail.js</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">test.txt</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">8</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">9</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">$</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">node</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">tail.js</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">test.txt</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">6</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">7</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">8</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">9</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">$</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">node</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">tail.js</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">test.txt</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">4</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">6</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">7</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">8</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">9</span></span>
<span class="line"><span style="color: #61AFEF">Line</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span></span></code></pre>
<p>We should also test the <code>tail</code> command with invalid arguments (e.g., a non-existent input file or a non-numeric number of lines) to ensure that it handles errors correctly:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #61AFEF">$</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">node</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">tail.js</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">invalid.txt</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span></span>
<span class="line"><span style="color: #61AFEF">Error:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">ENOENT:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">no</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">such</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">file</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">or</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">directory,</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">open</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'invalid.txt'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">$</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">node</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">tail.js</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">test.txt</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">foo</span></span>
<span class="line"><span style="color: #61AFEF">Error:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">parseInt</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">failed</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">on</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"foo"</span></span></code></pre>
<p>By testing the <code>tail</code> command with various input files and numbers of lines, we can ensure that it works correctly and handles errors gracefully.</p>
<h1 id="chapter-3-building-a-head-command">Chapter 3: Building a Head Command</h1>
<p>Overview of the head command and its functionality
The <code>head</code> command is a common Unix command that outputs the first few lines of a file. By default, it outputs the first 10 lines of the file, but this can be changed with the <code>-n</code> option followed by a number to specify the number of lines to output.</p>
<p>The basic syntax of the <code>head</code> command is:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">head</span><span style="color: #ABB2BF"> [</span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">] [</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">]</span></span></code></pre>
<p>where <code>options</code> is an optional set of command line options (such as <code>-n</code>) and <code>file</code> is the input file to read.</p>
<p>The most commonly used option for the <code>head</code> command is <code>-n</code>, which specifies the number of lines to output. For example, to output the first 20 lines of a file, we can use the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">head</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">20</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>If no option is specified, <code>head</code> will output the first 10 lines of the input file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">head</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>The <code>head</code> command is often used in combination with other commands in Unix pipelines to extract the first few lines of a file or to quickly check the contents of a file.</p>
<p>Designing the Typescript implementation of the head command
To implement the <code>head</code> command in Typescript, we can follow a similar approach to the <code>tail</code> command. We’ll need to read the input file and output the specified number of lines to the console. Here’s a possible design for the Typescript implementation of the <code>head</code> command:</p>
<ol>
<li>Parse the command line arguments to determine the input file and the number of lines to output.</li>
<li>Read the input file and split it into lines.</li>
<li>Output the specified number of lines to the console.</li>
<li>Handle errors gracefully, such as when the input file doesn’t exist or the number of lines is invalid.</li>
</ol>
<p>Here’s an example of how this might look in Typescript:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">readFileSync</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">head</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">numLines</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Read the input file and split it into lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">readFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'utf-8'</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Output the specified number of lines to the console</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">lines</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Error: </span><span style="color: #C678DD">${</span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">message</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Parse the command line arguments</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">numLines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">parseInt</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Call the head function with the specified arguments</span></span>
<span class="line"><span style="color: #61AFEF">head</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>In this example, we use the built-in <code>readFileSync</code> function from the Node.js <code>fs</code> module to read the input file and split it into lines. We then use a simple for loop to output the specified number of lines to the console.</p>
<p>We also handle errors gracefully using a try-catch block to catch any errors that might occur when reading the file or outputting the lines. Finally, we parse the command line arguments using <code>process.argv</code> and call the <code>head</code> function with the specified arguments.</p>
<p>This is just one possible implementation of the <code>head</code> command in Typescript, but it should give you a good idea of the basic approach.</p>
<p>Reading and processing the input file
To read and process the input file for the <code>head</code> command in Typescript, we can use the built-in <code>readFileSync</code> function from the Node.js <code>fs</code> module. This function reads the contents of a file synchronously and returns the contents as a string.</p>
<p>Once we have the contents of the file, we can split it into lines using the <code>split</code> function, which splits a string into an array of substrings based on a specified delimiter. In the case of the <code>head</code> command, the delimiter is the newline character <code>\n</code>, which separates the lines of the file.</p>
<p>Here’s an updated version of the <code>head</code> function that reads and processes the input file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">readFileSync</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">head</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">numLines</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Read the input file and split it into lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">contents</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">readFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'utf-8'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">contents</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Output the specified number of lines to the console</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">lines</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Error: </span><span style="color: #C678DD">${</span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">message</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this updated version, we first call <code>readFileSync</code> with the filename and the encoding <code>'utf-8'</code> to read the contents of the file as a string. We then split the contents into an array of lines using the <code>split</code> function and the delimiter <code>\n</code>. We can now iterate over the first <code>numLines</code> elements of the <code>lines</code> array and output them to the console using <code>console.log</code>.</p>
<p>Implementing the head functionality
To implement the <code>head</code> functionality in Typescript, we can start with the basic structure of the <code>head</code> function and add code to handle the following cases:</p>
<ol>
<li>When the input file is empty or contains fewer lines than the requested number of lines.</li>
<li>When the requested number of lines is greater than the total number of lines in the input file.</li>
</ol>
<p>Here’s an example implementation of the <code>head</code> function that handles these cases:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">readFileSync</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">head</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">numLines</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Read the input file and split it into lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">contents</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">readFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'utf-8'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">contents</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Handle empty or short files</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">lines</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">''</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">''</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Output the specified number of lines to the console</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">lines</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Error: </span><span style="color: #C678DD">${</span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">message</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this implementation, we first check if the input file is empty or contains only one line with an empty string. In this case, we output an empty string and return early from the function. We then check if the requested number of lines is greater than the total number of lines in the input file. If so, we set <code>numLines</code> to the total number of lines.</p>
<p>Finally, we iterate over the first <code>numLines</code> elements of the <code>lines</code> array and output them to the console using <code>console.log</code>.</p>
<p>Outputting the results to the console
To output the results of the <code>head</code> command to the console, we can simply call the <code>head</code> function with the appropriate arguments and let the function handle the output. Here’s an example of how we can call the <code>head</code> function to output the first 10 lines of a file called <code>example.txt</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #61AFEF">head</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'example.txt'</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>This will read the contents of <code>example.txt</code>, split them into lines, and output the first 10 lines to the console. If the file contains fewer than 10 lines, it will output all the lines in the file.</p>
<p>We can also modify the <code>head</code> function to return the first <code>numLines</code> lines of the input file as a string instead of outputting them to the console. Here’s an example implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">readFileSync</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">head</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">numLines</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Read the input file and split it into lines</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">contents</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">readFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'utf-8'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">contents</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Handle empty or short files</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">lines</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">''</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">''</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Return the specified number of lines as a string</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">numLines</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Error: </span><span style="color: #C678DD">${</span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">message</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">''</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this implementation, we first check if the input file is empty or contains only one line with an empty string. In this case, we return an empty string. We then check if the requested number of lines is greater than the total number of lines in the input file. If so, we set <code>numLines</code> to the total number of lines.</p>
<p>Finally, we use the <code>slice</code> function to extract the first <code>numLines</code> elements of the <code>lines</code> array, and then join them into a single string with the newline character <code>\n</code>. We then return this string from the function.</p>
<p>Testing the head command
To test the <code>head</code> command, we can create a test file with some example contents and then call the <code>head</code> function with different arguments to verify that it produces the expected output.</p>
<p>Here’s an example of how we can test the <code>head</code> function using the Jest testing framework:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">head</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'./head'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">describe</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'head'</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">it</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'should return an empty string for an empty file'</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">head</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'test/empty.txt'</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">)).</span><span style="color: #61AFEF">toBe</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">''</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">it</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'should return all lines for a file with fewer lines than requested'</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">head</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'test/short.txt'</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">)).</span><span style="color: #61AFEF">toBe</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'Line 1</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 2</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 3'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">it</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'should return the first n lines of a file'</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">head</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'test/long.txt'</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">)).</span><span style="color: #61AFEF">toBe</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'Line 1</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 2</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 3'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">it</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'should return all lines for a file with fewer lines than requested'</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">head</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'test/long.txt'</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">)).</span><span style="color: #61AFEF">toBe</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'Line 1</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 2</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 3</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 4</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 5</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 6</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 7</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 8</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 9</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">Line 10'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre>
<p>In this example, we have four test cases:</p>
<ol>
<li>An empty file, which should return an empty string.</li>
<li>A file with fewer lines than requested, which should return all the lines in the file.</li>
<li>A file with more lines than requested, which should return the first <code>n</code> lines of the file.</li>
<li>A file with more lines than requested, but fewer lines than the total number of lines in the file. This test case is similar to the previous one, but with a larger value of <code>n</code>.</li>
</ol>
<p>For each test case, we call the <code>head</code> function with the appropriate arguments and use the <code>expect</code> function to verify that the function returns the expected result.</p>
<h1 id="chapter-4-building-a-du-command">Chapter 4: Building a Du Command</h1>
<p>Overview of the du command and its functionality
The <code>du</code> command is a Unix-based command-line utility that is used to estimate the space usage of a file or directory. The name “du” stands for “disk usage”.</p>
<p>The <code>du</code> command displays the number of blocks used by a file or directory on the file system. By default, the <code>du</code> command displays the space used by the entire directory and all of its subdirectories. It can also display the size of individual files within the directory.</p>
<p>The <code>du</code> command has several options that allow you to customize the output. For example, you can use the <code>-h</code> option to display the sizes in human-readable format (such as “1K”, “2M”, etc.), or you can use the <code>-s</code> option to display only the total size of the directory without showing the sizes of its subdirectories.</p>
<p>Designing the Typescript implementation of the du command
To implement the <code>du</code> command in Typescript, we will need to recursively traverse the directory hierarchy and calculate the size of each file and subdirectory. We can then sum up the sizes to obtain the total size of the directory. Here is an outline of the steps we will need to follow:</p>
<ol>
<li>Parse the command-line arguments to determine the directory to be analyzed and any options that were specified.</li>
<li>Use the Node.js <code>fs</code> module to check if the specified directory exists and is accessible.</li>
<li>Traverse the directory hierarchy using the <code>fs.readdirSync</code> function to obtain a list of all files and subdirectories within the directory.</li>
<li>For each file, use the <code>fs.statSync</code> function to obtain the file size and add it to the total size of the directory.</li>
<li>For each subdirectory, recursively call the <code>du</code> function to obtain its size and add it to the total size of the directory.</li>
<li>Output the total size of the directory in the appropriate format, based on any options that were specified.</li>
</ol>
<p>Here’s an example of what the code might look like:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">du</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">directory</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">options</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: { </span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF"> }): </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readdirSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directory</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">`</span><span style="color: #C678DD">${</span><span style="color: #E06C75">directory</span><span style="color: #C678DD">}</span><span style="color: #98C379">/</span><span style="color: #C678DD">${</span><span style="color: #E06C75">file</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">statSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isFile</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isDirectory</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">du</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">options</span><span style="color: #ABB2BF">?.</span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">formatSize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">formatSize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">sizeInBytes</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Implementation of human-readable formatting</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">directory</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">options</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">includes</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'-h'</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">undefined</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">du</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directory</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">));</span></span></code></pre>
<p>In this implementation, the <code>du</code> function takes a directory path as its first argument and an optional options object as its second argument. The <code>options</code> object can have a <code>humanReadable</code> property, which is a boolean indicating whether the output should be in human-readable format.</p>
<p>The <code>du</code> function recursively traverses the directory hierarchy and calculates the total size of the directory. For each file, it uses the <code>fs.statSync</code> function to obtain the file size and adds it to the total size of the directory. For each subdirectory, it recursively calls the <code>du</code> function to obtain its size and adds it to the total size of the directory.</p>
<p>The <code>formatSize</code> function takes a size in bytes and returns a human-readable string representation of the size, such as “1K”, “2M”, etc.</p>
<p>Finally, the script reads the command-line arguments and calls the <code>du</code> function with the appropriate arguments. The result is output to the console. If the <code>-h</code> option was specified, the size is displayed in human-readable format.</p>
<p>If the <code>-h</code> option is specified, the <code>du</code> function returns the result in human-readable format by calling the <code>formatSize</code> function. The <code>formatSize</code> function takes the total size in bytes as its argument and returns a human-readable string representation of the size. Here’s an example implementation of the <code>formatSize</code> function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">formatSize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">sizeInBytes</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">units</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [</span><span style="color: #98C379">'B'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'K'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'M'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'G'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'T'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'P'</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sizeInBytes</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">unitIndex</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">size</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">>=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">unitIndex</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">units</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">unitIndex</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">`</span><span style="color: #C678DD">${</span><span style="color: #E5C07B">size</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toFixed</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">}${</span><span style="color: #E06C75">units</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">unitIndex</span><span style="color: #ABB2BF">]</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This implementation uses an array of unit names, such as “B” for bytes, “K” for kilobytes, “M” for megabytes, etc. It iteratively divides the total size by 1024 until the result is less than 1024 or the largest unit has been reached. It then formats the result as a string with one decimal place and the appropriate unit name.</p>
<p>If the <code>-h</code> option was not specified, the <code>du</code> function returns the result in bytes as a number. The caller is responsible for formatting the result as appropriate.</p>
<p>With this implementation, we can now calculate the total size of a directory using the <code>du</code> command in Typescript. We can run the script with a command like this:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">node</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">du</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">ts</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #E06C75">path</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">to</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">directory</span></span></code></pre>
<p>If we want the output to be in human-readable format, we can use the <code>-h</code> option:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">node</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">du</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">ts</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #E06C75">path</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">to</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">directory</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #E06C75">h</span></span></code></pre>
<p>Reading and processing the input directory
To calculate the total size of a directory in Typescript, we first need to read and process the input directory. We can use the <code>fs</code> module in Node.js to do this.</p>
<p>Here’s an example implementation of the <code>readDirectory</code> function, which reads the contents of a directory and returns an array of file and directory names:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">readDirectory</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">directoryPath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[]> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">resolve</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">reject</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readdir</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directoryPath</span><span style="color: #ABB2BF">, (</span><span style="color: #E06C75; font-style: italic">err</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">files</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reject</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This implementation uses the <code>fs.readdir</code> function to read the contents of the directory. It returns a promise that resolves with an array of file and directory names. If an error occurs, the promise is rejected with the error.</p>
<p>Next, we can use the <code>readDirectory</code> function to process the input directory and calculate its size. We can use the <code>fs.stat</code> function to get information about each file and directory in the directory. We can then add up the sizes of all the files and recursively process any subdirectories.</p>
<p>Here’s an example implementation of the <code>du</code> function that calculates the total size of a directory:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">du</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">directoryPath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">humanReadable</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">|</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">readDirectory</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directoryPath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filePath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">`</span><span style="color: #C678DD">${</span><span style="color: #E06C75">directoryPath</span><span style="color: #C678DD">}</span><span style="color: #98C379">/</span><span style="color: #C678DD">${</span><span style="color: #E06C75">file</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isDirectory</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">subdirectorySize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">du</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">subdirectorySize</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">formatSize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This implementation first initializes the <code>totalSize</code> variable to 0. It then reads the contents of the directory using the <code>readDirectory</code> function and loops over each file and directory. For each file, it uses the <code>fs.stat</code> function to get information about the file. If the file is a directory, it recursively calls the <code>du</code> function to get the size of the subdirectory. Otherwise, it adds the size of the file to the <code>totalSize</code> variable.</p>
<p>At the end of the function, it returns the <code>totalSize</code> variable, or the result of calling the <code>formatSize</code> function on the <code>totalSize</code> variable if the <code>humanReadable</code> option is <code>true</code>.</p>
<p>Implementing the du functionality
To implement the <code>du</code> functionality in Typescript, we can use the <code>du</code> function we designed earlier, along with some additional code to handle the command-line arguments and print the output to the console.</p>
<p>Here’s an example implementation of the <code>du</code> command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">readDirectory</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">directoryPath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[]> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">resolve</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">reject</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readdir</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directoryPath</span><span style="color: #ABB2BF">, (</span><span style="color: #E06C75; font-style: italic">err</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">files</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reject</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">filePath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">Stats</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">resolve</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">reject</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">, (</span><span style="color: #E06C75; font-style: italic">err</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">stats</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reject</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">stats</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">formatSize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">units</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [</span><span style="color: #98C379">'B'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'KB'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'MB'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'GB'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'TB'</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">unitIndex</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">formattedSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">formattedSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">>=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">unitIndex</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">units</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">formattedSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">unitIndex</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">`</span><span style="color: #C678DD">${</span><span style="color: #E5C07B">formattedSize</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toFixed</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">}</span><span style="color: #98C379"> </span><span style="color: #C678DD">${</span><span style="color: #E06C75">units</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">unitIndex</span><span style="color: #ABB2BF">]</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">du</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">directoryPath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">humanReadable</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">|</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">readDirectory</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directoryPath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filePath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">`</span><span style="color: #C678DD">${</span><span style="color: #E06C75">directoryPath</span><span style="color: #C678DD">}</span><span style="color: #98C379">/</span><span style="color: #C678DD">${</span><span style="color: #E06C75">file</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isDirectory</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">subdirectorySize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">du</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">subdirectorySize</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">formatSize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">directoryPath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">humanReadable</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">includes</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'-h'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">du</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directoryPath</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">`</span><span style="color: #C678DD">${</span><span style="color: #61AFEF">formatSize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">}</span><span style="color: #98C379"> total`</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">message</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">();</span></span></code></pre>
<p>This implementation first defines the <code>readDirectory</code>, <code>stat</code>, <code>formatSize</code>, and <code>du</code> functions we designed earlier. It then defines a <code>main</code> function that parses the command-line arguments using <code>process.argv</code>, calls the <code>du</code> function with the appropriate arguments, and prints the output to the console using <code>console.log</code>.</p>
<p>To run the <code>du</code> command, you can save the above code to a file (e.g. <code>du.ts</code>) and then compile it to JavaScript using the Typescript compiler (<code>tsc du.ts</code>). You can then run the resulting JavaScript file using Node.js (<code>node du.js</code>), passing the directory you want to calculate the size of as the first argument and the <code>-h</code> option if you want the size to be displayed in human-readable format. For example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">$</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">node</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">du</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">js</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #E06C75">path</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">to</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">directory</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #E06C75">h</span></span>
<span class="line"><span style="color: #D19A66">4.54</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MB</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">total</span></span></code></pre>
<p>Outputting the results to the console
To output the results to the console, we can use the <code>console.log()</code> method to print the size of each directory. If the <code>-h</code> option is specified, we can use the <code>filesize</code> library to convert the size into human-readable format.</p>
<p>Here’s the implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">path</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'path'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">filesize</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'filesize'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">duCommand</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">directoryPath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">humanReadable</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">directorySize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">getDirectorySize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directoryPath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">formattedSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">filesize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directorySize</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">directorySize</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`</span><span style="color: #C678DD">${</span><span style="color: #E06C75">directoryPath</span><span style="color: #C678DD">}</span><span style="color: #56B6C2">\t</span><span style="color: #C678DD">${</span><span style="color: #E06C75">formattedSize</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">getDirectorySize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">directoryPath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readdirSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directoryPath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forEach</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filePath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directoryPath</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">statSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isFile</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">getDirectorySize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In the <code>duCommand</code> function, we first call the <code>getDirectorySize</code> function to get the total size of the directory. We then format the size based on whether the <code>-h</code> option was specified or not. Finally, we use <code>console.log()</code> to output the results to the console.</p>
<p>The <code>getDirectorySize</code> function recursively iterates over all the files and subdirectories in the given directory and calculates their size using the <code>fs.statSync()</code> method. If the file is a regular file, its size is added to the total size. If the file is a directory, the function is called recursively on the directory to get its size.</p>
<p>Note that the <code>du</code> command only accepts a single directory as input, so we don’t need to handle multiple directories like we did in the <code>tail</code> and <code>head</code> commands.</p>
<p>Testing the du command
To test the <code>du</code> command, we can create a test directory with some files and subdirectories, and then run the command on that directory. We can then verify that the output is correct based on the expected sizes of the files and directories.</p>
<p>Here’s an example implementation of a test case:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">duCommand</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'./du'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">describe</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'duCommand'</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">it</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'should output the correct size of the directory'</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">testDir</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'./testDir'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'file1.txt'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'file2.txt'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">subDir</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'subdir'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">subDirFile</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'subdirfile.txt'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">subSubDir</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'subsubdir'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">subSubDirFile</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'subsubdirfile.txt'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// create test directory with files and subdirectories</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">mkdirSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">testDir</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">testDir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">file1</span><span style="color: #ABB2BF">), </span><span style="color: #98C379">'1234567890'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">testDir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">file2</span><span style="color: #ABB2BF">), </span><span style="color: #98C379">'abcdefghijklmnopqrstuvwxyz'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">mkdirSync</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">testDir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">subDir</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">testDir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">subDir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">subDirFile</span><span style="color: #ABB2BF">), </span><span style="color: #98C379">'1'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">mkdirSync</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">testDir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">subDir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">subSubDir</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">testDir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">subDir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">subSubDir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">subSubDirFile</span><span style="color: #ABB2BF">), </span><span style="color: #98C379">'12'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// run du command on test directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">expectedSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">38</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">formattedSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'38 B'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">output</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">captureConsole</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">duCommand</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">testDir</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// verify output</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">output</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">toEqual</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`</span><span style="color: #C678DD">${</span><span style="color: #E06C75">testDir</span><span style="color: #C678DD">}</span><span style="color: #56B6C2">\t</span><span style="color: #C678DD">${</span><span style="color: #E06C75">formattedSize</span><span style="color: #C678DD">}</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">captureConsole</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">fn</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">oldConsole</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">global</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">console</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">output</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Array</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">>();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">global</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">console</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> { ...</span><span style="color: #E06C75">oldConsole</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">msg</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">msg</span><span style="color: #ABB2BF">) };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fn</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">global</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">console</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">oldConsole</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">''</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this test case, we create a test directory with some files and subdirectories using the <code>fs</code> module. We then call the <code>duCommand</code> function on the test directory with the <code>-h</code> option set to <code>true</code> to get the human-readable size.</p>
<p>We then capture the output of the <code>console.log()</code> method using the <code>captureConsole</code> helper function, and verify that the output is correct based on the expected size of the directory.</p>
<p>Note that we use the <code>captureConsole</code> function to capture the output of the <code>console.log()</code> method, since we don’t want to actually output anything to the console during testing.</p>
<h1 id="chapter-5-building-a-df-command">Chapter 5: Building a Df Command</h1>
<p>Overview of the df command and its functionality
The <code>df</code> command is used to display the amount of free and used disk space on a file system. It can be used to get an overview of the available disk space on a system, and can help identify which file systems are running low on space.</p>
<p>The <code>df</code> command typically takes one or more file system paths as arguments, and displays the amount of used and free space, as well as the total and percentage capacity of each file system. The output can also include information about the type of file system, the number of inodes, and the mount point of the file system.</p>
<p>The <code>df</code> command can be useful for system administrators and users who need to monitor disk usage on a system and identify potential issues with low disk space.</p>
<p>Designing the Typescript implementation of the df command
To implement the <code>df</code> command in Typescript, we can follow the following basic steps:</p>
<ol>
<li>Parse any command line arguments to determine the file system paths to query.</li>
<li>Use the <code>fs.stat()</code> method to get information about each file system path, including the total size and available space.</li>
<li>Calculate the used and free space for each file system, as well as the percentage of total capacity that is used.</li>
<li>Format the output in a human-readable format, including information about the file system type, mount point, total size, used space, free space, and percentage used.</li>
<li>Print the output to the console.</li>
</ol>
<p>We can use the <code>fs</code> module in Node.js to interact with the file system and get information about file system paths. We can also use the <code>filesize</code> library to format the file sizes in a human-readable format.</p>
<p>Reading and processing the input file system
To read and process the input file system for the <code>df</code> command, we can use the <code>fs.stat()</code> method in Node.js to get information about each file system path that was specified as a command line argument. Here’s an example code snippet:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">promisify</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'util'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">promisify</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">stat</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">getFileSystemStats</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">paths</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">all</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">paths</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">)));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">stat</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">index</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> ({</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">paths</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">index</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">blocks</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">blksize</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">availableSpace</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">blocksAvailable</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">blksize</span></span>
<span class="line"><span style="color: #ABB2BF"> }));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we first import the <code>fs</code> module and the <code>promisify</code> function from the <code>util</code> module to convert the <code>fs.stat()</code> method into a Promise-based function. We define an <code>async</code> function called <code>getFileSystemStats</code> that takes an array of file system paths as an argument.</p>
<p>Inside the function, we use <code>Promise.all()</code> to call <code>fs.stat()</code> for each file system path, and store the resulting <code>fs.Stats</code> object in an array called <code>stats</code>. We then use the <code>map()</code> method to convert each <code>fs.Stats</code> object into an object with the path, total size, and available space properties.</p>
<p>The <code>totalSize</code> property is calculated by multiplying the <code>blocks</code> and <code>blksize</code> properties of the <code>fs.Stats</code> object. The <code>availableSpace</code> property is calculated by multiplying the <code>blocksAvailable</code> and <code>blksize</code> properties of the <code>fs.Stats</code> object.</p>
<p>The function returns an array of objects, where each object represents a file system path and contains information about the total size and available space.</p>
<p>Implementing the df functionality
To implement the <code>df</code> functionality in Typescript, we can use the <code>getFileSystemStats()</code> function we defined earlier to get information about the file systems specified as command line arguments. We can then use this information to calculate the used and free space for each file system, as well as the percentage of total capacity that is used. Finally, we can format the output in a human-readable format and print it to the console.</p>
<p>Here’s an example code snippet:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">Command</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'commander'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">getFileSystemStats</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'./fs-utils'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">format</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'filesize'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">program</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Command</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E06C75">program</span></span>
<span class="line"><span style="color: #ABB2BF"> .</span><span style="color: #61AFEF">option</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'-h, --human-readable'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'print sizes in human readable format'</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF"> .</span><span style="color: #61AFEF">parse</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">argv</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">paths</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">program</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">df</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsStats</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">getFileSystemStats</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">paths</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsStats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forEach</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">fsStat</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">usedSpace</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsStat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsStat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">availableSpace</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">percentageUsed</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">usedSpace</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fsStat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">100</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">sizeFormat</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">program</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">format</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">size</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">size</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toString</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`</span><span style="color: #C678DD">${</span><span style="color: #E5C07B">fsStat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">path</span><span style="color: #C678DD">}</span><span style="color: #56B6C2">\t</span><span style="color: #C678DD">${</span><span style="color: #61AFEF">sizeFormat</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">fsStat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">totalSize</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">}</span><span style="color: #56B6C2">\t</span><span style="color: #C678DD">${</span><span style="color: #61AFEF">sizeFormat</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">usedSpace</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">}</span><span style="color: #56B6C2">\t</span><span style="color: #C678DD">${</span><span style="color: #61AFEF">sizeFormat</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">fsStat</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">availableSpace</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">}</span><span style="color: #56B6C2">\t</span><span style="color: #C678DD">${</span><span style="color: #E5C07B">percentageUsed</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toFixed</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">}</span><span style="color: #98C379">%`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">df</span><span style="color: #ABB2BF">();</span></span></code></pre>
<p>In this code, we first import the <code>Command</code> class from the <code>commander</code> module, the <code>getFileSystemStats()</code> function we defined earlier, and the <code>format()</code> function from the <code>filesize</code> library to format the file sizes in a human-readable format.</p>
<p>We then create a new instance of the <code>Command</code> class and define an option called <code>-h</code> or <code>--human-readable</code> that determines whether the sizes should be printed in a human-readable format. We use the <code>parse()</code> method to parse the command line arguments and store any file system paths in an array called <code>paths</code>.</p>
<p>Next, we define an <code>async</code> function called <code>df()</code> that calls the <code>getFileSystemStats()</code> function to get information about the file systems specified as command line arguments. We then use the <code>forEach()</code> method to loop through each file system and calculate the used space, free space, and percentage used.</p>
<p>We use a ternary operator to determine whether to use the <code>format()</code> function to format the file sizes or to simply convert them to strings. We then use <code>console.log()</code> to print the output to the console, which includes information about the file system path, total size, used space, free space, and percentage used. The output is formatted according to whether the <code>-h</code> option was specified.</p>
<p>Finally, we call the <code>df()</code> function to run the command.</p>
<p>Outputting the results to the console
Once the calculations have been performed, we can output the results to the console. We can display the output in a tabular format to make it more readable. We can use the <code>console.table</code> method to display the output in a tabular format.</p>
<p>Here’s the implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">printTable</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">rows</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF">[]) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">table</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">rows</span><span style="color: #ABB2BF">, [</span><span style="color: #98C379">'Filesystem'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'Size'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'Used'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'Available'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'Use%'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'Mounted on'</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">printResults</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">filesystem</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">blockSize</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">blocks</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">usedBlocks</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">availableBlocks</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">size</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">blockSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">blocks</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">used</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">blockSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">usedBlocks</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">available</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">blockSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">availableBlocks</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">usePercent</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> ((</span><span style="color: #E06C75">used</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">100</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">toFixed</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'%'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Filesystem'</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">filesystem</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Size'</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">size</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Used'</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">used</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Available'</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">available</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Use%'</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">usePercent</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Mounted on'</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'/'</span></span>
<span class="line"><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">printTable</span><span style="color: #ABB2BF">([</span><span style="color: #E06C75">data</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In the above code, the <code>printTable</code> function takes an array of objects and displays them in a tabular format using the <code>console.table</code> method. The second parameter of <code>console.table</code> specifies the columns to display.</p>
<p>The <code>printResults</code> function calculates the values of <code>size</code>, <code>used</code>, <code>available</code>, and <code>usePercent</code> using the provided arguments. It then creates an object with the calculated values and passes it to the <code>printTable</code> function for display.</p>
<p>We can now call the <code>printResults</code> function to output the results to the console.</p>
<p>Testing the df command
To test the <code>df</code> command, we can run it on a file system and check if the results match the expected output.</p>
<p>Here’s an example test case:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">df</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'./df'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">test</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'df command should display file system information'</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">df</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'/dev'</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">expectedOutput</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Filesystem'</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'/dev'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Size'</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">20971520</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Used'</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1241088</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Available'</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">19730432</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Use%'</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'5.92%'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #98C379">'Mounted on'</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'/'</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> ];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">toEqual</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">expectedOutput</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre>
<p>In the above code, we import the <code>df</code> function from the <code>df.ts</code> module. We then define a test case that calls the <code>df</code> function with a file system path and a block size of <code>1024</code>. We then define the expected output as an array of objects with the file system information.</p>
<p>Finally, we use the <code>expect</code> function to compare the actual output of the <code>df</code> command with the expected output. If the actual output matches the expected output, the test case passes. If not, it fails.</p>
<p>We can run this test case using a testing framework like Jest to ensure that the <code>df</code> command works correctly.</p>
<h1 id="chapter-6-building-a-rm-command">Chapter 6: Building a Rm Command</h1>
<p>Overview of the rm command and its functionality
The <code>rm</code> (remove) command is a Unix/Linux utility that is used to remove files or directories. It can be used to remove a single file, multiple files, or an entire directory tree.</p>
<p>The basic syntax of the <code>rm</code> command is:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">rm</span><span style="color: #ABB2BF"> [</span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">] </span><span style="color: #61AFEF">file</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">) </span><span style="color: #E06C75">or</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">directory</span></span></code></pre>
<p>Some common options for the <code>rm</code> command include:</p>
<ul>
<li><code>-r</code>: Removes directories and their contents recursively</li>
<li><code>-f</code>: Forces the removal of files without prompting for confirmation</li>
<li><code>-i</code>: Prompts the user before deleting each file</li>
</ul>
<p>The <code>rm</code> command can be a powerful tool, so it should be used with care to avoid accidentally deleting important files or directories.</p>
<p>Designing the Typescript implementation of the rm command
To design the Typescript implementation of the <code>rm</code> command, we need to first decide on the input and output of the command. The <code>rm</code> command takes one or more file or directory paths as input and removes them. It does not produce any output.</p>
<p>Here is a basic design for the <code>rm</code> command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #61AFEF">rm</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">string</span><span style="color: #ABB2BF">[], </span><span style="color: #E06C75">recursive</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">boolean</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">force</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">boolean</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">prompt</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">boolean</span><span style="color: #ABB2BF">): </span><span style="color: #C678DD">void</span></span></code></pre>
<p>The <code>rm</code> function takes an array of file or directory paths to remove, and three boolean parameters:</p>
<ul>
<li><code>recursive</code>: If <code>true</code>, the function will remove directories and their contents recursively.</li>
<li><code>force</code>: If <code>true</code>, the function will remove files without prompting for confirmation.</li>
<li><code>prompt</code>: If <code>true</code>, the function will prompt the user before deleting each file.</li>
</ul>
<p>The <code>rm</code> function does not return anything. It will throw an error if there is a problem removing any of the files or directories.</p>
<p>Here is a more detailed design for the <code>rm</code> command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">rm</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[], </span><span style="color: #E06C75; font-style: italic">recursive</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">force</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">prompt</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Validate input</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// - Ensure path exists and is a file or directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// - Ensure user has permission to delete path</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// If path is a file, delete it</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// If path is a directory and recursive flag is set, delete it and its contents recursively</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// If path is a directory and recursive flag is not set, throw an error</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// If force flag is set, delete files without prompting for confirmation</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// If prompt flag is set, prompt user before deleting each file</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This design outlines the basic steps that the <code>rm</code> function will take to remove files and directories. It also includes input validation to ensure that the user has provided valid paths to remove and has permission to delete them. The function will handle files and directories differently based on the <code>recursive</code> flag, and will either delete them or throw an error if necessary. Finally, the function will handle the <code>force</code> and <code>prompt</code> flags to either delete files without prompting or to prompt the user before deleting each file.</p>
<p>Reading and processing the input file or directory
To implement the <code>rm</code> command in Typescript, we first need to read and process the input file or directory path provided by the user. We can use the <code>fs</code> module in Node.js to achieve this.</p>
<p>Here’s an updated version of the design that includes the file and directory processing step:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">rm</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[], </span><span style="color: #E06C75; font-style: italic">recursive</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">force</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">prompt</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Validate input</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// - Ensure path exists and is a file or directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// - Ensure user has permission to delete path</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Read and process input files and directories</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">pathsToDelete</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forEach</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">p</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">existsSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">statSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isDirectory</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">recursive</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">pathsToDelete</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">throw</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Cannot delete directory '</span><span style="color: #C678DD">${</span><span style="color: #E06C75">p</span><span style="color: #C678DD">}</span><span style="color: #98C379">'. Use the recursive flag to delete directories.`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isFile</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">pathsToDelete</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">throw</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Path '</span><span style="color: #C678DD">${</span><span style="color: #E06C75">p</span><span style="color: #C678DD">}</span><span style="color: #98C379">' is not a file or directory.`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">throw</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Path '</span><span style="color: #C678DD">${</span><span style="color: #E06C75">p</span><span style="color: #C678DD">}</span><span style="color: #98C379">' does not exist.`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// If path is a file, delete it</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// If path is a directory and recursive flag is set, delete it and its contents recursively</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// If path is a directory and recursive flag is not set, throw an error</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// If force flag is set, delete files without prompting for confirmation</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// If prompt flag is set, prompt user before deleting each file</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this updated design, we first use the <code>fs</code> module to check if each path in the input array exists, and if so, whether it is a file or directory. If a path is a file, we add it to an array of paths to delete. If a path is a directory, we check whether the <code>recursive</code> flag is set, and add it to the array of paths to delete if it is. If <code>recursive</code> is not set for a directory, we throw an error.</p>
<p>We use the <code>fs</code> module’s <code>existsSync</code> method to check if the path exists, and the <code>fs</code> module’s <code>statSync</code> method to get information about the path. We can then use the <code>isDirectory</code> and <code>isFile</code> methods of the <code>fs.Stats</code> object to determine if the path is a directory or a file.</p>
<p>Once we have processed the input files and directories, we can move on to deleting them based on the <code>recursive</code>, <code>force</code>, and <code>prompt</code> flags.</p>
<p>Implementing the rm functionality
To implement the <code>rm</code> command in Typescript, we can use the <code>fs</code> module to delete the specified file or directory. The implementation will take the following steps:</p>
<ol>
<li>Check if the specified path exists and is a file or directory.</li>
<li>If it is a file, delete it using the <code>fs.unlink</code> method.</li>
<li>If it is a directory, recursively delete all its contents and then delete the directory itself using the <code>fs.rmdir</code> method.</li>
</ol>
<p>Here’s the Typescript code for the <code>rm</code> command implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">path</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'path'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">deleteFileOrDirectory</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">filePath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">statSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isFile</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">unlinkSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isDirectory</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readdirSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">forEach</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">curPath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">deleteFileOrDirectory</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">curPath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">rmdirSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'Usage: rm &#x3C;file or directory>'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filePath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">existsSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Error: </span><span style="color: #C678DD">${</span><span style="color: #E06C75">filePath</span><span style="color: #C678DD">}</span><span style="color: #98C379"> does not exist`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">deleteFileOrDirectory</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">();</span></span></code></pre>
<p>This implementation recursively deletes all contents of a specified directory. It also checks if the specified file or directory exists before attempting to delete it, and displays an error message if it does not exist.</p>
<p>Note that the <code>fs.unlinkSync</code> method is used to delete a file synchronously, while the <code>fs.rmdirSync</code> method is used to delete a directory synchronously. The <code>fs.readdirSync</code> method is used to get a list of all files and directories in a specified directory.</p>
<p>Outputting the results to the console
Since the <code>rm</code> command does not produce any output, we don’t need to output anything to the console. However, we should display an error message if the specified file or directory cannot be deleted.</p>
<p>We can modify the <code>deleteFileOrDirectory</code> function to throw an error if it encounters any issues while deleting a file or directory. Then, we can catch this error in the <code>main</code> function and display an error message to the console.</p>
<p>Here’s the updated code for the <code>deleteFileOrDirectory</code> function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">deleteFileOrDirectory</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">filePath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">statSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isFile</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">unlinkSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isDirectory</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readdirSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">forEach</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">curPath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">deleteFileOrDirectory</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">curPath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">rmdirSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">throw</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`</span><span style="color: #C678DD">${</span><span style="color: #E06C75">filePath</span><span style="color: #C678DD">}</span><span style="color: #98C379"> is not a file or directory`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>And here’s the updated <code>main</code> function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'Usage: rm &#x3C;file or directory>'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filePath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">existsSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Error: </span><span style="color: #C678DD">${</span><span style="color: #E06C75">filePath</span><span style="color: #C678DD">}</span><span style="color: #98C379"> does not exist`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">deleteFileOrDirectory</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Error: </span><span style="color: #C678DD">${</span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">message</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Now, if an error occurs while deleting a file or directory, we display an error message to the console.</p>
<p>Testing the rm command
To test the <code>rm</code> command, we can create some files and directories and then delete them using the <code>rm</code> command.</p>
<p>Here’s an example of how we can test the <code>rm</code> command:</p>
<ol>
<li>Create a new directory called <code>test_dir</code> and navigate into it:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">mkdir</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">test_dir</span></span>
<span class="line"><span style="color: #E06C75">cd</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">test_dir</span></span></code></pre>
<ol start="2">
<li>Create some files and directories inside the <code>test_dir</code> directory:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">mkdir</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">dir1</span></span>
<span class="line"><span style="color: #E06C75">touch</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #E06C75">touch</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file2</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #E06C75">mkdir</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">dir2</span></span>
<span class="line"><span style="color: #E06C75">touch</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file3</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<ol start="3">
<li>Use the <code>ls</code> command to confirm that the files and directories were created:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">$</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ls</span></span>
<span class="line"><span style="color: #E06C75">dir1</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">dir2</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file2</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file3</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<ol start="4">
<li>Use the <code>rm</code> command to delete the <code>file1.txt</code> file:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">rm</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>The <code>file1.txt</code> file should be deleted.
5. Use the <code>ls</code> command to confirm that the <code>file1.txt</code> file was deleted:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">$</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ls</span></span>
<span class="line"><span style="color: #E06C75">dir1</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">dir2</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file2</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file3</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<ol start="6">
<li>Use the <code>rm</code> command to delete the <code>dir1</code> directory and its contents:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">rm</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #E06C75">r</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">dir1</span></span></code></pre>
<p>The <code>dir1</code> directory and its contents should be deleted.
7. Use the <code>ls</code> command to confirm that the <code>dir1</code> directory and its contents were deleted:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">$</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ls</span></span>
<span class="line"><span style="color: #E06C75">dir2</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file2</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file3</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<ol start="8">
<li>Use the <code>rm</code> command to delete the <code>test_dir</code> directory and its contents:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">cd</span><span style="color: #ABB2BF"> ..</span></span>
<span class="line"><span style="color: #E06C75">rm</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #E06C75">r</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">test_dir</span></span></code></pre>
<p>The <code>test_dir</code> directory and its contents should be deleted.
9. Use the <code>ls</code> command to confirm that the <code>test_dir</code> directory and its contents were deleted:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">ls</span></span></code></pre>
<p>There should be no output, indicating that the <code>test_dir</code> directory and its contents were successfully deleted.</p>
<h1 id="chapter-7-building-a-touch-command">Chapter 7: Building a Touch Command</h1>
<p>Overview of the touch command and its functionality
The <code>touch</code> command is a command-line utility in Unix and Unix-like operating systems, used to create, change and modify timestamps of a file. If the file specified does not exist, it creates an empty file with the name provided. If the file exists, the timestamp of the file is updated to the current time. The name of the command <code>touch</code> comes from the fact that it updates the timestamp of the file and thus “touches” the file.</p>
<p>Designing the Typescript implementation of the touch command
The implementation of the <code>touch</code> command in Typescript will require the following steps:</p>
<ol>
<li>Reading and processing the command line arguments to determine the file name(s) to touch and the options specified (such as <code>-c</code>, <code>-a</code>, <code>-m</code>).</li>
<li>Checking if the file(s) specified exist or not. If it doesn’t exist, create an empty file with the specified name. If it does exist, update the access and/or modification timestamp of the file as specified by the options.</li>
<li>Output the result to the console.</li>
</ol>
<p>We will need to use the <code>fs</code> module in Node.js to interact with the file system and modify the timestamps of the files.</p>
<p>Here is a sample implementation in Typescript:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TouchOptions</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">c</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">m</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">touchFile</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">filename</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">options</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TouchOptions</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">existsSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">options</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">utimesSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Date</span><span style="color: #ABB2BF">(), </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Date</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">options</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">m</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">utimesSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Date</span><span style="color: #ABB2BF">(), </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">statSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">).</span><span style="color: #E06C75">atime</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">utimesSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">statSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">).</span><span style="color: #E06C75">atime</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Date</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">''</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">touchFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">filenames</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[], </span><span style="color: #E06C75; font-style: italic">options</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TouchOptions</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filename</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">filenames</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">touchFile</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Updated timestamp of file: </span><span style="color: #C678DD">${</span><span style="color: #E06C75">filename</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">parseArguments</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[]): { </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[]; </span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TouchOptions</span><span style="color: #ABB2BF"> } {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">options</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TouchOptions</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">c</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">m</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">arg</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">arg</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">startsWith</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'-'</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">option</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">arg</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">keyof</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TouchOptions</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">arg</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">options</span><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[]): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> { </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">options</span><span style="color: #ABB2BF"> } </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">parseArguments</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">touchFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">));</span></span></code></pre>
<p>In this implementation, we define an <code>interface</code> for the <code>TouchOptions</code> that contains the boolean flags for <code>-c</code>, <code>-m</code>, and <code>-a</code>. We define a <code>touchFile</code> function that takes in a filename and the options and updates the timestamps of the file. If the file doesn’t exist, it creates a new empty file. We define a <code>touchFiles</code> function that takes in an array of filenames and options, and calls <code>touchFile</code> on each of them. We also define a <code>parseArguments</code> function that parses the command-line arguments and returns the options and filenames. Finally, we define a <code>main</code> function that calls <code>parseArguments</code> and <code>touchFiles</code> with the options and filenames respectively.</p>
<p>Reading and processing the input file
Since the <code>touch</code> command creates a new file or updates the modification time of an existing file, it needs to read and process the input file.</p>
<p>The input file can be specified as a command-line argument, and the touch command needs to determine if the file already exists or needs to be created. If the file already exists, the touch command should update its modification time. If the file doesn’t exist, the touch command should create it.</p>
<p>In addition, the touch command may need to create intermediate directories if they don’t already exist, depending on the path specified for the new file.</p>
<p>To read and process the input file, the touch command can use the <code>fs</code> module provided by Node.js. Specifically, it can use the <code>fs.stat()</code> method to check if the file already exists, and the <code>fs.writeFile()</code> method to create a new file or update the modification time of an existing file. The <code>fs.mkdir()</code> method can also be used to create intermediate directories if needed.</p>
<p>Implementing the touch functionality
To implement the touch functionality in TypeScript, we can start by importing the <code>fs</code> module:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span></code></pre>
<p>Then, we can define a function that takes a file path as a parameter and updates its modification time or creates the file if it doesn’t exist. We can use the <code>fs.stat()</code> method to check if the file exists, and the <code>fs.writeFile()</code> method to create the file or update its modification time. Here’s an example implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">touch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">filePath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">, (</span><span style="color: #E06C75; font-style: italic">err</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">stats</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">err</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">code</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'ENOENT'</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// File doesn't exist, create it</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeFile</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">''</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">err</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Error creating file: </span><span style="color: #C678DD">${</span><span style="color: #E06C75">err</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Created file: </span><span style="color: #C678DD">${</span><span style="color: #E06C75">filePath</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Error checking file: </span><span style="color: #C678DD">${</span><span style="color: #E06C75">err</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// File already exists, update its modification time</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">utimes</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">atime</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Date</span><span style="color: #ABB2BF">(), </span><span style="color: #E06C75; font-style: italic">err</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Error updating file: </span><span style="color: #C678DD">${</span><span style="color: #E06C75">err</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Updated file: </span><span style="color: #C678DD">${</span><span style="color: #E06C75">filePath</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This function checks if the file exists by calling <code>fs.stat()</code> with the file path. If the file doesn’t exist, the function creates it by calling <code>fs.writeFile()</code> with an empty string as the file content. If the file already exists, the function updates its modification time by calling <code>fs.utimes()</code> with the existing access time and the current time.</p>
<p>Finally, we can call this <code>touch()</code> function with the file path specified as a command-line argument:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filePath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #61AFEF">touch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>Note that this implementation doesn’t handle the case where the file path specifies intermediate directories that don’t exist. In that case, we need to create the intermediate directories before creating the file. We can use the <code>fs.mkdir()</code> method for this.</p>
<p>Outputting the results to the console
The <code>touch</code> command does not typically have any output to the console unless there is an error. If the file already exists, it will update the modification time, and if it doesn’t exist, it will create an empty file with the specified name. A message can be displayed if the file is successfully created or updated.</p>
<p>Testing the touch command
To test the <code>touch</code> command, you can perform the following steps:</p>
<ol>
<li>Create a test file: <code>touch testfile.txt</code></li>
<li>Verify that the file was created: <code>ls -l testfile.txt</code></li>
<li>Check the modification time of the file: <code>stat testfile.txt</code></li>
<li>Update the file’s modification time: <code>touch testfile.txt</code></li>
<li>Verify that the modification time has been updated: <code>stat testfile.txt</code></li>
<li>Try creating a file with an invalid file name: <code>touch $'invalid:file:name'</code></li>
</ol>
<p>By performing these steps, you can verify that the <code>touch</code> command is able to create and update files with valid file names and that it fails gracefully when provided with invalid file names.</p>
<h1 id="chapter-8-building-a-locate-command">Chapter 8: Building a Locate Command</h1>
<p>Overview of the locate command and its functionality
The <code>locate</code> command is used to find files on the system by name. It works by searching an index of file names and locations, which is created and updated periodically by the system’s indexing service. The <code>locate</code> command then searches this index for files that match the specified search pattern and outputs their paths to the console. The <code>locate</code> command is typically much faster than using <code>find</code> to search the file system, especially when searching for files with common names. However, it may not find files that have been recently added or modified, since the index is only updated periodically.</p>
<p>Designing the Typescript implementation of the locate command
To implement the <code>locate</code> command in Typescript, we will need to use the Node.js <code>child_process</code> module to run the <code>locate</code> command in a new child process and capture its output. Here is an outline of the steps involved:</p>
<ol>
<li>Parse the command line arguments to determine the search pattern and any options, such as case sensitivity or file type filters.</li>
<li>Construct the <code>locate</code> command string based on the options specified and the search pattern.</li>
<li>Use the <code>child_process.spawn()</code> method to create a new child process that runs the <code>locate</code> command with the specified options and search pattern.</li>
<li>Capture the output of the <code>locate</code> command as it is streamed to the console by listening to the <code>stdout</code> event of the child process.</li>
<li>Parse the output of the <code>locate</code> command to extract the file paths that match the search pattern.</li>
<li>Output the matching file paths to the console in a formatted way.</li>
</ol>
<p>We can implement each of these steps in Typescript to create a working <code>locate</code> command.</p>
<p>Reading and processing the input search query
To implement the <code>locate</code> command in Typescript, we need to first read and process the input search query. The <code>locate</code> command accepts a single argument which is the search query. The command then searches the entire file system for files and directories that contain the search query in their name or path.</p>
<p>In Typescript, we can read the input search query using the <code>process.argv</code> array. The first argument in the <code>process.argv</code> array is the path to the <code>node</code> executable, and the second argument is the path to the Typescript file being executed. We can access the input search query by getting the third argument in the array, which corresponds to the search query.</p>
<p>Here’s some sample code to read and process the input search query:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">searchQuery</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">];</span></span></code></pre>
<p>This code reads the input search query from the command line arguments and stores it in the <code>searchQuery</code> variable.</p>
<p>Next, we need to check if the input search query is valid. If the search query is not provided, we should display an error message and exit the program. If the search query is provided, we can proceed with searching the file system for files and directories that contain the search query in their name or path.</p>
<p>Implementing the locate functionality
To implement the locate command, we can use the <code>find</code> command that comes with most Unix-like systems. The <code>find</code> command recursively searches for files and directories in a given path, based on certain criteria, such as the file name, size, or modification time.</p>
<p>In our Typescript implementation of the <code>locate</code> command, we will take the following steps:</p>
<ol>
<li>Parse the input search query, which can be a string or a regular expression.</li>
<li>Use the <code>child_process</code> module to execute the <code>find</code> command with the given path and search criteria.</li>
<li>Parse the output of the <code>find</code> command, which will be a list of file paths.</li>
<li>Output the list of file paths to the console.</li>
</ol>
<p>Let’s go through each of these steps in more detail.</p>
<p>First, we need to parse the input search query. The search query can be a string or a regular expression, so we need to handle both cases. We can define a function called <code>parseSearchQuery</code> that takes a string as input and returns either a string or a regular expression, depending on the format of the input. For example, if the input is <code>/usr/local/*.txt</code>, we will return a regular expression that matches all files with a <code>.txt</code> extension in the <code>/usr/local</code> directory. If the input is just <code>*.txt</code>, we will return a string that matches all files with a <code>.txt</code> extension in the current directory.</p>
<p>Next, we will use the <code>child_process</code> module to execute the <code>find</code> command with the given path and search criteria. We can define a function called <code>executeFindCommand</code> that takes a path and a search query as input and returns a Promise that resolves with the output of the <code>find</code> command. To execute the <code>find</code> command, we can use the <code>spawn</code> method of the <code>child_process</code> module, passing the path and search query as arguments.</p>
<p>Once we have the output of the <code>find</code> command, we need to parse it to get a list of file paths. We can define a function called <code>parseFindOutput</code> that takes the output of the <code>find</code> command as input and returns an array of file paths. To do this, we can split the output by newline characters and filter out any empty lines or lines that don’t contain file paths.</p>
<p>Finally, we need to output the list of file paths to the console. We can define a function called <code>outputFilePaths</code> that takes an array of file paths as input and outputs each path on a separate line.</p>
<p>With these functions in place, we can define our <code>locate</code> command by calling the <code>parseSearchQuery</code>, <code>executeFindCommand</code>, and <code>parseFindOutput</code> functions in sequence, and then passing the resulting array of file paths to the <code>outputFilePaths</code> function.</p>
<p>Outputting the results to the console
To output the results of the <code>locate</code> command to the console, we can simply loop through the results array and print each item to the console.</p>
<p>Here’s an example implementation:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">outputLocateResults</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">results</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[], </span><span style="color: #E06C75; font-style: italic">humanReadable</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">results</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'No results found.'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'Results:'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">results</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forEach</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">result</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">humanReadable</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'Total number of results:'</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">results</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this implementation, we first check if the results array is empty. If it is, we print a message to the console and return. If there are results, we print a message to indicate that the results are about to be printed.</p>
<p>We then loop through the results array and print each item to the console using <code>console.log()</code>. Finally, if the <code>humanReadable</code> flag is set to true, we print the total number of results to the console.</p>
<p>Testing the locate command
To test the <code>locate</code> command, we can create some test files in a directory and then search for them using the command.</p>
<p>First, let’s create a directory called <code>testDir</code> and move into it:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">mkdirSync</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"testDir"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">chdir</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"testDir"</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>Now, we’ll create some test files using the <code>touch</code> command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"file1.txt"</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">""</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"file2.txt"</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">""</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">writeFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"file3.md"</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">""</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>Finally, we can test the <code>locate</code> command by searching for all files with the <code>.txt</code> extension:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">searchQuery</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">".txt"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">results</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">locate</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">searchQuery</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">results</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>This should output an array containing the paths to the <code>file1.txt</code> and <code>file2.txt</code> files.</p>
<h1 id="chapter-9-building-a-find-command">Chapter 9: Building a Find Command</h1>
<p>Overview of the find command and its functionality
The <code>find</code> command is a powerful tool that is used to search for files and directories within a specified directory hierarchy. It can be used to search for files based on different criteria, such as name, size, modification time, and permissions. The <code>find</code> command is commonly used by system administrators to manage and maintain file systems. It can also be used by developers to locate specific files in a project directory.</p>
<p>Designing the Typescript implementation of the find command
The <code>find</code> command in Typescript can be implemented using the <code>fs</code> module provided by Node.js. The basic functionality of the <code>find</code> command is to search for files in a specified directory hierarchy based on different search criteria.</p>
<p>Here is a rough outline of the design for the Typescript implementation of the <code>find</code> command:</p>
<ol>
<li>Parse the command line arguments to extract the search directory and the search criteria.</li>
<li>Check if the search directory exists, and if it is a directory or a file.</li>
<li>If the search directory is a file, output an error message and exit.</li>
<li>If the search directory is a directory, recursively search for files based on the search criteria.</li>
<li>For each file found, output the file path to the console.</li>
</ol>
<p>To implement the search criteria, we can use the <code>fs.stat()</code> method to get the file stats and check the file name, size, modification time, or permissions.</p>
<p>We can also use the <code>path</code> module to handle file path operations like joining and normalizing paths.</p>
<p>Overall, the implementation of the <code>find</code> command in Typescript would involve working with file system operations provided by Node.js, parsing command line arguments, and outputting search results to the console.</p>
<p>Reading and processing the input directory and search query
To implement the <code>find</code> command, we need to read and process the input directory path and the search query pattern.</p>
<p>The input directory path is specified as the first argument after the command name. We can use the <code>process.argv</code> array to retrieve the command line arguments, where <code>process.argv[0]</code> is the path to the Node.js executable, <code>process.argv[1]</code> is the path to the script file, and the remaining elements are the command line arguments.</p>
<p>The search query pattern is specified as an option, which can be preceded by a hyphen (<code>-</code>) or double hyphen (<code>--</code>). For example, to search for files with the <code>.txt</code> extension, we can use the <code>-name "*.txt"</code> option. We can use the <code>minimist</code> package to parse the command line arguments and retrieve the options.</p>
<p>Here’s an example code snippet to retrieve the input directory path and search query pattern:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">minimist</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'minimist'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">resolve</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'path'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">minimist</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">directory</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'.'</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// use current directory if not specified</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">query</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">`-name "</span><span style="color: #C678DD">${</span><span style="color: #E5C07B">args</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #C678DD">}</span><span style="color: #98C379">"`</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">''</span><span style="color: #ABB2BF">;</span></span></code></pre>
<p>In this example, we’re using the <code>resolve</code> function from the <code>path</code> module to resolve the input directory path to an absolute path, and defaulting to the current directory if not specified. We’re also checking if the <code>name</code> option is specified, and using it to construct the search query pattern.</p>
<p>Implementing the find functionality
To implement the <code>find</code> functionality in Typescript, we can follow these steps:</p>
<ol>
<li>Read the input directory and search query from the command-line arguments.</li>
<li>Use the <code>fs</code> module to traverse the directory recursively and find all files and subdirectories.</li>
<li>Use the <code>path</code> module to check if each file matches the search query.</li>
<li>Print the absolute path of each matching file to the console.</li>
</ol>
<p>Here’s an implementation of the <code>find</code> command in Typescript:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">path</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'path'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">findFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">dir</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">query</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[] {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">results</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readdirSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">dir</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">forEach</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filePath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">dir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">statSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">isDirectory</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">results</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">results</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">concat</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">findFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">includes</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">results</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">results</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> [</span><span style="color: #E5C07B">dir</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">query</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">findFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">dir</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">query</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">));</span></span></code></pre>
<p>In this implementation, the <code>findFiles</code> function is called recursively for each subdirectory of the input directory. It checks if each file in the directory matches the search query, and if so, adds its absolute path to the <code>results</code> array. Finally, the function returns the <code>results</code> array, which contains the absolute paths of all matching files.</p>
<p>In the main body of the program, we read the input directory and search query from the command-line arguments, and call the <code>findFiles</code> function to find all matching files. We then print the absolute path of each matching file to the console, separated by newline characters.</p>
<p>Note that this implementation does not handle errors that may occur while reading the input directory, such as permission errors or non-existent directories. It also does not handle edge cases such as file names containing newlines. These issues can be addressed with additional error handling and input validation.</p>
<p>Outputting the results to the console
To output the results of the find command to the console, we can use the <code>console.log()</code> method to print each matching file path to the console. We can also provide options to customize the output, such as showing only the file name instead of the full path, and displaying the file size or modification date.</p>
<p>Here is an example implementation of the <code>find</code> command’s output functionality:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FindOptions</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pathOnly</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">showSize</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">showDate</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">printFileDetails</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">filePath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">options</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">FindOptions</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">statSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">output</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">options</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">pathOnly</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">output</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">basename</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">options</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">showSize</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">output</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">` (</span><span style="color: #C678DD">${</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">size</span><span style="color: #C678DD">}</span><span style="color: #98C379"> bytes)`</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">options</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">showDate</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">output</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">` (</span><span style="color: #C678DD">${</span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">mtime</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">toLocaleString</span><span style="color: #ABB2BF">()</span><span style="color: #C678DD">}</span><span style="color: #98C379">)`</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">output</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">printMatches</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">matches</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[], </span><span style="color: #E06C75; font-style: italic">options</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">FindOptions</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filePath</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">matches</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">printFileDetails</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>The <code>printFileDetails()</code> function takes in a file path and the options object, and constructs the output string based on the selected options. The <code>printMatches()</code> function takes in the list of matching file paths and the options object, and prints each file’s details to the console using the <code>printFileDetails()</code> function.</p>
<p>Note that the <code>fs.statSync()</code> method is used to retrieve the file’s size and modification date. The <code>path.basename()</code> method is used to extract the file name from the full path, if the <code>pathOnly</code> option is enabled.</p>
<p>We can call the <code>printMatches()</code> function with the list of matching file paths and the options object, as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">matches</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">findFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">directoryPath</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">searchQuery</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #61AFEF">printMatches</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">matches</span><span style="color: #ABB2BF">, { </span><span style="color: #E06C75">pathOnly</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">showSize</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> });</span></span></code></pre>
<p>This will print the list of matching file names along with their sizes, using a human-readable format if the file size is large.</p>
<p>Testing the find command
As with the other commands, we will need to test the <code>find</code> command thoroughly to ensure that it works as expected. We can create a directory structure with files and directories to use for testing the command.</p>
<p>Here’s an example of how we can set up our test directory structure:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">testDir</span></span>
<span class="line"><span style="color: #ABB2BF">├── </span><span style="color: #E5C07B">file1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #ABB2BF">├── </span><span style="color: #E5C07B">file2</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #ABB2BF">├── </span><span style="color: #E5C07B">file3</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">md</span></span>
<span class="line"><span style="color: #ABB2BF">├── </span><span style="color: #E06C75">subDir1</span></span>
<span class="line"><span style="color: #ABB2BF">│ ├── </span><span style="color: #E5C07B">file4</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #ABB2BF">│ ├── </span><span style="color: #E5C07B">file5</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">md</span></span>
<span class="line"><span style="color: #ABB2BF">│ └── </span><span style="color: #E06C75">subDir2</span></span>
<span class="line"><span style="color: #ABB2BF">│ ├── </span><span style="color: #E5C07B">file6</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #ABB2BF">│ └── </span><span style="color: #E5C07B">file7</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">md</span></span>
<span class="line"><span style="color: #ABB2BF">└── </span><span style="color: #E06C75">subDir3</span></span>
<span class="line"><span style="color: #ABB2BF"> ├── </span><span style="color: #E5C07B">file8</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #ABB2BF"> ├── </span><span style="color: #E5C07B">file9</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">md</span></span>
<span class="line"><span style="color: #ABB2BF"> └── </span><span style="color: #E06C75">subDir4</span></span>
<span class="line"><span style="color: #ABB2BF"> ├── </span><span style="color: #E5C07B">file10</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span>
<span class="line"><span style="color: #ABB2BF"> └── </span><span style="color: #E5C07B">file11</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">md</span></span></code></pre>
<p>We can create the test directory structure using the following commands:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">mkdir</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">testDir</span></span>
<span class="line"><span style="color: #E06C75">cd</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">testDir</span></span>
<span class="line"><span style="color: #E06C75">touch</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file2</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file3</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">md</span></span>
<span class="line"><span style="color: #E06C75">mkdir</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">subDir1</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">subDir3</span></span>
<span class="line"><span style="color: #E06C75">cd</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">subDir1</span></span>
<span class="line"><span style="color: #E06C75">touch</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file4</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file5</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">md</span></span>
<span class="line"><span style="color: #E06C75">mkdir</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">subDir2</span></span>
<span class="line"><span style="color: #E06C75">cd</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">subDir2</span></span>
<span class="line"><span style="color: #E06C75">touch</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file6</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file7</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">md</span></span>
<span class="line"><span style="color: #E06C75">cd</span><span style="color: #ABB2BF"> ..</span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">..</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">subDir3</span></span>
<span class="line"><span style="color: #E06C75">touch</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file8</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file9</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">md</span></span>
<span class="line"><span style="color: #E06C75">mkdir</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">subDir4</span></span>
<span class="line"><span style="color: #E06C75">cd</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">subDir4</span></span>
<span class="line"><span style="color: #E06C75">touch</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file10</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file11</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">md</span></span>
<span class="line"><span style="color: #E06C75">cd</span><span style="color: #ABB2BF"> ..</span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF">..</span></span></code></pre>
<p>Now, we can test the <code>find</code> command by running it with different search queries and options, and verifying that the output is correct. Here are some examples of how we can test the command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color: #ABB2BF"># </span><span style="color: #E06C75">Find</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">all</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">the</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">test</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">directory</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">structure</span></span>
<span class="line"><span style="color: #E06C75">ts</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">node</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">find</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">ts</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">testDir</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"># </span><span style="color: #E06C75">Find</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">all</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">with</span><span style="color: #ABB2BF"> .</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">extension</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">the</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">test</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">directory</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">structure</span></span>
<span class="line"><span style="color: #E06C75">ts</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">node</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">find</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">ts</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">testDir</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\*</span><span style="color: #98C379">.txt"</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"># </span><span style="color: #E06C75">Find</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">all</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">with</span><span style="color: #ABB2BF"> .</span><span style="color: #E06C75">md</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">extension</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">the</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">subDir1</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">directory</span></span>
<span class="line"><span style="color: #E06C75">ts</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">node</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">find</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">ts</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">testDir</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">subDir1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\*</span><span style="color: #98C379">.md"</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"># </span><span style="color: #E06C75">Find</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">all</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">with</span><span style="color: #ABB2BF"> .</span><span style="color: #E06C75">txt</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">extension</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">the</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">subDir2</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">directory</span></span>
<span class="line"><span style="color: #E06C75">ts</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">node</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">find</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">ts</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">testDir</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">subDir1</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">subDir2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"</span><span style="color: #56B6C2">\*</span><span style="color: #98C379">.txt"</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"># </span><span style="color: #E06C75">Find</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">all</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">directories</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">the</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">test</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">directory</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">structure</span></span>
<span class="line"><span style="color: #E06C75">ts</span><span style="color: #56B6C2">-</span><span style="color: #E06C75">node</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">find</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">ts</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">testDir</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">d</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"># Find all files in the test directory structure modified in the last 24 hours</span></span>
<span class="line"><span style="color: #ABB2BF">ts-node find.ts testDir -mtime 0</span></span></code></pre>
<p>We should compare the output of the <code>find</code> command with the expected results for each test case, and make sure that they match. If the output is correct for all test cases, we can conclude that the <code>find</code> command works as expected.</p>
<h1 id="chapter-10-building-a-grep-command">Chapter 10: Building a Grep Command</h1>
<p>Overview of the grep command and its functionality
The <code>grep</code> command is a powerful search tool used to find specific text or patterns in files or directories. It stands for “Global Regular Expression Print”. The command takes in a pattern, searches for it in a given input file, and outputs any lines that contain the specified pattern.</p>
<p>The basic syntax of the <code>grep</code> command is as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">grep</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pattern</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span></span></code></pre>
<p>Where <code>pattern</code> is the text or regular expression to search for, and <code>file</code> is the name of the file to search in. Multiple files can be searched by using a wildcard, for example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">grep</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pattern</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>This would search for the pattern in all text files in the current directory.</p>
<p>The <code>grep</code> command also supports various options that modify its behavior, such as case sensitivity, recursive searching, and displaying line numbers.</p>
<p>Designing the Typescript implementation of the grep command
The <code>grep</code> command is used to search for specific patterns in files. The command takes a regular expression pattern and a file name or names as arguments, and searches each specified file for lines containing the pattern.</p>
<p>To design the Typescript implementation of the <code>grep</code> command, we need to consider the following steps:</p>
<ol>
<li>Reading and processing the input file or files</li>
<li>Searching for the specified pattern in each file</li>
<li>Outputting the matching lines to the console</li>
</ol>
<p>To handle the regular expression pattern, we can use the built-in <code>RegExp</code> object in Typescript.</p>
<p>To handle multiple files, we can accept an array of file names as input, and iterate through each file to search for the pattern.</p>
<p>To handle command line options, we can use a library like <code>commander</code> to parse and handle the options. Possible options for the <code>grep</code> command include:</p>
<ul>
<li><code>-i</code>: ignore case when searching for the pattern</li>
<li><code>-n</code>: print the line numbers of the matching lines</li>
<li><code>-v</code>: invert the match, printing only the lines that do not match the pattern</li>
<li><code>-c</code>: print only the count of matching lines</li>
</ul>
<p>By implementing these steps and options, we can create a Typescript version of the <code>grep</code> command that can be used to search for patterns in files.</p>
<p>Reading and processing the input file and search query
To implement the <code>grep</code> command in TypeScript, we need to read and process the input file and search query.</p>
<p>We can start by accepting the search query as the first argument, and the file path as the second argument. We will then read the file line by line and search for the given pattern in each line. If a line matches the pattern, we will store it in a result array.</p>
<p>Here’s the basic code skeleton for reading and processing the input file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">searchQuery</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">filePath</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fileData</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filePath</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'utf-8'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fileLines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fileData</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [];</span></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">line</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fileLines</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">line</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">includes</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">searchQuery</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">line</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we first read the search query and file path from the command line arguments. We then read the contents of the file and split it into an array of lines. We iterate through each line and check if it contains the search query using the <code>includes()</code> method. If it does, we add the line to the result array.</p>
<p>Note that this is just the basic structure, and we will need to add error handling and other features for a complete implementation.</p>
<p>Implementing the grep functionality
To implement the grep functionality in Typescript, we need to read the input file and search for the specified pattern within it. Here are the basic steps:</p>
<ol>
<li>Read the input file and store its content in a string variable.</li>
<li>Split the content of the file into an array of lines.</li>
<li>Loop through each line of the file, searching for the specified pattern using a regular expression.</li>
<li>If the pattern is found in the line, output the line to the console.</li>
</ol>
<p>Here’s a sample implementation of the <code>grep</code> command in Typescript:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">grep</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">filename</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">pattern</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">content</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readFileSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'utf8'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">content</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lines</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">line</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">lines</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">match</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">line</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">match</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">pattern</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">match</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">line</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this implementation, we use the Node.js <code>fs</code> module to read the input file and store its content in the <code>content</code> variable. We then split the content of the file into an array of lines using the <code>split</code> method. We then loop through each line of the file using a <code>for</code> loop, searching for the specified pattern using the <code>match</code> method of the <code>String</code> class, which returns an array of matches or null if no match is found. If a match is found, we output the line to the console using the <code>console.log</code> method.</p>
<p>Note that this implementation assumes that the input file is a text file. If the input file is a binary file, we would need to use a different approach to read its content.</p>
<p>Outputting the results to the console
To output the results of the <code>grep</code> command to the console, we can simply loop through the <code>matchingLines</code> array and log each line to the console using <code>console.log()</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">line</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">matchingLines</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">line</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>We can also add an option to output the results to a file by using the <code>fs</code> module to create a write stream and piping the matching lines to it:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">outputFile</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">writeStream</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createWriteStream</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">outputFile</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">line</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">matchingLines</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">writeStream</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">line</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">writeStream</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">end</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">line</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">matchingLines</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">line</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In the above code, we first check if an output file was specified using the <code>outputFile</code> variable. If it was, we create a write stream using <code>fs.createWriteStream()</code> and loop through the <code>matchingLines</code> array, writing each line to the stream. Finally, we call <code>writeStream.end()</code> to close the stream.</p>
<p>If no output file was specified, we simply loop through the <code>matchingLines</code> array and log each line to the console using <code>console.log()</code>.</p>
<p>Testing the grep command
To test the <code>grep</code> command, we can create a sample text file and search for a specific string in it.</p>
<p>Here’s an example:</p>
<ol>
<li>Create a file named <code>sample.txt</code> and add some text to it.</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">echo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"This is a sample text file. It contains some random text."</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">sample</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<ol start="2">
<li>Run the <code>grep</code> command to search for a specific string.</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">grep</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"random"</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">sample</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">txt</span></span></code></pre>
<p>This should output the line that contains the word “random” in the <code>sample.txt</code> file.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">It</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">contains</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">some</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">random</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">.</span></span></code></pre>
<h1 id="chapter-11-building-a-tar-command">Chapter 11: Building a Tar Command</h1>
<p>Overview of the tar command and its functionality
The <code>tar</code> command is used to create, view, and extract tar archives. A tar archive is a collection of files that are stored as a single file. The tar format is often used to create backups or to distribute files.</p>
<p>The <code>tar</code> command can be used to perform a variety of operations on tar archives, including:</p>
<ul>
<li><code>c</code>: Create a new tar archive.</li>
<li><code>x</code>: Extract files from a tar archive.</li>
<li><code>t</code>: List the contents of a tar archive.</li>
<li><code>u</code>: Update an existing tar archive.</li>
<li><code>r</code>: Append files to an existing tar archive.</li>
<li><code>f</code>: Specify the name of the tar archive.</li>
</ul>
<p>The <code>tar</code> command can also be used with various options to customize its behavior. For example, the <code>-z</code> option is used to compress the archive with gzip, and the <code>-j</code> option is used to compress the archive with bzip2.</p>
<p>Designing the Typescript implementation of the tar command
To implement the <code>tar</code> command in TypeScript, we can follow these steps:</p>
<ol>
<li>Parse the command line arguments to determine the mode of operation, i.e., whether to create an archive or extract files from an archive.</li>
<li>If the mode of operation is to create an archive, determine the files/directories to be included in the archive.</li>
<li>If the mode of operation is to extract files from an archive, determine the archive file and the target directory for extraction.</li>
<li>Create an archive or extract files based on the mode of operation and the inputs provided.</li>
</ol>
<p>We can use the <code>tar</code> library to create and extract tar archives. The library provides methods to create an archive, extract files from an archive, add files to an existing archive, and update an archive.</p>
<p>We can use the <code>yargs</code> library to parse command-line arguments. We can define command-line options to specify the mode of operation, archive file name, target directory, and files/directories to be included in the archive.</p>
<p>Once we have the necessary inputs, we can use the <code>tar</code> library to create or extract the archive. We can display progress messages and errors to the console based on the outcome of the operation.</p>
<p>Reading and processing the input files or directories
To implement the <code>tar</code> command, we need to be able to read and process the input files or directories.</p>
<p>The <code>tar</code> command is used to create archives, which are collections of files and directories that can be compressed for easier transfer or storage. To create an archive with <code>tar</code>, we need to specify the files and directories that we want to include, as well as the name of the archive file that we want to create. We can also specify various options to control the compression and other aspects of the archive creation process.</p>
<p>To read and process the input files or directories, we can use the <code>fs</code> module in Node.js. We can use the <code>fs.readdir()</code> method to get a list of files and directories in a directory, and the <code>fs.stat()</code> method to get information about a file or directory, such as its size and type.</p>
<p>We can also use the <code>path</code> module to work with file paths, and the <code>stream</code> module to handle the reading and writing of data.</p>
<p>Implementing the tar functionality
To implement the <code>tar</code> command, we will first need to decide on the specific tar file format we want to use. The most common formats are <code>tar</code>, <code>tar.gz</code>, and <code>tar.bz2</code>.</p>
<p>Once we have decided on the format, we will need to use a third-party library or module that supports that format to create the tar archive. We will also need to implement the ability to extract the contents of the tar archive.</p>
<p>Here’s a rough outline of how we could implement the <code>tar</code> command:</p>
<ol>
<li>Read in the list of files or directories to include in the tar archive.</li>
<li>Use a third-party library or module to create the tar archive in the desired format.</li>
<li>If the <code>--extract</code> flag is present, extract the contents of the tar archive using the same library or module.</li>
<li>Output the results to the console.</li>
</ol>
<p>We can use the <code>tar</code> module available in Node.js to create and extract tar archives. We will also use the <code>fs</code> module to read and write files.</p>
<p>Here’s a sample implementation of the <code>tar</code> command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"fs"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">createReadStream</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">createWriteStream</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"fs"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">createGzip</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">createBrotliCompress</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"zlib"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tar</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"tar"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tarFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">files</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[], </span><span style="color: #E06C75; font-style: italic">tarFileName</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">format</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"tar"</span><span style="color: #ABB2BF"> | </span><span style="color: #98C379">"gz"</span><span style="color: #ABB2BF"> | </span><span style="color: #98C379">"bz2"</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">writeStream</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">format</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"tar"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createWriteStream</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">tarFileName</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">format</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"gz"</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createWriteStream</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">tarFileName</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">createGzip</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createWriteStream</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">tarFileName</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">createBrotliCompress</span><span style="color: #ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">pack</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tar</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">create</span><span style="color: #ABB2BF">({ </span><span style="color: #E06C75">cwd</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"/"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">follow</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">strict</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">pack</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">writeStream</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">pack</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">pack</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">end</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Successfully created tar archive at </span><span style="color: #C678DD">${</span><span style="color: #E06C75">tarFileName</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">extractTarArchive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">tarFileName</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">extractPath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">readStream</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarFileName</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">endsWith</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">".gz"</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createReadStream</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">tarFileName</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">createGunzip</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarFileName</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">endsWith</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">".bz2"</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createReadStream</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">tarFileName</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">createBrotliDecompress</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createReadStream</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">tarFileName</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">extract</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tar</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">extract</span><span style="color: #ABB2BF">({ </span><span style="color: #E06C75">cwd</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">extractPath</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">strict</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">readStream</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">extract</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">extract</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">on</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"finish"</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Successfully extracted tar archive to </span><span style="color: #C678DD">${</span><span style="color: #E06C75">extractPath</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">(): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> [, , </span><span style="color: #E5C07B">flag</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">tarFileName</span><span style="color: #ABB2BF">, ...</span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">argv</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">format</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarFileName</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">endsWith</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">".gz"</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"gz"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarFileName</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">endsWith</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">".bz2"</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"bz2"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"tar"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">flag</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"--extract"</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">extractTarArchive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">tarFileName</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">"."</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tarFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">tarFileName</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">format</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">();</span></span></code></pre>
<p>In this implementation, we use the <code>tar.create()</code> method to create a new tar stream and the <code>tar.extract()</code> method to extract the contents of a tar archive. We also use the <code>zlib</code> module to support gzip and brotli compression formats.</p>
<p>To create a tar archive, we can use the <code>tar</code> module in Node.js. This module provides an easy-to-use API for creating, extracting, and manipulating tar archives.</p>
<p>To add files or directories to the tar archive, we can use the <code>tar.create</code> method. Here is an example of how we can create a tar archive:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tar</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'tar'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [</span><span style="color: #98C379">'file1.txt'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'file2.txt'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'dir1'</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'dir2'</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarStream</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tar</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">create</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'archive.tar'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">cwd</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'/path/to/source/dir'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">gzip</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">filter</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Exclude node_modules directory</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">includes</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'node_modules'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> },</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Add files and directories to the tar archive</span></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarStream</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Close the tar archive stream</span></span>
<span class="line"><span style="color: #E5C07B">tarStream</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">end</span><span style="color: #ABB2BF">();</span></span></code></pre>
<p>In this example, we use the <code>tar.create</code> method to create a writable stream for the tar archive. The <code>file</code> option specifies the name of the tar archive file to create, and the <code>cwd</code> option specifies the base directory for the files and directories to add to the archive.</p>
<p>We also enable gzip compression by setting the <code>gzip</code> option to <code>true</code>, and we filter out the <code>node_modules</code> directory by using the <code>filter</code> option.</p>
<p>Next, we use a <code>for</code> loop to add each file and directory to the tar archive using the <code>tarStream.add</code> method.</p>
<p>Finally, we close the tar archive stream by calling the <code>tarStream.end</code> method.</p>
<p>To extract files from a tar archive, we can use the <code>tar.extract</code> method. Here is an example of how we can extract a tar archive:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tar</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'tar'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarStream</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createReadStream</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'archive.tar'</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">tar</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">extract</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">cwd</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'/path/to/extract/dir'</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">tarStream</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">on</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'end'</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'Tar archive extraction complete.'</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre>
<p>In this example, we use the <code>fs.createReadStream</code> method to create a readable stream for the tar archive file, and we pipe the stream to the <code>tar.extract</code> method to extract the files and directories to the specified directory.</p>
<p>We also use the <code>cwd</code> option to specify the base directory for the extracted files and directories.</p>
<p>Finally, we listen to the <code>end</code> event of the <code>tarStream</code> object to be notified when the tar archive extraction is complete.</p>
<p>Note that the <code>tar</code> module also supports other compression formats, such as brotli, by setting the <code>brotli</code> option to <code>true</code> when creating a tar archive.</p>
<p>Outputting the results to the console or archive file
The <code>tar</code> command can output the results to the console or an archive file. To specify the output file, we can add the <code>-f</code> option followed by the output file name.</p>
<p>Here’s an updated implementation of the <code>tar</code> command in TypeScript that includes the option to output to an archive file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">path</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'path'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tar</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'tar'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">zlib</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'zlib'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tarFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">outputFile</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">files</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[], </span><span style="color: #E06C75; font-style: italic">compression</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'gzip'</span><span style="color: #ABB2BF"> | </span><span style="color: #98C379">'brotli'</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarStream</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">compression</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tar</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">create</span><span style="color: #ABB2BF">({ </span><span style="color: #E06C75">gzip</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">compression</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'gzip'</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">brotli</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">compression</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'brotli'</span><span style="color: #ABB2BF"> }) </span><span style="color: #C678DD">:</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tar</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">create</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forEach</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">file</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">statSync</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isFile</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarStream</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">stat</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isDirectory</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarStream</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">, { </span><span style="color: #E06C75">recursive</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">outputFile</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">output</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createWriteStream</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">outputFile</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">compressStream</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">compression</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">compression</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'gzip'</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">zlib</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createGzip</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">zlib</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createBrotliCompress</span><span style="color: #ABB2BF">()) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">undefined</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">compressStream</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarStream</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">compressStream</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">output</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarStream</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">output</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">output</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">on</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'close'</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Successfully created </span><span style="color: #C678DD">${</span><span style="color: #E06C75">compression</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">compression</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">' compressed '</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">''</span><span style="color: #C678DD">}</span><span style="color: #98C379">tar archive </span><span style="color: #C678DD">${</span><span style="color: #E06C75">outputFile</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">tarStream</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">stdout</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">outputFile</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'-f'</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">argv</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">undefined</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">files</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">argv</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">outputFile</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">tarFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">outputFile</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'gzip'</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// Example: create gzip compressed tar archive</span></span>
<span class="line"><span style="color: #61AFEF">tarFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">outputFile</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">'brotli'</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// Example: create brotli compressed tar archive</span></span>
<span class="line"><span style="color: #61AFEF">tarFiles</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">outputFile</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">files</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// Example: output to console</span></span></code></pre>
<p>This implementation takes the output file name from the command-line arguments if the <code>-f</code> option is specified. Otherwise, it outputs to the console.</p>
<p>The <code>tar.create()</code> method creates a tar stream that can be used to add files and directories to the archive. We loop through the list of files and add each file to the tar stream using the <code>tarStream.add()</code> method. If a directory is encountered, we use the <code>recursive</code> option to add the directory and all its contents to the archive.</p>
<p>If an output file is specified, we create a write stream and use the <code>pipe()</code> method to pipe the tar stream to the output stream. If the <code>compression</code> option is specified, we create a compression stream using the <code>zlib</code> module and pipe the tar stream to the compression stream before piping it to the output stream.</p>
<p>Finally, we listen for the <code>close</code> event on the output stream to print a success message if an output file is specified.</p>
<p>Testing the tar command
However, you can manually test the <code>tar</code> command by running it on your local system with various options and inputs to verify that it works as expected.</p>
<h1 id="chapter-12-building-a-chmod-command">Chapter 12: Building a Chmod Command</h1>
<p>Overview of the chmod command and its functionality
The <code>chmod</code> command is a utility that allows a user to modify the permissions of a file or directory. The permissions of a file or directory determine who can read, write, and execute the file or directory. There are three levels of permission: read (r), write (w), and execute (x). These permissions can be assigned to three categories of users: the owner of the file or directory, the group that the file or directory belongs to, and all other users (also known as “world”).</p>
<p>The <code>chmod</code> command accepts a permission string as an argument, which specifies the new permissions that should be assigned to the file or directory. The permission string consists of three digits, with each digit representing the permission level for one of the three categories of users. The digits are calculated by adding up the following values:</p>
<ul>
<li>4 for read permission</li>
<li>2 for write permission</li>
<li>1 for execute permission</li>
</ul>
<p>For example, a permission string of “755” would give the owner of the file or directory read, write, and execute permission, and give the group and all other users only read and execute permission.</p>
<p>The <code>chmod</code> command can also be used with the symbolic notation, which allows users to modify permissions based on the existing permissions of the file or directory. The symbolic notation consists of one or more of the following operators:</p>
<ul>
<li>”+” adds a permission</li>
<li>”-” removes a permission</li>
<li>”=” sets the permission to the specified value</li>
</ul>
<p>The symbolic notation also uses the letters “u” for the owner, “g” for the group, “o” for all other users, and “a” for all users. For example, the command “chmod u+x file.txt” would add execute permission for the owner of the file “file.txt”.</p>
<p>Designing the Typescript implementation of the chmod command
The <code>chmod</code> command is used to modify the permissions of files or directories. In Linux and Unix-like systems, files and directories have three types of permissions: read, write, and execute. These permissions can be set for three types of users: the owner of the file or directory, users who belong to the same group as the owner, and all other users.</p>
<p>The <code>chmod</code> command takes a mode string as an argument, which specifies the permissions to be set. The mode string consists of a combination of numbers and letters that represent the permissions. The first character of the mode string specifies the type of the file: ”-” for a regular file, “d” for a directory, “l” for a symbolic link, and so on. The next three characters represent the permissions for the owner, the next three for the group, and the last three for all other users.</p>
<p>The numbers 4, 2, and 1 represent read, write, and execute permissions, respectively. These numbers are added together to represent different combinations of permissions. For example, the number 7 represents read, write, and execute permissions (4 + 2 + 1), the number 6 represents read and write permissions (4 + 2), and the number 5 represents read and execute permissions (4 + 1).</p>
<p>Design:</p>
<p>For the Typescript implementation of the <code>chmod</code> command, we will need to read and process the input file or directory, parse the mode string, and apply the permissions to the file or directory. We will use the <code>fs</code> module to modify the permissions of the file or directory.</p>
<p>The command syntax will be:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">chmod</span><span style="color: #ABB2BF"> [</span><span style="color: #E06C75">mode</span><span style="color: #ABB2BF">] [</span><span style="color: #E06C75">file</span><span style="color: #56B6C2">/</span><span style="color: #E06C75">directory</span><span style="color: #ABB2BF">]</span></span></code></pre>
<p>Where <code>mode</code> is the mode string representing the new permissions, and <code>file/directory</code> is the file or directory whose permissions will be changed.</p>
<p>The implementation steps will be:</p>
<ol>
<li>Parse the mode string to extract the file type and the permissions for the owner, group, and other users.</li>
<li>Use the <code>fs.stat</code> method to get the current permissions of the file or directory.</li>
<li>Use the <code>fs.chmod</code> method to set the new permissions of the file or directory.</li>
</ol>
<p>We will also need to handle errors, such as invalid input parameters or insufficient permissions to modify the file or directory.</p>
<p>Reading and processing the input file or directory and permission settings
The <code>chmod</code> command requires two main pieces of input - the path to the file or directory whose permissions are to be changed, and the desired permission settings.</p>
<p>The path to the file or directory can be provided as a command-line argument or read from user input during runtime.</p>
<p>The permission settings can be provided in two ways:</p>
<ol>
<li>As a symbolic mode, which uses a combination of letters (<code>u</code>, <code>g</code>, <code>o</code>, <code>a</code>) and operators (<code>+</code>, <code>-</code>, <code>=</code>) to specify the desired permission settings. For example, <code>u+rwx</code> specifies that the user should be granted read, write, and execute permissions.</li>
<li>As an octal mode, which uses a three-digit number to represent the permission settings for the owner, group, and others, respectively. Each digit is the sum of the permissions for the corresponding category (read = 4, write = 2, execute = 1). For example, <code>755</code> specifies that the owner should have read, write, and execute permissions, while the group and others should have only read and execute permissions.</li>
</ol>
<p>The input permission settings can also be modified by using the <code>+</code> and <code>-</code> operators to add or remove individual permissions, respectively.</p>
<p>The Typescript implementation of the <code>chmod</code> command will need to take both of these input parameters into account, as well as validate the input to ensure that the file or directory exists and that the permission settings are valid.</p>
<p>Implementing the chmod functionality
The <code>chmod</code> command is used to change the permissions of a file or directory. The permissions can be specified in either the symbolic or octal notation. Here’s a possible implementation in TypeScript:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">promises</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"fs"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ChmodOptions</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">recursive</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">chmod</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">path</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">mode</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">options</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">ChmodOptions</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">recursive</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF"> }): </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">stat</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">options</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">recursive</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x26;&#x26;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">stats</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">isDirectory</span><span style="color: #ABB2BF">()) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">entries</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readdir</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">all</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">entries</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">entry</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">chmod</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`</span><span style="color: #C678DD">${</span><span style="color: #E06C75">path</span><span style="color: #C678DD">}</span><span style="color: #98C379">/</span><span style="color: #C678DD">${</span><span style="color: #E06C75">entry</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">mode</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">)));</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">chmod</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">mode</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this implementation, we use the <code>fs</code> module to read the current permissions of the file or directory using the <code>stat</code> function, and to modify the permissions using the <code>chmod</code> function.</p>
<p>The <code>mode</code> parameter can be specified in either the symbolic or octal notation. In the symbolic notation, the <code>mode</code> string consists of one or more clauses, separated by commas. Each clause consists of a scope specifier (either <code>u</code> for the user, <code>g</code> for the group, <code>o</code> for others, or <code>a</code> for all), a permission operator (<code>+</code> to add a permission, <code>-</code> to remove a permission, or <code>=</code> to set the permissions explicitly), and a permission specifier (<code>r</code> for read, <code>w</code> for write, or <code>x</code> for execute). For example, the clause <code>u+x</code> adds execute permission for the user.</p>
<p>In the octal notation, the <code>mode</code> string consists of a three-digit number, where each digit represents the permissions for the user, group, and others, respectively. The digits are calculated by summing the permissions: 4 for read, 2 for write, and 1 for execute. For example, the mode <code>755</code> corresponds to <code>rwxr-xr-x</code>.</p>
<p>The <code>options.recursive</code> parameter specifies whether to apply the permission changes recursively to all subdirectories and files. If <code>options.recursive</code> is <code>true</code> and the path is a directory, we use the <code>readdir</code> function to get a list of entries in the directory, and apply the <code>chmod</code> function recursively to each entry.</p>
<p>To use the <code>chmod</code> function, we can call it with the path to the file or directory, the desired mode string, and an optional <code>ChmodOptions</code> object. For example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">chmod</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"/path/to/file"</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">"644"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">chmod</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"/path/to/directory"</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">"755"</span><span style="color: #ABB2BF">, { </span><span style="color: #E06C75">recursive</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> });</span></span></code></pre>
<p>This changes the permissions of the file to <code>rw-r--r--</code> and the permissions of the directory and its contents to <code>rwxr-xr-x</code>.</p>
<p>Outputting the results to the console
The <code>chmod</code> command typically does not produce any output, unless there was an error with the command execution. In that case, an error message will be displayed on the console. However, we can also display the modified file permissions after executing the <code>chmod</code> command, if the user specifies a command-line option to do so.</p>
<p>For example, we could add an option <code>-v</code> to the command to enable verbose output. When this option is specified, the new file permissions will be displayed for each file that was modified.</p>
<p>Alternatively, we could also add an option <code>-q</code> to suppress all output, including error messages, and only display output in case of successful execution. This can be useful in situations where the user wants to perform a silent <code>chmod</code> operation on a large number of files, without being prompted for confirmation or receiving any output.</p>
<p>Overall, the choice of output behavior for the <code>chmod</code> command depends on the user’s needs and preferences.</p>
<p>Testing the chmod command
However, I can suggest some scenarios that can be tested to ensure the correct behavior of the <code>chmod</code> command:</p>
<ul>
<li>Test changing the permissions of a file from read-only to writeable</li>
<li>Test changing the permissions of a file from writeable to read-only</li>
<li>Test changing the permissions of a file to be executable</li>
<li>Test changing the permissions of a file to be non-executable</li>
<li>Test changing the permissions of a directory to allow read, write, and execute for owner and group</li>
<li>Test changing the permissions of a directory to allow only read and execute for owner and group</li>
<li>Test changing the permissions of a directory to allow only write and execute for owner and group</li>
<li>Test changing the permissions of a file or directory using both symbolic and absolute modes.</li>
</ul>
<h1 id="chapter-13-building-a-wget-command">Chapter 13: Building a Wget Command</h1>
<p>Overview of the wget command and its functionality
The <code>wget</code> command is used to download files from the internet. It supports HTTP, HTTPS, and FTP protocols, and can be used to download files recursively. It also supports resuming downloads and can be used to download files in the background. The <code>wget</code> command is commonly used in shell scripts for automated downloading of files.</p>
<p>Designing the Typescript implementation of the wget command
The <code>wget</code> command is used to download files from the internet. Given a URL, <code>wget</code> retrieves the file and saves it to the current working directory or a specified output directory.</p>
<p>Here’s the design of the Typescript implementation of the <code>wget</code> command:</p>
<ol>
<li>Parse the input arguments to extract the URL and output directory, if specified.</li>
<li>Use the <code>http</code> or <code>https</code> module to send a GET request to the URL.</li>
<li>Pipe the response stream to a write stream to save the file to the output directory, or to the current working directory if no output directory is specified.</li>
<li>Handle errors appropriately, such as when the URL is invalid or the file cannot be saved to the output directory.</li>
</ol>
<p>Here’s an example usage of the <code>wget</code> command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">wget</span><span style="color: #ABB2BF"> https:</span><span style="color: #7F848E; font-style: italic">//example.com/file.txt -o /path/to/output/directory</span></span></code></pre>
<p>This would download the file <code>file.txt</code> from <code>https://example.com</code> and save it to the directory <code>/path/to/output/directory</code>. If no output directory is specified, the file would be saved to the current working directory.</p>
<p>Reading and processing the input URL and download options
To implement the <code>wget</code> command in TypeScript, we need to read and process the input URL and download options.</p>
<p>We can take the following steps:</p>
<ol>
<li>Read the input URL and download options from the command-line arguments passed to the program.</li>
<li>Parse the download options to determine the download location, filename, and whether to overwrite existing files.</li>
<li>Use the <code>http</code> or <code>https</code> module in Node.js to send a GET request to the URL.</li>
<li>Stream the response to a writable file stream, creating the file if it doesn’t exist or overwriting it if the <code>overwrite</code> option is set to <code>true</code>.</li>
<li>Handle any errors that may occur during the download process, such as network errors or file system errors.</li>
</ol>
<p>Once we have implemented these steps, we will have a functioning <code>wget</code> command that can download files from the internet.</p>
<p>Implementing the wget functionality
To implement the <code>wget</code> command in TypeScript, we need to read and process the input URL and download options.</p>
<p>We can take the following steps:</p>
<ol>
<li>Read the input URL and download options from the command-line arguments passed to the program.</li>
<li>Parse the download options to determine the download location, filename, and whether to overwrite existing files.</li>
<li>Use the <code>http</code> or <code>https</code> module in Node.js to send a GET request to the URL.</li>
<li>Stream the response to a writable file stream, creating the file if it doesn’t exist or overwriting it if the <code>overwrite</code> option is set to <code>true</code>.</li>
<li>Handle any errors that may occur during the download process, such as network errors or file system errors.</li>
</ol>
<p>Once we have implemented these steps, we will have a functioning <code>wget</code> command that can download files from the internet.</p>
<p>Here’s a TypeScript implementation of the wget command that downloads a file from a given URL and saves it to the specified file path:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">https</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'https'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fs</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'fs'</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">DownloadOptions</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">outputPath</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">showProgress</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">downloadFile</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">url</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">options</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">DownloadOptions</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">resolve</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">reject</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> { </span><span style="color: #E5C07B">outputPath</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">showProgress</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF"> } </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createWriteStream</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">outputPath</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">https</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">response</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">totalBytes</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">parseInt</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">headers</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">'content-length'</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'0'</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">downloadedBytes</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">on</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'data'</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">chunk</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">downloadedBytes</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">chunk</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">showProgress</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">progress</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Math</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">floor</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75">downloadedBytes</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">totalBytes</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">100</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #E5C07B">process</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">stdout</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Downloading... </span><span style="color: #C678DD">${</span><span style="color: #E06C75">progress</span><span style="color: #C678DD">}</span><span style="color: #98C379">%</span><span style="color: #56B6C2">\r</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">on</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'end'</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">end</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pipe</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }).</span><span style="color: #61AFEF">on</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'error'</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">error</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">unlink</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">outputPath</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> {});</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #61AFEF">reject</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">  });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Example usage</span></span>
<span class="line"><span style="color: #61AFEF">downloadFile</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'https://example.com/image.jpg'</span><span style="color: #ABB2BF">, { </span><span style="color: #E06C75">outputPath</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">'./image.jpg'</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">showProgress</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> })</span></span>
<span class="line"><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">then</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">'Download complete!'</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">catch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">error</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=></span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Error downloading file: </span><span style="color: #C678DD">${</span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">message</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">));</span></span></code></pre>
<p>This implementation uses the built-in https module to download the file from the given URL and the fs module to save it to the specified file path. The downloadFile function takes two arguments: the URL to download from and an options object that includes the output file path and an optional showProgress flag that displays the download progress in the console if set to true.</p>
<p>The function returns a Promise that resolves when the download is complete and rejects if there is an error during the download process.</p>
<h1 id="conclusion">Conclusion</h1>
<p>There are many resources available for building command line applications in Typescript. Here are a few:</p>
<p>The official Typescript documentation has a section on building command line applications: <a href="https://www.typescriptlang.org/docs/handbook/integrating-with-build-tools.html#command-line-applications">https://www.typescriptlang.org/docs/handbook/integrating-with-build-tools.html#command-line-applications</a></p>
<p>The Commander.js library is a popular framework for building command line applications in Node.js, and has excellent Typescript support: <a href="https://github.com/tj/commander.js#typescript">https://github.com/tj/commander.js#typescript</a></p>
<p>The Yargs library is another popular option for building command line applications in Node.js, and also has Typescript support: <a href="https://github.com/yargs/yargs#typescript">https://github.com/yargs/yargs#typescript</a></p>
<p>The Inquirer.js library provides a powerful set of tools for creating interactive command line interfaces, and has Typescript support: <a href="https://github.com/SBoudrias/Inquirer.js#typescript">https://github.com/SBoudrias/Inquirer.js#typescript</a></p>
<p>The Oclif framework provides a batteries-included toolkit for building CLI applications with TypeScript, including features like command generators and automatic help text generation: <a href="https://oclif.io/docs/introduction">https://oclif.io/docs/introduction</a></p>
<p>These are just a few examples of the many resources available for building command line applications in Typescript. With its strong typing and rich tooling ecosystem, Typescript is a great choice for building robust and maintainable CLI applications.</p>
<p>Throughout this book, we have covered various aspects of building command-line applications using TypeScript. We started by discussing the benefits of using TypeScript for building command-line applications and set up a basic TypeScript project. We then went on to cover the most essential concepts such as parsing command-line arguments, handling file input and output, and interacting with the file system.</p>
<p>We then discussed the most commonly used command-line tools such as ls, df, rm, touch, locate, find, grep, tar, chmod, and wget and provided detailed information about their functionalities and how to implement them in TypeScript.</p>
<p>Finally, we provided additional resources for further learning and building more advanced command-line applications in TypeScript. With the knowledge gained from this book, readers should be able to build efficient and robust command-line applications in TypeScript that can handle complex tasks with ease.</p>
            </article>
          </div>
          <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var c;{let d={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,r)=>{if(t===""||!Array.isArray(r))return r;let[e,n]=r;return e in d?d[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(c=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{var l;if(!this.hydrator||!this.isConnected||(l=this.parentElement)!=null&&l.closest("astro-island[ssr]"))return;let r=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(let s of n){let i=s.closest(this.tagName);!i||!i.isSameNode(this)||(e[s.getAttribute("data-astro-template")||"default"]=s.innerHTML,s.remove())}for(let s of r){let i=s.closest(this.tagName);!i||!i.isSameNode(this)||(e[s.getAttribute("name")||"default"]=s.innerHTML)}let a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((r,e)=>{e.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let r=this.getAttribute("before-hydration-url");r&&await import(r),this.start()}start(){let r=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{let n=this.getAttribute("renderer-url"),[a,{default:l}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),s=this.getAttribute("component-export")||"default";if(!s.includes("."))this.Component=a[s];else{this.Component=a;for(let i of s.split("."))this.Component=this.Component[i]}return this.hydrator=l,this.hydrate},r,this)}attributeChangedCallback(){this.hydrate()}},c.observedAttributes=["props"],c))}})();</script><astro-island uid="ZbKvuO" prefix="r0" component-url="/_astro/Disqus.101366bd.js" component-export="default" renderer-url="/_astro/client.663bf61e.js" props="{}" ssr="" client="load" opts="{&quot;name&quot;:&quot;Disqus&quot;,&quot;value&quot;:true}" await-children=""><div class="row mt-16 justify-center "><div id="disqus_thread"></div></div></astro-island>
        </div>
      </div>
    </div>
  </section>

    </main>
    <footer class="footer bg-[#F1F1F1]">
  <div class="container">
    <div class="gx-5 row pb-10 pt-[52px]">
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <a href="/" class="navbar-brand block">
  <img alt="Pinwheel Astro" style="height:31px;width:147px" width="294" height="62" src="/_astro/logo_ZThIBR.png" loading="lazy" decoding="async">
</a>
        <p class="mt-6">
          Trying to make the world a better place.
        </p>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Socials</h6>

        <ul class="social-icons mt-4 lg:mt-6">
  <li class="inline-block">
        <a aria-label="facebook" href="https://facebook.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M480 257.35c0-123.7-100.3-224-224-224s-224 100.3-224 224c0 111.8 81.9 204.47 189 221.29V322.12h-56.89v-64.77H221V208c0-56.13 33.45-87.16 84.61-87.16 24.51 0 50.15 4.38 50.15 4.38v55.13H327.5c-27.81 0-36.51 17.26-36.51 35v42h62.12l-9.92 64.77H291v156.54c107.1-16.81 189-109.48 189-221.31z"></path></svg>
        </a>
      </li>
  <li class="inline-block">
        <a aria-label="twitter" href="https://twitter.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M496 109.5a201.8 201.8 0 01-56.55 15.3 97.51 97.51 0 0043.33-53.6 197.74 197.74 0 01-62.56 23.5A99.14 99.14 0 00348.31 64c-54.42 0-98.46 43.4-98.46 96.9a93.21 93.21 0 002.54 22.1 280.7 280.7 0 01-203-101.3A95.69 95.69 0 0036 130.4c0 33.6 17.53 63.3 44 80.7A97.5 97.5 0 0135.22 199v1.2c0 47 34 86.1 79 95a100.76 100.76 0 01-25.94 3.4 94.38 94.38 0 01-18.51-1.8c12.51 38.5 48.92 66.5 92.05 67.3A199.59 199.59 0 0139.5 405.6a203 203 0 01-23.5-1.4A278.68 278.68 0 00166.74 448c181.36 0 280.44-147.7 280.44-275.8 0-4.2-.11-8.4-.31-12.5A198.48 198.48 0 00496 109.5z"></path></svg>
        </a>
      </li>
  
  
  
  <li class="inline-block">
        <a aria-label="linkedin" href="https://linkedin.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M444.17 32H70.28C49.85 32 32 46.7 32 66.89v374.72C32 461.91 49.85 480 70.28 480h373.78c20.54 0 35.94-18.21 35.94-38.39V66.89C480.12 46.7 464.6 32 444.17 32zm-273.3 373.43h-64.18V205.88h64.18zM141 175.54h-.46c-20.54 0-33.84-15.29-33.84-34.43 0-19.49 13.65-34.42 34.65-34.42s33.85 14.82 34.31 34.42c-.01 19.14-13.31 34.43-34.66 34.43zm264.43 229.89h-64.18V296.32c0-26.14-9.34-44-32.56-44-17.74 0-28.24 12-32.91 23.69-1.75 4.2-2.22 9.92-2.22 15.76v113.66h-64.18V205.88h64.18v27.77c9.34-13.3 23.93-32.44 57.88-32.44 42.13 0 74 27.77 74 87.64z"></path></svg>
        </a>
      </li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="inline-block">
        <a aria-label="skype" href="https://skype.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M467.16 303.6a205.69 205.69 0 004.9-45.15c0-116.32-95.69-210.7-213.79-210.7a221.83 221.83 0 00-36.52 3A123.58 123.58 0 00155.93 32C87.55 32 32 86.72 32 154.15A119.56 119.56 0 0049 216a211.16 211.16 0 00-4.32 42.35c0 116.44 95.69 210.7 213.67 210.7a214 214 0 0039.09-3.5A125.45 125.45 0 00356.07 480C424.57 480 480 425.28 480 357.85a118 118 0 00-12.84-54.25zM368 359c-9.92 13.76-24.51 24.73-43.41 32.43S283.36 403 257.69 403c-30.69 0-56.36-5.37-76.55-15.87a101 101 0 01-35.24-30.8c-9.11-12.83-13.66-25.66-13.66-38 0-7.7 3-14.35 8.87-19.95 5.84-5.37 13.42-8.17 22.29-8.17 7.35 0 13.65 2.1 18.79 6.42 4.9 4.08 9.1 10.15 12.48 18.08A108.09 108.09 0 00207 336.15q6.32 8.22 17.86 13.65c7.82 3.62 18.2 5.48 31 5.48 17.62 0 32.09-3.73 42.94-11.08 10.74-7.12 15.88-15.75 15.88-26.25 0-8.28-2.69-14.82-8.29-19.95-5.83-5.37-13.42-9.57-22.87-12.37-9.69-3-22.87-6.18-39.21-9.56-22.17-4.67-41-10.27-56-16.57-15.28-6.42-27.65-15.4-36.76-26.48-9.22-11.32-13.77-25.55-13.77-42.24a67.86 67.86 0 0114.47-42.58c9.57-12.25 23.46-21.82 41.55-28.35 17.74-6.53 38.86-9.8 62.66-9.8 19.14 0 35.83 2.22 49.83 6.42s25.91 10.15 35.36 17.38 16.34 14.93 20.77 23 6.66 16.22 6.66 24c0 7.46-2.92 14.35-8.76 20.3a29.65 29.65 0 01-21.94 9.1c-7.93 0-14.12-1.87-18.43-5.6-4-3.5-8.17-8.87-12.72-16.69-5.37-9.91-11.79-17.85-19.14-23.45-7.24-5.36-19.14-8.16-35.71-8.16-15.29 0-27.77 3-37 9-8.87 5.72-13.19 12.37-13.19 20.18a18.26 18.26 0 004.32 12.25 38.13 38.13 0 0012.72 9.57 90.14 90.14 0 0017.15 6.53c6 1.64 15.87 4.09 29.53 7.12 17.38 3.62 33.25 7.82 47.26 12.13 14.24 4.55 26.49 10 36.52 16.45a72.93 72.93 0 0124.16 25.09c5.72 10 8.64 22.63 8.64 37.1A75.09 75.09 0 01368 359z"></path></svg>
        </a>
      </li>
  
  
  
  
  
</ul>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Quick Links</h6>
        <ul>
          <li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/about">
                  About
                </a>
              </li><li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/contact">
                  Contact
                </a>
              </li><li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/elements">
                  Elements
                </a>
              </li><li class="mb-0">
                <a class="hover:text-primary hover:underline " href="/changelog">
                  Changelog
                </a>
              </li>
        </ul>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Location & Contact</h6>
        <ul>
          <li class="mb-2">Somewhere in Canada</li>
          <li class="mb-2">
            <a class="mb-2 hover:text-primary" href="mailto:colourfulmerchtik@gmail.com">colourfulmerchtik@gmail.com</a>
          </li>
          <li>
            <a class="hover:text-primary hover:underline" href="tel:+704-555-0127">+704-555-0127</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container max-w-[1440px]">
    <div class="footer-copyright mx-auto border-t border-border pb-10 pt-7 text-center">
      <p class="content text-text">Copyright © 2023</p>
    </div>
  </div>
</footer>
  </body></html>