<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- favicon -->
    <link rel="shortcut icon" href="/images/favicon.png">
    <!-- theme meta -->
    <meta name="theme-name" content="pinwheel-astro">
    <meta name="msapplication-TileColor" content="#000000">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479144310234386" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6">

  </script>
  
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
    <meta name="generator" content="Astro v2.6.6">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- google font css -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&#38;family=Merriweather:wght@700;900&#38;display=swap" rel="stylesheet">

    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
		<script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>

    <!-- responsive meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">

    <!-- title -->
    <title>
      Introduction to Rust: A Safe and Performant Language for the Modern Era
    </title>

    <!-- canonical url -->
    

    <!-- noindex robots -->
    

    <!-- meta-description -->
    <meta name="description" content="Introduction to Rust: A Safe and Performant Language for the Modern Era">

    <!-- author from config.json -->
    <meta name="author" content="FriendlyUser">

    <!-- og-title -->
    <meta property="og:title" content="Introduction to Rust: A Safe and Performant Language for the Modern Era">

    <!-- og-description -->
    <meta property="og:description" content="Introduction to Rust: A Safe and Performant Language for the Modern Era">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pinwheel-astro.vercel.app/books/rust/">

    <!-- twitter-title -->
    <meta name="twitter:title" content="Introduction to Rust: A Safe and Performant Language for the Modern Era">

    <!-- twitter-description -->
    <meta name="twitter:description" content="Introduction to Rust: A Safe and Performant Language for the Modern Era">

    <!-- og-image -->
    <meta property="og:image" content="https://pinwheel-astro.vercel.app/images/og-image.png">

    <!-- twitter-image -->
    <meta name="twitter:image" content="https://pinwheel-astro.vercel.app/images/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
  <link rel="stylesheet" href="/_astro/_single_.db0af2d4.css" />
<link rel="stylesheet" href="/_astro/404.99013387.css" /><script type="module" src="/_astro/hoisted.4256c07d.js"></script></head>
  <body>
    
    <header class="header">
  <nav class="navbar container">
    <!-- logo -->
    <div class="order-0">
      <a href="/" class="navbar-brand block">
  <img alt="Pinwheel Astro" style="height:31px;width:147px" width="294" height="62" src="/_astro/logo_ZThIBR.png" loading="lazy" decoding="async">
</a>
    </div>
    <!-- navbar toggler -->
    <input id="nav-toggle" type="checkbox" class="hidden">
    <label id="show-button" for="nav-toggle" class="order-2 flex cursor-pointer items-center lg:order-1 lg:hidden">
      <svg class="h-6 fill-current" viewBox="0 0 20 20">
        <title>Menu Open</title>
        <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path>
      </svg>
    </label>
    <label id="hide-button" for="nav-toggle" class="order-2 hidden cursor-pointer items-center lg:order-1">
      <svg class="h-6 fill-current" viewBox="0 0 20 20">
        <title>Menu Close</title>
        <polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"></polygon>
      </svg>
    </label>
    <!-- /navbar toggler -->

    <ul id="nav-menu" class="navbar-nav order-3 hidden w-full lg:order-1 lg:flex lg:w-auto lg:space-x-2">
      <li class="nav-item">
                <a href="/" class="nav-link inline-block lg:block false">
                  Home
                </a>
              </li><li class="nav-item">
                <a href="/books" class="nav-link inline-block lg:block false">
                  Books
                </a>
              </li><li class="nav-item">
                <a href="/contact" class="nav-link inline-block lg:block false">
                  Contact
                </a>
              </li>
      <li class="nav-item mt-2 lg:hidden">
        <a class="btn btn-white btn-sm border-border" href="/books">
          View Books</a>
      </li>
    </ul>
    <div class="order-1 ml-auto hidden items-center md:order-2 md:ml-0 lg:flex">
      <a class="btn btn-white btn-sm" href="/signin"> View Books</a>
    </div>
  </nav>
</header>
<script>
  const button = document.getElementById("dropdown-button");
  button.addEventListener("click", () => {
    const dropdown = document.getElementById("dropdown");
    dropdown.classList.toggle(dropdown.style === "hidden" ? "block" : "hidden");
  });

  //sticky header
  const header = document.querySelector(".header");
  window.addEventListener("scroll", () => {
    const scrollY = window.scrollY;
    if (scrollY > 0) {
      header.classList.add("header-sticky");
    } else {
      header.classList.remove("header-sticky");
    }
  });
</script>
    <main id="main-content">
      
  <section class="section blog-single">
    <div class="container">
      <div class="row justify-center">
        <div class="lg:col-10">
          <img class="w-full rounded-xl" alt="" width="920" height="450" src="/_astro/2979557006_tLU29.png" loading="lazy" decoding="async">
        </div>
        <div class="mt-10 max-w-[810px] lg:col-9">
          <h1 class="h2">
            Introduction to Rust: A Safe and Performant Language for the Modern Era
          </h1>
          <div class="mb-5 mt-6 flex items-center space-x-2">
            <ul class="mb-4">
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 104c-53 0-96 43-96 96s43 96 96 96 96-43 96-96-43-96-96-96zm0 144c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm0-240C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-49.7 0-95.1-18.3-130.1-48.4 14.9-23 40.4-38.6 69.6-39.5 20.8 6.4 40.6 9.6 60.5 9.6s39.7-3.1 60.5-9.6c29.2 1 54.7 16.5 69.6 39.5-35 30.1-80.4 48.4-130.1 48.4zm162.7-84.1c-24.4-31.4-62.1-51.9-105.1-51.9-10.2 0-26 9.6-57.6 9.6-31.5 0-47.4-9.6-57.6-9.6-42.9 0-80.6 20.5-105.1 51.9C61.9 339.2 48 299.2 48 256c0-110.3 89.7-200 200-200s200 89.7 200 200c0 43.2-13.9 83.2-37.3 115.9z"></path></svg>
                
              </li>

              <!-- <li class="mr-4 inline-block">
                <FaRegCalendarAlt className={"mr-2 -mt-1 inline-block"} />
                {dateFormat(post.data?.pubDate)}
              </li> -->
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg>
                70 Mins read
              </li>
              <li class="mr-4 inline-block">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="mr-2 -mt-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"></path></svg>
                
              </li>
            </ul>
          </div>

          <div class="content">
            <div id="search" class="ml-3 p-4 -mt-8"></div>
            <article id="article">
              <h1 id="chapter-1-introduction-to-rust">Chapter 1: Introduction to Rust</h1>
<p>What is Rust and why use it?
Rust is a systems programming language that runs blazingly fast, prevents segfaults, and guarantees thread safety. It was designed with a focus on safety, performance, and concurrency. Rust provides memory safety guarantees, which means that it’s harder to write code that causes memory-related errors such as buffer overflows, null pointer dereferences, and use-after-free errors.</p>
<p>Rust’s ownership model and borrow checker allow for efficient memory management without the need for a garbage collector. This leads to better performance and predictable memory usage, making Rust an ideal language for building high-performance systems.</p>
<p>In addition to its performance benefits, Rust’s focus on safety and thread safety make it a good fit for building reliable and secure systems. Rust’s strong typing system and functional features also make it a good choice for building scalable and maintainable codebases.</p>
<p>Overall, Rust provides a unique combination of safety, performance, and concurrency that makes it a compelling choice for building modern systems.</p>
<p>Rust’s history
Rust was created by Graydon Hoare at Mozilla Research in 2006. Hoare wanted to create a language that was fast, efficient, and safe, but still allowed for low-level control. After a few years of development, the first version of Rust was released in 2010 as an open-source project.</p>
<p>Over the next few years, Rust gained a following in the systems programming community for its unique features and focus on safety and performance. In 2014, Rust hit a major milestone with the release of version 1.0, which marked the language as stable and ready for production use.</p>
<p>Since then, Rust has continued to grow in popularity, with many developers and organizations adopting it for building high-performance, reliable systems. In addition to Mozilla, companies such as Microsoft, Amazon, and Google have all contributed to the development of Rust and use it in their own projects.</p>
<p>Today, Rust is a mature language with a vibrant community and ecosystem of tools and libraries. It continues to evolve and improve with each release, making it an exciting language to watch and use.</p>
<p>Rust’s features
Rust has a number of unique features that set it apart from other programming languages. Some of its key features include:</p>
<ol>
<li>Memory safety: Rust’s ownership model and borrow checker ensure that programs are memory safe, preventing bugs such as null pointers, buffer overflows, and use-after-free errors.</li>
<li>Performance: Rust is designed to be fast and efficient, with a focus on low-level control and optimization. It provides access to low-level system resources, such as memory and threads, without sacrificing safety.</li>
<li>Concurrency: Rust’s ownership model and borrow checker also make it easy to write safe concurrent code. Rust provides a number of abstractions for concurrency, such as channels and locks, as well as support for async/await syntax for asynchronous programming.</li>
<li>Strong typing: Rust’s type system ensures that programs are well-typed and free from type-related bugs, such as type coercion and null references.</li>
<li>Functional features: Rust provides a number of functional programming features, such as closures, iterators, and pattern matching, that make it easy to write concise and expressive code.</li>
<li>Interoperability: Rust has strong interoperability with other languages, allowing developers to use Rust code in other languages or call code written in other languages from Rust.</li>
</ol>
<p>Overall, Rust’s combination of safety, performance, concurrency, strong typing, functional features, and interoperability make it a powerful and unique language for building modern systems.</p>
<p>Rust’s syntax
Rust’s syntax is similar to that of C++ or Java, but with some unique features and syntax choices. Here are some of the key syntax elements in Rust:</p>
<ol>
<li>Variables: In Rust, variables are declared using the <code>let</code> keyword, followed by the variable name and an optional type annotation. For example: <code>let x: i32 = 5;</code>.</li>
<li>Functions: Rust functions are declared using the <code>fn</code> keyword, followed by the function name, arguments, and return type (if any). For example: <code>fn add(x: i32, y: i32) -> i32 { return x + y; }</code>.</li>
<li>Control flow: Rust has standard control flow statements like <code>if</code>, <code>else</code>, <code>while</code>, <code>for</code>, and <code>match</code>. For example:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"x is 5"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"x is not 5"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="4">
<li>Ownership and borrowing: Rust’s unique ownership model and borrow checker allow for efficient memory management and prevent common memory-related errors. In Rust, variables can have ownership of memory, and borrowing is used to allow multiple variables to access the same memory safely.</li>
<li>Structs and enums: Rust provides structs and enums for defining custom data types. Structs can be used to define groups of related fields, while enums can be used to define a set of possible values.</li>
<li>Traits: Rust’s trait system allows for defining interfaces that can be implemented by multiple types. This provides a powerful form of abstraction and allows for generic programming.</li>
<li>Modules: Rust’s module system allows for organizing code into logical units, with each module having its own namespace and visibility rules.</li>
</ol>
<p>Overall, Rust’s syntax is designed to be expressive and easy to read, while still providing the unique features and safety guarantees that make it a powerful language for systems programming.</p>
<p>Exercises
Sure, here are some exercises to help practice Rust syntax:</p>
<ol>
<li>Write a Rust program that takes two integers as input from the user and prints their sum.</li>
<li>Write a Rust program that prints out the first 10 numbers in the Fibonacci sequence.</li>
<li>Write a Rust function that takes a vector of integers and returns the sum of all the even numbers in the vector.</li>
<li>Write a Rust program that reads a file and counts the number of lines in the file.</li>
<li>Write a Rust program that defines a struct representing a 2D point with x and y coordinates, and a function that takes two points as input and calculates the Euclidean distance between them.</li>
</ol>
<p>I hope these exercises help you practice Rust syntax and build your skills in the language!</p>
<p>Solutions to exercises
Sure, here are some possible solutions to the exercises:</p>
<ol>
<li>Rust program that takes two integers as input from the user and prints their sum:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::io;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Enter two numbers:"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">stdin</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">read_line</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input1</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to read input."</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">stdin</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">read_line</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input2</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to read input."</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">num1</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input1</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">trim</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">parse</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Invalid input."</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">num2</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input2</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">trim</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">parse</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Invalid input."</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">num1</span><span style="color: #ABB2BF"> + </span><span style="color: #E06C75">num2</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"The sum is {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="2">
<li>Rust program that prints out the first 10 numbers in the Fibonacci sequence:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">prev</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">curr</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_i</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">..</span><span style="color: #D19A66">10</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">print!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{} "</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">curr</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">next</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">prev</span><span style="color: #ABB2BF"> + </span><span style="color: #E06C75">curr</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">prev</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">curr</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">curr</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">next</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="3">
<li>Rust function that takes a vector of integers and returns the sum of all the even numbers in the vector:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sum_even_numbers</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">numbers</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">>) -> </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">num</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numbers</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">num</span><span style="color: #ABB2BF"> % </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numbers</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sum_even_numbers</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">numbers</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"The sum of even numbers is {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="4">
<li>Rust program that reads a file and counts the number of lines in the file:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">BufRead</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">BufReader</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"input.txt"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to open file."</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">BufReader</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_line</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lines</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"The file has {} lines."</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="5">
<li>Rust program that defines a struct representing a 2D point with x and y coordinates, and a function that takes two points as input and calculates the Euclidean distance between them:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Point2D</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">euclidean_distance</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">p1</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Point2D</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">p2</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Point2D</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x_diff</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">p1</span><span style="color: #ABB2BF">.x - </span><span style="color: #E06C75">p2</span><span style="color: #ABB2BF">.x;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">y_diff</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">p1</span><span style="color: #ABB2BF">.y - </span><span style="color: #E06C75">p2</span><span style="color: #ABB2BF">.y;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">sqrt</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x_diff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">powi</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) + </span><span style="color: #E06C75">y_diff</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">powi</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">p1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Point2D</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1.0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">2.0</span><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">p2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Point2D</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">3.0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">4.0</span><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">dist</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">euclidean_distance</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">p1</span><span style="color: #ABB2BF">, &#x26;</span><span style="color: #E06C75">p2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"The distance between the points is {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">dist</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>I hope these solutions help you understand Rust syntax and build your skills in the language!</p>
<h1 id="chapter-2-getting-started-with-rust">Chapter 2: Getting Started with Rust</h1>
<p>Installing Rust
Sure, here are the steps to install Rust:</p>
<ol>
<li>Go to the official Rust website: <a href="https://www.rust-lang.org/">https://www.rust-lang.org/</a></li>
<li>Click on the “Install” tab in the top navigation bar.</li>
<li>Choose the appropriate installation option for your operating system. Rust supports Windows, macOS, and Linux.</li>
<li>Follow the installation instructions for your chosen option. The instructions will guide you through the installation process, which typically involves downloading an installer or package and running it.</li>
<li>Once the installation is complete, open a terminal or command prompt and run the following command to verify that Rust is installed correctly:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">rustc</span><span style="color: #ABB2BF"> --</span><span style="color: #E06C75">version</span></span></code></pre>
<p>This should print out the version number of Rust that you just installed.</p>
<p>That’s it! You now have Rust installed on your machine and you’re ready to start programming in Rust.</p>
<p>Setting up the Rust environment
Once you have Rust installed, you may want to set up your Rust environment. Here are some steps you can take to do that:</p>
<ol>
<li>Choose a text editor or integrated development environment (IDE) to write your Rust code in. Some popular options for Rust include Visual Studio Code, Sublime Text, Atom, and IntelliJ Rust. You can download and install these tools from their respective websites.</li>
<li>Set up a package manager for Rust. Rust uses a package manager called Cargo, which is included with the Rust installation. You can use Cargo to create new Rust projects, manage dependencies, and build your code. To create a new Rust project with Cargo, open a terminal or command prompt and navigate to the directory where you want to create your project. Then run the following command:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">cargo</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">new</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">myproject</span></span></code></pre>
<p>This will create a new directory called <code>myproject</code> with a basic Rust project inside.
3. Install Rust extensions or plugins for your text editor or IDE. These extensions can provide additional syntax highlighting, code completion, and debugging capabilities for Rust. You can find Rust extensions for most popular text editors and IDEs in their respective extension or plugin marketplaces.
4. Install additional Rust tools and libraries as needed. Rust has a rich ecosystem of tools and libraries that can help you develop and deploy your Rust code. You can use Cargo to install these tools and libraries by adding them to your <code>Cargo.toml</code> file and running the <code>cargo build</code> command. For example, to install the popular <code>serde</code> library for serialization and deserialization in Rust, add the following line to your <code>Cargo.toml</code> file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">[</span><span style="color: #E06C75">dependencies</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #E06C75">serde</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"1.0"</span></span></code></pre>
<p>Then run <code>cargo build</code> to download and build the library.</p>
<p>By following these steps, you can set up a comfortable and productive Rust development environment on your machine.</p>
<p>Hello, World! in Rust
Sure, here’s how you can write and run a “Hello, World!” program in Rust:</p>
<ol>
<li>Open a text editor and create a new file called <code>main.rs</code>.</li>
<li>In the file, add the following code:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Hello, World!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code defines a Rust function called <code>main</code> that prints the string “Hello, World!” to the console using the <code>println!</code> macro.
3. Save the file.
4. Open a terminal or command prompt and navigate to the directory where you saved <code>main.rs</code>.
5. Run the following command to compile and run the Rust program:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">cargo</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">run</span></span></code></pre>
<p>This will compile your Rust code and run the resulting executable. You should see the message “Hello, World!” printed to the console.</p>
<p>That’s it! You’ve written and run your first Rust program.</p>
<p>Rust’s basic syntax
Sure, here are some examples of Rust’s basic syntax:</p>
<h3 id="variables">Variables</h3>
<p>You can define variables in Rust using the <code>let</code> keyword. Rust is a statically typed language, so you need to specify the type of the variable when you define it. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">42</span><span style="color: #ABB2BF">;</span></span></code></pre>
<p>This code defines a variable <code>x</code> of type <code>i32</code> (32-bit integer) with the value <code>42</code>.</p>
<h3 id="functions">Functions</h3>
<p>You can define functions in Rust using the <code>fn</code> keyword. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> + </span><span style="color: #E06C75">y</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code defines a function <code>add</code> that takes two <code>i32</code> arguments and returns their sum as an <code>i32</code>.</p>
<h3 id="control-flow">Control flow</h3>
<p>Rust has standard control flow constructs like <code>if</code> statements, <code>for</code> loops, and <code>while</code> loops. Here are some examples:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">42</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"x is positive"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"x is negative"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"x is zero"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">..</span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>The first example uses an <code>if</code> statement to print a message depending on the value of <code>x</code>. The second example uses a <code>for</code> loop to print the numbers 0 through 4. The third example uses a <code>while</code> loop to do the same thing.</p>
<h3 id="ownership-and-borrowing">Ownership and borrowing</h3>
<p>Rust has a unique ownership and borrowing system that helps prevent memory errors like null pointer dereferences and buffer overflows. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"hello"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">len</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">calculate_length</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #E06C75">s</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push_str</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">", world"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">len</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">calculate_length</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">usize</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">len</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code defines a mutable string <code>s</code> and passes a reference to it (<code>&#x26;s</code>) to a function called <code>calculate_length</code>, which returns the length of the string. After calling the function, the main code appends ”, world” to the string and tries to print the original length. However, since <code>s</code> was borrowed by the <code>calculate_length</code> function, the main code can’t modify it until the borrow ends. This prevents bugs where multiple parts of the code try to modify the same memory at the same time.</p>
<p>These are just a few examples of Rust’s basic syntax. Rust has many other features like pattern matching, enums, and traits that make it a powerful and expressive language.</p>
<p>Rust’s data types
Sure! Here’s a brief overview of some of Rust’s data types:</p>
<h3 id="scalar-types">Scalar types</h3>
<p>Rust has four scalar types, which represent single values:</p>
<ul>
<li><strong>Booleans</strong> (<code>bool</code>): <code>true</code> or <code>false</code>.</li>
<li><strong>Characters</strong> (<code>char</code>): A single Unicode scalar value, written with single quotes, such as <code>'a'</code> or <code>'💕'</code>.</li>
<li><strong>Integers</strong> (<code>i8</code>, <code>u8</code>, <code>i16</code>, <code>u16</code>, <code>i32</code>, <code>u32</code>, <code>i64</code>, <code>u64</code>, <code>i128</code>, <code>u128</code>, <code>isize</code>, <code>usize</code>): Signed or unsigned integers of various sizes, from 8-bit to 128-bit. The <code>isize</code> and <code>usize</code> types are machine-dependent and are the same size as a pointer.</li>
<li><strong>Floating-point numbers</strong> (<code>f32</code>, <code>f64</code>): Single-precision or double-precision floating-point numbers, respectively.</li>
</ul>
<h3 id="compound-types">Compound types</h3>
<p>Rust has two compound types, which group multiple values into one:</p>
<ul>
<li><strong>Arrays</strong> (<code>[T; N]</code>): A fixed-size collection of values of the same type <code>T</code>. The size <code>N</code> must be known at compile time. Arrays are allocated on the stack.</li>
<li><strong>Tuples</strong> (<code>(T1, T2, ..., Tn)</code>): A collection of values of different types <code>T1</code>, <code>T2</code>, …, <code>Tn</code>. Tuples are allocated on the stack.</li>
</ul>
<h3 id="ownership-types">Ownership types</h3>
<p>Rust has three ownership types, which determine how values are stored and managed in memory:</p>
<ul>
<li><strong>References</strong> (<code>&#x26;T</code> and <code>&#x26;mut T</code>): A reference is a pointer to a value of type <code>T</code>. A reference can be immutable (<code>&#x26;T</code>) or mutable (<code>&#x26;mut T</code>), and it can be borrowed for a certain scope.</li>
<li><strong>Boxes</strong> (<code>Box&#x3C;T></code>): A box is a pointer to a value of type <code>T</code>, allocated on the heap. A box is used when you need to allocate a value that can be resized or that has an unknown size at compile time.</li>
<li><strong>Ownership</strong> (<code>T</code>): Ownership is a special kind of value that determines which part of the code “owns” a value and is responsible for managing its memory. Ownership is used to prevent common memory errors like null pointers, buffer overflows, and use-after-free bugs.</li>
</ul>
<p>These are just a few examples of Rust’s data types. Rust also has many other advanced types, such as slices, enums, and structs, that make it a powerful and expressive language.</p>
<p>Exercises
Sure, here are some exercises related to Rust’s data types:</p>
<ol>
<li>Declare a boolean variable called <code>is_true</code> and set it to <code>true</code>.</li>
<li>Declare a character variable called <code>my_char</code> and set it to the letter ‘A’.</li>
<li>Declare an array called <code>my_array</code> containing the integers 1, 2, 3, and 4.</li>
<li>Declare a tuple called <code>my_tuple</code> containing a boolean value, a character value, and an integer value.</li>
<li>Declare a mutable integer variable called <code>my_int</code> and set it to 10. Then, create a mutable reference to <code>my_int</code> called <code>my_int_ref</code> and change the value of <code>my_int</code> to 20 using the reference.</li>
</ol>
<p>Try writing out the Rust code for each of these exercises.</p>
<p>Solutions to exercises
Here are the solutions to the exercises:</p>
<ol>
<li><code>let is_true: bool = true;</code></li>
<li><code>let my_char: char = 'A';</code></li>
<li><code>let my_array: [i32; 4] = [1, 2, 3, 4];</code></li>
<li><code>let my_tuple: (bool, char, i32) = (true, 'A', 10);</code></li>
<li></li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_int</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_int_ref</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> &#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_int</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">*</span><span style="color: #E06C75">my_int_ref</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">20</span><span style="color: #ABB2BF">;`</span></span></code></pre>
<p>These exercises covered the basics of Rust’s data types, including booleans, characters, arrays, tuples, references, and mutability. With these data types, you can begin to write simple Rust programs and explore the language further.</p>
<h1 id="chapter-3-control-flow-in-rust">Chapter 3: Control Flow in Rust</h1>
<p>Rust’s if/else statements
Certainly! In Rust, the <code>if</code> and <code>if-else</code> statements are used for conditional branching in your code. Here are some examples of how to use them:</p>
<h3 id="basic-if-statement">Basic <code>if</code> statement</h3>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{} is less than 10"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use an <code>if</code> statement to check if the value of <code>number</code> is less than 10. If the condition is true, we print a message to the console.</p>
<h3 id="if-else-statement"><code>if-else</code> statement</h3>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">15</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{} is less than 10"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{} is greater than or equal to 10"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use an <code>if-else</code> statement to check if the value of <code>number</code> is less than 10. If the condition is true, we print a message saying that the number is less than 10. If the condition is false, we print a message saying that the number is greater than or equal to 10.</p>
<h3 id="if-else-if-else-statement"><code>if-else if-else</code> statement</h3>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">15</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{} is less than 10"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">20</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{} is between 10 and 19"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">} </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{} is greater than or equal to 20"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use an <code>if-else if-else</code> statement to check if the value of <code>number</code> falls into one of three ranges. If the value is less than 10, we print a message saying that the number is less than 10. If the value is between 10 and 19, we print a message saying that the number is between 10 and 19. If the value is greater than or equal to 20, we print a message saying that the number is greater than or equal to 20.</p>
<p>These are just a few examples of how to use <code>if</code> and <code>if-else</code> statements in Rust. There are many other ways to use conditional branching in your code, such as with <code>match</code> statements and loops.</p>
<p>Rust’s loops
Certainly! In Rust, there are three main types of loops: <code>loop</code>, <code>while</code>, and <code>for</code>. Here are some examples of how to use them:</p>
<h3 id="loop-statement"><code>loop</code> statement</h3>
<p>The <code>loop</code> statement creates an infinite loop that can be exited using the <code>break</code> keyword. Here is an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">loop</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Counter: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we create an infinite loop using the <code>loop</code> keyword. Inside the loop, we increment a counter variable and print its value to the console. We then check if the counter is equal to 5, and if it is, we exit the loop using the <code>break</code> keyword.</p>
<h3 id="while-statement"><code>while</code> statement</h3>
<p>The <code>while</code> statement executes a block of code while a condition is true. Here is an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Counter: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use a <code>while</code> loop to increment a counter variable and print its value to the console. We then check if the counter is less than 5, and if it is, we continue looping. When the counter reaches 5, the loop stops.</p>
<h3 id="for-statement"><code>for</code> statement</h3>
<p>The <code>for</code> statement is used to iterate over a collection of items. Here is an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_array</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_array</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Number: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use a <code>for</code> loop to iterate over each number in an array of integers. We use the <code>iter()</code> method to create an iterator for the array, and then loop over each item in the iterator. For each number in the array, we print its value to the console.</p>
<p>These are just a few examples of how to use loops in Rust. There are many other ways to use loops in your code, such as with nested loops, loop labels, and loop guards.</p>
<p>Rust’s match statements
In Rust, the <code>match</code> statement is used to compare a value against a series of patterns and execute code based on which pattern matches. Here’s an example of how to use <code>match</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"One"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Two"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF"> => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Three"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Other"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a variable called <code>number</code> and assign it a value of 3. We then use a <code>match</code> statement to compare the value of <code>number</code> against a series of patterns. The patterns are defined using the <code>=></code> operator and are followed by code to execute if the pattern matches. If none of the patterns match, the <code>_</code> pattern (which matches anything) is used.</p>
<p>When the code is run, the <code>match</code> statement compares the value of <code>number</code> against each pattern in order. Since the value of <code>number</code> is 3, the third pattern (<code>3 => println!("Three")</code>) matches, and the code inside the corresponding block (<code>println!("Three")</code>) is executed. The output of this code is <code>Three</code>.</p>
<p>You can also use <code>match</code> statements with more complex patterns, including ranges, variables, and enums. Here’s an example of a <code>match</code> statement that uses an enum:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">enum</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Direction</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Up</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Down</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Left</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Right</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_direction</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Direction</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Left</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_direction</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Direction</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Up</span><span style="color: #ABB2BF"> => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Moving up!"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Direction</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Down</span><span style="color: #ABB2BF"> => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Moving down!"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Direction</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Left</span><span style="color: #ABB2BF"> => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Moving left!"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Direction</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Right</span><span style="color: #ABB2BF"> => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Moving right!"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define an enum called <code>Direction</code> that has four possible values: <code>Up</code>, <code>Down</code>, <code>Left</code>, and <code>Right</code>. We then define a variable called <code>my_direction</code> and assign it a value of <code>Direction::Left</code>. Finally, we use a <code>match</code> statement to compare the value of <code>my_direction</code> against each possible value of the <code>Direction</code> enum. Since <code>my_direction</code> has a value of <code>Direction::Left</code>, the third pattern (<code>Direction::Left => println!("Moving left!")</code>) matches, and the code inside the corresponding block (<code>println!("Moving left!")</code>) is executed. The output of this code is <code>Moving left!</code>.</p>
<p>Rust’s error handling
Rust has a powerful error handling system that allows developers to gracefully handle errors and recover from them. The core of Rust’s error handling system is the <code>Result</code> type, which represents either success (with a value) or failure (with an error).</p>
<p>Here’s an example of how to use <code>Result</code> to handle errors:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ErrorKind</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">open_file</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file_name</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">str</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file_name</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">) => </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) => </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">kind</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ErrorKind</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">NotFound</span><span style="color: #ABB2BF"> => </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">format!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"File not found: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">file_name</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Error opening file"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">()),</span></span>
<span class="line"><span style="color: #ABB2BF"> },</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file_name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"example.txt"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">open_file</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file_name</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">) => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"File opened successfully"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Error opening file: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a function called <code>open_file</code> that takes a file name as a parameter and returns a <code>Result&#x3C;File, String></code>. Inside the function, we use a <code>match</code> statement to handle the result of calling <code>File::open(file_name)</code>. If the file is successfully opened (<code>Ok(file)</code>), we return the <code>File</code> object wrapped in an <code>Ok</code> variant. If an error occurs (<code>Err(error)</code>), we use another <code>match</code> statement to handle the type of error. In this case, if the file is not found (<code>ErrorKind::NotFound</code>), we return an error message indicating that the file was not found. Otherwise, we return a generic error message.</p>
<p>In the <code>main</code> function, we call <code>open_file</code> with a file name and use a <code>match</code> statement to handle the result. If the file is opened successfully (<code>Ok(file)</code>), we print a success message. Otherwise, we print an error message with the error string.</p>
<p>Rust also provides a convenient <code>?</code> operator that can be used to propagate errors up the call stack. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">BufRead</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">read_file</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file_name</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">str</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">io</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file_name</span><span style="color: #ABB2BF">)?;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">lines</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">BufReader</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">lines</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">collect</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">>, </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">>>()?;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">lines</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file_name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"example.txt"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">read_file</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file_name</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">lines</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">line</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">lines</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">line</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Error reading file: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a function called <code>read_file</code> that takes a file name as a parameter and returns a <code>Result&#x3C;Vec&#x3C;String>, io::Error></code>. Inside the function, we use the <code>?</code> operator to propagate errors up the call stack. First, we attempt to open the file using <code>File::open(file_name)</code>. If an error occurs, the <code>?</code> operator returns the error to the caller. If the file is opened successfully, we use a <code>BufReader</code> to read the lines of the file and collect them into a <code>Vec</code>. If an error occurs during this process, the <code>?</code> operator returns the error to the caller.</p>
<p>In the <code>main</code> function, we call <code>read_file</code> with a file name and use a <code>match</code> statement to handle the result. If the file is read successfully (<code>Ok(lines)</code>), we print each line of the file. Otherwise, we print</p>
<p>Exercises</p>
<ol>
<li>Write a function called <code>parse_int</code> that takes a string as a parameter and returns a <code>Result&#x3C;i32, String></code>. If the string can be parsed as an integer, the function should return the integer value wrapped in an <code>Ok</code> variant. If the string cannot be parsed as an integer, the function should return an error message wrapped in an <code>Err</code> variant.</li>
<li>Write a function called <code>divide</code> that takes two integers as parameters and returns a <code>Result&#x3C;i32, String></code>. If the second integer is zero, the function should return an error message wrapped in an <code>Err</code> variant. Otherwise, the function should return the result of dividing the first integer by the second integer, wrapped in an <code>Ok</code> variant.</li>
<li>Write a function called <code>check_prime</code> that takes an integer as a parameter and returns a <code>Result&#x3C;bool, String></code>. If the integer is prime, the function should return <code>true</code> wrapped in an <code>Ok</code> variant. If the integer is not prime, the function should return <code>false</code> wrapped in an <code>Ok</code> variant. If the input is less than 2, the function should return an error message wrapped in an <code>Err</code> variant.</li>
<li>Write a function called <code>sum_primes</code> that takes a vector of integers as a parameter and returns a <code>Result&#x3C;i32, String></code>. The function should compute the sum of all prime numbers in the vector and return the result wrapped in an <code>Ok</code> variant. If any of the integers in the vector are less than 2, the function should return an error message wrapped in an <code>Err</code> variant.</li>
<li>Write a program that prompts the user to enter two integers and then prints the result of dividing the first integer by the second integer. If an error occurs during the division, the program should print an error message. Use the <code>readline</code> function from the <code>rustyline</code> crate to read input from the user.</li>
</ol>
<p>Solutions to exercises
1.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">parse_int</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">str</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">parse</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF">) => </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">) => </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to parse integer"</span><span style="color: #ABB2BF">)),</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="2">
<li></li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">divide</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Cannot divide by zero"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF"> / </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="3">
<li></li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">check_prime</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">bool</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Input must be greater than or equal to 2"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">..(</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> + </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> % </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #D19A66">4</span><span style="color: #ABB2BF">. ``</span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sum_primes</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">numbers</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">>) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">numbers</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Input must be greater than or equal to 2"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">is_prime</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">..(</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> / </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> + </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> % </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">is_prime</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">is_prime</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">n</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="5">
<li></li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">rustyline</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ReadlineError</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">rustyline</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Editor</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">editor</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Editor</span><span style="color: #ABB2BF">::&#x3C;()>::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">loop</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">editor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readline</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Enter first integer: "</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">line</span><span style="color: #ABB2BF">) => </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">line</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">trim</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">parse</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">) => </span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Invalid integer"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> },</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ReadlineError</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Interrupted</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Interrupted"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ReadlineError</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Eof</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"EOF"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Error: {:?}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">editor</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">readline</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Enter second integer: "</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">line</span><span style="color: #ABB2BF">) => </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">line</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">trim</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">parse</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">) => </span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Invalid integer"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> },</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ReadlineError</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Interrupted</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Interrupted"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ReadlineError</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Eof</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"EOF"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Error: {:?}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">divide</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">) => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Result: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">msg</span><span style="color: #ABB2BF">) => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">msg</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">divide</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Cannot divide by zero"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF"> / </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<h1 id="chapter-4-rusts-ownership-model">Chapter 4: Rust’s Ownership Model</h1>
<p>What is Rust’s ownership model?
Rust’s ownership model is a unique approach to memory management that ensures safety and eliminates the need for a garbage collector. In Rust, every value has a variable that owns it, and that variable is responsible for managing the value’s memory.</p>
<p>Ownership rules in Rust ensure that each value has only one owner at any given time, and when the owner goes out of scope, the value is dropped and its memory is freed. Rust also includes borrowing and lifetime mechanisms that allow temporary access to values without taking ownership, and help prevent issues such as dangling pointers, null pointer dereferencing, or data races.</p>
<p>Rust’s ownership model allows for safe and efficient memory management, without sacrificing performance. However, it can require some additional work from the developer to handle ownership correctly, and to ensure that data is shared, moved, and borrowed in a way that complies with Rust’s rules.</p>
<p>Rust’s borrowing rules
Rust’s borrowing rules are an important aspect of its ownership model, and they govern how references to values can be borrowed in a way that avoids data races, dangling pointers, and other memory safety issues.</p>
<p>The borrowing rules in Rust ensure that there can be only one mutable reference or any number of immutable references to a value at any given time. This ensures that there is no concurrent modification of a value, which can lead to data races.</p>
<p>Borrowing also has lifetime constraints. A reference cannot outlive the value it refers to. This ensures that there are no dangling pointers, where a reference still exists after the value it points to has been deallocated.</p>
<p>The borrowing rules are enforced by the Rust compiler at compile time, and violations of these rules will cause compilation errors. This can make Rust programs more difficult to write than programs in other languages, but it also guarantees that Rust programs are memory safe and have a reduced risk of runtime errors.</p>
<p>Overall, Rust’s borrowing rules provide a way to safely share data between parts of a program, without the risk of data races or other memory safety issues.</p>
<p>Rust’s lifetimes
In Rust, a lifetime is a way to express how long a reference to a value should be valid. Lifetimes are used to ensure that references to values are only used while the value is still valid, and to prevent dangling pointers and other memory safety issues.</p>
<p>Every reference in Rust has a lifetime associated with it. The lifetime specifies the duration for which the reference is valid, and is expressed using an apostrophe (’) symbol followed by a name or a placeholder. The name or placeholder can then be used as a generic lifetime parameter in function signatures or struct definitions.</p>
<p>The Rust compiler uses lifetime analysis to ensure that references are used correctly, and will report errors if there are any violations of the lifetime rules. Some of the key lifetime rules in Rust include:</p>
<ul>
<li>A reference cannot outlive the value it points to.</li>
<li>A mutable reference cannot coexist with any other reference to the same value, whether mutable or immutable.</li>
<li>An immutable reference can coexist with other immutable references, but not with a mutable reference.</li>
</ul>
<p>The Rust language includes several advanced lifetime features, such as lifetime elision, lifetime bounds, and associated lifetimes, which provide flexibility and expressivity for complex data structures and algorithms.</p>
<p>Overall, Rust’s lifetimes provide a powerful and flexible tool for managing references and ensuring memory safety in Rust programs. While they can be challenging to understand and use correctly, they are an essential part of Rust’s safety and performance guarantees.</p>
<p>Rust’s smart pointers
Rust’s smart pointers are types that encapsulate a value and provide additional functionality beyond that of regular references. Smart pointers are often used to manage memory in Rust, and they come in two flavors: those that own the values they point to, and those that borrow them.</p>
<p>The most commonly used smart pointers that own the values they point to are:</p>
<ul>
<li>Box<t>: A pointer to a heap-allocated value of type T, where the pointer itself is located on the stack.</t></li>
<li>Rc<t>: A reference-counted pointer to a value of type T, which allows for shared ownership.</t></li>
<li>Arc<t>: An atomic reference-counted pointer to a value of type T, which allows for concurrent access across threads.</t></li>
</ul>
<p>The smart pointers that borrow the values they point to include:</p>
<ul>
<li>&#x26;T: A shared reference to a value of type T.</li>
<li>&#x26;mut T: A mutable reference to a value of type T.</li>
<li>RefCell<t>: A runtime-checked borrow-checked mutable container that allows interior mutability.</t></li>
</ul>
<p>Smart pointers can be useful in many scenarios, such as when allocating memory on the heap, sharing ownership between parts of a program, or providing a runtime-checked way to mutate values in a shared context.</p>
<p>Smart pointers are implemented as structs in Rust, and they often implement the Deref and/or DerefMut traits to allow for seamless interaction with regular references. This can make smart pointers easy to use and integrate into existing code.</p>
<p>Overall, smart pointers in Rust provide a flexible and powerful way to manage memory and ownership in Rust programs, while ensuring memory safety and avoiding common issues like null pointer dereferencing and data races.</p>
<p>Exercises</p>
<ol>
<li>What is the difference between a Box and a reference in Rust? When would you use a Box instead of a reference?</li>
<li>What is the difference between an Rc and an Arc in Rust? When would you use an Rc instead of an Arc?</li>
<li>How does RefCell differ from a mutable reference in Rust? When would you use RefCell instead of a mutable reference?</li>
<li>Write a function that takes a reference to a vector of integers and returns a Box containing a vector of the squares of those integers.</li>
<li>Write a function that takes an Rc reference to a string and returns a new Rc reference to the same string, without cloning the string. What is the reference count of the string before and after the function is called?</li>
<li>Write a function that takes an Arc reference to a vector of integers and returns the sum of the integers in the vector. What happens if two threads simultaneously call this function with the same Arc reference? How can you modify the code to avoid data races?</li>
<li>Write a program that uses RefCell to mutate a vector of integers in a shared context. How does RefCell ensure that the borrow rules are followed at runtime?</li>
</ol>
<p>Solutions to exercises</p>
<ol>
<li>A Box is an owned pointer to a value on the heap, while a reference is a borrowed pointer to a value on the stack or heap. You would use a Box instead of a reference when you want to allocate memory on the heap and have ownership over the value, or when you need to transfer ownership to another part of the program.</li>
<li>An Rc is a reference-counted pointer to a value on the heap that allows for shared ownership, while an Arc is an atomic reference-counted pointer that allows for concurrent access across threads. You would use an Rc instead of an Arc when you need to share ownership between parts of the program that are not running concurrently.</li>
<li>RefCell is a runtime-checked borrow-checked mutable container that allows interior mutability, while a mutable reference is a borrow-checked pointer to a mutable value. You would use RefCell instead of a mutable reference when you need to mutate a value in a shared context, but the borrow checker does not allow it at compile time.</li>
<li></li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">square_vec</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">>) -> </span><span style="color: #E5C07B">Box</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">>> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">squares</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">x</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> * </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">collect</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Box</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">squares</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="5">
<li></li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">rc</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Rc</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">clone_rc_string</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Rc</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">>) -> </span><span style="color: #E5C07B">Rc</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ptr</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Rc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">into_raw</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Rc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">)) </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> *</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsafe</span><span style="color: #ABB2BF"> { </span><span style="color: #E5C07B">Rc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_raw</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">ptr</span><span style="color: #ABB2BF">) }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Rc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"hello"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">s2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">clone_rc_string</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Rc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">strong_count</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Rc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">strong_count</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">s2</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>The reference count of the string before and after the function is called is 1.
6.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">sync</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::thread;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sum_vec</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">>>) -> </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">sum</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">v1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">v2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">h1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">move</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sum_vec</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">v1</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">move</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sum_vec</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">v2</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">h1</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">() + </span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>If two threads simultaneously call this function with the same Arc reference, a data race may occur because the reference count is not atomic. You can modify the code to avoid data races by using an atomic reference count with <code>std::sync::Arc</code>.
7.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">cell</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">RefCell</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">RefCell</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">borrow</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">borrow_mut</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">borrow</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">borrow</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">borrow</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">borrow</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{:?}"</span><span style="color: #ABB2BF">, *</span><span style="color: #E06C75">borrow</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>RefCell ensures that the borrow rules are followed at runtime by checking at runtime if a borrow has already occurred. If a mutable borrow has occurred and another borrow is attempted, the program will panic at runtime.</p>
<h1 id="chapter-5-rusts-concurrency-model">Chapter 5: Rust’s Concurrency Model</h1>
<p>What is Rust’s concurrency model?
Rust has a strong focus on concurrency and provides powerful abstractions for concurrent programming. Rust’s concurrency model is based on the concept of ownership and borrowing, which allows for safe and efficient concurrent programming without data races.</p>
<p>Rust’s concurrency model is primarily based on two constructs: threads and message passing. Threads are lightweight units of execution that can run in parallel, while message passing is a way for threads to communicate by sending data between each other.</p>
<p>In Rust, threads are created using the <code>std::thread</code> module, which provides functions for spawning new threads and joining them. Message passing is implemented using channels, which are a fundamental part of Rust’s standard library. Channels allow multiple threads to communicate by sending and receiving values over a channel.</p>
<p>Rust’s concurrency model also includes a number of synchronization primitives, such as mutexes, semaphores, and condition variables. These primitives are used to coordinate access to shared resources and ensure that only one thread can access a shared resource at a time.</p>
<p>Overall, Rust’s concurrency model is designed to provide safe and efficient concurrent programming without the need for manual memory management or locking.</p>
<p>Rust’s threads
In Rust, threads are lightweight units of execution that can run concurrently. Threads can be created using the <code>std::thread</code> module, which provides functions for spawning new threads and joining them.</p>
<p>To spawn a new thread, you can use the <code>std::thread::spawn</code> function, which takes a closure as an argument. The closure contains the code that will be executed by the new thread. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::thread;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Code executed by the new thread</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Hello from a new thread!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Wait for the thread to finish</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Code executed by the main thread</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Hello from the main thread!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we create a new thread using the <code>thread::spawn</code> function and pass a closure that prints a message to the console. We then use the <code>join</code> method on the thread handle to wait for the thread to finish executing before continuing with the main thread.</p>
<p>Rust’s threads also support communication through channels, which are a fundamental part of Rust’s standard library. Channels allow multiple threads to communicate by sending and receiving values over a channel. Here’s an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">sync</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">mpsc</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">Sender</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Receiver</span><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">sync</span><span style="color: #ABB2BF">::mpsc;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::thread;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">tx</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">rx</span><span style="color: #ABB2BF">): (</span><span style="color: #E5C07B">Sender</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">>, </span><span style="color: #E5C07B">Receiver</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">>) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">mpsc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">channel</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">move</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tx</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">send</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">42</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">rx</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">recv</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Received value: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we create a new channel using the <code>mpsc::channel</code> function and spawn a new thread that sends the value <code>42</code> over the channel. We then use the <code>recv</code> method on the receiving end of the channel to wait for a value to be sent and receive it.</p>
<p>Overall, Rust’s thread API provides a powerful and safe way to create concurrent programs.</p>
<p>Rust’s message passing
In Rust, message passing is a way to communicate between threads. Rust’s standard library provides the <code>std::sync::mpsc</code> module, which contains the channels used for message passing between threads.</p>
<p>The <code>mpsc</code> stands for “multiple producers, single consumer”. In Rust’s message passing model, there can be multiple threads that produce messages and a single thread that consumes them.</p>
<p>Here is an example of how to use message passing in Rust to communicate between two threads:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">sync</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">mpsc</span><span style="color: #ABB2BF">::channel;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::thread;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Create a new channel with a capacity of 1</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">tx</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">rx</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">channel</span><span style="color: #ABB2BF">::&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">>();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Spawn a new thread that sends a message</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">move</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">data</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">42</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tx</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">send</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">data</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> // Receive the message sent by the other thread</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">received_data</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">rx</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">recv</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Received data: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">received_data</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we create a channel using the <code>channel</code> function from the <code>mpsc</code> module. We then spawn a new thread that sends a message (in this case, the integer value 42) through the channel using the <code>send</code> method. Finally, we receive the message using the <code>recv</code> method on the receiving end of the channel and print it to the console.</p>
<p>Message passing is a powerful tool for building concurrent applications in Rust. By using channels to communicate between threads, you can ensure safe and predictable communication, while avoiding issues like data races and deadlocks.</p>
<p>Rust’s synchronization primitives
In Rust, synchronization primitives are used to coordinate access to shared resources between multiple threads. Rust’s standard library provides several synchronization primitives, including mutexes, semaphores, and condition variables.</p>
<p>Mutexes are the most commonly used synchronization primitive in Rust. They are used to protect shared resources by allowing only one thread to access them at a time. Rust’s standard library provides the <code>std::sync::Mutex</code> type for creating mutexes. Here is an example of how to use a mutex in Rust:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">sync</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Mutex</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::thread;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mutex</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Mutex</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">..</span><span style="color: #D19A66">10</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mutex_ref</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mutex</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">move</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">data</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">mutex_ref</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lock</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">data</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Final value: {:?}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">mutex</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lock</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we create a mutex using the <code>Mutex::new</code> function from the <code>std::sync</code> module. We then spawn 10 threads, each of which locks the mutex, adds its index to the shared value, and then unlocks the mutex. Finally, we join all the threads and print the final value of the shared variable.</p>
<p>Semaphores are another synchronization primitive that are used to limit the number of threads that can access a shared resource at a time. Rust’s standard library provides the <code>std::sync::Semaphore</code> type for creating semaphores.</p>
<p>Condition variables are used to block and wake up threads based on certain conditions. Rust’s standard library provides the <code>std::sync::Condvar</code> type for creating condition variables.</p>
<p>Overall, Rust’s synchronization primitives provide a powerful and flexible way to coordinate access to shared resources between multiple threads, while ensuring safety and predictability.</p>
<p>Exercises</p>
<ol>
<li>Write a program that spawns 5 threads, each of which increments a shared counter 100 times. Use a mutex to protect access to the counter and print the final value of the counter after all threads have completed.</li>
<li>Write a program that spawns 10 threads, each of which tries to decrement a shared counter 50 times. Use a semaphore to ensure that no more than 5 threads can access the counter at a time, and print the final value of the counter after all threads have completed.</li>
<li>Write a program that spawns 2 threads, one of which produces values and the other of which consumes them. Use a channel to pass values between the threads. The producer thread should generate the numbers 1 through 10 and send them to the consumer thread, which should print them to the console.</li>
<li>Write a program that spawns 3 threads, each of which prints a message to the console. Use a barrier to ensure that all threads have completed before the program exits.</li>
<li>Write a program that spawns 2 threads, each of which prints a message to the console. Use a condition variable to ensure that the second thread does not start printing until the first thread has completed.</li>
</ol>
<p>Solutions to exercises</p>
<ol>
<li>Here’s an example program that spawns 5 threads to increment a shared counter using a mutex:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">sync</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">Mutex</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::thread;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Mutex</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">..</span><span style="color: #D19A66">5</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">move</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">..</span><span style="color: #D19A66">100</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">num</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lock</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">num</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Final counter value: {}"</span><span style="color: #ABB2BF">, *</span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lock</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="2">
<li>Here’s an example program that spawns 10 threads to decrement a shared counter using a semaphore:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">sync</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">Mutex</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Semaphore</span><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::thread;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Mutex</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">100</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">semaphore</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Semaphore</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">..</span><span style="color: #D19A66">10</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">semaphore</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">semaphore</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">move</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">..</span><span style="color: #D19A66">50</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_guard</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">semaphore</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">acquire</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">num</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lock</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> *</span><span style="color: #E06C75">num</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Final counter value: {}"</span><span style="color: #ABB2BF">, *</span><span style="color: #E06C75">counter</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lock</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="3">
<li>Here’s an example program that spawns 2 threads, one to produce values and one to consume them using a channel:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">sync</span><span style="color: #ABB2BF">::mpsc;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::thread;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">tx</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">rx</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">mpsc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">channel</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">move</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">..=</span><span style="color: #D19A66">10</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tx</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">send</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">move</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">received</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">rx</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Received: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">received</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle1</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle2</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="4">
<li>Here’s an example program that spawns 3 threads, each of which prints a message to the console using a barrier:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">sync</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">Barrier</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::thread;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">barrier</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Barrier</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">..</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">barrier</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">barrier</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">move</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Thread {} is waiting at the barrier..."</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">barrier</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">wait</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Thread {} passed the barrier!"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handles</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="5">
<li>Here’s an example program that spawns 2 threads, one to print a message and one to wait for a condition variable before printing a message:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">sync</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Condvar</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Mutex</span><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::thread;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pair</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">((</span><span style="color: #E5C07B">Mutex</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">), </span><span style="color: #E5C07B">Condvar</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">()));</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pair2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Arc</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">pair</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">thread</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">spawn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">move</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">||</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> &#x26;(</span><span style="color: #C678DD">ref</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">lock</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">ref</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">cvar</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> &#x26;*</span><span style="color: #E06C75">pair2</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">started</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">lock</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lock</span><span style="color: #ABB2BF">().</span></span></code></pre>
<h1 id="chapter-6-rusts-standard-library">Chapter 6: Rust’s Standard Library</h1>
<p>Rust’s standard library
Rust’s standard library provides a rich set of modules and types for performing common programming tasks. Some of the most commonly used modules include:</p>
<ul>
<li><code>std::io</code>: provides types and functions for performing input and output operations, such as reading and writing files or data streams.</li>
<li><code>std::collections</code>: provides common data structures such as vectors, hash maps, and binary heaps.</li>
<li><code>std::thread</code>: provides types and functions for working with threads.</li>
<li><code>std::sync</code>: provides synchronization primitives such as mutexes and semaphores for coordinating access to shared data.</li>
<li><code>std::time</code>: provides types and functions for working with time, such as measuring elapsed time or sleeping for a specified duration.</li>
</ul>
<p>There are many other modules available in Rust’s standard library, covering a wide range of functionality such as networking, cryptography, and regular expressions. The documentation for the standard library is available online and can be accessed through Rust’s official website.</p>
<p>Rust’s collections
Rust’s standard library provides a set of collections that are commonly used in programming. Some of the most commonly used collections include:</p>
<ul>
<li><code>Vec&#x3C;T></code>: A dynamically sized array that stores elements of type <code>T</code>.</li>
<li><code>HashMap&#x3C;K, V></code>: A hash table that maps keys of type <code>K</code> to values of type <code>V</code>.</li>
<li><code>BTreeMap&#x3C;K, V></code>: A sorted map that maps keys of type <code>K</code> to values of type <code>V</code>.</li>
<li><code>HashSet&#x3C;T></code>: A hash set that stores elements of type <code>T</code>.</li>
<li><code>BTreeSet&#x3C;T></code>: A sorted set that stores elements of type <code>T</code>.</li>
</ul>
<p>These collections are generic, meaning they can store any type that implements certain traits, such as <code>Copy</code> or <code>Clone</code>. Rust’s collections are designed to be memory safe and provide efficient access to elements. They also implement a variety of useful methods such as <code>push</code>, <code>pop</code>, <code>insert</code>, <code>remove</code>, <code>get</code>, and <code>contains</code>.</p>
<p>In addition to these basic collections, Rust’s standard library provides a variety of other collections such as <code>LinkedList</code>, <code>BinaryHeap</code>, and <code>VecDeque</code>, as well as collections specialized for specific use cases such as <code>String</code> and <code>PathBuf</code>.</p>
<p>Overall, Rust’s collections provide a flexible and efficient way to work with collections of data in a safe and ergonomic manner.</p>
<p>Rust’s I/O
Rust’s standard library provides a comprehensive I/O module called <code>std::io</code> for performing input and output operations. This module provides a set of traits, types, and functions that can be used to read and write data to a variety of sources, including files, network sockets, standard input/output streams, and more.</p>
<p>Some of the commonly used types and traits in <code>std::io</code> include:</p>
<ul>
<li><code>std::io::Read</code>: A trait that defines methods for reading bytes from a source.</li>
<li><code>std::io::Write</code>: A trait that defines methods for writing bytes to a destination.</li>
<li><code>std::io::BufRead</code>: A trait that defines methods for reading lines or chunks of data from a buffered source.</li>
<li><code>std::io::BufReader</code>: A type that wraps a <code>Read</code> instance and provides buffered reading.</li>
<li><code>std::io::BufWriter</code>: A type that wraps a <code>Write</code> instance and provides buffered writing.</li>
<li><code>std::io::Cursor</code>: A type that provides a cursor-like interface for reading and writing to an in-memory buffer.</li>
</ul>
<p>These types and traits can be used to implement various I/O operations such as reading a file line by line, writing data to a network socket, or parsing data from a CSV file. Rust’s I/O module also provides additional features such as error handling, buffering, and formatting.</p>
<p>In addition to the <code>std::io</code> module, Rust’s standard library also provides specialized I/O functionality through other modules such as <code>std::fs</code>, which provides functions for working with the file system, and <code>std::net</code>, which provides types and functions for working with network sockets.</p>
<p>Rust’s networking
Rust provides a comprehensive set of networking libraries and APIs for building networked applications. The standard library provides networking capabilities through the <code>std::net</code> module, which includes types and functions for working with IP addresses, TCP/UDP sockets, and other network protocols.</p>
<p>Here are some of the commonly used types and functions in <code>std::net</code>:</p>
<ul>
<li><code>std::net::TcpListener</code> and <code>std::net::TcpStream</code>: These types provide support for TCP network connections. <code>TcpListener</code> can be used to listen for incoming TCP connections, while <code>TcpStream</code> can be used to establish a client-side TCP connection to a remote server.</li>
<li><code>std::net::UdpSocket</code>: This type provides support for UDP network connections. It can be used to send and receive datagrams over a UDP network.</li>
<li><code>std::net::IpAddr</code> and <code>std::net::Ipv4Addr</code>/<code>std::net::Ipv6Addr</code>: These types represent IP addresses, both version 4 and 6.</li>
<li><code>std::net::SocketAddr</code> and <code>std::net::SocketAddrV4</code>/<code>std::net::SocketAddrV6</code>: These types represent socket addresses, which consist of an IP address and a port number.</li>
</ul>
<p>In addition to the standard library, Rust has several third-party networking libraries such as <code>tokio</code> and <code>async-std</code>, which provide asynchronous networking capabilities, and <code>hyper</code>, a fast and safe HTTP client and server library.</p>
<p>Overall, Rust’s networking capabilities are robust and provide developers with a wide range of tools and APIs for building networked applications.</p>
<p>Rust’s file handling
Rust provides a number of modules and functions for handling files and file systems. The <code>std::fs</code> module is the primary module for file I/O operations in Rust’s standard library. Here are some commonly used types and functions in <code>std::fs</code>:</p>
<ul>
<li><code>std::fs::File</code>: This type represents a file handle, which can be used to perform read/write operations on a file.</li>
<li><code>std::fs::OpenOptions</code>: This type provides a way to specify options when opening a file, such as the file access mode and file permissions.</li>
<li><code>std::fs::create_dir</code> and <code>std::fs::create_dir_all</code>: These functions create a new directory at the specified path. <code>create_dir</code> creates a single directory, while <code>create_dir_all</code> creates all the directories in the given path recursively.</li>
<li><code>std::fs::remove_file</code> and <code>std::fs::remove_dir</code>: These functions delete a file or directory, respectively.</li>
<li><code>std::fs::metadata</code> and <code>std::fs::symlink_metadata</code>: These functions retrieve metadata about a file or directory, such as its size, permissions, and modification time.</li>
<li><code>std::fs::read</code> and <code>std::fs::write</code>: These functions read or write the entire contents of a file, respectively.</li>
<li><code>std::fs::read_to_string</code> and <code>std::fs::write</code>: These functions read or write the contents of a file as a string, respectively.</li>
</ul>
<p>In addition to <code>std::fs</code>, Rust also provides the <code>std::path</code> module, which provides utilities for working with file paths.</p>
<p>First, let’s start with a simple text file that we want to analyze. We will use the following text file as an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">the quick brown fox jumps over the lazy dog</span></span></code></pre>
<p>Our goal is to count the frequency of each word in this text file.</p>
<p>To do this, we will use Rust’s HashMap collection, which provides a way to store key-value pairs. In this case, the keys will be the words in the text file and the values will be the frequency of each word.</p>
<p>Here’s the code:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">collections</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">BufRead</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">BufReader</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"text.txt"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Unable to open file"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">BufReader</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">word_count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">line</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lines</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">word</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">line</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">split_whitespace</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">word_count</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entry</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">word</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">or_insert</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            *</span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">word</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">word_count</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">word</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Let’s go through the code line by line to understand what’s happening.</p>
<p>First, we import the HashMap collection from the std::collections module, as well as the File and BufRead types from the std::fs and std::io modules, respectively.</p>
<p>Next, we open the text file using the File::open function and create a BufReader to read the file line by line.</p>
<p>We create a new HashMap called word_count to store the word frequencies.</p>
<p>We then iterate over each line in the text file using the lines method of the BufReader. For each line, we iterate over each word using the split_whitespace method. We then use the entry method of the HashMap to either retrieve the frequency of the word or insert a new entry with a frequency of 0. We then increment the frequency count of the word.</p>
<p>Finally, we iterate over the word_count HashMap using the iter method and print out the word and its frequency.</p>
<p>When we run this program with the text file, we get the following output:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">brown: 1</span></span>
<span class="line"><span style="color: #abb2bf">jumps: 1</span></span>
<span class="line"><span style="color: #abb2bf">over: 1</span></span>
<span class="line"><span style="color: #abb2bf">fox: 1</span></span>
<span class="line"><span style="color: #abb2bf">dog: 1</span></span>
<span class="line"><span style="color: #abb2bf">lazy: 1</span></span>
<span class="line"><span style="color: #abb2bf">quick: 1</span></span>
<span class="line"><span style="color: #abb2bf">the: 2</span></span></code></pre>
<p>This program demonstrates the power and simplicity of Rust’s collections. By using a HashMap, we are able to efficiently store and manipulate the word frequencies, making it easy to perform complex data analysis tasks such as counting the frequency of words in a text file.</p>
<p>Overall, Rust’s file handling capabilities are robust and provide developers with a wide range of tools and APIs for working with files and file systems.</p>
<p>Exercises</p>
<ol>
<li>Write Rust code that creates a new directory named “my_directory” in the current working directory.</li>
<li>Write Rust code that creates a new file named “my_file.txt” in the current working directory, writes the string “Hello, World!” to it, and then closes the file.</li>
<li>Write Rust code that reads the entire contents of a file named “my_file.txt” in the current working directory and prints them to the console.</li>
<li>Write Rust code that reads the contents of a file named “my_file.txt” in the current working directory as a string and prints it to the console.</li>
<li>Write Rust code that deletes the file “my_file.txt” in the current working directory.</li>
</ol>
<p>Solutions to exercises
1.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::fs;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">create_dir</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_directory"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to create directory"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="2">
<li></li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Write</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">create</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_file.txt"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to create file"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">write_all</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">b"Hello, World!"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to write to file"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="3">
<li></li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Read</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_file.txt"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to open file"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">contents</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">read_to_string</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">contents</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to read file"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">print!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">contents</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="4">
<li></li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::read_to_string;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">contents</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">read_to_string</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_file.txt"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to read file"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">print!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">contents</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<ol start="5">
<li></li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::fs;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">remove_file</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_file.txt"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to delete file"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<h1 id="chapter-7-rusts-advanced-features">Chapter 7: Rust’s Advanced Features</h1>
<p>Rust’s macros
In Rust, macros are a way to write code that generates other code at compile time. This can be useful for reducing boilerplate, creating domain-specific languages, or for metaprogramming.</p>
<p>Rust has two types of macros: declarative macros and procedural macros.</p>
<p>Declarative macros are similar to C preprocessor macros or macros in other languages. They take an input expression, apply some transformations to it, and output a new expression. Declarative macros are defined using the <code>macro_rules!</code> macro.</p>
<p>Procedural macros are more powerful than declarative macros, and are used to generate code based on Rust syntax trees. Procedural macros are defined as external crates and can be imported into Rust code using the <code>use</code> statement.</p>
<p>Rust also has a number of built-in macros, such as <code>println!</code> and <code>assert!</code>, which are commonly used in Rust code. These macros are defined using the <code>macro</code> keyword.</p>
<p>Here’s an example of a declarative macro that adds a <code>sum</code> method to a vector of integers:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #61AFEF">macro_rules!</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sum</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> ($</span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">expr</span><span style="color: #ABB2BF">) => {{</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">total</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> $</span><span style="color: #E06C75">v</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">total</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">total</span></span>
<span class="line"><span style="color: #ABB2BF"> }};</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">vec!</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">total</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sum!</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"The sum of {:?} is {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">total</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This macro takes a vector expression <code>$v:expr</code> as input, and outputs a block of code that calculates the sum of the vector. The <code>{{}}</code> syntax is used to create a block expression, which can contain multiple statements.</p>
<p>Procedural macros are more powerful than declarative macros, and can be used to generate code based on Rust syntax trees. They are typically defined as external crates, and can be imported into Rust code using the <code>use</code> statement. Here’s an example of a procedural macro that generates a new struct based on a given input struct:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">extern</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">crate</span><span style="color: #ABB2BF"> proc_macro;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">proc_macro</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">TokenStream</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">quote</span><span style="color: #ABB2BF">::quote;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::{parse_macro_input, </span><span style="color: #E5C07B">DeriveInput</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[proc_macro_derive(</span><span style="color: #E5C07B">MyDerive</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">my_derive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TokenStream</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">TokenStream</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ast</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">parse_macro_input!</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">DeriveInput</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> &#x26;</span><span style="color: #E06C75">ast</span><span style="color: #ABB2BF">.ident;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">gen</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">quote!</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> #</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">gen</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This macro takes a <code>DeriveInput</code> syntax tree as input, and generates a new struct with the same name as the input struct, but with two additional fields. The <code>quote!</code> macro is used to generate the new code, and the <code>into()</code> method is used to convert the generated code into a <code>TokenStream</code>, which can be returned by the macro.</p>
<p>In this example, the <code>proc_macro_derive</code> attribute is used to mark the macro as a procedural macro, and to specify the name of the macro (<code>MyDerive</code>).</p>
<p>Rust’s unsafe code
In Rust, <code>unsafe</code> is a keyword used to tell the compiler that a certain block of code is not guaranteed to be safe. This is generally because the code accesses memory in a way that Rust’s ownership rules can’t guarantee is safe.</p>
<p>Here are some common reasons to use <code>unsafe</code> code in Rust:</p>
<ul>
<li>Interfacing with other languages or systems that don’t guarantee memory safety, such as C or hardware devices.</li>
<li>Implementing low-level abstractions like operating system kernels or device drivers that require direct access to hardware or memory.</li>
<li>Writing high-performance code that needs to bypass some of Rust’s safety checks for maximum speed.</li>
</ul>
<p>However, it’s important to use <code>unsafe</code> with caution, since it can lead to bugs and security vulnerabilities if used incorrectly. It’s generally a good idea to keep the amount of <code>unsafe</code> code in your project to a minimum and use it only when necessary.</p>
<p>Some common examples of <code>unsafe</code> code in Rust include:</p>
<ul>
<li>Dereferencing raw pointers</li>
<li>Accessing or modifying mutable static variables</li>
<li>Implementing or calling functions with <code>unsafe</code> code</li>
<li>Implementing or calling FFI (Foreign Function Interface) functions</li>
</ul>
<p>When writing <code>unsafe</code> code in Rust, it’s important to follow the language’s strict rules for memory safety, such as ensuring that pointers are not null and not used after their allocated memory has been freed. Rust’s documentation provides guidelines and best practices for writing <code>unsafe</code> code safely.</p>
<p>Rust’s FFI
Rust’s Foreign Function Interface (FFI) provides a way to call functions written in other languages from Rust code and vice versa. This is particularly useful for integrating Rust code with existing C or C++ codebases.</p>
<p>Rust’s FFI is based on C’s ABI (Application Binary Interface), which means that Rust can call any function that has a C-compatible interface. Rust’s <code>extern</code> keyword is used to indicate that a function is being called from outside Rust.</p>
<p>To call a C function from Rust, you need to do the following:</p>
<ol>
<li>Declare the C function signature in your Rust code using the <code>extern</code> keyword.</li>
<li>Link to the C library that contains the function you want to call using Rust’s build system (e.g. Cargo).</li>
<li>Call the C function from Rust code.</li>
</ol>
<p>Here’s an example of calling the <code>strlen</code> function from the C standard library in Rust:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">extern</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"C"</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">strlen</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">: *</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">libc</span><span style="color: #ABB2BF">::</span><span style="color: #E06C75">c_char</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">libc</span><span style="color: #ABB2BF">::</span><span style="color: #E06C75">size_t</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"Hello, world!</span><span style="color: #56B6C2">\0</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">as_ptr</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> *</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">libc</span><span style="color: #ABB2BF">::</span><span style="color: #E06C75">c_char</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">len</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsafe</span><span style="color: #ABB2BF"> { </span><span style="color: #61AFEF">strlen</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">) };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Length of string: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">len</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we declare the <code>strlen</code> function using the <code>extern "C"</code> syntax, which tells Rust to use the C ABI. We then call <code>strlen</code> with an unsafe block, since Rust’s safety rules cannot guarantee that the pointer passed to <code>strlen</code> is valid.</p>
<p>Rust’s FFI also allows you to define Rust functions that can be called from C code. To do this, you need to declare the Rust function with the <code>#[no_mangle]</code> attribute, which prevents the Rust compiler from mangling the function name. You can then call the Rust function from C code using the C function name.</p>
<p>Here’s an example of defining a Rust function that can be called from C:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[no_mangle]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extern</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"C"</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF"> + </span><span style="color: #E06C75">b</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define an <code>add</code> function that takes two <code>i32</code> arguments and returns their sum. We mark the function with the <code>#[no_mangle]</code> attribute so that the Rust compiler doesn’t modify the function name. We also use the <code>pub</code> keyword to make the function accessible from outside the Rust module.</p>
<p>We can then call this function from C code using the following declaration:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">extern</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E06C75">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">printf</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Sum: %d</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we declare the <code>add</code> function using the C function signature and call it from a C program. The Rust function is compiled into a shared library that can be linked to the C program.</p>
<p>Rust’s procedural macros
Rust’s procedural macros allow for the generation of Rust code programmatically, which can be useful for reducing boilerplate code or adding custom syntax to Rust. Procedural macros are macros that are executed at compile time, and can transform the input code into new code that is then compiled.</p>
<p>There are three types of procedural macros in Rust:</p>
<ol>
<li>Attribute macros: These macros are applied to items, such as functions or structs, and allow you to add metadata or modify the item based on the attributes.</li>
<li>Function-like macros: These macros take an input token stream and return a token stream as output. They can be used to generate repetitive code, like creating multiple structs with similar fields.</li>
<li>Derive macros: These macros automatically generate code for traits, such as the <code>Debug</code> or <code>Clone</code> traits, based on the structure of the annotated data.</li>
</ol>
<p>Procedural macros are defined in their own crate and are imported into other crates as a library. To create a procedural macro, you need to define a function or struct with a specific attribute and signature. The input to the function or struct is a token stream that represents the input code, and the output is a token stream that represents the transformed code.</p>
<p>Procedural macros can be very powerful, but they can also be unsafe if they generate code that is not valid Rust code. It is important to test and verify the output of procedural macros to ensure that they are generating valid code.</p>
<p>Exercises</p>
<ol>
<li>Write an attribute macro that adds a <code>#[debug]</code> attribute to a function or struct, which prints out the name and value of each variable passed to the function or struct when it is called.</li>
<li>Write a function-like macro that generates a struct with <code>n</code> number of fields, where <code>n</code> is the input to the macro. The fields should be named <code>field_0</code>, <code>field_1</code>, <code>field_2</code>, and so on.</li>
<li>Write a derive macro that generates an implementation of the <code>FromStr</code> trait for a struct. The macro should generate code that parses a string and sets the struct fields based on the values in the string.</li>
<li>Write an attribute macro that adds a <code>#[memoize]</code> attribute to a function, which caches the result of the function for future calls with the same arguments.</li>
<li>Write a function-like macro that generates a series of getter and setter methods for a struct with the specified fields. The generated methods should follow the Rust convention of <code>get_&#x3C;field></code> and <code>set_&#x3C;field></code>.</li>
</ol>
<p>Solutions to exercises</p>
<ol>
<li>Here’s a possible implementation of the <code>debug</code> attribute macro:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[proc_macro_attribute]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">debug</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">_attr</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TokenStream</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TokenStream</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">TokenStream</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">item</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">parse_macro_input!</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Item</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">output</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">item</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Item</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Fn</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">ref</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">func</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">func_name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> &#x26;</span><span style="color: #E06C75">func</span><span style="color: #ABB2BF">.sig.ident;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">inputs</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> &#x26;</span><span style="color: #E06C75">func</span><span style="color: #ABB2BF">.sig.inputs;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">debug_statements</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">inputs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">input</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">FnArg</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Receiver</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">) => </span><span style="color: #61AFEF">quote!</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">FnArg</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Typed</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">pat_type</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pat</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pat_type</span><span style="color: #ABB2BF">.pat.</span><span style="color: #61AFEF">as_ref</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pat_str</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">quote!</span><span style="color: #ABB2BF"> { #</span><span style="color: #E06C75">pat</span><span style="color: #ABB2BF"> }.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ident</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pat_type</span><span style="color: #ABB2BF">.pat.</span><span style="color: #61AFEF">to_token_stream</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">quote!</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}: {:?}"</span><span style="color: #ABB2BF">, #</span><span style="color: #E06C75">pat_str</span><span style="color: #ABB2BF">, #</span><span style="color: #E06C75">ident</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> },</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">body</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> &#x26;</span><span style="color: #E06C75">func</span><span style="color: #ABB2BF">.block;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tokens</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">quote!</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> #[allow(unused)]</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> #</span><span style="color: #61AFEF">func_name</span><span style="color: #ABB2BF">(#</span><span style="color: #E06C75">inputs</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;(), </span><span style="color: #E5C07B">Box</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #C678DD">dyn</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">std</span><span style="color: #ABB2BF">::</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">>> {</span></span>
<span class="line"><span style="color: #ABB2BF"> #(#</span><span style="color: #E06C75">debug_statements</span><span style="color: #ABB2BF">)*</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> { #</span><span style="color: #E06C75">body</span><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{} returned {:?}"</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">stringify!</span><span style="color: #ABB2BF">(#</span><span style="color: #E06C75">func_name</span><span style="color: #ABB2BF">), </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(())</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tokens</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF"> },</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Item</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Struct</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">ref</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_struct</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">struct_name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> &#x26;</span><span style="color: #E06C75">_struct</span><span style="color: #ABB2BF">.ident;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_struct</span><span style="color: #ABB2BF">.fields {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Fields</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">Named</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">ref</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">) => &#x26;</span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">.named,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">_struct</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">span</span><span style="color: #ABB2BF">(), </span><span style="color: #98C379">"struct must have named fields"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">into_compile_error</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">debug_statements</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">field</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">field</span><span style="color: #ABB2BF">.ident.</span><span style="color: #61AFEF">as_ref</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">field_str</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">quote!</span><span style="color: #ABB2BF"> { #</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF"> }.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">quote!</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}: {:?}"</span><span style="color: #ABB2BF">, #</span><span style="color: #E06C75">field_str</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">.#</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tokens</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">quote!</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> #</span><span style="color: #E06C75">struct_name</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">debug</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF"> #(#</span><span style="color: #E06C75">debug_statements</span><span style="color: #ABB2BF">)*</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">tokens</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF"> },</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">item</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">span</span><span style="color: #ABB2BF">(), </span><span style="color: #98C379">"debug can only be applied to functions and structs"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">into_compile_error</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">into</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">output</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This macro can be used as follows:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[debug]</span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">foo</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> + </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">len</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">i32</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[debug]</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Bar</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">foo</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">42</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">"hello"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Bar</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">42</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"hello"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">() }.</span><span style="color: #61AFEF">debug</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This will print out:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">42</span></span>
<span class="line"><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"hello"</span></span>
<span class="line"><span style="color: #E06C75">foo</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">returned</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">47</span></span>
<span class="line"><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">42</span></span>
<span class="line"><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">"hello"</span></span></code></pre>
<p>Here’s a solution to the problem:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #61AFEF">macro_rules!</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">generate_struct</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    ($</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">expr</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            $(</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">field_</span><span style="color: #ABB2BF"> $</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">u32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            )*</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">($(</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E06C75">field_</span><span style="color: #ABB2BF"> $</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">u32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            )*) -> </span><span style="color: #E5C07B">Self</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    $(</span></span>
<span class="line"><span style="color: #ABB2BF">                        </span><span style="color: #E06C75">field_</span><span style="color: #ABB2BF"> $</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">                    )*</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Usage:</span></span>
<span class="line"><span style="color: #61AFEF">generate_struct!</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>Explanation:</p>
<p>The <code>generate_struct!</code> macro takes a single argument, <code>n</code>, which is the number of fields to generate. The macro uses Rust’s <code>struct</code> syntax to define a new struct with <code>n</code> number of fields, each named <code>field_0</code>, <code>field_1</code>, <code>field_2</code>, and so on. Note that the <code>$i</code> in <code>field_$i</code> is a special syntax in Rust macros that generates a unique identifier for each field based on the loop index.</p>
<p>The macro also defines an <code>impl</code> block for the struct that provides a <code>new</code> method to create instances of the struct. The <code>new</code> method takes <code>n</code> arguments, each corresponding to a field in the struct, and initializes the struct with those values.</p>
<p>To use the macro, simply call it with the desired number of fields as the argument. In the example above, we generate a struct with 5 fields and then create a new instance of the struct with values 1, 2, 3, 4, and 5 for the fields. Note that the macro can generate structs with any number of fields, not just 5.</p>
<ol start="3">
<li>Here’s a solution to the problem:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">str</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">FromStr</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Debug</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">field_0</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">field_1</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">field_2</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Debug</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">enum</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ParseError</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">InvalidFormat</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">InvalidField</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FromStr</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ParseError</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">from_str</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">str</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Self</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Self</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #E5C07B">str</span><span style="color: #ABB2BF">> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">','</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">collect</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">len</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ParseError</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">InvalidFormat</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">field_0</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">parse</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">map_err</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">_</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ParseError</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">InvalidField</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"field_0"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">()))?;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">field_1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">field_2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">parse</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">map_err</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">_</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ParseError</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">InvalidField</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"field_2"</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">()))?;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">field_0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">field_1</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">field_2</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        })</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">macro_rules!</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">impl_from_str</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    ($</span><span style="color: #E06C75">struct_name</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">ident</span><span style="color: #ABB2BF">, $($</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">ident</span><span style="color: #ABB2BF">: $</span><span style="color: #E06C75">field_type</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">ty</span><span style="color: #ABB2BF">),*) => {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FromStr</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> $</span><span style="color: #E06C75">struct_name</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ParseError</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">from_str</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">str</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Self</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Self</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;&#x26;</span><span style="color: #E5C07B">str</span><span style="color: #ABB2BF">> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">','</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">collect</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">len</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> $(&#x3C;$</span><span style="color: #E06C75">field_type</span><span style="color: #ABB2BF">>::</span><span style="color: #61AFEF">from_str</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">""</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">(),)* {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">ParseError</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">InvalidFormat</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">                $(</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> $</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">fields</span><span style="color: #ABB2BF">[$(</span><span style="color: #61AFEF">stringify!</span><span style="color: #ABB2BF">($</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">len</span><span style="color: #ABB2BF">()+</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)*$</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #ABB2BF">                        .</span><span style="color: #61AFEF">parse</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">                        .</span><span style="color: #61AFEF">map_err</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">_</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ParseError</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">InvalidField</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">stringify!</span><span style="color: #ABB2BF">($</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">()))?;</span></span>
<span class="line"><span style="color: #ABB2BF">                )*</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">($</span><span style="color: #E06C75">struct_name</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    $($</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF">,)*</span></span>
<span class="line"><span style="color: #ABB2BF">                })</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// Usage:</span></span>
<span class="line"><span style="color: #61AFEF">impl_from_str!</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">field_0</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">field_1</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">field_2</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_str</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"1,hello,3.14"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{:?}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>Explanation:</p>
<p>The <code>FromStr</code> trait provides a way to convert a string into a struct. To implement this trait for a struct, we need to parse the string and set the struct fields based on the values in the string.</p>
<p>The <code>MyStruct</code> example struct above has three fields of different types. We define an <code>impl FromStr</code> block for this struct that parses a string of the form “x,y,z” and sets the struct fields to the values of x, y, and z, respectively.</p>
<p>We define an <code>enum ParseError</code> to represent errors that can occur during parsing. The <code>from_str</code> method splits the input string into fields using the <code>split</code> method, and then uses the <code>parse</code> method of the <code>FromStr</code> trait to parse each field into the appropriate type.</p>
<p>We then define a <code>impl_from_str!</code> macro that takes the name of the struct and a list of its fields and types as arguments. The macro generates an implementation of the <code>FromStr</code> trait for the struct by parsing the input string and setting the struct fields to the parsed values.</p>
<p>In the macro, we use the <code>stringify!</code> macro to convert the field names and types into strings that we can use to generate error messages. We also use the <code>$(...)*</code> syntax to generate code for each field in the struct.</p>
<p>To use the macro, we simply call it with the name of the struct and a list of its fields and types as arguments. In the example above, we use the macro to generate an implementation of the <code>FromStr</code> trait for <code>MyStruct</code>, and then use it to parse a string and create a new instance of the struct.</p>
<ol start="4">
<li>Write an attribute macro that adds a <code>#[memoize]</code> attribute to a function, which caches the result of the function for future calls with the same arguments.</li>
</ol>
<p>Solution:</p>
<p>To solve this problem, we will define an attribute macro that can be used to mark a function with the <code>#[memoize]</code> attribute. When the function is called, the macro will check if the arguments have been seen before and if so, return the cached result. If the arguments are new, the macro will call the function to compute the result and cache it for future use.</p>
<p>Here is the solution:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">collections</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[macro_export]</span></span>
<span class="line"><span style="color: #61AFEF">macro_rules!</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">memoize</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    ($</span><span style="color: #E06C75">fn</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">ident</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">memoize!</span><span style="color: #ABB2BF">($</span><span style="color: #E06C75">fn</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">    ($</span><span style="color: #E06C75">fn</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">ident</span><span style="color: #ABB2BF">, $</span><span style="color: #E06C75">cache</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">expr</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF">        #[allow(unused_variables)]</span></span>
<span class="line"><span style="color: #ABB2BF">        #[allow(unused_mut)]</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> $</span><span style="color: #E06C75">fn</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">hash</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Hash</span><span style="color: #ABB2BF"> + </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">cmp</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Eq</span><span style="color: #ABB2BF"> + </span><span style="color: #E5C07B">Clone</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Clone</span><span style="color: #ABB2BF">>(</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            $($</span><span style="color: #E06C75">arg</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">expr</span><span style="color: #ABB2BF">),*</span></span>
<span class="line"><span style="color: #ABB2BF">        ) -> </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">cache</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> $</span><span style="color: #E06C75">cache</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">(), $( $</span><span style="color: #E06C75">arg</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">() ),*);</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">cache</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">contains_key</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">cache</span><span style="color: #ABB2BF">[&#x26;</span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> $</span><span style="color: #E06C75">fn</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">args</span><span style="color: #ABB2BF">, $( $</span><span style="color: #E06C75">arg</span><span style="color: #ABB2BF"> ),*);</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">cache</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">insert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">clone</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E06C75">result</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Explanation:</p>
<p>The <code>memoize!</code> macro is defined with two variants. The first variant takes only the name of the function to memoize, while the second variant takes an additional argument which is the cache to use.</p>
<p>The macro defines a new function with the same name as the original function, but with an additional argument <code>args</code> which is used as the key in the cache. The macro also takes a variable number of arguments which correspond to the arguments of the original function.</p>
<p>The macro then checks if the cache contains the result for the given arguments. If it does, the cached result is returned. Otherwise, the original function is called with the arguments and the result is cached for future use.</p>
<p>To use the <code>memoize!</code> macro, simply add <code>#[memoize]</code> attribute to the function that you want to memoize. The macro will automatically create a new function with the same name that caches the result of the function for future calls with the same arguments.</p>
<p>Here is an example usage of the macro:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[memoize]</span></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fibonacci</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">u32</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">u64</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> => </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> => </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">_</span><span style="color: #ABB2BF"> => </span><span style="color: #61AFEF">fibonacci</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) + </span><span style="color: #61AFEF">fibonacci</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF">-</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">fibonacci</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50</span><span style="color: #ABB2BF">));</span><span style="color: #7F848E; font-style: italic"> // This will be slow</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">fibonacci</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">50</span><span style="color: #ABB2BF">));</span><span style="color: #7F848E; font-style: italic"> // This will be fast</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use the <code>memoize!</code> macro to memoize the <code>fibonacci</code> function. The first call to <code>fibonacci(50)</code> will be slow, but subsequent calls will be fast because the result is cached.</p>
<ol start="5">
<li>Problem 5: Write a function-like macro that generates a series of getter and setter methods for a struct with the specified fields. The generated methods should follow the Rust convention of <code>get_&#x3C;field></code> and <code>set_&#x3C;field></code>.</li>
</ol>
<p>Solution:</p>
<p>To solve this problem, we will define a function-like macro that generates a series of getter and setter methods for a struct with the specified fields. The macro will take the name of the struct and a list of its fields as arguments, and generate a getter and setter method for each field.</p>
<p>Here is the solution:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #61AFEF">macro_rules!</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">gen_getters_setters</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    ($</span><span style="color: #E06C75">struct_name</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">ident</span><span style="color: #ABB2BF">, $($</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF">:</span><span style="color: #E06C75">ident</span><span style="color: #ABB2BF">),*) => {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> $</span><span style="color: #E06C75">struct_name</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            $(</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">get_</span><span style="color: #ABB2BF">$</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">) -> &#x26;&#x3C;$</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">default</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">>::</span><span style="color: #E06C75">default</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">                    &#x26;</span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">.$</span><span style="color: #E06C75">field_name</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">set_</span><span style="color: #ABB2BF">$</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">, $</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF">: &#x3C;$</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">default</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Default</span><span style="color: #ABB2BF">>::</span><span style="color: #E06C75">default</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">                    </span><span style="color: #E5C07B">self</span><span style="color: #ABB2BF">.$</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> $</span><span style="color: #E06C75">field_name</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                }</span></span>
<span class="line"><span style="color: #ABB2BF">            )*</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Explanation:</p>
<p>The <code>gen_getters_setters!</code> macro takes the name of the struct and a list of its fields as arguments. For each field, the macro generates a getter and setter method with the appropriate name (<code>get_&#x3C;field></code> and <code>set_&#x3C;field></code>).</p>
<p>The macro uses the <code>impl</code> block to define the methods on the struct. Each method has the same name as the field, with either <code>get_</code> or <code>set_</code> added to the beginning.</p>
<p>The getter method returns a reference to the value of the field, while the setter method takes a new value for the field and sets it.</p>
<p>To use the <code>gen_getters_setters!</code> macro, simply call it with the name of the struct and a list of its fields as arguments. The macro will automatically generate the getter and setter methods for each field.</p>
<p>Here is an example usage of the macro:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">field_1</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">field_2</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">field_3</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">gen_getters_setters!</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">field_1</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">field_2</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">field_3</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyStruct</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">field_1</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">42</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">field_2</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"hello"</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">field_3</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">3.14</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">assert_eq!</span><span style="color: #ABB2BF">(*</span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_field_1</span><span style="color: #ABB2BF">(), </span><span style="color: #D19A66">42</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">assert_eq!</span><span style="color: #ABB2BF">(*</span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_field_2</span><span style="color: #ABB2BF">(), </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"hello"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">assert_eq!</span><span style="color: #ABB2BF">(*</span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_field_3</span><span style="color: #ABB2BF">(), </span><span style="color: #D19A66">3.14</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_field_1</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">123</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_field_2</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"world"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set_field_3</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2.71</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">assert_eq!</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF">.field_1, </span><span style="color: #D19A66">123</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">assert_eq!</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF">.field_2, </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"world"</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">assert_eq!</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">my_struct</span><span style="color: #ABB2BF">.field_3, </span><span style="color: #D19A66">2.71</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define a struct <code>MyStruct</code> with three fields. We then use the <code>gen_getters_setters!</code> macro to generate getter and setter methods for each field. We can then use these methods to get and set the values of the fields.</p>
<h1 id="chapter-8-rusts-web-development">Chapter 8: Rust’s Web Development</h1>
<p>Rust’s web frameworks
Rust has several web frameworks to choose from. Some popular ones include:</p>
<ol>
<li>Actix: A high-performance, actor-based web framework that uses Rust’s asynchronous capabilities to handle many concurrent connections efficiently.</li>
<li>Rocket: A simple and fast web framework that emphasizes type safety and is easy to use.</li>
<li>Warp: A fast and flexible web framework that uses Rust’s asynchronous capabilities to handle many concurrent connections efficiently.</li>
<li>Tide: A web framework that is designed to be simple, expressive, and fast, and that is built on top of Rust’s asynchronous capabilities.</li>
<li>Nickel: A simple and lightweight web framework that is easy to learn and use, and that provides a good balance between performance and ease of use.</li>
</ol>
<p>These frameworks provide a range of features, so you should choose the one that best fits your needs. For example, if you need a framework that can handle a large number of concurrent connections, Actix or Warp may be a good choice. If you need a simple and easy-to-use framework, Rocket or Tide may be a better fit.</p>
<p>It’s worth noting that Rust’s static typing and memory safety make it well-suited for web development, particularly for server-side applications. Rust’s performance also makes it a good choice for web applications that need to handle a high volume of traffic or process large amounts of data.</p>
<p>Rust’s web servers
Rust has several web servers that you can use to deploy your web applications. Some popular ones include:</p>
<ol>
<li>Hyper: A fast and asynchronous HTTP server that is built on top of Rust’s Tokio library, which allows it to handle many concurrent connections efficiently.</li>
<li>Warp: A web server that is designed to be fast and flexible, and that is built on top of Rust’s asynchronous capabilities. Warp is particularly well-suited for building RESTful APIs.</li>
<li>Actix-web: A web server that is built on top of Actix, which is a high-performance actor system for Rust. Actix-web is well-suited for building scalable and high-performance web applications.</li>
<li>Rocket: A web server that is designed to be simple and easy to use, and that emphasizes type safety. Rocket is a good choice if you’re looking for a web server that is easy to learn and use.</li>
<li>Iron: A web server that is designed to be flexible and modular, and that allows you to plug in middleware to customize the server’s behavior.</li>
</ol>
<p>These web servers provide a range of features, so you should choose the one that best fits your needs. For example, if you need a server that can handle a large number of concurrent connections, Hyper or Actix-web may be a good choice. If you need a simple and easy-to-use server, Rocket may be a better fit.</p>
<p>It’s worth noting that Rust’s static typing and memory safety make it well-suited for building web servers that are secure and reliable. Rust’s performance also makes it a good choice for web servers that need to handle a high volume of traffic or process large amounts of data.</p>
<p>Rust’s web clients
Rust has multiple libraries for creating web clients. One of the most popular libraries is reqwest. Here’s an example of how to use reqwest to make an HTTP GET request:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">reqwest</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">: &#x26;</span><span style="color: #E5C07B">str</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">response</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">reqwest</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">).</span><span style="color: #C678DD">await</span><span style="color: #ABB2BF">?.</span><span style="color: #61AFEF">text</span><span style="color: #ABB2BF">().</span><span style="color: #C678DD">await</span><span style="color: #ABB2BF">?;</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">response</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we define an asynchronous function called <code>get</code> that takes a URL string as a parameter and returns a <code>Result</code> containing a string or a <code>reqwest::Error</code>. The function uses <code>reqwest::get</code> to make an HTTP GET request to the specified URL and waits for the response. If the request is successful, the response is returned as a string wrapped in a <code>Result::Ok</code>. If the request fails, a <code>reqwest::Error</code> is returned wrapped in a <code>Result::Err</code>.</p>
<p>Here’s an example of how to use the <code>get</code> function to fetch the contents of a web page:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[tokio::main]</span></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"https://www.example.com"</span><span style="color: #ABB2BF">).</span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">response</span><span style="color: #ABB2BF">) => </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">response</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">e</span><span style="color: #ABB2BF">) => </span><span style="color: #61AFEF">eprintln!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Error: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">e</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this example, we use <code>tokio::main</code> to run the <code>main</code> function asynchronously. The <code>main</code> function calls the <code>get</code> function with a URL string as a parameter and uses pattern matching to handle the <code>Result</code>. If the <code>Result</code> is <code>Ok</code>, the response is printed to the console. If the <code>Result</code> is <code>Err</code>, an error message is printed to the console.</p>
<p>Rust’s web assembly
WebAssembly (often abbreviated as wasm) is a low-level bytecode format that can be used to run code on the web. Rust can be compiled to wasm, making it a popular language for developing web applications.</p>
<p>One of the key advantages of using Rust to write wasm modules is that Rust’s ownership and borrowing model provides strong guarantees of memory safety. This can be a significant advantage over writing JavaScript or other dynamically-typed languages, which can be more error-prone.</p>
<p>Rust also provides excellent tooling for working with WebAssembly. The <code>wasm-pack</code> tool can be used to package Rust code as a wasm module and generate the necessary JavaScript glue code to integrate it with a web application. The <code>wasm-bindgen</code> crate provides a convenient way to generate JavaScript bindings to Rust functions and data structures, making it easy to call Rust code from JavaScript.</p>
<p>Additionally, Rust’s performance and efficient memory management make it a good choice for computationally-intensive tasks such as audio processing, machine learning, and scientific simulations, which can be run in the browser using WebAssembly.</p>
<p>Exercises
Here are some exercises related to Rust’s WebAssembly capabilities:</p>
<ol>
<li>Write a Rust function that takes two <code>i32</code> arguments and returns their sum. Compile it to WebAssembly using <code>wasm-pack</code>, and test it by calling it from a JavaScript function.</li>
<li>Write a Rust function that takes a string argument and returns its length as an <code>i32</code>. Compile it to WebAssembly using <code>wasm-pack</code>, and test it by calling it from a JavaScript function.</li>
<li>Write a Rust function that takes a vector of <code>i32</code> values and returns their sum. Compile it to WebAssembly using <code>wasm-pack</code>, and test it by calling it from a JavaScript function.</li>
<li>Write a Rust function that calculates the factorial of a given integer. Compile it to WebAssembly using <code>wasm-pack</code>, and test it by calling it from a JavaScript function.</li>
<li>Write a Rust function that takes two <code>f64</code> arguments representing the sides of a right-angled triangle, and returns the length of the hypotenuse. Compile it to WebAssembly using <code>wasm-pack</code>, and test it by calling it from a JavaScript function.</li>
</ol>
<p>Note: In order to test the compiled WebAssembly code, you will need to write JavaScript functions to load the module and call its exported functions using the <code>WebAssembly.instantiateStreaming()</code> and <code>module.exports</code> APIs.</p>
<h2 id="solutions">Solutions</h2>
<ol>
<li>Rust function that takes two <code>i32</code> arguments and returns their sum:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[no_mangle]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF"> + </span><span style="color: #E06C75">b</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>To compile this to WebAssembly using <code>wasm-pack</code>, you can use the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">wasm-pack build --target web</span></span></code></pre>
<p>Then, you can test it by calling it from a JavaScript function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">wasm</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"my-package"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">wasm</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">)); </span><span style="color: #7F848E; font-style: italic">// Output: 5</span></span></code></pre>
<ol start="2">
<li>Rust function that takes a string argument and returns its length as an <code>i32</code>:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">os</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">raw</span><span style="color: #ABB2BF">::c_char;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ffi</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">CString</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[no_mangle]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get_string_length</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input_ptr</span><span style="color: #ABB2BF">: *</span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">c_char</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input_cstring</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsafe</span><span style="color: #ABB2BF"> { </span><span style="color: #E5C07B">CString</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_raw</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input_ptr</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> *</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">c_char</span><span style="color: #ABB2BF">) };</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input_str</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input_cstring</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_str</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">input_str</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">len</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">i32</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we need to use <code>std::ffi::CString</code> to convert the input string pointer to a Rust string, and then use the <code>len()</code> method to get its length.</p>
<p>To compile this to WebAssembly using <code>wasm-pack</code>, you can use the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">wasm-pack build --target web</span></span></code></pre>
<p>Then, you can test it by calling it from a JavaScript function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">wasm</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"my-package"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">input_str_ptr</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">wasm</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">allocCString</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Hello, world!"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">wasm</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get_string_length</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input_str_ptr</span><span style="color: #ABB2BF">)); </span><span style="color: #7F848E; font-style: italic">// Output: 13</span></span>
<span class="line"><span style="color: #E5C07B">wasm</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">freeCString</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input_str_ptr</span><span style="color: #ABB2BF">);</span></span></code></pre>
<p>In this example, we are using the <code>allocCString</code> and <code>freeCString</code> functions provided by the <code>wasm_bindgen</code> package to allocate and free the memory for the input string.</p>
<ol start="3">
<li>Rust function that takes a vector of <code>i32</code> values and returns their sum:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[no_mangle]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sum_numbers</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">numbers</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">>) -> </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">numbers</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">sum</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we are using the <code>sum()</code> method provided by Rust’s standard library to calculate the sum of the numbers.</p>
<p>To compile this to WebAssembly using <code>wasm-pack</code>, you can use the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">wasm-pack build --target web</span></span></code></pre>
<p>Then, you can test it by calling it from a JavaScript function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">wasm</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"my-package"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">numbers</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">wasm</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">sum_numbers</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">numbers</span><span style="color: #ABB2BF">)); </span><span style="color: #7F848E; font-style: italic">// Output: 15</span></span></code></pre>
<ol start="4">
<li>Rust function that calculates the factorial of a given integer:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[no_mangle]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">factorial</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&#x3C;=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #D19A66">1</span></span>
<span class="line"><span style="color: #ABB2BF">    } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> * </span><span style="color: #61AFEF">factorial</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> - </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we are using a recursive function to calculate the factorial of the given integer.</p>
<p>To compile this to WebAssembly using <code>wasm-pack</code>, you can use the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">wasm-pack build --target web</span></span></code></pre>
<p>Then, you can test it by calling it from a JavaScript function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">wasm</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"my-package"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">wasm</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">factorial</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">)); </span><span style="color: #7F848E; font-style: italic">// Output: 120</span></span></code></pre>
<ol start="5">
<li>Rust function that takes two <code>f64</code> arguments representing the sides of a right-angled triangle, and returns the length of the hypotenuse:</li>
</ol>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#[no_mangle]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">hypotenuse</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    (</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">powi</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">) + </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">powi</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">)).</span><span style="color: #61AFEF">sqrt</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, we are using the <code>powi()</code> method to calculate the square of each side, and then the <code>sqrt()</code> method to get the square root of their sum.</p>
<p>To compile this to WebAssembly using <code>wasm-pack</code>, you can use the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">wasm-pack build --target web</span></span></code></pre>
<p>Then, you can test it by calling it from a JavaScript function:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">*</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">wasm</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"my-package"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">wasm</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">hypotenuse</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">)); </span><span style="color: #7F848E; font-style: italic">// Output: 5</span></span></code></pre>
<h1 id="chapter-9-rusts-systems-programming">Chapter 9: Rust’s Systems Programming</h1>
<p>Rust’s systems programming
Rust is designed to be a systems programming language, with a focus on safety, performance, and concurrency. It offers a variety of low-level features that make it suitable for building high-performance systems software.</p>
<p>Some of the key features of Rust that make it a good fit for systems programming include:</p>
<ul>
<li>Memory safety: Rust’s ownership model and borrow checker ensure that memory safety is guaranteed at compile time, which makes it possible to write high-performance systems software without the risk of memory-related errors such as null pointer dereferences, buffer overflows, or use-after-free errors.</li>
<li>Low-level control: Rust provides fine-grained control over low-level details such as memory layout and allocation, thread synchronization, and CPU instructions, which makes it possible to optimize performance-critical code.</li>
<li>Cross-platform support: Rust is designed to be portable and can be compiled for a wide range of platforms, including Windows, macOS, Linux, and many embedded systems.</li>
<li>C and C++ interoperability: Rust can interoperate with C and C++ code, making it possible to integrate Rust code into existing systems or to use existing C and C++ libraries from Rust.</li>
<li>Concurrency: Rust provides powerful concurrency abstractions such as threads, channels, and futures, which make it easy to write scalable and performant systems software that can take advantage of modern multicore hardware.</li>
</ul>
<p>Some examples of systems software that can be written in Rust include operating systems, device drivers, network stacks, web servers, and embedded systems.</p>
<p>Rust’s low-level programming
Rust’s low-level programming involves the use of unsafe Rust code, which allows for direct manipulation of memory and low-level system operations. This is typically necessary when working on operating systems, embedded systems, or performance-critical applications where the overhead of safe abstractions would be prohibitive. Rust’s focus on memory safety and control makes it well-suited for these kinds of low-level programming tasks.</p>
<p>When working with unsafe Rust code, programmers take on the responsibility of ensuring that their code is correct and safe. They must manually manage memory allocation and deallocation, avoid data races, and prevent undefined behavior. Rust provides a number of constructs to help manage these tasks, such as raw pointers, unsafe blocks, and the ability to create custom unsafe abstractions.</p>
<p>While working with unsafe Rust code can be challenging, it also offers the potential for significant performance gains and low-level control over system resources. Rust’s safety guarantees ensure that low-level programming can be done with minimal risk of memory safety errors or undefined behavior, making it a compelling choice for these kinds of tasks.</p>
<p>Rust’s system calls
System calls in Rust are made using the <code>libc</code> crate, which provides a low-level interface to the underlying operating system. The <code>libc</code> crate defines a set of functions that mirror the standard C library functions, and can be used to interact with the operating system.</p>
<p>Here is an example of how to use the <code>libc</code> crate to call the <code>getpid</code> system call:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">libc</span><span style="color: #ABB2BF">::{getpid};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">pid</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsafe</span><span style="color: #ABB2BF"> { </span><span style="color: #61AFEF">getpid</span><span style="color: #ABB2BF">() };</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"My process ID is {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">pid</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Note that system calls are unsafe operations, as they can have side effects that are not captured by the Rust type system. Therefore, calling a system call requires an <code>unsafe</code> block, as shown in the example above.</p>
<p>In addition to the <code>libc</code> crate, Rust provides a <code>std::fs::File</code> type that can be used to interact with files at a low level, and a <code>std::net</code> module that provides low-level networking primitives. These can be used to build systems-level applications that interact directly with the operating system.</p>
<p>Rust’s memory management
Rust’s memory management revolves around its ownership and borrowing system, which helps prevent memory-related bugs like null pointers, data races, and buffer overflows at compile-time.</p>
<p>In Rust, memory allocation and deallocation are done using the <code>std::alloc</code> module. Rust provides low-level interfaces for interacting with memory, such as raw pointers, slices, and unsafe code, allowing for full control over memory management.</p>
<p>Rust also provides smart pointers, like <code>Box</code>, <code>Rc</code>, and <code>Arc</code>, which can help manage memory ownership and deallocation. <code>Box</code> allocates memory on the heap and owns it, allowing for fine-grained control over memory allocation and deallocation. <code>Rc</code> and <code>Arc</code> are reference-counted pointers that allow multiple owners of the same data.</p>
<p>In addition to these, Rust has a powerful mechanism for managing lifetimes, which determines when memory can be freed, preventing dangling pointers and use-after-free bugs.</p>
<p>Overall, Rust’s memory management allows for fast, safe, and predictable performance, making it ideal for systems programming and other performance-critical applications.</p>
<h2 id="sample-code-and-explainations">Sample Code and Explainations</h2>
<h2 id="getting-started-with-rust-macros">Getting Started With Rust Macros</h2>
<p>Macros are a powerful feature of Rust that allow developers to write code that generates other code. They are a way to write code that can be used to generate repetitive or boilerplate code, making it easier to write and maintain complex applications. Rust’s macros are known as procedural macros, which means they operate on the abstract syntax tree (AST) of the code and generate new code based on it.</p>
<p>To demonstrate the usage of Rust’s macros, we will build a custom assert macro that prints out the values being compared if the assertion fails. This will help us understand how macros work and how they can be used to simplify our code.</p>
<p>Let’s start by creating a new Rust project using Cargo, Rust’s package manager. Open a terminal and run the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">cargo</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">new</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">assert</span><span style="color: #ABB2BF">-</span><span style="color: #E06C75">demo</span></span></code></pre>
<p>This will create a new Rust project named <code>assert-demo</code>. Now, navigate to the project directory by running:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">cd</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">assert</span><span style="color: #ABB2BF">-</span><span style="color: #E06C75">demo</span></span></code></pre>
<p>Next, open the <code>Cargo.toml</code> file and add the following dependencies:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">[</span><span style="color: #E06C75">dependencies</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #E06C75">syn</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"1.0"</span></span>
<span class="line"><span style="color: #E06C75">quote</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"1.0"</span></span></code></pre>
<p>These dependencies are required for building procedural macros. The <code>syn</code> crate provides a parser for Rust’s syntax, while the <code>quote</code> crate allows us to generate new Rust code.</p>
<p>Now, let’s create a new file named <code>src/lib.rs</code> and add the following code:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">extern</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">crate</span><span style="color: #ABB2BF"> proc_macro;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">proc_macro</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">TokenStream</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">quote</span><span style="color: #ABB2BF">::quote;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::{parse_macro_input, </span><span style="color: #E5C07B">Expr</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[proc_macro]</span></span>
<span class="line"><span style="color: #C678DD">pub</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">assert_equals</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">TokenStream</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">TokenStream</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">exprs</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">parse_macro_input!</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">syn</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ExprBinary</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">left</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">exprs</span><span style="color: #ABB2BF">.left;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">right</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">exprs</span><span style="color: #ABB2BF">.right;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">expanded</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">quote!</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!</span><span style="color: #ABB2BF">(#</span><span style="color: #E06C75">left</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> #</span><span style="color: #E06C75">right</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #61AFEF">panic!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"assertion failed: {} != {}"</span><span style="color: #ABB2BF">, #</span><span style="color: #E06C75">left</span><span style="color: #ABB2BF">, #</span><span style="color: #E06C75">right</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">TokenStream</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">expanded</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Let’s go through this code step by step. First, we import the <code>proc_macro</code> module, which allows us to define procedural macros. We also import the <code>quote</code> and <code>syn</code> crates, which we added as dependencies earlier.</p>
<p>Next, we define a new procedural macro named <code>assert_equals</code>. This macro takes an expression as input, which should be a binary expression like <code>assert_equals!(a + b, c)</code>. We use the <code>parse_macro_input</code> macro from the <code>syn</code> crate to parse the input expression into an <code>ExprBinary</code> object.</p>
<p>We then extract the left and right expressions from the <code>ExprBinary</code> object using the <code>left</code> and <code>right</code> fields.</p>
<p>Finally, we use the <code>quote</code> macro to generate new Rust code. We construct an <code>if</code> statement that checks whether the left and right expressions are equal. If they are not, we panic with a message indicating that the assertion failed and print out the values of the left and right expressions.</p>
<p>Now that we’ve defined our macro, let’s use it in our main program. Open the <code>src/main.rs</code> file and add the following code:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">assert_equals!</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code defines two variables, <code>a</code> and <code>b</code>, and then uses our <code>assert_equals</code> macro to assert that they are equal. Since <code>a</code> and <code>b</code> are not equal, the assertion will fail and our macro will print out the values of <code>a</code> and <code>b</code>.</p>
<p>To run the program, use the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">cargo run</span></span></code></pre>
<p>You should see the following output:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">thread</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">'main'</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">panicked</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">at</span><span style="color: #ABB2BF"> '</span><span style="color: #E5C07B">assertion</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">failed</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #98C379">', src/main.rs:4:5</span></span></code></pre>
<p>This output indicates that the assertion failed and that the values of <code>a</code> and <code>b</code> are 1 and 2, respectively.</p>
<p>In conclusion, Rust’s macros are a powerful feature that enable developers to write expressive and efficient code. In this article, we built a custom assert macro that prints out the values being compared if the assertion fails. We learned how to define procedural macros, parse input expressions using the <code>syn</code> crate, and generate new Rust code using the <code>quote</code> crate. By using macros, we can simplify our code and improve its readability and maintainability.</p>
<h2 id="getting-started-with-io-in-rust">Getting Started With IO in Rust</h2>
<h1 id="rusts-io-reading-and-manipulating-csv-data">Rust’s I/O: Reading and Manipulating CSV Data</h1>
<p>Rust is a systems programming language that focuses on safety, performance, and concurrency. It provides excellent support for working with files and handling I/O operations. In this article, we’ll explore how to build a program in Rust that reads in a CSV file, performs operations such as sorting and filtering on the data, and writes the results to a new file.</p>
<h2 id="introducing-csv-in-rust">Introducing CSV in Rust</h2>
<p>To work with CSV files in Rust, we’ll use the <code>csv</code> crate, which provides a fast and flexible interface for reading and writing CSV data. In addition, we’ll use the <code>serde</code> crate for deserializing the CSV data into Rust structs. To include these crates in your project, add them to your <code>Cargo.toml</code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">[</span><span style="color: #61AFEF">dependencies</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #E06C75">csv</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"1.1"</span></span>
<span class="line"><span style="color: #E06C75">serde</span><span style="color: #ABB2BF"> = { </span><span style="color: #E06C75">version</span><span style="color: #ABB2BF"> = </span><span style="color: #98C379">"1.0"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">features</span><span style="color: #ABB2BF"> = [</span><span style="color: #98C379">"derive"</span><span style="color: #ABB2BF">] }</span></span></code></pre>
<h2 id="the-csv-data">The CSV Data</h2>
<p>For this example, let’s assume that we have a CSV file named <code>data.csv</code> with the following content:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">id,name,age</span></span>
<span class="line"><span style="color: #abb2bf">1,Alice,30</span></span>
<span class="line"><span style="color: #abb2bf">2,Bob,25</span></span>
<span class="line"><span style="color: #abb2bf">3,Carol,27</span></span>
<span class="line"><span style="color: #abb2bf">4,David,22</span></span>
<span class="line"><span style="color: #abb2bf">5,Eve,35</span></span></code></pre>
<p>We’ll build a Rust program that reads this CSV file, filters the records based on a given age threshold, sorts the results by the age column, and writes the output to a new CSV file.</p>
<h2 id="defining-the-data-structure">Defining the Data Structure</h2>
<p>First, we need to define a struct to represent the data in our CSV file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">serde</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Deserialize</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Debug</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">Deserialize</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">u32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">age</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">u32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">impl</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">from_record</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">record</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">csv</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">StringRecord</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Self</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">csv</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">person</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">record</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">deserialize</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">None</span><span style="color: #ABB2BF">)?;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">person</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>In this code, we define a <code>Person</code> struct with fields for <code>id</code>, <code>name</code>, and <code>age</code>. We derive the <code>Deserialize</code> trait from the <code>serde</code> crate, which allows us to deserialize CSV records directly into <code>Person</code> instances.</p>
<h2 id="reading-the-csv-file">Reading the CSV File</h2>
<p>Next, let’s create a function to read the CSV file and return a <code>Vec&#x3C;Person></code>:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Path</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">read_csv</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">P</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">AsRef</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Path</span><span style="color: #ABB2BF">>>(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">P</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">>, </span><span style="color: #E5C07B">Box</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #C678DD">dyn</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">>> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">)?;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">csv</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Reader</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_reader</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">persons</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">records</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">record</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">?;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">person</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_record</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">record</span><span style="color: #ABB2BF">)?;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">persons</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">person</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">persons</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This function opens the given file, creates a <code>csv::Reader</code> to read the contents, and iterates over the records to deserialize them into <code>Person</code> instances. The function returns a <code>Result&#x3C;Vec&#x3C;Person>, Box&#x3C;dyn Error>></code>, allowing the caller to handle any errors that may occur.</p>
<h2 id="sorting-and-filtering-the-data">Sorting and Filtering the Data</h2>
<p>Now that we can read the CSV data into a <code>Vec&#x3C;Person></code>, we can implement the sorting and filtering operations. Let’s define a function that takes a slice of <code>Person</code>, an age threshold, and returns a new, sorted <code>Vec&#x3C;Person></code> that only includes people older than the given age:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">filter_and_sort</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">persons</span><span style="color: #ABB2BF">: &#x26;[</span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">], </span><span style="color: #E06C75">age_threshold</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">u32</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">filtered_persons</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">persons</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">filter</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">person</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">person</span><span style="color: #ABB2BF">.age </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">age_threshold</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">cloned</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">collect</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">filtered_persons</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">sort_by_key</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">|</span><span style="color: #E06C75">person</span><span style="color: #56B6C2">|</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">person</span><span style="color: #ABB2BF">.age);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">filtered_persons</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This function uses Rust’s iterator methods to filter and sort the data. The <code>filter</code> method removes any <code>Person</code> with an age less than or equal to the age threshold, and the <code>sort_by_key</code> method sorts the remaining records by age.</p>
<h2 id="writing-the-output-csv">Writing the Output CSV</h2>
<p>Finally, let’s create a function to write the filtered and sorted data to a new CSV file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Write</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">write_csv</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">P</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">AsRef</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #E5C07B">Path</span><span style="color: #ABB2BF">>>(</span><span style="color: #E06C75">persons</span><span style="color: #ABB2BF">: &#x26;[</span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">], </span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">P</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;(), </span><span style="color: #E5C07B">Box</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #C678DD">dyn</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">>> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">create</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">)?;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">writer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">csv</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Writer</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">from_writer</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">person</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">persons</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">writer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">serialize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">person</span><span style="color: #ABB2BF">)?;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">writer</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">flush</span><span style="color: #ABB2BF">()?;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(())</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This function creates a new CSV file, initializes a <code>csv::Writer</code>, and serializes the <code>Person</code> instances to the writer. It then flushes the writer to ensure that all data is written to disk.</p>
<h2 id="bringing-it-all-together">Bringing It All Together</h2>
<p>With all the necessary functions defined, we can now bring everything together in a main function to read in the CSV data, filter and sort it, and write the output to a new file:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">path</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">Path</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[derive(</span><span style="color: #E5C07B">Debug</span><span style="color: #ABB2BF">, serde::</span><span style="color: #E5C07B">Deserialize</span><span style="color: #ABB2BF">, serde::</span><span style="color: #E5C07B">Serialize</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">struct</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">age</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">u32</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() -> </span><span style="color: #E5C07B">Result</span><span style="color: #ABB2BF">&#x3C;(), </span><span style="color: #E5C07B">Box</span><span style="color: #ABB2BF">&#x3C;</span><span style="color: #C678DD">dyn</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">>> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"input.csv"</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">age_threshold</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">30</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">persons</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">read_csv</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">filename</span><span style="color: #ABB2BF">)?;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">filtered_persons</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">filter_and_sort</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">persons</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">age_threshold</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">write_csv</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #E06C75">filtered_persons</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">"output.csv"</span><span style="color: #ABB2BF">)?;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(())</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This main function reads in the input CSV file, filters and sorts the data using the filter_and_sort function, and writes the output to a new CSV file using the write_csv function. It uses Rust’s error handling mechanisms to propagate any errors that occur during the execution of the program.</p>
<h2 id="dyanmically-linking-in-rust">Dyanmically Linking In Rust</h2>
<p>Dynamic Linking in Rust’s FFI: Understanding the Essentials</p>
<p>Rust’s Foreign function Interface (FFI) allows Rust code to call functions defined in other programming languages, such as C or C++. One of the key features of Rust’s FFI is dynamic linking, which enables Rust to call functions from shared libraries at runtime.</p>
<p>What is Dynamic Linking?</p>
<p>Dynamic linking is a process of linking an executable program with a shared library or DLL (Dynamic Link Library) at runtime, instead of statically linking the library at compile time. In other words, dynamic linking allows the program to access functions and data in the shared library only when it is needed, rather than including the entire library in the program’s executable file.</p>
<p>Dynamic linking has several advantages over static linking, such as smaller executable size, efficient memory usage, and easier maintenance of the shared library. It also allows multiple programs to share the same library in memory, reducing the overall memory usage of the system.</p>
<p>How Dynamic Linking Works in Rust’s FFI?</p>
<p>Rust’s FFI relies on dynamic linking to call functions from shared libraries, such as C or C++ libraries. The process of dynamic linking in Rust’s FFI can be summarized in the following steps:</p>
<p>Step 1: Defining the External function</p>
<p>The first step in using dynamic linking in Rust’s FFI is to define the external function that Rust will call from the shared library. This is done by using the extern keyword followed by the function signature, as shown below:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">extern</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"C"</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">my_function</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">arg1</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">arg2</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF">) -> </span><span style="color: #E5C07B">f64</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, extern “C” specifies the calling convention used by the function, which is the C calling convention. The function signature fn my_function(arg1: i32, arg2: f64) -> f64; specifies the name and argument types of the function that Rust will call from the shared library.</p>
<p>Step 2: Loading the Shared Library</p>
<p>The next step is to load the shared library at runtime using the dlopen function from the libc crate. The dlopen function takes the path to the shared library as an argument and returns a handle to the loaded library, as shown below:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ffi</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">CString</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">os</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">raw</span><span style="color: #ABB2BF">::c_void;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">libc</span><span style="color: #ABB2BF">::{c_double, c_int, dlclose, dlopen, dlsym};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">path</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">CString</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"/path/to/shared/library.so"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsafe</span><span style="color: #ABB2BF"> { </span><span style="color: #61AFEF">dlopen</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">path</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">as_ptr</span><span style="color: #ABB2BF">(), </span><span style="color: #E5C07B">libc</span><span style="color: #ABB2BF">::</span><span style="color: #D19A66">RTLD_NOW</span><span style="color: #ABB2BF">) };</span></span></code></pre>
<p>Here, <code>CString::new("/path/to/shared/library.so").unwrap()</code> creates a C-style string from the path to the shared library. The dlopen function loads the shared library specified by the path and returns a handle to the loaded library. The RTLD_NOW flag specifies that all symbols in the library should be resolved immediately.</p>
<p>Step 3: Resolving the function Symbol</p>
<p>Once the shared library is loaded, the next step is to resolve the function symbol using the dlsym function. The dlsym function takes the handle to the loaded library and the name of the symbol as arguments and returns a pointer to the symbol, as shown below:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">symbol_name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">CString</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"my_function"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">symbol</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsafe</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ptr</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">dlsym</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">symbol_name</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">as_ptr</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">mem</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">transmute</span><span style="color: #ABB2BF">::&#x3C;*</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">c_void</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">c_int</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">c_double</span><span style="color: #ABB2BF">) -> </span><span style="color: #E06C75">c_double</span><span style="color: #ABB2BF">>(</span><span style="color: #E06C75">ptr</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span></code></pre>
<p>Here, CString::new(“my_function”).unwrap() creates a C-style string from the name of the function symbol. The dlsym function resolves the function symbol specified by the name and returns a pointer to the symbol. The std::mem::transmute function converts the pointer to the symbol into a Rust function pointer with the same signature as the external function.</p>
<p>Step 4: Calling the External function</p>
<p>The final step is to call the external function using the Rust function pointer obtained from the dlsym function, as shown below:</p>
<p>let result = symbol(42, 3.14);
Here, symbol(42, 3.14) calls the external function with the arguments 42 and 3.14 and returns the result.</p>
<p>Step 5: Unloading the Shared Library</p>
<p>Once the external function is called, it is important to unload the shared library using the dlclose function to free the memory used by the library, as shown below:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">unsafe</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">dlclose</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">handle</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Here, dlclose(handle) unloads the shared library specified by the handle.</p>
<p>Conclusion</p>
<p>Dynamic linking is a powerful feature of Rust’s FFI that allows Rust code to call functions from shared</p>
<h2 id="introduction-to-borrowed-references">Introduction to Borrowed References</h2>
<p>Rust is a modern programming language that was designed with safety, concurrency, and performance in mind. One of the features that sets Rust apart from other programming languages is its borrowing rules, which ensure that programs are memory-safe and free from data races. In this article, we will explore Rust’s borrowing rules by building a program that uses a borrowed reference to a vector of integers to determine the average value of the integers.</p>
<p>Rust’s borrowing rules: Build a program that uses a borrowed reference to a vector of integers to determine the average value of the integers.</p>
<p>Let’s start by creating a new Rust project using the cargo tool. Open a terminal window and run the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">cargo</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">new</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">average</span></span></code></pre>
<p>This will create a new Rust project called average in a directory with the same name. Next, we will define a main function in the src/main.rs file that will prompt the user for a list of integers, compute the average of those integers, and print the result. Here’s what the main function should look like:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::io;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">nums</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">loop</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Enter a number (or </span><span style="color: #56B6C2">\"</span><span style="color: #98C379">done</span><span style="color: #56B6C2">\"</span><span style="color: #98C379"> to finish):"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">stdin</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">read_line</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to read line"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">trim</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"done"</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">trim</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">parse</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">) => </span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Invalid input, please try again"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">nums</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">nums</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">sum</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">nums</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">len</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">average</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF"> / </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">i32</span></span>
<span class="line"><span style="color: #ABB2BF">    } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #D19A66">0</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"The average is: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">average</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Let’s go over this code and explain how Rust’s borrowing rules work.</p>
<p>The main function starts by creating a new Vec called nums to store the user’s input. We use a loop to repeatedly prompt the user for input until they enter the string “done”. Each time through the loop, we read a line of input from the user using the read_line method of the io::stdin object. This method takes a mutable reference to a String as an argument, which allows it to store the user’s input in the string.</p>
<p>Next, we check if the input is equal to “done”. If it is, we break out of the loop. Otherwise, we parse the input as an i32 using the parse method of the String type. This method returns a Result that contains the parsed integer if successful, or an error if the input is not a valid integer. We use a match expression to handle these two cases. If parsing is successful, we add the integer to the nums vector using the push method. If parsing fails, we print an error message and continue with the next iteration of the loop.</p>
<p>After the loop finishes, we use the iter method of the Vec type to create an iterator over the elements of the vector. We then use the sum method of the Iterator trait to compute the sum of the integers. We also use the len method of the Vec type to get the number of elements in the vector.</p>
<p>To compute the average, we first check if the number of elements is greater than zero. If it is, we compute the average as the sum divided by the number of elements. We use the as keyword to convert the length to an i32, which allows us to perform integer division.</p>
<h1 id="chapter-10-rusts-projects">Chapter 10: Rust’s Projects</h1>
<p>Simple projects in Rust
Certainly! Here are a few simple project ideas in Rust:</p>
<ol>
<li>Command-line calculator: Write a command-line program that takes user input to perform basic arithmetic operations. You could use Rust’s built-in <code>std::io</code> library to read user input and perform calculations based on the input.</li>
<li>File explorer: Write a program that allows users to navigate a file system and perform basic file operations (e.g., create, delete, move files and directories). You could use Rust’s built-in <code>std::fs</code> library to perform file operations.</li>
<li>Password generator: Write a program that generates random passwords based on user input (e.g., password length, character set). You could use Rust’s built-in <code>std::random</code> library to generate random numbers and characters.</li>
<li>Guess the number: Write a simple guessing game where the computer generates a random number and the user tries to guess it. You could use Rust’s built-in <code>std::io</code> library to read user input and Rust’s <code>rand</code> crate to generate random numbers.</li>
<li>Web scraper: Write a program that scrapes data from a website and outputs it in a structured format (e.g., JSON). You could use Rust’s <code>reqwest</code> crate to make HTTP requests and Rust’s <code>scraper</code> crate to parse the HTML response.</li>
</ol>
<p>I hope these project ideas inspire you to start working on something fun and challenging in Rust!</p>
<p>Intermediate projects in Rust
Here are some intermediate project ideas in Rust:</p>
<ol>
<li>Build a command-line interface (CLI) tool: Rust has excellent support for creating CLI tools. You can build a tool to automate some repetitive tasks or to solve a specific problem. For example, you can create a CLI tool to convert a Markdown file to HTML or a tool to generate a random password.</li>
<li>Build a web scraper: Web scraping is a common task in the world of data science and analysis. You can build a Rust application that scrapes data from websites, saves it to a file or database, and processes it. You can use popular Rust libraries like <code>reqwest</code>, <code>select</code>, and <code>scraper</code> for this.</li>
<li>Build a game: Rust has excellent support for game development. You can use popular game engines like Amethyst or ggez to build a simple game. Alternatively, you can build a game from scratch using Rust’s built-in graphics and audio libraries.</li>
<li>Build a web app: Rust’s web frameworks like Rocket, Actix, and Warp make it easy to build fast and secure web applications. You can build a simple web app like a blog or a to-do list, or something more complex like a social network or an e-commerce platform.</li>
<li>Build a networked application: Rust’s support for networking and concurrency makes it an excellent choice for building networked applications. You can build a chat application, a multiplayer game, or a distributed computing platform.</li>
<li>Build a system tool: Rust’s low-level capabilities make it a great choice for building system tools like debuggers, performance profilers, or security scanners.</li>
</ol>
<p>These are just a few ideas to get you started. The Rust community is constantly creating new libraries and tools, so the possibilities are endless!</p>
<p>Advanced projects in Rust
I can suggest some project ideas that can be considered advanced in Rust:</p>
<ol>
<li>Implement a virtual machine in Rust</li>
<li>Develop a network file system using Rust’s networking libraries</li>
<li>Build a distributed key-value store with Raft consensus protocol in Rust</li>
<li>Create a custom database management system in Rust</li>
<li>Develop a high-performance web server with a custom TCP/IP stack in Rust</li>
<li>Build a parallel and distributed computing framework in Rust</li>
<li>Create a custom operating system kernel with Rust</li>
<li>Implement a blockchain in Rust</li>
<li>Develop a computer vision library in Rust</li>
<li>Create a cloud-native infrastructure with Rust</li>
</ol>
<p>These projects require advanced knowledge of Rust and its ecosystem and can help you develop your skills in Rust programming.</p>
<p>Sample project ideas per chapter
Sure! Here are some sample project ideas related to the topics covered in each chapter:</p>
<ol start="3">
<li>Hello, World! in Rust: Build a simple command-line program that greets the user by name, using input from the command line.</li>
<li>Rust’s basic syntax: Build a program that takes in two numbers from the user and performs basic arithmetic operations (addition, subtraction, multiplication, and division) on them.</li>
<li>Rust’s data types: Build a program that asks the user to enter a string and then counts the number of vowels and consonants in the string.</li>
<li>Rust’s if/else statements: Build a program that takes a user’s age as input and determines whether they are old enough to vote or not.</li>
<li>Rust’s loops: Build a program that takes a user’s input and prints out the Fibonacci sequence up to that number.</li>
<li>Rust’s match statements: Build a program that takes a user’s input (rock, paper, or scissors) and plays a game of rock-paper-scissors against the computer.</li>
<li>Rust’s error handling: Build a program that reads in a file and counts the number of words in the file, handling errors gracefully if the file cannot be read.</li>
<li>Rust’s ownership model: Build a program that demonstrates the ownership model by creating a data structure that contains a vector of integers and a vector of strings.</li>
<li>Rust’s borrowing rules: Build a program that uses a borrowed reference to a vector of integers to determine the average value of the integers.</li>
<li>Rust’s lifetimes: Build a program that demonstrates the use of lifetimes by creating a data structure that contains a vector of strings and a vector of references to those strings.</li>
<li>Rust’s smart pointers: Build a program that demonstrates the use of smart pointers by creating a data structure that contains a vector of integers and a reference-counted pointer to that vector.</li>
<li>Rust’s threads: Build a program that uses threads to perform a computationally-intensive task (such as calculating the value of pi) and returns the result to the user.</li>
<li>Rust’s message passing: Build a program that uses message passing to implement a producer-consumer pattern, where the producer generates random numbers and the consumer calculates the sum of those numbers.</li>
<li>Rust’s synchronization primitives: Build a program that uses mutexes to synchronize access to a shared data structure (such as a vector of integers) between multiple threads.</li>
<li>Rust’s standard library: Build a program that uses Rust’s standard library to perform operations such as sorting and searching on a vector of integers.</li>
<li>Rust’s collections: Build a program that uses Rust’s collections (such as HashMap and HashSet) to perform operations such as counting the frequency of words in a text file.</li>
<li>Rust’s I/O: Build a program that reads in a CSV file and performs operations such as sorting and filtering on the data.</li>
<li>Rust’s networking: Build a simple web server that responds to HTTP requests with a “Hello, World!” message.</li>
<li>Rust’s file handling: Build a program that reads in a file containing JSON data and parses the data into a data structure.</li>
<li>Rust’s macros: Build a program that demonstrates the use of macros by creating a custom assert macro that prints out the values being compared if the assertion fails.</li>
<li>Rust’s unsafe code: Build a program that demonstrates the use of unsafe code by performing low-level operations such as pointer arithmetic.</li>
<li>Rust’s FFI: Build a program that interfaces with a C library using Rust’s FFI capabilities.</li>
</ol>
<h3 id="sample-implementation-for-select-points">Sample Implementation for select points</h3>
<ol start="11">
<li>Rust’s borrowing rules: Build a program that uses a borrowed reference to a vector of integers to determine the average value of the integers.</li>
</ol>
<p>Let’s start by creating a new Rust project using the cargo tool. Open a terminal window and run the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">cargo</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">new</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">average</span></span></code></pre>
<p>This will create a new Rust project called average in a directory with the same name. Next, we will define a main function in the src/main.rs file that will prompt the user for a list of integers, compute the average of those integers, and print the result. Here’s what the main function should look like:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::io;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">nums</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Vec</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">loop</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">String</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Enter a number (or </span><span style="color: #56B6C2">\"</span><span style="color: #98C379">done</span><span style="color: #56B6C2">\"</span><span style="color: #98C379"> to finish):"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">stdin</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">read_line</span><span style="color: #ABB2BF">(&#x26;</span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            .</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Failed to read line"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">trim</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"done"</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">break</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">match</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">trim</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">parse</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Ok</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">) => </span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">Err</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">_</span><span style="color: #ABB2BF">) => {</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Invalid input, please try again"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            }</span></span>
<span class="line"><span style="color: #ABB2BF">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">nums</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">num</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">i32</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">nums</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">sum</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">nums</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">len</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">average</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">></span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF"> / </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">i32</span></span>
<span class="line"><span style="color: #ABB2BF">    } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #D19A66">0</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"The average is: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">average</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Let’s go over this code and explain how Rust’s borrowing rules work.</p>
<p>The main function starts by creating a new Vec called nums to store the user’s input. We use a loop to repeatedly prompt the user for input until they enter the string “done”. Each time through the loop, we read a line of input from the user using the read_line method of the io::stdin object. This method takes a mutable reference to a String as an argument, which allows it to store the user’s input in the string.</p>
<p>Next, we check if the input is equal to “done”. If it is, we break out of the loop. Otherwise, we parse the input as an i32 using the parse method of the String type. This method returns a Result that contains the parsed integer if successful, or an error if the input is not a valid integer. We use a match expression to handle these two cases. If parsing is successful, we add the integer to the nums vector using the push method. If parsing fails, we print an error message and continue with the next iteration of the loop.</p>
<p>After the loop finishes, we use the iter method of the Vec type to create an iterator over the elements of the vector. We then use the sum method of the Iterator trait to compute the sum of the integers. We also use the len method of the Vec type to get the number of elements in the vector.</p>
<p>To compute the average, we first check if the number of elements is greater than zero. If it is, we compute the average as the sum divided by the number of elements. We use the as keyword to convert the length to an i32, which allows us to perform integer division.</p>
<ol start="18">
<li>Rust’s collections: Build a program that uses Rust’s collections (such as HashMap and HashSet) to perform operations such as counting the frequency of words in a text file.</li>
</ol>
<p>Rust’s collections provide a powerful set of data structures for working with complex data in Rust. In this article, we will build a program that uses Rust’s collections, specifically HashMap and HashSet, to perform operations such as counting the frequency of words in a text file.</p>
<p>First, let’s start with a simple text file that we want to analyze. We will use the following text file as an example:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">the quick brown fox jumps over the lazy dog</span></span></code></pre>
<p>Our goal is to count the frequency of each word in this text file.</p>
<p>To do this, we will use Rust’s HashMap collection, which provides a way to store key-value pairs. In this case, the keys will be the words in the text file and the values will be the frequency of each word.</p>
<p>Here’s the code:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">collections</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">fs</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">io</span><span style="color: #ABB2BF">::{</span><span style="color: #E5C07B">BufRead</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">BufReader</span><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">File</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"text.txt"</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">expect</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"Unable to open file"</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">BufReader</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">mut</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">word_count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HashMap</span><span style="color: #ABB2BF">::</span><span style="color: #61AFEF">new</span><span style="color: #ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">line</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">reader</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">lines</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">word</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">line</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">unwrap</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">split_whitespace</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">word_count</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entry</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">word</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">to_string</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">or_insert</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">            *</span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">word</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">word_count</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">iter</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"{}: {}"</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">word</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Let’s go through the code line by line to understand what’s happening.</p>
<p>First, we import the HashMap collection from the std::collections module, as well as the File and BufRead types from the std::fs and std::io modules, respectively.</p>
<p>Next, we open the text file using the File::open function and create a BufReader to read the file line by line.</p>
<p>We create a new HashMap called word_count to store the word frequencies.</p>
<p>We then iterate over each line in the text file using the lines method of the BufReader. For each line, we iterate over each word using the split_whitespace method. We then use the entry method of the HashMap to either retrieve the frequency of the word or insert a new entry with a frequency of 0. We then increment the frequency count of the word.</p>
<p>Finally, we iterate over the word_count HashMap using the iter method and print out the word and its frequency.</p>
<p>When we run this program with the text file, we get the following output:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #abb2bf">brown: 1</span></span>
<span class="line"><span style="color: #abb2bf">jumps: 1</span></span>
<span class="line"><span style="color: #abb2bf">over: 1</span></span>
<span class="line"><span style="color: #abb2bf">fox: 1</span></span>
<span class="line"><span style="color: #abb2bf">dog: 1</span></span>
<span class="line"><span style="color: #abb2bf">lazy: 1</span></span>
<span class="line"><span style="color: #abb2bf">quick: 1</span></span>
<span class="line"><span style="color: #abb2bf">the: 2</span></span></code></pre>
<p>This program demonstrates the power and simplicity of Rust’s collections. By using a HashMap, we are able to efficiently store and manipulate the word frequencies, making it easy to perform complex data analysis tasks such as counting the frequency of words in a text file.</p>
<ol start="24">
<li>Rust’s FFI: Build a program that interfaces with a C library using Rust’s FFI capabilities.</li>
</ol>
<p>Rust’s Foreign Function Interface (FFI) allows Rust code to interact with code written in other programming languages, such as C. In this article, we will explore Rust’s FFI capabilities by building a program that interfaces with a C library using Rust’s FFI. Specifically, we will use Rust to call a C library function that computes the sum of two integers.</p>
<p>Let’s start by creating a new Rust project using the cargo tool. Open a terminal window and run the following command:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">cargo</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">new</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ffi</span></span></code></pre>
<p>This will create a new Rust project called ffi in a directory with the same name. Next, we will create a C source file called sum.c that defines a function that computes the sum of two integers. Here’s what sum.c should look like:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #ABB2BF">#</span><span style="color: #E06C75">include</span><span style="color: #ABB2BF"> &#x3C;</span><span style="color: #E06C75">stdio</span><span style="color: #ABB2BF">.h></span></span>
<span class="line"></span>
<span class="line"><span style="color: #E06C75">int</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sum</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">int</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> + </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>This code defines a simple function called sum that takes two integer arguments and returns their sum. We will use Rust to call this function using FFI.</p>
<p>Next, we need to create a Rust source file that will use FFI to call the sum function. Create a new file called src/main.rs and add the following code:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">os</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">raw</span><span style="color: #ABB2BF">::c_int;</span></span>
<span class="line"><span style="color: #C678DD">use</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">std</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">ffi</span><span style="color: #ABB2BF">::</span><span style="color: #E5C07B">CString</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">#[link(name </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"sum"</span><span style="color: #ABB2BF">)]</span></span>
<span class="line"><span style="color: #C678DD">extern</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">"C"</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">sum</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">c_int</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">c_int</span><span style="color: #ABB2BF">) -> </span><span style="color: #E06C75">c_int</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">fn</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">main</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">unsafe</span><span style="color: #ABB2BF"> { </span><span style="color: #61AFEF">sum</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">) };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">println!</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">"The sum of {} and {} is {}."</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre>
<p>Let’s go over this code and explain how Rust’s FFI capabilities work.</p>
<p>The use statements at the beginning of the file import the c_int type from the std::os::raw module and the CString type from the std::ffi module. The c_int type is used to represent C int types in Rust, and the CString type is used to create null-terminated C-style strings from Rust strings.</p>
<p>Next, we use the #[link] attribute to link to the sum C library. The name argument specifies the name of the library, which is sum in this case. The extern “C” block declares the sum function as an external C function that takes two c_int arguments and returns a c_int result.</p>
<p>Inside the main function, we define two variables x and y that represent the integers to be added. We then call the sum function using the unsafe keyword, which is required when calling external functions using FFI. The result of the function call is stored in the result variable.</p>
<p>Finally, we use the println! macro to print the result of the computation.</p>
<p>To compile and run the program, we need to first compile the sum.c file into a shared library that can be linked to by Rust. Open a terminal window and run the following commands:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #61AFEF">gcc</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-c</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-fPIC</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">sum.c</span></span>
<span class="line"><span style="color: #61AFEF">gcc</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-shared</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-o</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">libsum.so</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">sum.o</span></span></code></pre>
<p>The first command compiles sum.c into an object file (sum.o) with position-independent code (-fPIC). The second command links the object file into a shared library (libsum.so) that can be used by Rust.</p>
<p>Next, we can build and run the Rust program using the cargo tool. Open a terminal window and run the following commands:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #E06C75">cargo</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">build</span></span>
<span class="line"><span style="color: #E06C75">cargo</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">run</span></span></code></pre>
<p>The output of the program should be:</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color: #282c34; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color: #61AFEF">The</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">sum</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">of</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">and</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">is</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #98C379">.</span></span></code></pre>
<p>This demonstrates how Rust can use FFI to call a C library function.</p>
<p>Now let’s examine the code in more detail.</p>
<p>The #[link] attribute is used to link to a C library. In this case, we link to the sum library, which is defined in the sum.c file. The extern “C” block declares the sum function as an external C function that takes two c_int arguments and returns a c_int result. The c_int type is defined in the std::os::raw module and represents a C int type.</p>
<p>The main function defines two integer variables x and y. The unsafe keyword is used to call the sum function, which is an external C function. The result of the function call is stored in the result variable.</p>
<p>It’s important to note that the unsafe keyword is used because FFI involves calling code that is outside the control of the Rust compiler. This means that the Rust compiler cannot ensure the safety of the code at compile time, so it requires the programmer to explicitly mark FFI calls as unsafe.</p>
<p>The CString type is used to create a null-terminated C-style string from a Rust string. This is necessary because C functions often expect null-terminated strings as arguments.</p>
<p>Overall, Rust’s FFI capabilities provide a powerful way to interface with C and other programming languages. By using FFI, Rust programs can leverage existing C libraries and take advantage of the performance benefits of low-level languages. While FFI requires the use of unsafe code, Rust’s strong type system and memory safety guarantees help to minimize the risk of bugs and security vulnerabilities.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In conclusion, Rust is a modern programming language that offers a unique combination of safety, performance, and productivity. Its syntax is concise and expressive, making it easy to write clean and maintainable code. Rust’s ownership and borrowing system ensures that memory safety is guaranteed at compile time, making it possible to write high-performance software without sacrificing safety.</p>
<p>Throughout this introductory Rust book, we covered the fundamentals of the language, including basic syntax, ownership and borrowing, control flow, functions, and data types. We also explored some of Rust’s advanced features, such as error handling, traits, and concurrency.</p>
<p>We also worked through several hands-on projects, including building a simple command-line tool, a program that uses Rust’s FFI capabilities to interface with a C library, and a program that uses Rust’s collections to perform operations such as counting the frequency of words in a text file. These projects helped to reinforce the concepts covered in the book and provided practical experience with real-world Rust development.</p>
<p>Overall, Rust is a powerful language that is well-suited to a wide range of programming tasks, from low-level systems programming to high-level web development. Its safety guarantees and performance make it an excellent choice for mission-critical software where reliability and efficiency are paramount. Whether you are a seasoned developer or just starting out, Rust is a language that is definitely worth exploring.</p>
            </article>
          </div>
          <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var c;{let d={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,r)=>{if(t===""||!Array.isArray(r))return r;let[e,n]=r;return e in d?d[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(c=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{var l;if(!this.hydrator||!this.isConnected||(l=this.parentElement)!=null&&l.closest("astro-island[ssr]"))return;let r=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(let s of n){let i=s.closest(this.tagName);!i||!i.isSameNode(this)||(e[s.getAttribute("data-astro-template")||"default"]=s.innerHTML,s.remove())}for(let s of r){let i=s.closest(this.tagName);!i||!i.isSameNode(this)||(e[s.getAttribute("name")||"default"]=s.innerHTML)}let a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((r,e)=>{e.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let r=this.getAttribute("before-hydration-url");r&&await import(r),this.start()}start(){let r=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{let n=this.getAttribute("renderer-url"),[a,{default:l}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),s=this.getAttribute("component-export")||"default";if(!s.includes("."))this.Component=a[s];else{this.Component=a;for(let i of s.split("."))this.Component=this.Component[i]}return this.hydrator=l,this.hydrate},r,this)}attributeChangedCallback(){this.hydrate()}},c.observedAttributes=["props"],c))}})();</script><astro-island uid="ZbKvuO" prefix="r0" component-url="/_astro/Disqus.101366bd.js" component-export="default" renderer-url="/_astro/client.663bf61e.js" props="{}" ssr="" client="load" opts="{&quot;name&quot;:&quot;Disqus&quot;,&quot;value&quot;:true}" await-children=""><div class="row mt-16 justify-center "><div id="disqus_thread"></div></div></astro-island>
        </div>
      </div>
    </div>
  </section>

    </main>
    <footer class="footer bg-[#F1F1F1]">
  <div class="container">
    <div class="gx-5 row pb-10 pt-[52px]">
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <a href="/" class="navbar-brand block">
  <img alt="Pinwheel Astro" style="height:31px;width:147px" width="294" height="62" src="/_astro/logo_ZThIBR.png" loading="lazy" decoding="async">
</a>
        <p class="mt-6">
          Trying to make the world a better place.
        </p>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Socials</h6>

        <ul class="social-icons mt-4 lg:mt-6">
  <li class="inline-block">
        <a aria-label="facebook" href="https://facebook.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M480 257.35c0-123.7-100.3-224-224-224s-224 100.3-224 224c0 111.8 81.9 204.47 189 221.29V322.12h-56.89v-64.77H221V208c0-56.13 33.45-87.16 84.61-87.16 24.51 0 50.15 4.38 50.15 4.38v55.13H327.5c-27.81 0-36.51 17.26-36.51 35v42h62.12l-9.92 64.77H291v156.54c107.1-16.81 189-109.48 189-221.31z"></path></svg>
        </a>
      </li>
  <li class="inline-block">
        <a aria-label="twitter" href="https://twitter.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M496 109.5a201.8 201.8 0 01-56.55 15.3 97.51 97.51 0 0043.33-53.6 197.74 197.74 0 01-62.56 23.5A99.14 99.14 0 00348.31 64c-54.42 0-98.46 43.4-98.46 96.9a93.21 93.21 0 002.54 22.1 280.7 280.7 0 01-203-101.3A95.69 95.69 0 0036 130.4c0 33.6 17.53 63.3 44 80.7A97.5 97.5 0 0135.22 199v1.2c0 47 34 86.1 79 95a100.76 100.76 0 01-25.94 3.4 94.38 94.38 0 01-18.51-1.8c12.51 38.5 48.92 66.5 92.05 67.3A199.59 199.59 0 0139.5 405.6a203 203 0 01-23.5-1.4A278.68 278.68 0 00166.74 448c181.36 0 280.44-147.7 280.44-275.8 0-4.2-.11-8.4-.31-12.5A198.48 198.48 0 00496 109.5z"></path></svg>
        </a>
      </li>
  
  
  
  <li class="inline-block">
        <a aria-label="linkedin" href="https://linkedin.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M444.17 32H70.28C49.85 32 32 46.7 32 66.89v374.72C32 461.91 49.85 480 70.28 480h373.78c20.54 0 35.94-18.21 35.94-38.39V66.89C480.12 46.7 464.6 32 444.17 32zm-273.3 373.43h-64.18V205.88h64.18zM141 175.54h-.46c-20.54 0-33.84-15.29-33.84-34.43 0-19.49 13.65-34.42 34.65-34.42s33.85 14.82 34.31 34.42c-.01 19.14-13.31 34.43-34.66 34.43zm264.43 229.89h-64.18V296.32c0-26.14-9.34-44-32.56-44-17.74 0-28.24 12-32.91 23.69-1.75 4.2-2.22 9.92-2.22 15.76v113.66h-64.18V205.88h64.18v27.77c9.34-13.3 23.93-32.44 57.88-32.44 42.13 0 74 27.77 74 87.64z"></path></svg>
        </a>
      </li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li class="inline-block">
        <a aria-label="skype" href="https://skype.com/" target="_blank" rel="noopener noreferrer nofollow">
          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M467.16 303.6a205.69 205.69 0 004.9-45.15c0-116.32-95.69-210.7-213.79-210.7a221.83 221.83 0 00-36.52 3A123.58 123.58 0 00155.93 32C87.55 32 32 86.72 32 154.15A119.56 119.56 0 0049 216a211.16 211.16 0 00-4.32 42.35c0 116.44 95.69 210.7 213.67 210.7a214 214 0 0039.09-3.5A125.45 125.45 0 00356.07 480C424.57 480 480 425.28 480 357.85a118 118 0 00-12.84-54.25zM368 359c-9.92 13.76-24.51 24.73-43.41 32.43S283.36 403 257.69 403c-30.69 0-56.36-5.37-76.55-15.87a101 101 0 01-35.24-30.8c-9.11-12.83-13.66-25.66-13.66-38 0-7.7 3-14.35 8.87-19.95 5.84-5.37 13.42-8.17 22.29-8.17 7.35 0 13.65 2.1 18.79 6.42 4.9 4.08 9.1 10.15 12.48 18.08A108.09 108.09 0 00207 336.15q6.32 8.22 17.86 13.65c7.82 3.62 18.2 5.48 31 5.48 17.62 0 32.09-3.73 42.94-11.08 10.74-7.12 15.88-15.75 15.88-26.25 0-8.28-2.69-14.82-8.29-19.95-5.83-5.37-13.42-9.57-22.87-12.37-9.69-3-22.87-6.18-39.21-9.56-22.17-4.67-41-10.27-56-16.57-15.28-6.42-27.65-15.4-36.76-26.48-9.22-11.32-13.77-25.55-13.77-42.24a67.86 67.86 0 0114.47-42.58c9.57-12.25 23.46-21.82 41.55-28.35 17.74-6.53 38.86-9.8 62.66-9.8 19.14 0 35.83 2.22 49.83 6.42s25.91 10.15 35.36 17.38 16.34 14.93 20.77 23 6.66 16.22 6.66 24c0 7.46-2.92 14.35-8.76 20.3a29.65 29.65 0 01-21.94 9.1c-7.93 0-14.12-1.87-18.43-5.6-4-3.5-8.17-8.87-12.72-16.69-5.37-9.91-11.79-17.85-19.14-23.45-7.24-5.36-19.14-8.16-35.71-8.16-15.29 0-27.77 3-37 9-8.87 5.72-13.19 12.37-13.19 20.18a18.26 18.26 0 004.32 12.25 38.13 38.13 0 0012.72 9.57 90.14 90.14 0 0017.15 6.53c6 1.64 15.87 4.09 29.53 7.12 17.38 3.62 33.25 7.82 47.26 12.13 14.24 4.55 26.49 10 36.52 16.45a72.93 72.93 0 0124.16 25.09c5.72 10 8.64 22.63 8.64 37.1A75.09 75.09 0 01368 359z"></path></svg>
        </a>
      </li>
  
  
  
  
  
</ul>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Quick Links</h6>
        <ul>
          <li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/about">
                  About
                </a>
              </li><li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/contact">
                  Contact
                </a>
              </li><li class="mb-4">
                <a class="hover:text-primary hover:underline " href="/elements">
                  Elements
                </a>
              </li><li class="mb-0">
                <a class="hover:text-primary hover:underline " href="/changelog">
                  Changelog
                </a>
              </li>
        </ul>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Location & Contact</h6>
        <ul>
          <li class="mb-2">Somewhere in Canada</li>
          <li class="mb-2">
            <a class="mb-2 hover:text-primary" href="mailto:colourfulmerchtik@gmail.com">colourfulmerchtik@gmail.com</a>
          </li>
          <li>
            <a class="hover:text-primary hover:underline" href="tel:+704-555-0127">+704-555-0127</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container max-w-[1440px]">
    <div class="footer-copyright mx-auto border-t border-border pb-10 pt-7 text-center">
      <p class="content text-text">Copyright © 2023</p>
    </div>
  </div>
</footer>
  </body></html>